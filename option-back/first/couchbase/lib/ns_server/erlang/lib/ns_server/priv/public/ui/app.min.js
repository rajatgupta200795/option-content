(function(){"use strict";angular.module('app',['mnAdmin','mnAuth','mnWizard','mnHttp','mnExceptionReporter','ui.bootstrap','mnEnv','mnFilters']).run(appRun);function appRun($state,$urlRouter,$exceptionHandler,mnPools,$window,$rootScope,$location,$http,mnPrettyVersionFilter){$rootScope.$on("$locationChangeStart",function(event,newUrl){if($location.url().indexOf("#")===0){$location.replace();}});angular.element($window).on("storage",function(storage){if(storage.key==="mnLogIn"){$urlRouter.sync();}});var originalOnerror=$window.onerror;$window.onerror=onError;function onError(message,url,lineNumber,columnNumber,exception){$exceptionHandler({message:message,fileName:url,lineNumber:lineNumber,columnNumber:columnNumber,stack:exception&&exception.stack});originalOnerror&&originalOnerror.apply($window,Array.prototype.slice.call(arguments));}
$http({method:"GET",url:"/versions"}).then(function(resp){var pools=resp.data;var version=mnPrettyVersionFilter(pools.implementationVersion);$rootScope.mnTitle="Couchbase Server";});mnPools.get().then(function(pools){if(!pools.isInitialized){return $state.go('app.wizard.welcome');}},function(resp){switch(resp.status){case 401:return $state.go('app.auth',null,{location:false});}}).then(function(){$urlRouter.listen();$urlRouter.sync();});$state.defaultErrorHandler(function(error){error&&$exceptionHandler(error);});}})();(function(){"use strict";angular.module('app').config(appConfig);angular.module('ui.select').run(function($animate){var origEnabled=$animate.enabled
$animate.enabled=function(elem){if(arguments.length!==1){return origEnabled.apply($animate,arguments);}else if(origEnabled(elem)){return(/enable-ng-animation/).test(elem.classNames);}
return false}});function appConfig($httpProvider,$stateProvider,$urlRouterProvider,$uibModalProvider,$transitionsProvider,$uibTooltipProvider,$animateProvider,$qProvider,$sceDelegateProvider){$httpProvider.defaults.headers.common['invalid-auth-response']='on';$httpProvider.defaults.headers.common['Cache-Control']='no-cache';$httpProvider.defaults.headers.common['Pragma']='no-cache';$httpProvider.defaults.headers.common['ns-server-ui']='yes';$animateProvider.classNameFilter(/enable-ng-animation/);$sceDelegateProvider.resourceUrlWhitelist(['self','https://ph.couchbase.net/**']);$qProvider.errorOnUnhandledRejections(false);$uibTooltipProvider.options({placement:"auto right",trigger:"outsideClick"});$urlRouterProvider.rule(function($injector,$location){if($location.url().indexOf("#")===0){return $location.hash();}});$urlRouterProvider.otherwise(function($injector,$location){$injector.get("mnPools").get().then(function(pools){if(pools.isInitialized){return $injector.get("$state").go("app.admin.overview.statistics");}});return true;});$stateProvider.state('app',{url:'?{enableInternalSettings:bool}&{disablePoorMansAlerts:bool}',params:{enableInternalSettings:{value:null,squash:true},disablePoorMansAlerts:{value:null,squash:true}},abstract:true,resolve:{env:function(mnEnv,$rootScope){return mnEnv.loadEnv().then(function(env){$rootScope.ENV=env;});}},template:'<div ui-view="" class="root-container"></div>'+'<div ng-show="mnGlobalSpinnerFlag" class="global-spinner"></div>'});$transitionsProvider.onFinish({from:"app.admin.**",to:"app.admin.**"},function(trans){var $rootScope=trans.injector().get('$rootScope');$rootScope.showMainSpinner=false;});$transitionsProvider.onError({from:"app.admin.**",to:"app.admin.**"},function(trans){var $rootScope=trans.injector().get('$rootScope');$rootScope.showMainSpinner=false;});$transitionsProvider.onBefore({from:"app.admin.**",to:"app.admin.**"},function(trans){var mnPools=trans.injector().get('mnPools');var $rootScope=trans.injector().get('$rootScope');var mnPendingQueryKeeper=trans.injector().get('mnPendingQueryKeeper');var $uibModalStack=trans.injector().get('$uibModalStack');var isModalOpen=!!$uibModalStack.getTop();var toName=trans.to().name;var fromName=trans.from().name;if($rootScope.mnGlobalSpinnerFlag){return false;}
if(!isModalOpen&&toName.indexOf(fromName)===-1&&fromName.indexOf(toName)===-1){mnPendingQueryKeeper.cancelTabsSpecificQueries();$rootScope.showMainSpinner=true;}
return!isModalOpen;});$transitionsProvider.onBefore({from:"app.auth",to:"app.admin.**"},function(trans,$state){var mnPools=trans.injector().get('mnPools');return mnPools.get().then(function(pools){return pools.isInitialized?true:$state.target("app.wizard.welcome");},function(resp){switch(resp.status){case 401:return false;}});});$transitionsProvider.onBefore({from:"app.wizard.**",to:"app.admin.**"},function(trans){var mnPools=trans.injector().get('mnPools');return mnPools.getFresh().then(function(pools){return pools.isInitialized;});});$transitionsProvider.onBefore({from:"app.wizard.**",to:"app.auth"},function(trans){var mnPools=trans.injector().get('mnPools');return mnPools.get().then(function(pools){return pools.isInitialized;},function(resp){switch(resp.status){case 401:return true;}});});$transitionsProvider.onBefore({from:"app.admin.**",to:"app.auth"},function(trans){var mnPools=trans.injector().get('mnPools');return mnPools.get().then(function(){return false;},function(resp){switch(resp.status){case 401:return true;}});});$transitionsProvider.onStart({to:function(state){return state.data&&state.data.permissions;}},function(trans){var mnPermissions=trans.injector().get('mnPermissions');var $parse=trans.injector().get('$parse');return mnPermissions.check().then(function(){if(!!$parse(trans.to().data.permissions)(mnPermissions.export)){return true;}else{return trans.router.stateService.target('app.admin.overview.statistics');}});});$transitionsProvider.onStart({to:function(state){return state.data&&state.data.compat;}},function(trans){var mnPoolDefault=trans.injector().get('mnPoolDefault');var $parse=trans.injector().get('$parse');return mnPoolDefault.get().then(function(){if(!!$parse(trans.to().data.compat)(mnPoolDefault.export.compat)){return true;}else{return trans.router.stateService.target('app.admin.overview.statistics');}});});$transitionsProvider.onStart({to:function(state){return state.data&&state.data.enterprise;}},function(trans){var mnPools=trans.injector().get('mnPools');return mnPools.get().then(function(pools){if(pools.isEnterprise){return true;}else{return trans.router.stateService.target('app.admin.overview.statistics');}});});$urlRouterProvider.deferIntercept();}})();(function(){"use strict";angular.module('mnStoreService',["mnHelper"]).factory('mnStoreService',mnStoreServiceFactory);function mnStoreServiceFactory(mnHelper){var db={};var stores={};var storeService={createStore:createStore,store:store};Store.prototype.get=get;Store.prototype.add=add;Store.prototype.put=put;Store.prototype.delete=_delete;Store.prototype.deleteItem=deleteItem;Store.prototype.getByIncludes=getByIncludes;Store.prototype.share=share;Store.prototype.copy=copy;Store.prototype.last=last;Store.prototype.clear=clear;return storeService;function store(name){return stores[name];}
function createStore(name,options){stores[name]=new Store(name,options);}
function Store(name,options){this.keyPath=options.keyPath;this.name=name;if(options.fill){if(db[this.name]){this.clear();Array.prototype.push.apply(db[this.name],options.fill);}else{db[this.name]=options.fill;}}else{db[this.name]=[];}}
function last(){return db[this.name][db[this.name].length-1];}
function clear(){db[this.name].splice(0,db[this.name].length);}
function share(){return db[this.name];}
function copy(){return db[this.name].slice();}
function put(item){var copyTo=this.get(item[this.keyPath]);Object.keys(item).forEach(function(key){copyTo[key]=item[key];});}
function add(item){item=Object.assign({},item);item[this.keyPath]=mnHelper.generateID();db[this.name].push(item);return item;}
function _delete(value){db[this.name].splice(db[this.name].findIndex(function(item){return item[this.keyPath]==value;}.bind(this)),1);}
function deleteItem(item){db[this.name].splice(db[this.name].indexOf(item),1);}
function get(value){return db[this.name].find(function(item){return item[this.keyPath]==value;}.bind(this));}
function getByIncludes(value,row){return db[this.name].find(function(item){return item[row].includes(value);}.bind(this));}}})();(function(){"use strict";angular.module('mnAdmin',['mnAlertsService','mnTasksDetails','mnAuthService','mnHelper','mnPromiseHelper','mnBuckets','mnAnalytics','mnStatisticsNew','mnLogs','mnOverview','mnIndexes','mnServers','mnGroups','mnDocuments','mnSettings','mnXDCR','mnSecurity','mnPoll','mnLaunchpad','mnFilters','mnPluggableUiRegistry','mnInternalSettings','mnLostConnection','ui.router','ui.bootstrap','mnPoorMansAlerts','mnPermissions','mnMemoryQuotaService','mnElementCrane','ngAnimate','mnDragAndDrop','mnResetPasswordDialog','mnResetPasswordDialogService','mnSessionService','mnClusterConfigurationService']).config(mnAdminConfig);function mnAdminConfig($stateProvider,$urlRouterProvider,$urlMatcherFactoryProvider,mnHelperProvider){function valToString(val){return val!=null?val.toString():val;}
$urlMatcherFactoryProvider.type("string",{encode:valToString,decode:valToString,is:function(val){return(/[^/]*/).test(val);}});$stateProvider.state('app.admin',{url:"?scenarioBucket&scenarioZoom&scenario",abstract:true,params:{scenarioBucket:{value:null},scenario:{value:null,dynamic:true},scenarioZoom:{value:"minute"}},resolve:{poolDefault:function(mnPoolDefault){return mnPoolDefault.getFresh();},pools:function(mnPools){return mnPools.get();},permissions:function(mnPermissions){return mnPermissions.check();},whoami:function(mnAuthService){return mnAuthService.whoami();}},views:{"":{controller:'mnAdminController as adminCtl',templateUrl:'app/mn_admin/mn_admin.html'},"lostConnection@app.admin":{templateUrl:'app/mn_admin/mn_lost_connection/mn_lost_connection.html',controller:'mnLostConnectionController as lostConnCtl'}}}).state('app.admin.overview',{url:'/overview',abstract:true,views:{"main@app.admin":{controller:'mnOverviewController as overviewCtl',templateUrl:'app/mn_admin/mn_overview/mn_overview.html'}},data:{title:"Dashboard"}}).state('app.admin.buckets',{url:'/buckets?openedBucket',params:{openedBucket:{array:true,dynamic:true}},views:{"main@app.admin":{controller:'mnBucketsController as bucketsCtl',templateUrl:'app/mn_admin/mn_buckets/mn_buckets.html'},"details@app.admin.buckets":{templateUrl:'app/mn_admin/mn_buckets/details/mn_buckets_details.html',controller:'mnBucketsDetailsController as bucketsDetailsCtl'},"item@app.admin.buckets":{templateUrl:'app/mn_admin/mn_buckets/list/item/mn_buckets_list_item.html',controller:'mnBucketsListItemController as bucketsItemCtl'}},data:{title:"Buckets",permissions:"cluster.bucket['.'].settings.read"}}).state('app.admin.servers',{abstract:true,url:'/servers',views:{"main@app.admin":{controller:'mnServersController as serversCtl',templateUrl:'app/mn_admin/mn_servers/mn_servers.html'}},data:{title:"Servers"}}).state('app.admin.servers.list',{url:'/list?openedServers',params:{openedServers:{array:true,dynamic:true}},views:{"":{templateUrl:'app/mn_admin/mn_servers/list/mn_servers_list.html'},"details@app.admin.servers.list":{templateUrl:'app/mn_admin/mn_servers/details/mn_servers_list_item_details.html',controller:'mnServersListItemDetailsController as serversListItemDetailsCtl'},"item@app.admin.servers.list":{templateUrl:'app/mn_admin/mn_servers/list/item/mn_servers_list_item.html',controller:'mnServersListItemController as serversItemCtl'}}}).state('app.admin.replications',{url:'/replications',views:{"main@app.admin":{templateUrl:'app/mn_admin/mn_xdcr/mn_xdcr.html',controller:'mnXDCRController as xdcrCtl'}},params:{xdcrDetails:{array:true,dynamic:true}},data:{permissions:"cluster.tasks.read",title:"XDCR Replications"}}).state('app.admin.logs',{url:'/logs',abstract:true,views:{"main@app.admin":{templateUrl:'app/mn_admin/mn_logs/mn_logs.html',controller:'mnLogsController as logsCtl'}},data:{title:"Logs",permissions:"cluster.logs.read"}}).state('app.admin.logs.list',{url:'',controller:'mnLogsListController as logsListCtl',templateUrl:'app/mn_admin/mn_logs/list/mn_logs_list.html'}).state('app.admin.logs.collectInfo',{url:'/collectInfo',abstract:true,controller:'mnLogsCollectInfoController as logsCollectInfoCtl',templateUrl:'app/mn_admin/mn_logs/collect_info/mn_logs_collect_info.html',data:{permissions:"cluster.admin.logs.read",title:"Collect Information"}}).state('app.admin.logs.collectInfo.result',{url:'/result',templateUrl:'app/mn_admin/mn_logs/collect_info/mn_logs_collect_info_result.html'}).state('app.admin.logs.collectInfo.form',{url:'/form',templateUrl:'app/mn_admin/mn_logs/collect_info/mn_logs_collect_info_form.html'}).state('app.admin.statistics_overview',{url:'/stats_overview?statsNode&statsBucket&statsZoom',views:{"main@app.admin":{controller:'mnStatisticsOverviewController as statisticsOverviewCtl',templateUrl:'app/mn_admin/mn_statistics/overview_page/mn_statistics_overview.html',}},data:{title:"Statistics Overview"}}).state('app.admin.overview.statistics',{url:'/stats?statsHostname',controller:'mnStatisticsNewController as statisticsNewCtl',templateUrl:'app/mn_admin/mn_statistics/mn_statistics.html',params:{statsHostname:"all"},redirectTo:function(trans,permissions){var mnPermissionsService=trans.injector().get("mnPermissions");var params=_.clone(trans.params(),true);return mnPermissionsService.check().then(function(permissions){var statsRead=permissions.bucketNames['.stats!read'];var state={state:"app.admin.overview.statistics",params:params};if(!params.scenarioBucket&&statsRead&&statsRead[0]){state.params.scenarioBucket=statsRead[0];return state;}
if(params.scenarioBucket&&statsRead&&statsRead.indexOf(params.scenarioBucket)<0){state.params.scenarioBucket=statsRead[0];return state;}
if(params.scenarioBucket&&(!statsRead||!statsRead[0])){state.params.scenarioBucket=null;return state;}});}});addAnalyticsStates("app.admin.servers.list");addGroupsStates("app.admin.servers.list");addAnalyticsStates("app.admin.buckets");addDocumentsStates("app.admin.buckets");function addGroupsStates(parent){$stateProvider.state(parent+'.groups',{url:'/groups',views:{"main@app.admin":{templateUrl:'app/mn_admin/mn_groups/mn_groups.html',controller:'mnGroupsController as groupsCtl'}},data:{enterprise:true,permissions:"cluster.server_groups.read",title:"Server Groups",child:parent}});}
function addDocumentsStates(parent){$stateProvider.state(parent+'.documents',{abstract:true,views:{"main@app.admin":{templateUrl:'app/mn_admin/mn_documents/mn_documents.html',controller:"mnDocumentsController as documentsCtl"}},url:"/documents?bucket",data:{title:"Documents",child:parent,permissions:"cluster.bucket['.'].settings.read && cluster.bucket['.'].data.docs.read"}}).state(parent+'.documents.control',{abstract:true,controller:'mnDocumentsControlController as documentsControlCtl',templateUrl:'app/mn_admin/mn_documents/list/mn_documents_control.html'}).state(parent+'.documents.control.list',{url:"?{pageLimit:int}&{pageNumber:int}&documentsFilter",params:{pageLimit:{value:10},pageNumber:{value:0},documentsFilter:null},controller:'mnDocumentsListController as documentsListCtl',templateUrl:'app/mn_admin/mn_documents/list/mn_documents_list.html'}).state(parent+'.documents.editing',{url:'/:documentId',controller:'mnDocumentsEditingController as documentsEditingCtl',templateUrl:'app/mn_admin/mn_documents/editing/mn_documents_editing.html',data:{child:parent+".documents.control.list",title:"Documents Editing"}});}
function addAnalyticsStates(parent){$stateProvider.state(parent+'.analytics',{abstract:true,url:'/analytics?statsHostname&bucket&specificStat',views:{"main@app.admin":{controller:'mnAnalyticsController as analyticsCtl',templateUrl:'app/mn_admin/mn_analytics/mn_analytics.html'}},params:{specificStat:{value:null},bucket:{value:null}},data:{permissions:"cluster.bucket['.'].settings.read && "+"cluster.bucket['.'].stats.read && cluster.stats.read"}}).state(parent+'.analytics.list',{url:'?openedStatsBlock&openedSpecificStatsBlock&columnName',params:{openedStatsBlock:{array:true,dynamic:true},openedSpecificStatsBlock:{array:true,dynamic:true},transZoom:{dynamic:true},transGraph:{dynamic:true},columnName:null},data:{title:"Statistics",child:parent},controller:'mnAnalyticsListController as analyticsListCtl',templateUrl:'app/mn_admin/mn_analytics/mn_analytics_list.html',redirectTo:function(trans){var mnAnalyticsService=trans.injector().get("mnAnalyticsService");var params=_.clone(trans.params(),true);params.zoom=params.transZoom||"minute";params.graph=params.transGraph;return mnAnalyticsService.getStats({$stateParams:params}).then(function(state){function checkLackOfParam(paramName){return!params[paramName]||!params[paramName].length||!_.intersection(params[paramName],_.pluck(state.statsDirectoryBlocks,'blockName')).length;}
if(!state.status){if(params.specificStat){if(checkLackOfParam("openedSpecificStatsBlock")){params.openedSpecificStatsBlock=[state.statsDirectoryBlocks[0].blockName];}}else{if(checkLackOfParam("openedStatsBlock")){params.openedStatsBlock=[state.statsDirectoryBlocks[0].blockName,state.statsDirectoryBlocks[1].blockName];}}
var selectedStat=state.statsByName&&state.statsByName[params.graph];if(!params.graph&&(!selectedStat||!selectedStat.config.data.length)){var findBy=function(info){return info.config.data.length;};if(params.specificStat){var directoryForSearch=state.statsDirectoryBlocks[0];}else{var directoryForSearch=state.statsDirectoryBlocks[1];}
selectedStat=_.detect(directoryForSearch.stats,findBy)||_.detect(state.statsByName,findBy);if(selectedStat){params.graph=selectedStat.name;}}}
return{state:parent+".analytics.list"+(params.specificStat?".specificGraph":".graph"),params:params};});}}).state(parent+'.analytics.list.specificGraph',{url:'/specific/:graph?zoom',params:{graph:{value:null},zoom:{value:null}},data:{title:"Specific",child:parent+".analytics.list",childParams:{specificStat:null}},controller:'mnAnalyticsListGraphController as analyticsListGraphCtl',templateUrl:'app/mn_admin/mn_analytics/mn_analytics_list_graph.html'}).state(parent+'.analytics.list.graph',{url:'/:graph?zoom',params:{graph:{value:null},zoom:{value:null}},controller:'mnAnalyticsListGraphController as analyticsListGraphCtl',templateUrl:'app/mn_admin/mn_analytics/mn_analytics_list_graph.html'});}}})();(function(){"use strict";angular.module('mnAdmin').controller('mnAdminController',mnAdminController);function mnAdminController($scope,$rootScope,$state,$uibModal,mnAlertsService,poolDefault,mnSettingsNotificationsService,mnPromiseHelper,pools,mnPoller,mnEtagPoller,mnAuthService,mnTasksDetails,mnPoolDefault,mnSettingsAutoFailoverService,formatProgressMessageFilter,mnPrettyVersionFilter,mnPoorMansAlertsService,mnLostConnectionService,mnPermissions,mnPools,mnMemoryQuotaService,mnResetPasswordDialogService,whoami,mnBucketsStats,mnBucketsService,$q,mnSessionService,mnServersService,mnSettingsClusterService,mnLogsService){var vm=this;vm.poolDefault=poolDefault;vm.launchpadId=pools.launchID;vm.implementationVersion=pools.implementationVersion;vm.logout=mnAuthService.logout;vm.resetAutoFailOverCount=resetAutoFailOverCount;vm.isProgressBarClosed=true;vm.toggleProgressBar=toggleProgressBar;vm.filterTasks=filterTasks;vm.showResetPasswordDialog=showResetPasswordDialog;vm.postCancelRebalanceRetry=postCancelRebalanceRetry;vm.showClusterInfoDialog=mnLogsService.showClusterInfoDialog;vm.isDeveloperPreview=pools.isDeveloperPreview;vm.user=whoami;vm.$state=$state;vm.enableInternalSettings=$state.params.enableInternalSettings;vm.runInternalSettingsDialog=runInternalSettingsDialog;vm.lostConnState=mnLostConnectionService.getState();vm.clientAlerts=mnAlertsService.clientAlerts;vm.alerts=mnAlertsService.alerts;vm.closeAlert=mnAlertsService.removeItem;vm.setHideNavSidebar=mnPoolDefault.setHideNavSidebar;vm.postStopRebalance=postStopRebalance;vm.closeCustomAlert=closeCustomAlert;vm.enableCustomAlert=enableCustomAlert;vm.getRebalanceReport=getRebalanceReport;$rootScope.rbac=mnPermissions.export;$rootScope.poolDefault=mnPoolDefault.export;$rootScope.pools=mnPools.export;$rootScope.buckets=mnBucketsService.export;activate();function closeCustomAlert(alertName){vm.clientAlerts[alertName]=true;}
function enableCustomAlert(alertName){vm.clientAlerts[alertName]=false;}
function postCancelRebalanceRetry(id){mnSettingsClusterService.postCancelRebalanceRetry(id);}
function showResetPasswordDialog(){vm.showUserDropdownMenu=false;mnResetPasswordDialogService.showDialog(whoami);}
function postStopRebalance(){return mnPromiseHelper(vm,mnServersService.stopRebalanceWithConfirm()).broadcast("reloadServersPoller");}
function runInternalSettingsDialog(){$uibModal.open({templateUrl:"app/mn_admin/mn_internal_settings/mn_internal_settings.html",controller:"mnInternalSettingsController as internalSettingsCtl"});}
function toggleProgressBar(){vm.isProgressBarClosed=!vm.isProgressBarClosed;}
function filterTasks(runningTasks,includeRebalance){return(runningTasks||[]).filter(function(task){return formatProgressMessageFilter(task,includeRebalance);});}
function resetAutoFailOverCount(){var queries=[mnSettingsAutoFailoverService.resetAutoFailOverCount({group:"global"}),mnSettingsAutoFailoverService.resetAutoReprovisionCount({group:"global"})];mnPromiseHelper(vm,$q.all(queries)).reloadState().showSpinner('resetQuotaLoading').catchGlobalErrors('Unable to reset Auto-failover quota!').showGlobalSuccess("Auto-failover quota reset successfully!");}
function getRebalanceReport(){mnTasksDetails.getRebalanceReport().then(function(report){var file=new Blob([JSON.stringify(report,null,2)],{type:"application/json",name:"rebalanceReport.json"});saveAs(file,"rebalanceReport.json");});}
function activate(){new mnPoller($scope,function(){return mnBucketsService.findMoxiBucket();}).subscribe("moxiBucket",vm).reloadOnScopeEvent(["reloadBucketStats"]).cycle();if(mnPermissions.export.cluster.settings.read){new mnPoller($scope,function(){return mnSettingsAutoFailoverService.getAutoFailoverSettings();}).setInterval(10000).subscribe("autoFailoverSettings",vm).reloadOnScopeEvent(["reloadServersPoller","rebalanceFinished"]).cycle();}
mnSessionService.init($scope);if(mnPermissions.export.cluster.settings.read){mnPromiseHelper(vm,mnSettingsNotificationsService.maybeCheckUpdates({group:"global"})).applyToScope("updates").onSuccess(function(updates){if(updates.sendStats){mnPromiseHelper(vm,mnSettingsNotificationsService.buildPhoneHomeThingy({group:"global"})).applyToScope("launchpadSource")}});}
var etagPoller=new mnEtagPoller($scope,function(previous){return mnPoolDefault.get({etag:previous?previous.etag:"",waitChange:$state.current.name==="app.admin.overview.statistics"?3000:10000},{group:"global"});},true).subscribe(function(resp,previous){if(!_.isEqual(resp,previous)){$rootScope.$broadcast("mnPoolDefaultChanged");}
if(Number(localStorage.getItem("uiSessionTimeout"))!==(resp.uiSessionTimeout*1000)){$rootScope.$broadcast("newSessionTimeout",resp.uiSessionTimeout);}
vm.tabName=resp.clusterName;if(previous&&!_.isEqual(resp.nodes,previous.nodes)){$rootScope.$broadcast("nodesChanged",[resp.nodes,previous.nodes]);}
if(previous&&previous.buckets.uri!==resp.buckets.uri){$rootScope.$broadcast("reloadBucketStats");}
if(previous&&previous.serverGroupsUri!==resp.serverGroupsUri){$rootScope.$broadcast("serverGroupsUriChanged");}
if(previous&&previous.indexStatusURI!==resp.indexStatusURI){$rootScope.$broadcast("indexStatusURIChanged");}
if(!_.isEqual(resp.alerts,(previous||{}).alerts)){mnPoorMansAlertsService.maybeShowAlerts(resp);}
var version=mnPrettyVersionFilter(pools.implementationVersion);$rootScope.mnTitle=vm.tabName+(version?(' - '+version):'');if(previous&&previous.tasks.uri!=resp.tasks.uri){$rootScope.$broadcast("reloadTasksPoller");}
if(previous&&previous.checkPermissionsURI!=resp.checkPermissionsURI){$rootScope.$broadcast("reloadPermissions");}}).cycle();if(mnPermissions.export.cluster.tasks.read){if(pools.isEnterprise&&poolDefault.compat.atLeast65){var retryRebalancePoller=new mnPoller($scope,function(){return mnSettingsClusterService.getPendingRetryRebalance({group:"global"});}).setInterval(function(resp){return resp.data.retry_after_secs?1000:3000;}).subscribe(function(resp){vm.retryRebalance=resp.data;}).cycle();}
var tasksPoller=new mnPoller($scope,function(prevTask){return mnTasksDetails.getFresh({group:"global"}).then(function(tasks){if(tasks.tasksRebalance.status=="notRunning"){if(!tasks.tasksRebalance.masterRequestTimedOut&&prevTask&&(tasks.tasksRebalance.lastReportURI!=prevTask.tasksRebalance.lastReportURI)){mnTasksDetails.clearRebalanceReportCache(prevTask.tasksRebalance.lastReportURI);}
return mnTasksDetails.getRebalanceReport(tasks.tasksRebalance.lastReportURI).then(function(rv){if(rv.data.stageInfo){tasks.tasksRebalance.stageInfo=rv.data.stageInfo;tasks.tasksRebalance.completionMessage=rv.data.completionMessage;}
return tasks;});}
return tasks;});}).setInterval(function(result){return(_.chain(result.tasks).pluck('recommendedRefreshPeriod').compact().min().value()*1000)>>0||10000;}).subscribe(function(tasks,prevTask){vm.showTasksSpinner=false;if(!_.isEqual(tasks,prevTask)){$rootScope.$broadcast("mnTasksDetailsChanged");}
var isRebalanceFinished=tasks.tasksRebalance&&tasks.tasksRebalance.status!=='running'&&prevTask&&prevTask.tasksRebalance&&prevTask.tasksRebalance.status==="running";if(isRebalanceFinished){$rootScope.$broadcast("rebalanceFinished");}
if(!vm.isProgressBarClosed&&!filterTasks(tasks.running).length&&!tasks.tasksRebalance.stageInfo&&prevTask&&filterTasks(prevTask.running).length){vm.isProgressBarClosed=true;}
var stageInfo={services:{},startTime:null,completedTime:{status:true}};var serverStageInfo=tasks.tasksRebalance.stageInfo||(tasks.tasksRebalance.previousRebalance&&tasks.tasksRebalance.previousRebalance.stageInfo);if(serverStageInfo){var services=Object.keys(serverStageInfo).sort(function(a,b){if(!serverStageInfo[a].timeTaken){return 1;}
if(!serverStageInfo[b].startTime){return-1;}
if(new Date(serverStageInfo[a].startTime)>new Date(serverStageInfo[b].startTime)){return 1;}else{return-1;}});stageInfo.services=services.map(function(key){var value=serverStageInfo[key];value.name=key;var details=Object.keys(value.details||{})
value.details=details.map(function(bucketName){value.details[bucketName].name=bucketName;return value.details[bucketName];});if(value.startTime){if(!stageInfo.startTime||stageInfo.startTime>new Date(value.startTime)){stageInfo.startTime=new Date(value.startTime);}}
if(value.completedTime){value.completedTime=new Date(value.completedTime);if(!stageInfo.completedTime.time||(stageInfo.completedTime.time<value.completedTime)){stageInfo.completedTime.time=new Date(value.completedTime);}}else{stageInfo.completedTime.status=false;}
return value;});tasks.tasksRebalance.stageInfo=stageInfo;}
if(tasks.inRebalance){if(!prevTask){vm.isProgressBarClosed=false;}else{if(!prevTask.tasksRebalance||prevTask.tasksRebalance.status!=="running"){vm.isProgressBarClosed=false;}}}
if(tasks.tasksRebalance.errorMessage&&mnAlertsService.isNewAlert({id:tasks.tasksRebalance.statusId})){mnAlertsService.setAlert("error",tasks.tasksRebalance.errorMessage,null,tasks.tasksRebalance.statusId);}
vm.tasks=tasks;},vm).cycle();}
$scope.$on("reloadPermissions",function(){mnPermissions.getFresh();});$scope.$on("newSessionTimeout",function(e,uiSessionTimeout){mnSessionService.setTimeout(uiSessionTimeout);mnSessionService.resetTimeoutAndSyncAcrossTabs();});$scope.$on("reloadTasksPoller",function(event,params){if(!params||!params.doNotShowSpinner){vm.showTasksSpinner=true;}
if(tasksPoller){tasksPoller.reload(true);}});$scope.$on("reloadPoolDefaultPoller",function(){mnPoolDefault.clearCache();etagPoller.reload();});$scope.$on("reloadBucketStats",function(){mnBucketsService.clearCache();mnBucketsService.getBucketsByType();});$rootScope.$broadcast("reloadBucketStats");$scope.$on("maybeShowMemoryQuotaDialog",function(event,services){return mnPoolDefault.get().then(function(poolsDefault){var servicesToCheck=["index","fts"];if(poolsDefault.isEnterprise){servicesToCheck=servicesToCheck.concat(["cbas","eventing"]);}
var firstTimeAddedServices=mnMemoryQuotaService.getFirstTimeAddedServices(servicesToCheck,services,poolsDefault.nodes);if(firstTimeAddedServices.count){$uibModal.open({windowTopClass:"without-titlebar-close",backdrop:'static',templateUrl:'app/mn_admin/mn_servers/memory_quota_dialog/memory_quota_dialog.html',controller:'mnServersMemoryQuotaDialogController as serversMemoryQuotaDialogCtl',resolve:{memoryQuotaConfig:function(mnMemoryQuotaService){return mnMemoryQuotaService.memoryQuotaConfig(services,true,false);},indexSettings:function(mnSettingsClusterService){return mnSettingsClusterService.getIndexSettings();},firstTimeAddedServices:function(){return firstTimeAddedServices;}}});}});});}}})();(function(){"use strict";angular.module('mnLostConnection',['mnLostConnectionService','mnHelper']).config(mnLostConnectionConfig);function mnLostConnectionConfig($httpProvider){$httpProvider.interceptors.push(['$q','$injector',interceptorOfErrConnectionRefused]);}
function interceptorOfErrConnectionRefused($q,$injector){var wantedUrls={};return{responseError:function(rejection){if(rejection.status<=0&&(rejection.xhrStatus=="error")){wantedUrls[rejection.config.url]=true;$injector.get("mnLostConnectionService").activate();}else{if(wantedUrls[rejection.config.url]){wantedUrls={};$injector.get("mnLostConnectionService").deactivate();}}
return $q.reject(rejection);},response:function(resp){if(wantedUrls[resp.config.url]){wantedUrls={};$injector.get("mnLostConnectionService").deactivate();}
return resp;}};}})();(function(){"use strict";angular.module("mnLostConnection").controller("mnLostConnectionController",mnLostConnectionController);function mnLostConnectionController($scope,mnLostConnectionService,$window,mnHelper){var vm=this;vm.lostConnectionAt=$window.location.host;vm.state=mnLostConnectionService.getState();vm.retryNow=mnLostConnectionService.resendQueries;}})();(function(){"use strict";angular.module("mnLostConnectionService",["mnHelper","ui.router","ui.bootstrap"]).factory("mnLostConnectionService",mnLostConnectionFactory);function mnLostConnectionFactory($interval,mnHelper,$uibModalStack,$window,$state){var state={isActive:false,isReload:false};var mnLostConnectionService={activate:activate,deactivate:deactivate,getState:getState,resendQueries:resendQueries};return mnLostConnectionService;function activate(){if(state.isActive){return;}
state.isActive=true;resetTimer();runTimer();}
function runTimer(){state.interval=$interval(function(){state.repeatAt-=1;if(state.repeatAt<=0){$uibModalStack.dismissAll();resendQueries();}},1000);}
function resetTimer(){$interval.cancel(state.interval);state.interval=null;state.repeatAt=60;}
function resendQueries(){$state.reload().then(deactivate,function(){resetTimer();runTimer();});}
function deactivate(){if(state.isReload){return;}
state.isReload=true;$interval.cancel(state.interval);$window.location.reload(true);}
function getState(){return state;}}})();(function(){"use strict";angular.module("mnResetPasswordDialog",["mnResetPasswordDialogService","mnAuthService","mnFilters","mnEqual"]).controller("mnResetPasswordDialogController",mnResetPasswordDialogController);function mnResetPasswordDialogController($scope,mnResetPasswordDialogService,mnPromiseHelper,mnAuthService,user){var vm=this;vm.submit=submit;vm.user={name:user.id};function submit(){if(vm.form.$invalid){return;}
var promise=mnResetPasswordDialogService.post(vm.user);mnPromiseHelper(vm,promise).showGlobalSpinner().catchErrors().onSuccess(function(){return mnAuthService.logout();});}}})();(function(){"use strict";angular.module("mnResetPasswordDialogService",["ui.bootstrap"]).factory("mnResetPasswordDialogService",mnResetPasswordDialogFactory);function mnResetPasswordDialogFactory($http,$uibModal,$q){var mnResetPasswordDialogService={post:post,showDialog:showDialog};return mnResetPasswordDialogService;function showDialog(user){$uibModal.open({templateUrl:'app/mn_admin/mn_reset_password_dialog/mn_reset_password_dialog.html',controller:"mnResetPasswordDialogController as resetPasswordDialogCtl",resolve:{user:function(){return user;}}});}
function post(user){return $http({headers:{'Authorization':"Basic "+btoa(user.name+":"+user.currentPassword),'ns-server-ui':undefined},url:"/controller/changePassword",method:"POST",data:{password:user.password}}).then(function(resp){return resp.data;},function(resp){if(resp.status===401){return $q.reject("Incorrect user password");}else{return $q.reject(resp);}});}}})();(function(){"use strict";angular.module("mnInternalSettings",["mnInternalSettingsService","mnPromiseHelper","mnSpinner"]).controller("mnInternalSettingsController",mnInternalSettingsController);function mnInternalSettingsController($scope,mnInternalSettingsService,mnPromiseHelper,mnPoolDefault,$uibModalInstance){var vm=this;vm.onSubmit=onSubmit;vm.mnPoolDefault=mnPoolDefault.latestValue();activate();function onSubmit(){if(vm.viewLoading){return;}
mnPromiseHelper(vm,mnInternalSettingsService.save(vm.state),$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().reloadState().showGlobalSuccess("Settings saved successfully!");}
function activate(){mnPromiseHelper(vm,mnInternalSettingsService.getState()).showSpinner().applyToScope("state");}}})();(function(){"use strict";angular.module("mnInternalSettingsService",[]).factory("mnInternalSettingsService",mnInternalSettingsFactory);function mnInternalSettingsFactory($http){var mnInternalSettingsService={getState:getState,save:save};return mnInternalSettingsService;function save(data){return $http({method:"POST",url:"/internalSettings",data:data});}
function getState(){return $http({method:"GET",url:"/internalSettings"}).then(function(resp){return resp.data;})}}})();(function(){"use strict";angular.module('mnOverview',['mnOverviewService','mnBarUsage','mnPlot','mnBucketsService','mnPoll','ui.bootstrap','mnElementCrane','mnDropdown','mnPromiseHelper','mnXDCRService','mnHelper','mnPoolDefault']).controller('mnOverviewController',mnOverviewController);function mnOverviewController($scope,$rootScope,mnBucketsService,mnOverviewService,mnPoller,mnPromiseHelper,mnHelper,mnXDCRService,permissions,pools,mnPoolDefault){var vm=this;vm.getEndings=mnHelper.getEndings;vm.isIPv6=pools.isIPv6;vm.nodeEncryption=mnPoolDefault.export.thisNode.nodeEncryption;activate();function activate(){$rootScope.$broadcast("reloadPoolDefaultPoller");if(permissions.cluster.xdcr.remote_clusters.read){new mnPoller($scope,mnXDCRService.getReplicationState).setInterval(3000).subscribe("xdcrReferences",vm).cycle();}
new mnPoller($scope,mnOverviewService.getOverviewConfig).reloadOnScopeEvent("mnPoolDefaultChanged").subscribe("mnOverviewConfig",vm).cycle();new mnPoller($scope,function(){return mnOverviewService.getServices();}).reloadOnScopeEvent("nodesChanged").subscribe("nodes",vm).cycle();if(permissions.cluster.bucket['.'].stats.read){new mnPoller($scope,mnOverviewService.getStats).setInterval(3000).subscribe("mnOverviewStats",vm).cycle();}}}})();(function(){"use strict"
angular.module('mnOverviewService',['mnPoolDefault','mnServersService']).factory('mnOverviewService',mnOverviewServiceFactory);function mnOverviewServiceFactory($http,mnPoolDefault,mnServersService){var mnOverviewService={getStats:getStats,getOverviewConfig:getOverviewConfig,getServices:getServices};var processPlotOptions=function(plotOptions,plotDatas){var firstData=plotDatas[0];var t0=firstData[0][0];var t1=this.lastSampleTime;if(t1-t0<300000){plotOptions.xaxis.ticks=[t0,t1];plotOptions.xaxis.tickSize=[null,"minute"];}
return plotOptions;};var ramOverviewConfigBase={topRight:{name:'total quota'},items:[{name:'in use'},{name:'unused quota'},{name:'unallocated'}]};var hddOverviewConfigBase={topRight:{name:'usable free space'},items:[{name:'in use by couchbase'},{name:'other data'},{name:"free"}]};return mnOverviewService;function getNodesByService(service,nodes){var nodes2=_.filter(nodes.allNodes,function(node){return _.indexOf(node.services,service)>-1;});return mnServersService.addNodesByStatus(nodes2);}
function getServices(){return mnServersService.getNodes().then(function(nodes){var rv={kv:getNodesByService("kv",nodes),index:getNodesByService("index",nodes),n1ql:getNodesByService("n1ql",nodes),fts:getNodesByService("fts",nodes),all:nodes};if(mnPoolDefault.export.isEnterprise){rv.cbas=getNodesByService("cbas",nodes);rv.eventing=getNodesByService("eventing",nodes);}
return rv;});}
function getStats(){return $http({url:'/pools/default/overviewStats',method:"GET"}).then(function(statsResponse){var stats=statsResponse.data;var now=new Date().valueOf();var tstamps=stats.timestamp||[];var interval=tstamps[tstamps.length-1]-tstamps[0];var breakInterval=(tstamps.length>1)?(interval/Math.min(tstamps.length/2,30)):undefined;var options={lastSampleTime:now,breakInterval:breakInterval,processPlotOptions:processPlotOptions};return{opsGraphConfig:{stats:stats['ops'],tstamps:tstamps,options:options},readsGraphConfig:{stats:stats['ep_bg_fetched'],tstamps:tstamps,options:options}};});}
function getOverviewConfig(){return mnPoolDefault.get().then(function(poolsDetails){var details=poolsDetails;var rv={};(function(){var ram=details.storageTotals.ram;var usedQuota=ram.usedByData;var bucketsQuota=ram.quotaUsed;var quotaTotal=ram.quotaTotal;var ramOverviewConfig=_.clone(ramOverviewConfigBase,true);ramOverviewConfig.topRight.value=bucketsQuota;ramOverviewConfig.items[0].value=usedQuota;ramOverviewConfig.items[1].value=bucketsQuota-usedQuota;ramOverviewConfig.items[2].value=Math.max(quotaTotal-bucketsQuota,0);if(ramOverviewConfig.items[1].value<0){ramOverviewConfig.items[0].value=bucketsQuota;ramOverviewConfig.items[1]={name:'overused',value:usedQuota-bucketsQuota};ramOverviewConfig.topRight={name:'cluster quota',value:quotaTotal};if(usedQuota<quotaTotal){ramOverviewConfig.items[2]={name:'available',value:quotaTotal-usedQuota};}else{ramOverviewConfig.items.pop();}}
rv.ramOverviewConfig=ramOverviewConfig;})();;(function(){var hdd=details.storageTotals.hdd;var usedSpace=hdd.usedByData;var total=hdd.total;var other=hdd.used-usedSpace;var free=hdd.free;var hddOverviewConfig=_.clone(hddOverviewConfigBase,true);hddOverviewConfig.topRight.value=free;hddOverviewConfig.items[0].value=usedSpace;hddOverviewConfig.items[1].value=other;hddOverviewConfig.items[2].value=total-other-usedSpace;rv.hddOverviewConfig=hddOverviewConfig;})();return rv;});}}})();(function(){"use strict";angular.module('mnStatisticsDescriptionService',[]).factory('mnStatisticsDescriptionService',mnStatisticsDescriptionFactory);function mnStatisticsDescriptionFactory(){return{"kvGroups":{"Ops":["ops","cmd_get","cmd_set","hit_ratio","delete_hits","cas_hits","ep_cache_miss_rate","couch_views_ops","ep_num_ops_del_meta","ep_num_ops_get_meta","ep_num_ops_set_meta","ep_ops_create","ep_ops_update","vb_active_ops_create","vb_pending_ops_create","vb_replica_ops_create","xdc_ops","curr_connections"],"Memory":["mem_used","ep_kv_size","ep_meta_data_memory","ep_tmp_oom_errors","ep_mem_low_wat","ep_mem_high_wat","vb_active_itm_memory","vb_active_meta_data_memory","vb_pending_itm_memory","vb_pending_meta_data_memory","vb_replica_itm_memory","vb_replica_meta_data_memory"],"Disk":["couch_total_disk_size","ep_cache_miss_rate","vb_avg_total_queue_age","avg_disk_update_time","avg_disk_commit_time","couch_docs_actual_disk_size","couch_views_actual_disk_size","disk_write_queue","ep_bg_fetched","ep_data_read_failed","ep_data_write_failed","ep_num_value_ejects","ep_ops_create","ep_ops_update"],"vBuckets":["ep_vb_total","vb_active_num","curr_items","vb_active_ops_create","vb_active_resident_items_ratio","vb_active_eject","vb_active_sync_write_accepted_count","vb_active_sync_write_committed_count","vb_active_sync_write_aborted_count","avg_active_timestamp_drift","ep_active_ahead_exceptions","vb_pending_num","vb_pending_curr_items","vb_pending_ops_create","vb_pending_resident_items_ratio","vb_pending_eject","vb_replica_num","vb_replica_curr_items","vb_replica_ops_create","vb_replica_resident_items_ratio","vb_replica_eject","avg_replica_timestamp_drift","ep_replica_ahead_exceptions"],"Disk Queues":["ep_diskqueue_fill","ep_diskqueue_drain","ep_diskqueue_items","vb_active_queue_fill","vb_active_queue_drain","vb_active_queue_size","vb_replica_queue_fill","vb_replica_queue_drain","vb_replica_queue_size","vb_pending_queue_fill","vb_pending_queue_drain","vb_pending_queue_size"],"DCP Queues":["ep_dcp_views+indexes_count","ep_dcp_views+indexes_producer_count","ep_dcp_views+indexes_items_remaining","ep_dcp_views+indexes_total_bytes","ep_dcp_views+indexes_backoff","ep_dcp_cbas_count","ep_dcp_cbas_producer_count","ep_dcp_cbas_items_remaining","ep_dcp_cbas_total_bytes","ep_dcp_cbas_backoff","ep_dcp_replica_count","ep_dcp_replica_producer_count","ep_dcp_replica_items_remaining","ep_dcp_replica_total_bytes","ep_dcp_replica_backoff","ep_dcp_xdcr_count","ep_dcp_xdcr_producer_count","ep_dcp_xdcr_items_remaining","ep_dcp_xdcr_total_bytes","ep_dcp_xdcr_backoff","ep_dcp_eventing_count","ep_dcp_eventing_producer_count","ep_dcp_eventing_items_remaining","ep_dcp_eventing_total_bytes","ep_dcp_eventing_backoff"]},"stats":{"@system":{"cpu_cores_available":null,"cpu_idle_ms":null,"cpu_local_ms":null,"cpu_utilization_rate":{unit:"percent",title:"CPU",desc:"Percentage of CPU in use across all available cores on this server."},"hibernated_requests":{unit:"number",title:"Idle Streaming Requests",desc:"Number of streaming requests on management port (usually 8091) now idle."},"hibernated_waked":{unit:"number/sec",title:"Streaming Wakeups",desc:"Number of streaming request wakeups per second on management port (usually 8091)."},"mem_actual_free":{unit:"bytes",title:"Available RAM",desc:"Bytes of RAM available to Couchbase on this server."},"mem_actual_used":null,"mem_free":null,"mem_limit":null,"mem_total":null,"mem_used_sys":null,"rest_requests":{unit:"number/sec",title:"HTTP Request Rate",desc:"Number of http requests per second on management port (usually 8091)."},"swap_total":null,"swap_used":{unit:"bytes",title:"Swap Used",desc:"Bytes of swap space in use on this server."},},"@kv-":{"couch_total_disk_size":{unit:"bytes",title:"Data/Views On Disk",desc:"The total size on disk of all data and view files for this bucket. (measured from couch_total_disk_size)"},"couch_docs_fragmentation":{unit:"percent",title:"Docs Fragmentation",desc:"Percentage of fragmented data to be compacted compared to real data for the data files in this bucket. (measured from couch_docs_fragmentation)"},"couch_views_fragmentation":{unit:"percent",title:"Views Fragmentation",desc:"Percentage of fragmented data to be compacted compared to real data for the view index files in this bucket. (measured from couch_views_fragmentation)"},"hit_ratio":{unit:"percent",title:"Get Ratio",desc:"Percentage of get requests served with data from this bucket. (measured from get_hits * 100/cmd_get)"},"ep_cache_miss_rate":{unit:"percent",title:"Cache Miss Ratio",desc:"Percentage of reads per second to this bucket from disk as opposed to RAM. (measured from ep_bg_fetches / gets * 100)"},"ep_resident_items_rate":{unit:"percent",title:"Resident Ratio",desc:"Percentage of all items cached in RAM in this bucket. (measured from ep_resident_items_rate)"},"vb_avg_active_queue_age":{unit:"second",title:"Active Queue Age",desc:"Average age in seconds of active items in the active item queue for this bucket. (measured from vb_avg_active_queue_age)"},"vb_avg_replica_queue_age":{unit:"second",title:"Replica Queue Age",desc:"Average age in seconds of replica items in the replica item queue for this bucket. (measured from vb_avg_replica_queue_age)"},"vb_avg_pending_queue_age":{unit:"second",title:"Pending Queue Age",desc:"Average age in seconds of pending items in the pending item queue for this bucket. Should be transient during rebalancing. (measured from vb_avg_pending_queue_age)"},"vb_avg_total_queue_age":{unit:"second",title:"Disk Write Queue Age",desc:"Average age in seconds of all items in the disk write queue for this bucket. (measured from vb_avg_total_queue_age)"},"vb_active_resident_items_ratio":{unit:"percent",title:"Active Resident Ratio",desc:"Percentage of active items cached in RAM in this bucket. (measured from vb_active_resident_items_ratio)"},"vb_replica_resident_items_ratio":{unit:"percent",title:"Replica Resident Ratio",name:"vb_replica_resident_items_ratio",desc:"Percentage of replica items cached in RAM in this bucket. (measured from vb_replica_resident_items_ratio)"},"vb_pending_resident_items_ratio":{unit:"percent",title:"Pending Resident Ratio",desc:"Percentage of items cached in RAM for pending vBuckets in this bucket. (measured from vb_pending_resident_items_ratio)"},"avg_disk_update_time":{unit:"microsecond",title:"Disk Update Time",desc:"Average disk update time in microseconds as from disk_update histogram of timings. (measured from avg_disk_update_time)"},"avg_disk_commit_time":{unit:"percent",title:"Disk Commit Time",desc:"Average disk commit time in seconds as from disk_update histogram of timings. (measured from avg_disk_commit_time)"},"avg_bg_wait_time":{unit:"microsecond",title:"Background Fetch Time",desc:"Average background fetch time in microseconds. (measured from avg_bg_wait_time)"},"avg_active_timestamp_drift":{unit:"second",title:"Active Timestamp Drift",name:"avg_active_timestamp_drift",desc:"Average drift (in seconds) between mutation timestamps and the local time for active vBuckets. (measured from ep_active_hlc_drift and ep_active_hlc_drift_count)"},"avg_replica_timestamp_drift":{unit:"second",title:"Replica Timestamp Drift",desc:"Average drift (in seconds) between mutation timestamps and the local time for replica vBuckets. (measured from ep_replica_hlc_drift and ep_replica_hlc_drift_count)"},"ep_dcp_views+indexes_count":{unit:"number",title:"DCP Indexes Connections",desc:"Number of internal views/gsi/search index DCP connections in this bucket (measured from ep_dcp_views_count + ep_dcp_2i_count + ep_dcp_fts_count)"},"ep_dcp_views+indexes_items_remaining":{unit:"number",title:"DCP Indexes Items Remaining",desc:"Number of items remaining to be sent to consumer in this bucket (measured from ep_dcp_views_items_remaining + ep_dcp_2i_items_remaining + ep_dcp_fts_items_remaining)"},"ep_dcp_views+indexes_producer_count":{unit:"number",title:"DCP Indexes Senders",desc:"Number of views/gsi/search index senders for this bucket (measured from ep_dcp_views_producer_count + ep_dcp_2i_producer_count + ep_dcp_fts_producer_count)"},"ep_dcp_views+indexes_total_backlog_size":null,"ep_dcp_views+indexes_items_sent":{unit:"number/sec",title:"DCP Indexes Items Sent",desc:"Number of items per second being sent for a producer for this bucket (measured from ep_dcp_views_items_sent + ep_dcp_2i_items_sent + ep_dcp_fts_items_sent)"},"ep_dcp_views+indexes_total_bytes":{unit:"bytes/sec",title:"DCP Indexes Drain Rate",desc:"Number of bytes per second being sent for views/gsi/search index DCP connections for this bucket (measured from ep_dcp_views_total_bytes + ep_dcp_2i_total_bytes + ep_dcp_fts_total_bytes)"},"ep_dcp_views+indexes_backoff":{unit:"number/sec",title:"DCP Indexes Backoffs",desc:"Number of backoffs for views/gsi/search index DCP connections (measured from ep_dcp_views_backoff + ep_dcp_2i_backoff + ep_dcp_fts_backoff)"},"bg_wait_count":null,"bg_wait_total":null,"bytes_read":{unit:"bytes/sec",name:"bytes_read",title:"Memcached RX Rate",desc:"Bytes per second received in this bucket. (measured from bytes_read)"},"bytes_written":{unit:"bytes/sec",title:"Memcached TX Rate",desc:"Number of bytes per second sent from this bucket. (measured from bytes_written)"},"cas_badval":{unit:"number/sec",title:"CAS Badval Rate",desc:"Number of CAS operations per second using an incorrect CAS ID for data that this bucket contains. (measured from cas_badval)"},"cas_hits":{unit:"number/sec",title:"CAS Ops Rate",desc:"Number of operations with a CAS id per second for this bucket. (measured from cas_hits)"},"cas_misses":{unit:"number/sec",title:"CAS Miss Rate",desc:"Number of CAS operations per second for data that this bucket does not contain. (measured from cas_misses)"},"cmd_get":{unit:"number/sec",title:"Gets",desc:"Number of reads (get operations) per second from this bucket. (measured from cmd_get)"},"cmd_total_gets":{unit:"number/sec",title:"Total Gets",desc:"Number of total get operations per second from this bucket (measured from cmd_total_gets). This includes additional get operations such as get locked that are not included in cmd_get"},"cmd_set":{unit:"number/sec",title:"Sets",desc:"Number of writes (set operations) per second to this bucket. (measured from cmd_set)"},"couch_docs_actual_disk_size":{unit:"bytes",title:"Data Total Disk Size",desc:"The size of all data service files on disk for this bucket, including the data itself, metadata, and temporary files. (measured from couch_docs_actual_disk_size)"},"couch_docs_data_size":{unit:"bytes",title:"Active Data Size",desc:"Bytes of active data in this bucket. (measured from couch_docs_data_size)"},"couch_docs_disk_size":null,"couch_spatial_data_size":null,"couch_spatial_disk_size":null,"couch_spatial_ops":null,"couch_views_actual_disk_size":{unit:"bytes",title:"Views Disk Size",desc:"Bytes of active items in all the views for this bucket on disk (measured from couch_views_actual_disk_size)"},"couch_views_data_size":{unit:"bytes",title:"Views Data",desc:"Bytes of active data for all the views in this bucket. (measured from couch_views_data_size)"},"couch_views_disk_size":null,"couch_views_ops":{unit:"number/sec",title:"Views Read Rate",desc:"All the views reads for all design documents including scatter gather. (measured from couch_views_ops)"},"curr_connections":{unit:"number",title:"Current Connections",desc:"Number of currrent connections to this server including connections from external client SDKs, proxies, DCP requests and internal statistic gathering. (measured from curr_connections)"},"curr_items":{unit:"number",title:"Active Items",desc:"Number of active items in this bucket. (measured from curr_items)",},"curr_items_tot":{unit:"number",title:"Total Items",desc:"Total number of items in this bucket. (measured from curr_items_tot)"},"decr_hits":{unit:"number/sec",title:"Decr Hit Rate",desc:"Number of decrement operations per second for data that this bucket contains. (measured from decr_hits)"},"decr_misses":{unit:"number/sec",title:"Decr Miss Rate",desc:"Number of decr operations per second for data that this bucket does not contain. (measured from decr_misses)"},"delete_hits":{unit:"number/sec",title:"Delete Rate",desc:"Number of delete operations per second for this bucket. (measured from delete_hits)"},"delete_misses":{unit:"number/sec",title:"Delete Miss Rate",desc:"Number of delete operations per second for data that this bucket does not contain. (measured from delete_misses)"},"disk_commit_count":null,"disk_commit_total":null,"disk_update_count":null,"disk_update_total":null,"disk_write_queue":{unit:"number",title:"Disk Write Queue",desc:"Number of items waiting to be written to disk in this bucket. (measured from ep_queue_size+ep_flusher_todo)"},"ep_active_ahead_exceptions":{unit:"number/sec",title:"Active Ahead Exception Rate",desc:"Total number of ahead exceptions (when timestamp drift between mutations and local time has exceeded 5000000 s) per second for all active vBuckets."},"ep_active_hlc_drift":null,"ep_active_hlc_drift_count":null,"ep_bg_fetched":{unit:"number/sec",title:"Disk Read Rate",desc:"Number of reads per second from disk for this bucket. (measured from ep_bg_fetched)"},"ep_clock_cas_drift_threshold_exceeded":null,"ep_data_read_failed":{unit:"number",title:"Disk Read Failures",desc:"Number of disk read failures. (measured from ep_data_read_failed)"},"ep_data_write_failed":{unit:"number",title:"Disk Write Failures",desc:"Number of disk write failures. (measured from ep_data_write_failed)"},"ep_dcp_2i_backoff":null,"ep_dcp_2i_count":null,"ep_dcp_2i_items_remaining":null,"ep_dcp_2i_items_sent":null,"ep_dcp_2i_producer_count":null,"ep_dcp_2i_total_backlog_size":null,"ep_dcp_2i_total_bytes":null,"ep_dcp_cbas_backoff":{unit:"number/sec",title:"DCP Analytics Backoffs",desc:"Number of backoffs per second for analytics DCP connections (measured from ep_dcp_cbas_backoff)"},"ep_dcp_cbas_count":{unit:"number",title:"DCP Analytics Connections",desc:"Number of internal analytics DCP connections in this bucket (measured from ep_dcp_cbas_count)"},"ep_dcp_cbas_items_remaining":{unit:"number",title:"DCP Analytics Items Remaining",desc:"Number of items remaining to be sent to consumer in this bucket (measured from ep_dcp_cbas_items_remaining)"},"ep_dcp_cbas_items_sent":{unit:"number/sec",title:"DCP Analytics Items Sent",desc:"Number of items per second being sent for a producer for this bucket (measured from ep_dcp_cbas_items_sent)"},"ep_dcp_cbas_producer_count":{unit:"number",title:"DCP Analytics Senders",desc:"Number of analytics senders for this bucket (measured from ep_dcp_cbas_producer_count)"},"ep_dcp_cbas_total_backlog_size":null,"ep_dcp_cbas_total_bytes":{unit:"bytes/sec",title:"DCP Analytics Drain Rate",desc:"Number of bytes per second being sent for analytics DCP connections for this bucket (measured from ep_dcp_cbas_total_bytes)"},"ep_dcp_fts_backoff":null,"ep_dcp_fts_count":null,"ep_dcp_fts_items_remaining":null,"ep_dcp_fts_items_sent":null,"ep_dcp_fts_producer_count":null,"ep_dcp_fts_total_backlog_size":null,"ep_dcp_fts_total_bytes":null,"ep_dcp_eventing_backoff":{unit:"number/sec",title:"DCP Eventing Backoffs",desc:"Number of backoffs per second for eventing DCP connections (measured from ep_dcp_eventing_backoff)"},"ep_dcp_eventing_count":{unit:"number",title:"DCP Eventing Connections",desc:"Number of internal eventing DCP connections in this bucket (measured from ep_dcp_eventing_count)"},"ep_dcp_eventing_items_remaining":{unit:"number",title:"DCP Eventing Items Remaining",desc:"Number of items remaining to be sent to consumer in this bucket (measured from ep_dcp_eventing_items_remaining)"},"ep_dcp_eventing_items_sent":{unit:"number/sec",title:"DCP Eventing Items Sent",desc:"Number of items per second being sent for a producer for this bucket (measured from ep_dcp_eventing_items_sent)"},"ep_dcp_eventing_producer_count":{unit:"number",title:"DCP Eventing Senders",desc:"Number of eventing senders for this bucket (measured from ep_dcp_eventing_producer_count)"},"ep_dcp_eventing_total_backlog_size":null,"ep_dcp_eventing_total_bytes":{unit:"bytes/sec",title:"DCP Eventing Drain Rate",desc:"Number of bytes per second being sent for eventing DCP connections for this bucket (measured from ep_dcp_eventing_total_bytes)"},"ep_dcp_other_backoff":{unit:"number/sec",title:"DCP Other Backoffs",desc:"Number of backoffs for other DCP connections"},"ep_dcp_other_count":{unit:"number",title:"DCP Other Connections",desc:"Number of other DCP connections in this bucket (measured from ep_dcp_other_count)"},"ep_dcp_other_items_remaining":{unit:"number",title:"DCP Other Items Remaining",desc:"Number of items remaining to be sent to consumer in this bucket (measured from ep_dcp_other_items_remaining)"},"ep_dcp_other_items_sent":{unit:"number/sec",title:"DCP Other Items Sent",desc:"Number of items per second being sent for a producer for this bucket (measured from ep_dcp_other_items_sent)"},"ep_dcp_other_producer_count":{unit:"number",title:"DCP Other Senders",desc:"Number of other senders for this bucket (measured from ep_dcp_other_producer_count)"},"ep_dcp_other_total_backlog_size":null,"ep_dcp_other_total_bytes":{unit:"bytes/sec",title:"DCP Other Drain Rate",desc:"Number of bytes per second being sent for other DCP connections for this bucket (measured from ep_dcp_other_total_bytes)"},"ep_dcp_replica_backoff":{unit:"number",title:"DCP Replication Backoffs",desc:"Number of backoffs for replication DCP connections"},"ep_dcp_replica_count":{unit:"number",title:"DCP Replication Connections",desc:"Number of internal replication DCP connections in this bucket (measured from ep_dcp_replica_count)"},"ep_dcp_replica_items_remaining":{unit:"number",title:"DCP Replication Items Remaining",desc:"Number of items remaining to be sent to consumer in this bucket (measured from ep_dcp_replica_items_remaining)",},"ep_dcp_replica_items_sent":{unit:"number",title:"DCP Replication Items Sent",desc:"Number of items per second being sent for a producer for this bucket (measured from ep_dcp_replica_items_sent)"},"ep_dcp_replica_producer_count":{unit:"number",title:"DCP Replication Senders",desc:"Number of replication senders for this bucket (measured from ep_dcp_replica_producer_count)"},"ep_dcp_replica_total_backlog_size":null,"ep_dcp_replica_total_bytes":{unit:"bytes/sec",title:"DCP Replication Drain Rate",desc:"Number of bytes per second being sent for replication DCP connections for this bucket (measured from ep_dcp_replica_total_bytes)"},"ep_dcp_views_backoff":null,"ep_dcp_views_count":null,"ep_dcp_views_items_remaining":null,"ep_dcp_views_items_sent":null,"ep_dcp_views_producer_count":null,"ep_dcp_views_total_backlog_size":null,"ep_dcp_views_total_bytes":null,"ep_dcp_xdcr_backoff":{unit:"number",title:"DCP XDCR Backoffs",desc:"Number of backoffs for XDCR DCP connections"},"ep_dcp_xdcr_count":{unit:"number",title:"DCP XDCR Connections",desc:"Number of internal XDCR DCP connections in this bucket (measured from ep_dcp_xdcr_count)"},"ep_dcp_xdcr_items_remaining":{unit:"number",title:"DCP XDCR Items Remaining",desc:"Number of items remaining to be sent to consumer in this bucket (measured from ep_dcp_xdcr_items_remaining)"},"ep_dcp_xdcr_items_sent":{unit:"number/sec",title:"DCP XDCR Items Sent",desc:"Number of items per second being sent for a producer for this bucket (measured from ep_dcp_xdcr_items_sent)"},"ep_dcp_xdcr_producer_count":{unit:"number",title:"DCP XDCR Senders",desc:"Number of XDCR senders for this bucket (measured from ep_dcp_xdcr_producer_count)"},"ep_dcp_xdcr_total_backlog_size":null,"ep_dcp_xdcr_total_bytes":{unit:"bytes/sec",title:"DCP XDCR Drain Rate",desc:"Number of bytes per second being sent for XDCR DCP connections for this bucket (measured from ep_dcp_xdcr_total_bytes)"},"ep_diskqueue_drain":{unit:"number/sec",title:"Disk Queue Total Drain Rate",desc:"Total number of items per second being written to disk in this bucket (measured from ep_diskqueue_drain)"},"ep_diskqueue_fill":{unit:"number/sec",title:"Disk Queue Total Fill Rate",desc:"Total number of items per second being put on the disk queue in this bucket (measured from ep_diskqueue_fill)"},"ep_diskqueue_items":{unit:"number",title:"Disk Queue Total Items",desc:"Total number of items waiting (in queue) to be written to disk in this bucket (measured from ep_diskqueue_items)"},"ep_flusher_todo":null,"ep_item_commit_failed":null,"ep_kv_size":{unit:"bytes",title:"User Data in RAM",desc:"Total amount of user data cached in RAM in this bucket. (measured from ep_kv_size)"},"ep_max_size":null,"ep_mem_high_wat":{unit:"bytes",title:"High Water Mark",desc:"High water mark (in bytes) for auto-evictions. (measured from ep_mem_high_wat)"},"ep_mem_low_wat":{unit:"bytes",title:"Low Water Mark",desc:"Low water mark (in bytes) for auto-evictions. (measured from ep_mem_low_wat)"},"ep_meta_data_memory":{unit:"bytes",title:"Total Metadata in RAM",desc:"Bytes of item metadata consuming RAM in this bucket (measured from ep_meta_data_memory)"},"ep_num_non_resident":null,"ep_num_ops_del_meta":{unit:"number/sec",title:"XDCR Incoming Delete Rate",desc:"Number of delete operations per second for this bucket as the target for XDCR. (measured from ep_num_ops_del_meta)"},"ep_num_ops_del_ret_meta":null,"ep_num_ops_get_meta":{unit:"number/sec",title:"XDCR Incoming Metadata Read Rate",desc:"Number of metadata read operations per second for this bucket as the target for XDCR. (measured from ep_num_ops_get_meta)"},"ep_num_ops_set_meta":{unit:"number/sec",title:"XDCR Incoming Set Rate",desc:"Number of set operations per second for this bucket as the target for XDCR. (measured from ep_num_ops_set_meta)"},"ep_num_ops_set_ret_meta":null,"ep_num_value_ejects":{unit:"number/sec",title:"Ejection Rate",desc:"Number of items per second being ejected to disk in this bucket. (measured from ep_num_value_ejects)"},"ep_oom_errors":null,"ep_ops_create":{unit:"number/sec",title:"Total Disk Create Rate",desc:"Number of new items created on disk per second for this bucket. (measured from vb_active_ops_create + vb_replica_ops_create + vb_pending_ops_create)"},"ep_ops_update":{unit:"number/sec",title:"Disk Update Rate",desc:"Number of items updated on disk per second for this bucket. (measured from vb_active_ops_update + vb_replica_ops_update + vb_pending_ops_update)"},"ep_overhead":null,"ep_queue_size":null,"ep_replica_ahead_exceptions":{unit:"number/sec",title:"Replica Ahead Exception Rate",desc:"Total number of ahead exceptions (when timestamp drift between mutations and local time has exceeded 5000000 s) per second for all replica vBuckets."},"ep_replica_hlc_drift":null,"ep_replica_hlc_drift_count":null,"ep_tmp_oom_errors":{unit:"number/sec",title:"Temp OOM Rate",desc:"Number of back-offs sent per second to client SDKs due to \"out of memory\" situations from this bucket. (measured from ep_tmp_oom_errors)"},"ep_vb_total":{unit:"number",title:"vBuckets Total",desc:"Total number of vBuckets for this bucket. (measured from ep_vb_total)"},"evictions":{unit:"number/sec",title:"Eviction Rate",desc:"Number of items per second evicted from this bucket. (measured from evictions)"},"get_hits":{unit:"number/sec",title:"Get Hit Rate",desc:"Number of get operations per second for data that this bucket contains. (measured from get_hits)"},"get_misses":{unit:"number/sec",title:"Get Miss Rate",desc:"Number of get operations per second for data that this bucket does not contain. (measured from get_misses)",},"incr_hits":{unit:"number/sec",title:"Incr Hit Rate",desc:"Number of increment operations per second for data that this bucket contains. (measured from incr_hits)"},"incr_misses":{unit:"number/sec",title:"Incr Miss Rate",desc:"Number of increment operations per second for data that this bucket does not contain. (measured from incr_misses)"},"mem_used":{unit:"bytes",title:"Data Total RAM Used",desc:"Total memory used in bytes. (as measured from mem_used)"},"misses":null,"ops":{unit:"number/sec",title:"Total Ops",desc:"Total operations per second (including XDCR) to this bucket. (measured from cmd_get + cmd_set + incr_misses + incr_hits + decr_misses + decr_hits + delete_misses + delete_hits + ep_num_ops_del_meta + ep_num_ops_get_meta + ep_num_ops_set_meta)"},"vb_active_eject":{unit:"number/sec",title:"Active Ejection Rate",desc:"Number of items per second being ejected to disk from active vBuckets in this bucket. (measured from vb_active_eject)"},"vb_active_itm_memory":{unit:"bytes",title:"Active User Data in RAM",desc:"Amount of active user data cached in RAM in this bucket. (measured from vb_active_itm_memory)"},"vb_active_meta_data_memory":{unit:"bytes",title:"Active Metadata in RAM",desc:"Amount of active item metadata consuming RAM in this bucket. (measured from vb_active_meta_data_memory)"},"vb_active_num":{unit:"number",title:"vBuckets Active",desc:"Number of active vBuckets in this bucket. (measured from vb_active_num)"},"vb_active_num_non_resident":null,"vb_active_ops_create":{unit:"number/sec",title:"Active Create Rate",desc:"New items per second being inserted into active vBuckets in this bucket. (measured from vb_active_ops_create)"},"vb_active_ops_update":null,"vb_active_queue_age":null,"vb_active_queue_drain":{unit:"number/sec",title:"Disk Queue Active Drain Rate",desc:"Number of active items per second being written to disk in this bucket. (measured from vb_active_queue_drain)"},"vb_active_queue_fill":{unit:"number/sec",title:"Disk Queue Active Fill Rate",desc:"Number of active items per second being put on the active item disk queue in this bucket. (measured from vb_active_queue_fill)"},"vb_active_queue_size":{unit:"number",title:"Disk Queue Active Items",desc:"Number of active items waiting to be written to disk in this bucket. (measured from vb_active_queue_size)"},"vb_active_sync_write_accepted_count":{unit:"number/sec",title:"Accepted Sync Writes Rate",desc:"Number of accepted synchronous write per second into active vBuckets in this bucket. (measured from vb_active_sync_write_accepted_count)"},"vb_active_sync_write_committed_count":{unit:"number/sec",title:"Committed Sync Writes Rate",desc:"Number of committed synchronous writes per second into active vBuckets in this bucket. (measured from vb_active_sync_write_committed_count)"},"vb_active_sync_write_aborted_count":{unit:"number/sec",title:"Aborted Sync Writes Rate",desc:"Number of aborted synchronous writes per second into active vBuckets in this bucket. (measured from vb_active_sync_write_aborted_count)"},"vb_pending_curr_items":{unit:"number",title:"Pending Items",desc:"Number of items in pending vBuckets in this bucket. Should be transient during rebalancing. (measured from vb_pending_curr_items)"},"vb_pending_eject":{unit:"number/sec",title:"Pending Ejection Rate",desc:"Number of items per second being ejected to disk from pending vBuckets in this bucket. Should be transient during rebalancing. (measured from vb_pending_eject)"},"vb_pending_itm_memory":{unit:"bytes",title:"Pending User Data in RAM",desc:"Amount of pending user data cached in RAM in this bucket. Should be transient during rebalancing. (measured from vb_pending_itm_memory)"},"vb_pending_meta_data_memory":{unit:"bytes",title:"Pending Metadata in RAM",desc:"Amount of pending item metadata consuming RAM in this bucket. Should be transient during rebalancing. (measured from vb_pending_meta_data_memory)"},"vb_pending_num":{unit:"number",title:"vBuckets Pending",desc:"Number of pending vBuckets in this bucket. Should be transient during rebalancing. (measured from vb_pending_num)"},"vb_pending_num_non_resident":null,"vb_pending_ops_create":{unit:"number/sec",title:"Pending Create Rate",desc:"New items per second being instead into pending vBuckets in this bucket. Should be transient during rebalancing. (measured from vb_pending_ops_create)"},"vb_pending_ops_update":null,"vb_pending_queue_age":null,"vb_pending_queue_drain":{unit:"number/sec",title:"Disk Queue Pending Drain Rate",desc:"Number of pending items per second being written to disk in this bucket. Should be transient during rebalancing. (measured from vb_pending_queue_drain)"},"vb_pending_queue_fill":{unit:"number/sec",title:"Disk Queue Pending Fill Rate",desc:"Number of pending items per second being put on the pending item disk queue in this bucket. Should be transient during rebalancing (measured from vb_pending_queue_fill)"},"vb_pending_queue_size":{unit:"number",title:"Disk Queue Pending Items",desc:"Number of pending items waiting to be written to disk in this bucket and should be transient during rebalancing  (measured from vb_pending_queue_size)"},"vb_replica_curr_items":{unit:"number",title:"Replica Items",desc:"Number of items in replica vBuckets in this bucket. (measured from vb_replica_curr_items)"},"vb_replica_eject":{unit:"number/sec",title:"Replica Ejection Rate",desc:"Number of items per second being ejected to disk from replica vBuckets in this bucket. (measured from vb_replica_eject)"},"vb_replica_itm_memory":{unit:"bytes",title:"Replica User Data in RAM",desc:"Amount of replica user data cached in RAM in this bucket. (measured from vb_replica_itm_memory)"},"vb_replica_meta_data_memory":{unit:"bytes",title:"Replica Metadata in RAM",desc:"Amount of replica item metadata consuming in RAM in this bucket. (measured from vb_replica_meta_data_memory)"},"vb_replica_num":{unit:"number",title:"vBuckets Replica",desc:"Number of replica vBuckets in this bucket. (measured from vb_replica_num)"},"vb_replica_num_non_resident":null,"vb_replica_ops_create":{unit:"number/sec",title:"Replica Item Create Rate",desc:"New items per second being inserted into \"replica\" vBuckets in this bucket (measured from vb_replica_ops_create"},"vb_replica_ops_update":null,"vb_replica_queue_age":null,"vb_replica_queue_drain":{unit:"number/sec",title:"Disk Queue Replica Drain Rate",desc:"Number of replica items per second being written to disk in this bucket (measured from vb_replica_queue_drain)"},"vb_replica_queue_fill":{unit:"number/sec",title:"Disk Queue Replica Fill Rate",desc:"Number of replica items per second being put on the replica item disk queue in this bucket (measured from vb_replica_queue_fill)"},"vb_replica_queue_size":{unit:"number",title:"Disk Queue Replica Items",desc:"Number of replica items waiting to be written to disk in this bucket (measured from vb_replica_queue_size)"},"vb_total_queue_age":null,"xdc_ops":{unit:"number/sec",title:"XDCR Incoming Op Rate",desc:"Number of incoming XDCR operations per second for this bucket. (measured from xdc_ops)"},"@items":{"accesses":{unit:"number/sec",title:"Views Read Rate",desc:"Traffic to the views in this design doc."},"data_size":{unit:"bytes",title:"Views Data Size",desc:"Bytes stored in memory for views in this design doc."},"disk_size":{unit:"bytes",title:"Views Disk Size",desc:"Bytes stored on disk for views in this design doc."}}},"@index":{"index_memory_quota":null,"index_memory_used":null,"index_ram_percent":{unit:"percent",title:"Index RAM Quota Used",desc:"Percentage of Index RAM quota in use across all indexes on this server."},"index_remaining_ram":{unit:"bytes",title:"Index RAM Quota Available",desc:"Bytes of Index RAM quota still available on this server."}},"@index-":{"@items":{"num_docs_pending+queued":{unit:"number",title:"Index Mutations Remaining",desc:"Number of documents pending to be indexed. Per index."},"num_docs_indexed":{unit:"number/sec",title:"Index Drain Rate",desc:"Number of documents indexed by the indexer per second. Per index."},"index_resident_percent":{unit:"percent",title:"Index Resident Percent",desc:"Percentage of index data resident in memory. Per index."},"memory_used":{unit:"bytes",title:"Index RAM Used",desc:"Bytes in memory for this index. Per index."},"items_count":{unit:"number",title:"Indexed Items",desc:"Current total indexed documents. Per index."},"data_size":{unit:"bytes",title:"Index Data Size",desc:"Bytes of data in this index. Per index."},"disk_size":{unit:"bytes",title:"Index Disk Size",desc:"Bytes on disk for this index. Per index."},"avg_item_size":{unit:"bytes",title:"Index Item Size",desc:"Average size of each index item. Per index."},"avg_scan_latency":{unit:"nanoseconds",title:"Index Scan Latency",desc:"Average time (in nanoseconds) to serve a scan request. Per index."},"num_requests":{unit:"number/sec",title:"Index Request Rate",desc:"Number of requests served by the indexer per second. Per index."},"num_rows_returned":{unit:"number/sec",title:"Index Scan Items",desc:"Number of index items scanned by the indexer per second. Per index."},"scan_bytes_read":{unit:"number/sec",title:"Index Scan Bytes",desc:"Bytes per second read by a scan. Per index."},"cache_hits":null,"index_frag_percent":{unit:"percent",title:"Index Fragmentation",desc:"Percentage fragmentation of the index. Note: at small index sizes of less than a hundred kB, the static overhead of the index disk file will inflate the index fragmentation percentage. Per index."},"cache_miss_ratio":{unit:"percent",title:"Index Cache Miss Ratio",desc:"Percentage of accesses to this index data from disk as opposed to RAM. (measured from cache_misses * 100 / (cache_misses + cache_hits))"},"cache_misses":null,"disk_overhead_estimate":null,"frag_percent":null,"num_docs_pending":null,"num_docs_queued":null,"recs_in_mem":null,"recs_on_disk":null,"total_scan_duration":null,},"index/cache_hits":null,"index/cache_misses":null,"index/data_size":{unit:"bytes",title:"Index Total RAM Used",desc:"Bytes in memory used by Index across all indexes and buckets."},"index/disk_overhead_estimate":null,"index/disk_size":{unit:"bytes",title:"Index Total Disk Size",desc:"Bytes on disk used by Index across all indexes and buckets."},"index/frag_percent":null,"index/fragmentation":{unit:"percent",title:"Index Total Fragmentation",desc:"Percentage fragmentation for all indexes. Note: at small index sizes of less than a hundred kB, the static overhead of the index disk file will inflate the index fragmentation percentage."},"index/cache_hits":null,"index/cache_misses":null,"index/items_count":{unit:"number",title:"Index Doc Count",desc:"Current total number of indexed documents"},"index/memory_used":{unit:"bytes",title:"Index RAM Used",desc:"Total memory used by the index."},"index/num_docs_indexed":{unit:"number/sec",title:"Indexing Rate",desc:"Number of documents indexed by the indexer per second."},"index/num_docs_pending":null,"index/num_docs_queued":null,"index/num_requests":{unit:"number/sec",title:"Index Request Rate",desc:"Number of requests served by the indexer per second"},"index/num_rows_returned":{unit:"number/sec",title:"Index Total Scan Rate",desc:"Number of index items scanned by the indexer per second across all indexes."},"index/recs_in_mem":null,"index/recs_on_disk":null,"index/scan_bytes_read":{unit:"bytes/sec",title:"Index Scan Bytes",desc:"Number of bytes/sec scanned by the index."},"index/total_scan_duration":null},"@query":{"query_avg_req_time":{unit:"second",title:"Query Request Time",desc:"Average end-to-end time to process a query (in seconds)."},"query_avg_svc_time":{unit:"second",title:"Query Execution Time",desc:"Average time to execute a query (in seconds)."},"query_avg_response_size":{unit:"bytes",title:"Query Result Size",desc:"Average size (in bytes) of the data returned by a query"},"query_avg_result_count":{unit:"number",title:"Query Result Items",desc:"Average number of results (items/documents) returned by a query."},"query_active_requests":null,"query_errors":{unit:"number/sec",title:"N1QL Error Rate",desc:"Number of N1QL errors returned per second."},"query_invalid_requests":{unit:"number/sec",title:"N1QL Invalid Request Rate",desc:"Number of requests for unsupported endpoints per second, specifically HTTP requests for all endpoints not supported by the query engine. For example, a request for http://localhost:8093/foo will be included. Potentially useful in identifying DOS attacks."},"query_queued_requests":null,"query_request_time":null,"query_requests":{unit:"number/sec",title:"N1QL Request Rate",desc:"Number of N1QL requests processed per second."},"query_requests_1000ms":{unit:"number/sec",title:"Queries > 1000ms",desc:"Number of queries that take longer than 1000 ms per second"},"query_requests_250ms":{unit:"number/sec",title:"Queries > 250ms",desc:"Number of queries that take longer than 250 ms per second."},"query_requests_5000ms":{unit:"number/sec",title:"Queries > 5000ms",desc:"Number of queries that take longer than 5000 ms per second."},"query_requests_500ms":{unit:"number/sec",title:"Queries > 500ms",desc:"Number of queries that take longer than 500 ms per second."},"query_result_count":null,"query_result_size":null,"query_selects":{unit:"number/sec",title:"N1QL Select Rate",desc:"Number of N1QL selects processed per second."},"query_service_time":null,"query_warnings":{unit:"number/sec",title:"N1QL Warning Rate",desc:"Number of N1QL warnings returned per second."}},"@fts-":{"@items":{"avg_queries_latency":{unit:"millisecond",title:"Search Query Latency",desc:"Average milliseconds to answer a Search query. Per index. (measured from avg_queries_latency)"},"doc_count":{unit:"number",title:"Search Docs",desc:"Number of documents examined. Per index. (measured from doc_count)"},"num_bytes_used_disk":{unit:"bytes",title:"Search Disk Size",desc:"Bytes on disk for this index. Per index. (measured from num_bytes_used_disk)"},"num_files_on_disk":{unit:"number",title:"Search Disk Files",desc:"Number of search files on disk across all partitions. (measured from num_files_on_disk)"},"num_root_memorysegments":{unit:"number",title:"Search Memory Segments",desc:"Number of memory segments in the index across all partitions. (measured from num_root_memorysegments)"},"num_root_filesegments":{unit:"number",title:"Search Disk Segments",desc:"Number of file segments in the index across all partitions. (measured from num_root_filesegments)"},"num_mutations_to_index":{unit:"number",title:"Search Mutations Remaining",desc:"Number of mutations not yet indexed. Per index. (measured from num_mutations_to_index)"},"num_pindexes_actual":{unit:"number",title:"Search Partitions",desc:"Number of index partitions. Per index. (including replica partitions, measured from num_pindexes_actual)"},"num_pindexes_target":{unit:"number",title:"Search Partitions Expected",desc:"Number of index partitions expected. Per index. (including replica partitions, measured from num_pindexes_target)"},"num_recs_to_persist":{unit:"number",title:"Search Records to Persist",desc:"Number of index records not yet persisted to disk. Per index. (measured from num_recs_to_persist)"},"total_bytes_indexed":{unit:"bytes/sec",title:"Search Index Rate",desc:"Bytes of plain text indexed per second. Per index. (measured from total_bytes_indexed)"},"total_bytes_query_results":{unit:"bytes/sec",title:"Search Result Rate",desc:"Bytes returned in results per second. Per index. (measured from total_bytes_query_results)"},"total_compaction_written_bytes":{unit:"bytes/sec",title:"Search Compaction Rate",desc:"Compaction bytes written per second. Per index. (measured from total_compaction_written_bytes)",},"total_queries":{unit:"number/sec",title:"Search Query Rate",desc:"Number of queries per second. Per index. (measured from total_queries)"},"total_queries_error":{unit:"number/sec",title:"Search Query Error Rate",desc:"Number of queries per second (including timeouts) that resulted in errors. Per index. (measured from total_queries_error)"},"total_queries_slow":{unit:"number/sec",title:"Search Slow Queries",desc:"Number of slow queries (> 5s to run) per second. Per index. (measured from total_queries_slow)"},"total_queries_timeout":{unit:"number/sec",title:"Search Query Timeout Rate",desc:"Number of queries that timeout per second. Per index. (measured from total_queries_timeout)"},"total_request_time":null,"total_term_searchers":{unit:"number/sec",title:"Term Searchers Start Rate",desc:"Number of term searchers started per second. Per index. (measured from total_term_searchers)"},},"fts/doc_count":null,"fts/num_bytes_used_disk":{unit:"bytes",title:"Search Total Disk Used",desc:"Bytes stored on disk for all Search indexes in this bucket."},"fts/num_files_on_disk":{unit:"number",title:"Search Disk Files",desc:"Number of search files on disk across all partitions."},"fts/num_mutations_to_index":null,"fts/num_pindexes_actual":null,"fts/num_pindexes_target":null,"fts/num_recs_to_persist":null,"fts/total_bytes_indexed":{unit:"bytes/sec",title:"Search Index Rate",desc:"Search bytes indexed per second for all Search indexes in this bucket."},"fts/total_bytes_query_results":null,"fts/total_compaction_written_bytes":null,"fts/total_queries":{unit:"number/sec",title:"Search Query Rate",desc:"Search queries per second for all Search indexes in this bucket."},"fts/total_queries_error":null,"fts/total_queries_slow":null,"fts/total_queries_timeout":null,"fts/total_request_time":null,"fts/total_term_searchers":null},"@fts":{"fts_num_bytes_used_ram":{unit:"bytes",title:"Search Total RAM Used",desc:"Bytes of RAM used by Search across all indexes and all buckets on this server."},"fts_total_queries_rejected_by_herder":{unit:"number",title:"Search Queries Rejected",desc:"Number of queries rejected by throttler due to high memory consumption."},"fts_curr_batches_blocked_by_herder":{unit:"number",title:"DCP batches blocked by FTS throttler",desc:"DCP batches blocked by throttler due to high memory consumption."}},"@cbas-":{"cbas/failed_at_parser_records_count":null,"cbas/failed_at_parser_records_count_total":{unit:"number",title:"Analytics Parse Fail Since Connect",desc:"Number of records Analytics failed to parse during bucket synchronization - since last bucket connect."},"cbas/incoming_records_count":{unit:"number/sec",title:"Analytics Ops Rate",desc:"Operations (gets + sets + deletes) per second processed by Analytics for this bucket."},"cbas/incoming_records_count_total":{unit:"number",title:"Analytics Ops Since Connect",desc:"Number of operations (gets + sets + deletes) processed by Analytics for this bucket since last bucket connect."}},"@cbas":{"cbas_disk_used":{unit:"bytes",title:"Analytics Total Disk Size",desc:"The total disk size used by Analytics."},"cbas_gc_count":{unit:"number",title:"Analytics Garbage Collection Rate",desc:"Number of JVM garbage collections per second for this Analytics node."},"cbas_gc_time":{unit:"millisecond/sec",title:"Analytics Garbage Collection Time",desc:"The amount of time in milliseconds spent performing JVM garbage collections for Analytics node."},"cbas_heap_used":{unit:"bytes",title:"Analytics Heap Used",desc:"Bytes of JVM heap used by Analytics on this server."},"cbas_system_load_average":{unit:"bytes",title:"Analytics System Load",desc:"System load in bytes for Analytics node."},"cbas_thread_count":{unit:"number",title:"AnalyticsThread Count",desc:"Number of threads for Analytics node."},"cbas_io_reads":{unit:"bytes/sec",title:"Analytics Read Rate",desc:"Number of disk bytes read on Analytics node per second."},"cbas_io_writes":{unit:"bytes/sec",title:"Analytics Write Rate",desc:"Number of disk bytes written on Analytics node per second."}},"@eventing":{"eventing/processed_count":{unit:"number",title:"Eventing Mutations Processed",desc:"Mutations the function has finished processing. Per function."},"eventing/failed_count":{unit:"number",title:"Eventing Failures",desc:"Mutations for which the function execution failed. Per function."},"eventing/dcp_backlog":{unit:"number",title:"Eventing Backlog",desc:"Remaining mutations to be processed by the function. Per function."},"eventing/timeout_count":{unit:"number",title:"Eventing Timeouts",desc:"Execution timeouts while processing mutations. Per function."}},"@xdcr-":{"replication_changes_left":{unit:"number/sec",title:"XDCR Total Outbound Mutations",desc:"Number of mutations to be replicated to other clusters. (measured from replication_changes_left)"},"replication_docs_rep_queue":null,"@items":{"percent_completeness":{unit:"percent",title:"XDCR Checked Ratio",desc:"Percentage of checked items out of all checked and to-be-replicated items. Per-replication. (measured from percent_completeness)"},"bandwidth_usage":{unit:"bytes/sec",title:"XDCR Replication Rate",desc:"Rate of replication in terms of bytes replicated per second. Per-replication. (measured from bandwidth_usage)"},"changes_left":{unit:"number",title:"XDCR Replication Mutations",desc:"Number of mutations to be replicated to other clusters. Per-replication. (measured from changes_left)"},"data_replicated":null,"dcp_datach_length":null,"dcp_dispatch_time":null,"deletion_docs_written":null,"deletion_failed_cr_source":null,"deletion_filtered":null,"deletion_received_from_dcp":null,"docs_checked":null,"docs_failed_cr_source":{unit:"number",title:"XDCR Mutations Skipped",desc:"Number of mutations that failed conflict resolution on the source side and hence have not been replicated to other clusters. Per-replication. (measured from per-replication stat docs_failed_cr_source)"},"docs_filtered":{unit:"number/sec",title:"XDCR Mutations Filtered Rate",desc:"Number of mutations per second that have been filtered out and have not been replicated to other clusters. Per-replication. (measured from per-replication stat docs_filtered)"},"docs_opt_repd":null,"docs_processed":null,"docs_received_from_dcp":null,"docs_rep_queue":null,"docs_written":{unit:"number",title:"XDCR Mutations Replicated",desc:"Number of mutations that have been replicated to other clusters. Per-replication. (measured from docs_written)"},"expiry_docs_written":null,"expiry_failed_cr_source":null,"expiry_filtered":null,"expiry_received_from_dcp":null,"num_checkpoints":null,"num_failedckpts":null,"rate_doc_checks":{unit:"number/sec",title:"XDCR Doc Check Rate",desc:"Number of doc checks per second. Per-replication."},"rate_doc_opt_repd":{unit:"number/sec",title:"XDCR Optimistic Replication Rate",desc:"Number of replicated mutations per second. Per-replication."},"rate_received_from_dcp":{unit:"number/sec",title:"doc reception rate",desc:"Rate of mutations received from dcp in terms of number of mutations per second. Per-replication."},"rate_replicated":{unit:"number/sec",title:"XDCR Replication Rate",desc:"Number of replicated mutations per second. Per-replication. (measured from rate_replicated)"},"resp_wait_time":null,"set_docs_written":null,"set_failed_cr_source":null,"set_filtered":null,"set_received_from_dcp":null,"size_rep_queue":null,"throttle_latency":null,"time_committing":null,"wtavg_docs_latency":{unit:"millisecond",title:"XDCR Doc Batch Latency",desc:"Weighted average latency in ms of sending replicated mutations to remote cluster. Per-replication. (measured from wtavg_docs_latency)"},"wtavg_meta_latency":{unit:"millisecond",title:"XDCR Meta Batch Latency",desc:"Weighted average latency in ms of sending getMeta and waiting for a conflict solution result from remote cluster. Per-replication. (measured from wtavg_meta_latency)"}}}}}}})();(function(){"use strict";angular.module('mnStatisticsNewService',["mnServersService",'mnPoll',"mnStatisticsDescriptionService","mnHelper"]).factory('mnStatisticsNewService',mnStatisticsNewServiceFactory);function mnStatisticsNewServiceFactory($http,$q,mnServersService,mnPoller,$rootScope,mnStatisticsDescriptionService,mnHelper,mnStoreService){var rootScope=$rootScope.$new();var perChartConfig=[];var perChartScopes=[];var currentPerChartScopes=[];var formatSecond=d3.timeFormat("%-I:%M:%S%p");var formatMinute=d3.timeFormat("%-I:%M%p");var formatHour=d3.timeFormat("%-I%p");var formatDayMonth=d3.timeFormat("%b %-d");var formatYear=d3.timeFormat("%Y");var mnStatisticsNewService={prepareNodesList:prepareNodesList,export:{scenario:{}},subscribeUIStatsPoller:subscribeUIStatsPoller,descriptionPathsToStatNames:descriptionPathsToStatNames,descriptionPathToStatName:descriptionPathToStatName,defaultZoomInterval:defaultZoomInterval,copyScenario:copyScenario,deleteScenario:deleteScenario,deleteGroup:deleteGroup,deleteChart:deleteChart,doAddPresetScenario:doAddPresetScenario,getStatsDirectory:getStatsDirectory,readByPath:readByPath,getStatsUnits:getStatsUnits,getStatsTitle:getStatsTitle,getStatsDesc:getStatsDesc,tickMultiFormat:multiFormat,heartbeat:new mnPoller(rootScope,function(){currentPerChartScopes=[...perChartScopes];return postStats([...perChartConfig]);}).setInterval(function(resp){return resp.interval||1000;}).subscribe(function(value){if(!value.data){return;}
currentPerChartScopes.forEach(function(scope,i){scope["mnUIStats"]=value.data[i];});})};return mnStatisticsNewService;function defaultZoomInterval(zoom){return function(resp){return resp.interval||(function(){switch(zoom){case"minute":return 1000;default:return 15000;}})();};}
function multiFormat(date){return(d3.timeMinute(date)<date?formatSecond:d3.timeHour(date)<date?formatMinute:d3.timeDay(date)<date?formatHour:d3.timeMonth(date)<date?formatDayMonth:d3.timeYear(date)<date?formatDayMonth:formatYear)(date);}
function getStatsDirectory(bucket,params){params=params||{adde:'"all"',adda:'"all"',addi:'"all"',addf:'"all"',addq:"1"};return $http({url:"/pools/default/buckets//"+bucket+"/statsDirectory",method:'GET',params:params});}
function deleteChart(chartID){var group=mnStoreService.store("groups").getByIncludes(chartID,"charts");group.charts.splice(group.charts.indexOf(chartID),1);mnStoreService.store("charts").delete(chartID);}
function deleteGroup(groupID){var scenario=mnStoreService.store("scenarios").getByIncludes(groupID,"groups");scenario.groups.splice(scenario.groups.indexOf(groupID),1);var group=mnStoreService.store("groups").get(groupID);group.charts.forEach(function(chartID){mnStoreService.store("charts").delete(chartID);});mnStoreService.store("groups").delete(groupID);}
function deleteScenario(scenarioID){var scenario=mnStoreService.store("scenarios").get(scenarioID);mnStoreService.store("scenarios").deleteItem(scenario);scenario.groups.forEach(function(groupID){var group=mnStoreService.store("groups").get(groupID);mnStoreService.store("groups").deleteItem(group);group.charts.forEach(function(chartID){mnStoreService.store("charts").delete(chartID);});});}
function copyScenario(scenario,copyFrom){scenario=mnStoreService.store("scenarios").add(scenario);scenario.groups=(copyFrom.groups||[]).map(function(groupID){var groupToCopy=mnStoreService.store("groups").get(groupID);var copiedGroup=mnStoreService.store("groups").add(groupToCopy);copiedGroup.preset=false;copiedGroup.charts=(copiedGroup.charts||[]).map(function(chartID){var chartToCopy=mnStoreService.store("charts").get(chartID);var copiedChart=mnStoreService.store("charts").add(chartToCopy);copiedChart.preset=false;return copiedChart.id;});return copiedGroup.id;});}
function getStatsTitle(stats){return Object.keys(stats).map(function(descPath){var desc=mnStatisticsNewService.readByPath(descPath);return desc?desc.title:descPath.split(".").pop();}).join(", ");}
function getStatsDesc(stats){return Object.keys(stats).map(function(descPath){var desc=mnStatisticsNewService.readByPath(descPath);if(desc){return"<b>"+desc.title+"</b><p>"+desc.desc+"</p>";}else{return"<b>"+descPath.split(".").pop()+"</b>"+"<p>There is no such stat name anymore. Edit the chart in order to remove it.</p>";}}).join("");}
function getStatsUnits(stats){var units={};Object.keys(stats).forEach(function(descPath){if(!stats[descPath]){return;}
var desc=mnStatisticsNewService.readByPath(descPath);if(desc){units[desc.unit]=true;}});return units;}
function readByPath(descPath){var paths=descPath.split('.');var statsDesc=mnStatisticsDescriptionService.stats;var i;for(i=0;i<paths.length;++i){if(statsDesc[paths[i]]==undefined){return undefined;}else{statsDesc=statsDesc[paths[i]];}}
return statsDesc;}
function postStats(perChartConfig){return $http({url:'/_uistats',method:'POST',mnHttp:{group:"global",isNotForm:true},data:perChartConfig});}
function descriptionPathToStatName(descPath,items){var splitted=descPath.split(".");var service=splitted[0].substring(1,splitted[0].length-1);var maybeItem=descPath.includes("@items")&&((items||{})[service])
return(maybeItem||"")+splitted[splitted.length-1];}
function descriptionPathsToStatNames(chartConfig,items){return Object.keys(chartConfig.stats).map(function(descPath){return descriptionPathToStatName(descPath,items);});}
function zoomToMS(zoom){switch(zoom){case"minute":return 60000;case"hour":return 3600000;case"day":return 86400000;case"week":return 604800000
case"month":return 2628000000;default:return zoom}}
function zoomToStep(zoom){return zoomToMS(zoom)/60000;}
function subscribeUIStatsPoller(config,scope){config.startTS=0-zoomToMS(config.zoom);config.step=config.step||zoomToStep(config.zoom);if(config.node=="all"&&!config.specificStat){config.aggregate=true;}
if(config.node!=="all"){config.nodes=[config.node];}
_.difference(Object.keys(config),["bucket","stats","startTS","endTS","step","nodes","aggregate"]).forEach(function(key){delete config[key];});perChartConfig.push(config);perChartScopes.push(scope);scope.$on("$destroy",function(){perChartConfig.splice(perChartConfig.indexOf(config),1);perChartScopes.splice(perChartScopes.indexOf(scope),1);if(!perChartConfig.length){currentPerChartScopes=[];mnStatisticsNewService.heartbeat.stop();}});mnStatisticsNewService.heartbeat.throttledReload();}
function prepareNodesList(params){return mnServersService.getNodes().then(function(nodes){var rv={};rv.nodesNames=_(nodes.active).filter(function(node){return!(node.clusterMembership==='inactiveFailed')&&!(node.status==='unhealthy');}).pluck("hostname").value();rv.nodesNames.unshift("All Server Nodes ("+rv.nodesNames.length+")");rv.nodesNames.selected=params.statsHostname==="all"?rv.nodesNames[0]:params.statsHostname;return rv;});}
function doAddPresetScenario(){presetScenario().forEach(function(scenario){scenario.preset=true;scenario.groups=scenario.groups.map(function(group){group.preset=true;group.charts=group.charts.map(function(chart){chart.preset=true;chart=mnStoreService.store("charts").add(chart);return chart.id;});group=mnStoreService.store("groups").add(group);return group.id;});mnStoreService.store("scenarios").add(scenario);});}
function presetScenario(){return[{name:"Cluster Overview",desc:"Stats showing the general health of your cluster.",groups:[{name:"Cluster Overview",isOpen:true,charts:[{stats:{"@kv-.ops":true,"@query.query_requests":true,"@fts-.@items.total_queries":true,"@kv-.ep_tmp_oom_errors":true,"@kv-.ep_cache_miss_rate":true,"@kv-.cmd_get":true,"@kv-.cmd_set":true,"@kv-.delete_hits":true,"@kv-.@items.accesses":true},size:"large",specificStat:false},{stats:{"@kv-.mem_used":true,"@kv-.ep_mem_low_wat":true,"@kv-.ep_mem_high_wat":true},size:"medium",specificStat:false},{stats:{"@kv-.curr_items":true,"@kv-.vb_replica_curr_items":true,"@kv-.vb_active_resident_items_ratio":true,"@kv-.vb_replica_resident_items_ratio":true},size:"medium",specificStat:false},{stats:{"@kv-.disk_write_queue":true},size:"small",specificStat:true},{stats:{"@kv-.ep_dcp_replica_items_remaining":true},size:"small",specificStat:true},{stats:{"@kv-.ep_data_read_failed":true,"@kv-.ep_data_write_failed":true,"@query.query_errors":true,"@query.total_queries_error":true,"@eventing.eventing/failed_count":true},size:"small",specificStat:false},{stats:{"@query.query_requests_250ms":true,"@query.query_requests_500ms":true,"@query.query_requests_1000ms":true,"@query.query_requests_5000ms":true},size:"small",specificStat:false},{stats:{"@xdcr-.replication_changes_left":true},size:"small",specificStat:true},{stats:{"@index-.@items.num_docs_pending+queued":true},size:"small",specificStat:true},{stats:{"@fts-.@items.num_mutations_to_index":true},size:"small",specificStat:true},{stats:{"@eventing.eventing/dcp_backlog":true},size:"small",specificStat:true},]},{name:"Node Resources",isOpen:false,charts:[{stats:{"@system.cpu_utilization_rate":true},size:"medium",specificStat:true},{stats:{"@system.rest_requests":true},size:"medium",specificStat:true},{stats:{"@system.mem_actual_free":true},size:"medium",specificStat:false},{stats:{"@system.swap_used":true},size:"medium",specificStat:true}]}]},{name:"All Services",desc:'Most common stats, arranged per service. Customize and make your own dashboard with "new dashboard... " below.',groups:[{name:"Data (Docs/Views/XDCR)",isOpen:true,charts:[{stats:{"@kv-.mem_used":true,"@kv-.ep_mem_low_wat":true,"@kv-.ep_mem_high_wat":true,"@kv-.ep_kv_size":true,"@kv-.ep_meta_data_memory":true,"@kv-.vb_active_resident_items_ratio":true},size:"medium",specificStat:false},{stats:{"@kv-.ops":true,"@kv-.ep_cache_miss_rate":true,"@kv-.cmd_get":true,"@kv-.cmd_set":true,"@kv-.delete_hits":true,"@kv-.@items.accesses":true,"@kv-.ep_num_ops_set_meta":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_dcp_views+indexes_items_remaining":true,"@kv-.ep_dcp_cbas_items_remaining":true,"@kv-.ep_dcp_replica_items_remaining":true,"@kv-.ep_dcp_xdcr_items_remaining":true,"@kv-.ep_dcp_eventing_items_remaining":true,"@kv-.ep_dcp_other_items_remaining":true,"@xdcr-.replication_changes_left":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_bg_fetched":true,"@kv-.ep_data_read_failed":true,"@kv-.ep_data_write_failed":true,"@kv-.ep_ops_create":true,"@kv-.ep_ops_update":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_diskqueue_items":true},size:"small",specificStat:true}]},{name:"Query",isOpen:false,charts:[{stats:{"@query.query_requests_1000ms":true,"@query.query_requests_500ms":true,"@query.query_requests_5000ms":true},size:"medium",specificStat:false},{stats:{"@query.query_selects":true,"@query.query_requests":true,"@query.query_warnings":true,"@query.query_invalid_requests":true,"@query.query_errors":true},size:"medium",specificStat:false},{stats:{"@query.query_avg_req_time":true,"@query.query_avg_svc_time":true},size:"small",specificStat:false},{stats:{"@query.query_avg_result_count":true},size:"small",specificStat:true},{stats:{"@query.query_avg_response_size":true},size:"small",specificStat:false}]},{name:"Index",isOpen:false,charts:[{stats:{"@index-.index/num_rows_returned":true},size:"small",specificStat:true},{stats:{"@index-.@items.num_docs_pending+queued":true},size:"small",specificStat:true},{stats:{"@index-.index/data_size":true},size:"small",specificStat:true},{stats:{"@index-.index/disk_size":true},size:"small",specificStat:true},{stats:{"@index.index_ram_percent":true,"@index.index_remaining_ram":true,"@index-.index/data_size":true,"@index-.index/disk_size":true},size:"medium",specificStat:false}]},{name:"Search",isOpen:false,charts:[{stats:{"@fts-.fts/num_bytes_used_disk":true,"@fts.fts_num_bytes_used_ram":true},size:"medium",specificStat:false},{stats:{"@fts-.@items.total_queries":true,"@fts-.@items.total_queries_error":true,"@fts-.@items.total_queries_slow":true,"@fts-.@items.total_queries_timeout":true,"@fts.fts_total_queries_rejected_by_herder":true},size:"medium",specificStat:false}]},{name:"Analytics",enterprise:true,isOpen:false,charts:[{stats:{"@cbas-.cbas/incoming_records_count":true},size:"small",specificStat:true},{stats:{"@cbas.cbas_heap_used":true},size:"small",specificStat:true},{stats:{"@cbas.cbas_disk_used":true},size:"small",specificStat:true},{stats:{"@cbas.cbas_system_load_average":true},size:"small",specificStat:true}]},{name:"Eventing",enterprise:true,isOpen:false,charts:[{stats:{"@eventing.eventing/dcp_backlog":true},size:"small",specificStat:true},{stats:{"@eventing.eventing/failed_count":true,"@eventing.eventing/timeout_count":true},size:"small",specificStat:false}]},{name:"XDCR",isOpen:false,charts:[{stats:{"@xdcr-.replication_changes_left":true},size:"small",specificStat:true},{stats:{"@xdcr-.@items.changes_left":true},size:"small",specificStat:true},{stats:{"@xdcr-.@items.wtavg_docs_latency":true,"@xdcr-.@items.wtavg_meta_latency":true},size:"small",specificStat:false},{stats:{"@xdcr-.@items.docs_failed_cr_source":true,"@xdcr-.@items.docs_filtered":true},size:"small",specificStat:false}]},{name:"vBucket Resources",isOpen:false,charts:[{stats:{"@kv-.vb_active_num":true,"@kv-.vb_replica_num":true,"@kv-.vb_pending_num":true,"@kv-.ep_vb_total":true},size:"medium",specificStat:false},{stats:{"@kv-.curr_items":true,"@kv-.vb_replica_curr_items":true,"@kv-.vb_pending_curr_items":true,"@kv-.curr_items_tot":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_active_resident_items_ratio":true,"@kv-.vb_replica_resident_items_ratio":true,"@kv-.vb_pending_resident_items_ratio":true,"@kv-.ep_resident_items_rate":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_active_ops_create":true,"@kv-.vb_replica_ops_create":true,"@kv-.vb_pending_ops_create":true,"@kv-.ep_ops_create":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_active_eject":true,"@kv-.vb_replica_eject":true,"@kv-.vb_pending_eject":true,"@kv-.ep_num_value_ejects":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_active_itm_memory":true,"@kv-.vb_replica_itm_memory":true,"@kv-.vb_pending_itm_memory":true,"@kv-.ep_kv_size":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_active_meta_data_memory":true,"@kv-.vb_replica_meta_data_memory":true,"@kv-.vb_pending_meta_data_memory":true,"@kv-.ep_meta_data_memory":true},size:"medium",specificStat:false}]},{name:"DCP Queues",isOpen:false,charts:[{stats:{"@kv-.ep_dcp_views+indexes_count":true,"@kv-.ep_dcp_cbas_count":true,"@kv-.ep_dcp_replica_count":true,"@kv-.ep_dcp_xdcr_count":true,"@kv-.ep_dcp_eventing_count":true,"@kv-.ep_dcp_other_count":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_dcp_views+indexes_producer_count":true,"@kv-.ep_dcp_cbas_producer_count":true,"@kv-.ep_dcp_replica_producer_count":true,"@kv-.ep_dcp_xdcr_producer_count":true,"@kv-.ep_dcp_xdcr_eventing_count":true,"@kv-.ep_dcp_other_producer_count":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_dcp_views+indexes_items_remaining":true,"@kv-.ep_dcp_cbas_items_remaining":true,"@kv-.ep_dcp_replica_items_remaining":true,"@kv-.ep_dcp_xdcr_items_remaining":true,"@kv-.ep_dcp_eventing_items_remaining":true,"@kv-.ep_dcp_other_items_remaining":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_dcp_views+indexes_items_sent":true,"@kv-.ep_dcp_cbas_items_sent":true,"@kv-.ep_dcp_replica_items_sent":true,"@kv-.ep_dcp_xdcr_items_sent":true,"@kv-.ep_dcp_eventing_items_sent":true,"@kv-.ep_dcp_other_items_sent":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_dcp_views+indexes_total_bytes":true,"@kv-.ep_dcp_cbas_total_bytes":true,"@kv-.ep_dcp_replica_total_bytes":true,"@kv-.ep_dcp_xdcr_total_bytes":true,"@kv-.ep_dcp_eventing_total_bytes":true,"@kv-.ep_dcp_other_total_bytes":true},size:"medium",specificStat:false},{stats:{"@kv-.ep_dcp_views+indexes_backoff":true,"@kv-.ep_dcp_cbas_backoff":true,"@kv-.ep_dcp_replica_backoff":true,"@kv-.ep_dcp_xdcr_backoff":true,"@kv-.ep_dcp_eventing_backoff":true,"@kv-.ep_dcp_other_backoff":true},size:"medium",specificStat:false}]},{name:"Disk Queues",isOpen:false,charts:[{stats:{"@kv-.ep_diskqueue_fill":true,"@kv-.ep_diskqueue_drain":true,"@kv-.ep_diskqueue_items":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_active_queue_fill":true,"@kv-.vb_active_queue_drain":true,"@kv-.vb_active_queue_size":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_replica_queue_fill":true,"@kv-.vb_replica_queue_drain":true,"@kv-.vb_replica_queue_size":true},size:"medium",specificStat:false},{stats:{"@kv-.vb_pending_queue_fill":true,"@kv-.vb_pending_queue_drain":true,"@kv-.vb_pending_queue_size":true},size:"medium",specificStat:false}]}]}]}}})();(function(){"use strict";angular.module('mnStatisticsNew',['mnStatisticsNewService','mnStatisticsDescriptionService','mnPoll','mnBucketsService','mnHelper','ui.router','ui.bootstrap','mnBucketsStats','mnSpinner','mnStatisticsChart','mnUserRolesService','mnFilters','mnStoreService']).controller('mnStatisticsNewController',mnStatisticsNewController).controller('mnStatisticsGroupsController',mnStatisticsGroupsController).controller('mnStatisticsChartsController',mnStatisticsChartsController);function mnStatisticsChartsController($scope,$rootScope,$uibModal,mnStatisticsNewService,mnStoreService,mnHelper,mnUserRolesService,$state,$timeout){var vm=this;vm.deleteChart=deleteChart;vm.editChart=editChart;vm.openDetailedChartDialog=openDetailedChartDialog;vm.chart=mnStoreService.store("charts").get($scope.chartID);vm.api={};function deleteChart(){vm.showChartControls=false;$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/chart_builder/mn_statistics_chart_builder_delete.html'}).result.then(function(){mnStatisticsNewService.deleteChart($scope.chartID);mnUserRolesService.saveDashboard();$scope.mnStatsGroupsCtl.maybeShowItemsControls();});}
function editChart(group,scenario){vm.showChartControls=false;$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/chart_builder/mn_statistics_chart_builder.html',controller:'mnStatisticsNewChartBuilderController as builderCtl',resolve:{chart:mnHelper.wrapInFunction(vm.chart),group:mnHelper.wrapInFunction(group),scenario:mnHelper.wrapInFunction(scenario)}}).result.then(function(){mnUserRolesService.saveDashboard();vm.reloadChartDirective=true;$timeout(function(){vm.reloadChartDirective=false;$scope.mnStatsGroupsCtl.maybeShowItemsControls();});});}
function openDetailedChartDialog(){$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/mn_statistics_detailed_chart.html',controller:'mnStatisticsDetailedChartController as detailedChartCtl',windowTopClass:"chart-overlay",resolve:{items:mnHelper.wrapInFunction($scope.mnStatsGroupsCtl.items),chart:mnHelper.wrapInFunction(vm.chart)}});}}
function mnStatisticsGroupsController($scope,$uibModal,$timeout,mnStatisticsNewService,mnStoreService,mnUserRolesService){var vm=this;vm.isDetailsOpened=true;vm.hideGroupControls=hideGroupControls;vm.onGroupNameBlur=onGroupNameBlur;vm.onGroupFocus=onGroupFocus;vm.onGroupSubmit=onGroupSubmit;vm.onGroupDelete=onGroupDelete;vm.deleteGroup=deleteGroup;vm.maybeShowItemsControls=maybeShowItemsControls;vm.saveDashboard=mnUserRolesService.saveDashboard;vm.items={};vm.enabledItems={};vm.group=mnStoreService.store("groups").get($scope.groupID);maybeShowItemsControls();$scope.$watch("mnStatsGroupsCtl.items.index",onItemChange);$scope.$watch("mnStatsGroupsCtl.items.xdcr",onItemChange);$scope.$watch("mnStatsGroupsCtl.items.fts",onItemChange);$scope.$watch("mnStatsGroupsCtl.items.kv",onItemChange);function onItemChange(){vm.reloadChartDirective=true;$timeout(function(){vm.reloadChartDirective=false;});}
function maybeShowItemsControls(){var items={};((vm.group||{}).charts||[]).forEach(function(chartID){var stats=mnStoreService.store("charts").get(chartID)?mnStoreService.store("charts").get(chartID).stats:{};var chartStats=Object.keys(stats);chartStats.forEach(function(statPath){if(statPath.includes("@items")){items[statPath.split(".")[0]]=true;}});});vm.enabledItems=items;}
function deleteGroup(groupID){$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/mn_statistics_group_delete.html',}).result.then(function(){mnStatisticsNewService.deleteGroup(groupID);mnUserRolesService.saveDashboard();});}
function onGroupDelete(){vm.onControlClick=true;deleteGroup($scope.groupID);hideGroupControls();}
function onGroupSubmit(){vm.initName=vm.group.name;mnUserRolesService.saveDashboard()
hideGroupControls();vm.focusOnSubmit=true;}
function onGroupFocus(){vm.showGroupControls=true;vm.initName=vm.group.name;}
function onGroupNameBlur(){if(!vm.onControlClick){vm.showGroupControls=false;vm.group.name=vm.initName;mnStoreService.store("groups").put(vm.group);}}
function hideGroupControls(){if(vm.onControlClick){vm.onControlClick=false;onGroupNameBlur();}}}
function mnStatisticsNewController($scope,mnStatisticsNewService,$state,$http,mnPoller,mnBucketsService,$uibModal,$rootScope,mnHelper,$window,mnUserRolesService,permissions,$timeout,mnStoreService,mnGsiService,mnViewsListService,mnTasksDetails,$anchorScroll,$location){var vm=this;vm.mnStatisticsNewScope=$scope;vm.onSelectScenario=onSelectScenario;vm.onSelectZoom=onSelectZoom;vm.bucket=$state.params.scenarioBucket;vm.zoom=$state.params.scenarioZoom;vm.node=$state.params.statsHostname;vm.scenario={};vm.openGroupDialog=openGroupDialog;vm.selectedBucket=$state.params.scenarioBucket;vm.onBucketChange=onBucketChange;vm.onSelectNode=onSelectNode;vm.openChartBuilderDialog=openChartBuilderDialog;vm.resetDashboardConfiguration=resetDashboardConfiguration;vm.showBlocks={"Server Resources":true};activate();function resetDashboardConfiguration(){return $uibModal.open({templateUrl:'app/mn_admin/mn_statistics/mn_statistics_reset_dialog.html'}).result.then(function(){mnStoreService.store("charts").clear();mnStoreService.store("groups").clear();mnStoreService.store("scenarios").clear();mnStatisticsNewService.doAddPresetScenario();vm.scenario.selected=mnStoreService.store("scenarios").last();$state.go("^.statistics",{scenario:mnStoreService.store("scenarios").last().id});return mnUserRolesService.saveDashboard();});}
function openGroupDialog(scenario){$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/mn_statistics_group.html',controller:'mnGroupDialogController as groupDialogCtl',resolve:{scenario:mnHelper.wrapInFunction(scenario)}}).result.then(function(group){$location.hash('group-'+group.id);$anchorScroll();});}
function openChartBuilderDialog(group,scenario,groupCtl){$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/chart_builder/mn_statistics_chart_builder.html',controller:'mnStatisticsNewChartBuilderController as builderCtl',resolve:{scenario:mnHelper.wrapInFunction(scenario),chart:mnHelper.wrapInFunction(),group:mnHelper.wrapInFunction(group)}}).result.then(function(){mnUserRolesService.saveDashboard();groupCtl.maybeShowItemsControls();});}
function onSelectNode(selectedHostname){$state.go('^.statistics',{statsHostname:selectedHostname.indexOf("All Server Nodes")>-1?"all":selectedHostname});}
function onBucketChange(bucket){$state.go('^.statistics',{scenarioBucket:bucket});}
function onSelectScenario(scenario){$state.go('^.statistics',{scenario:scenario.id,});}
function onSelectZoom(){$state.go('^.statistics',{scenarioZoom:vm.zoom});}
function initItemsDropdownSelect(){if($scope.rbac.cluster.tasks.read){new mnPoller($scope,function(){return mnTasksDetails.get().then(function(rv){if(!$state.params.scenarioBucket){return;}
return rv.tasksXDCR.filter(function(row){return row.source==$state.params.scenarioBucket;});});}).setInterval(10000).subscribe("xdcrItems",vm).reloadOnScopeEvent("reloadXdcrPoller").cycle();}
if($scope.rbac.cluster.settings.fts.read){new mnPoller($scope,function(){return $http.get('/_p/fts/api/index').then(function(rv){return Object.keys(rv.data.indexDefs.indexDefs).reduce(function(acc,key){var index=rv.data.indexDefs.indexDefs[key];if(index.sourceName==$state.params.scenarioBucket){acc.push(index);}
return acc;},[]);});}).setInterval(10000).subscribe("ftsItems",vm).reloadOnScopeEvent("reloadXdcrPoller").cycle();}
if($scope.rbac.cluster.bucket['.'].n1ql.index.read){new mnPoller($scope,function(){return mnGsiService.getIndexesState().then(function(rv){if(!$state.params.scenarioBucket){return;}
return rv.byBucket[$state.params.scenarioBucket];});}).setInterval(10000).subscribe("indexItems",vm).reloadOnScopeEvent("indexStatusURIChanged").cycle();}
if($scope.rbac.cluster.bucket['.'].views.read){new mnPoller($scope,function(){return mnStatisticsNewService.getStatsDirectory($state.params.scenarioBucket,{}).then(function(rv){if(!$state.params.scenarioBucket){return;}
return rv.data.blocks.filter(function(block){if(block.blockName.includes("View Stats")){block.statId=block.blockName.split(": ")[1];var name=block.stats[0].name.split("/");name.pop()
block.statKeyPrefix=name.join("/")+"/";return true;}});});}).setInterval(10000).subscribe("viewItems",vm).reloadOnScopeEvent("reloadViewsPoller").cycle();}}
function activate(){initItemsDropdownSelect();mnStatisticsNewService.heartbeat.setInterval(mnStatisticsNewService.defaultZoomInterval(vm.zoom));if($scope.rbac.cluster.stats.read){mnUserRolesService.getUserProfile().then(function(profile){vm.scenario.selected=$state.params.scenario?mnStoreService.store("scenarios").get($state.params.scenario):mnStoreService.store("scenarios").last();vm.scenarios=mnStoreService.store("scenarios").share();});}
new mnPoller($scope,function(){return mnStatisticsNewService.prepareNodesList($state.params);}).subscribe("nodes",vm).reloadOnScopeEvent("nodesChanged").cycle();}}})();(function(){"use strict";angular.module("mnStatisticsNew").controller("mnStatisticsNewChartBuilderController",mnStatisticsNewChartBuilderController).filter("mnFormatStatsSections",mnFormatStatsSections);function mnFormatStatsSections(){return function(section){if(section.includes("@")){section=section.substr(1);}
if(section.includes("-")){section=section.substr(0,section.length-1);}
switch(section){case"items":return"Item";case"system":return"System";case"xdcr":return"XDCR";default:return section;}};}
function mnStatisticsNewChartBuilderController(mnStatisticsNewService,chart,group,scenario,$uibModalInstance,mnStatisticsDescriptionService,$state,mnFormatStatsSectionsFilter,mnFormatServicesFilter,mnStoreService){var vm=this;vm.isEditing=!!chart;vm.create=create;vm.units={};vm.breadcrumbs={};vm.showInPopup=false;vm.tabs=["@system","@kv","@index","@query","@fts","@cbas","@eventing","@xdcr"];vm.statIsNotSupported=[];vm.onStatChecked=onStatChecked;vm.onSpecificChecked=onSpecificChecked;vm.maybeDisableField=maybeDisableField;vm.filterStats=filterStats;vm.selectTab=selectTab;vm.statsDesc=mnStatisticsDescriptionService.stats;vm.kvGroups=mnStatisticsDescriptionService.kvGroups;vm.getSelectedStats=getSelectedStats;vm.getSelectedStatsLength=getSelectedStatsLength;vm.formatGroupLabel=formatGroupLabel;var selectedUnits={};vm.selectedKVFilters={};var selectedByNodeStats={};var selectedStats={};activate();function formatGroupLabel(service){switch(service){case"@index":return"Indexes";case"@xdcr":return"Replications";case"@kv":return"Views";default:return"Items";}}
function selectTab(name){vm.tab=name;}
function getSelectedStatsLength(){return Object.keys(getSelectedStats()).length;}
function getSelectedStats(){return Object.keys(vm.newChart.stats).reduce(function(acc,key){if(vm.newChart.stats[key]){acc[key]=vm.newChart.stats[key];}
return acc;},{});}
function reActivateStats(){vm.units={};vm.breadcrumbs={};vm.disableStats=false;Object.keys(getSelectedStats()).forEach(onStatChecked);}
function filterStats(section){return!section.includes("-");}
function maybeDisableField(descPath){var stat=mnStatisticsNewService.readByPath(descPath);return((vm.newChart.specificStat=="false")&&vm.disableStats&&!vm.units[stat.unit])||(vm.newChart.specificStat=="true"&&vm.disableStats&&!vm.newChart.stats[descPath]);}
function onSpecificChecked(){if(vm.newChart.specificStat=="true"){selectedStats=vm.newChart.stats;vm.newChart.stats=selectedByNodeStats;}else{selectedByNodeStats=vm.newChart.stats;vm.newChart.stats=selectedStats;}
reActivateStats();}
function onStatChecked(descPath){var desc=mnStatisticsNewService.readByPath(descPath);var breadcrumb=descPath.split(".");if(!desc){vm.newChart.stats[descPath]=false;vm.statIsNotSupported.push(breadcrumb.pop());return;}
var value=vm.newChart.stats[descPath];if(vm.units[desc.unit]===undefined){vm.units[desc.unit]=0;}
if(value){vm.units[desc.unit]+=1;vm.breadcrumbs[breadcrumb.map(mnFormatStatsSectionsFilter).map(mnFormatServicesFilter).join(" > ")]=true;}else{vm.units[desc.unit]-=1;delete vm.breadcrumbs[breadcrumb.map(mnFormatStatsSectionsFilter).map(mnFormatServicesFilter).join(" > ")];}
var selectedUnitsCount=Object.keys(vm.units).reduce(function(acc,key){if(vm.units[key]>0){acc+=1}
return acc;},0);if(vm.newChart.specificStat!=="false"){vm.disableStats=selectedUnitsCount>=1;}else{vm.disableStats=selectedUnitsCount>=2;}}
function activate(){if(vm.isEditing){vm.newChart=_.cloneDeep(chart);vm.newChart.specificStat=vm.newChart.specificStat.toString();vm.selectedGroup=group.id;vm.groups=scenario.groups.map(function(id){return mnStoreService.store("groups").get(id);});Object.keys(vm.newChart.stats).forEach(onStatChecked);}else{vm.newChart={stats:{},size:"small",specificStat:"true"};}
vm.bucket=$state.params.scenarioBucket;if(vm.isEditing){vm.tab=Object.keys(chart.stats).map(function(stat){var tab=stat.split(".")[0];if(tab.includes("-")){tab=tab.substr(0,tab.length-1);}
return tab;}).sort(function(a,b){return vm.tabs.indexOf(a)-vm.tabs.indexOf(b);})[0];vm.selectedKVFilters=Object.keys(chart.stats).filter(function(stat){return stat.includes("@kv")&&!stat.includes("@items");}).reduce(function(acc,kvStat){Object.keys(vm.kvGroups).forEach(function(kvFilter){if(vm.kvGroups[kvFilter].includes(kvStat.split(".")[1])){acc[kvFilter]=true;}});return acc;},{});}else{vm.tab=vm.tabs[0];}}
function create(){var chart={size:vm.newChart.size,specificStat:vm.newChart.specificStat==="true",id:vm.newChart.id,stats:getSelectedStats()};var toGroup=mnStoreService.store("groups").get(vm.selectedGroup||group.id);var fromGroup;if(vm.isEditing){if(group.id!==vm.selectedGroup){fromGroup=mnStoreService.store("groups").get(group.id);fromGroup.charts.splice(fromGroup.charts.indexOf(chart.id),1);toGroup.charts.push(chart.id);}
mnStoreService.store("charts").put(chart);}else{toGroup.charts.push(mnStoreService.store("charts").add(chart).id);}
$uibModalInstance.close();}}})();(function(){"use strict";angular.module("mnStatisticsNew").controller("mnStatisticsDetailedChartController",mnStatisticsDetailedChartController)
function mnStatisticsDetailedChartController($scope,chart,$timeout,$state,items,mnStatisticsNewService){var vm=this;vm.chart=Object.assign({},chart,{size:"extra"});vm.items=items;vm.onSelectZoom=onSelectZoom;vm.bucket=$state.params.scenarioBucket;vm.zoom=$state.params.scenarioZoom!=="minute"?$state.params.scenarioZoom:"hour";vm.node=$state.params.statsHostname;vm.options={showFocus:true,showTicks:true,showLegends:true};mnStatisticsNewService.heartbeat.setInterval(mnStatisticsNewService.defaultZoomInterval(vm.zoom));function onSelectZoom(){vm.options.showFocus=vm.zoom!=="minute";mnStatisticsNewService.heartbeat.setInterval(mnStatisticsNewService.defaultZoomInterval(vm.zoom));vm.reloadChartDirective=true;$timeout(function(){vm.reloadChartDirective=false;});}
$scope.$on("$destroy",function(){mnStatisticsNewService.heartbeat.setInterval(mnStatisticsNewService.defaultZoomInterval($state.params.scenarioZoom));mnStatisticsNewService.heartbeat.reload();})}})();(function(){"use strict"
angular.module('mnStatisticsChart',["mnStatisticsNewService","mnStatisticsDescriptionService","ui.bootstrap","mnPoll","mnFilters","mnHelper","mnD3Service"]).directive("mnStatisticsChart",mnStatisticsNewChartDirective);function mnStatisticsNewChartDirective(mnStatisticsNewService,mnStatisticsDescriptionService,$uibModal,$state,mnPrepareQuantityFilter,mnTruncateTo3DigitsFilter,$rootScope,mnHelper,$timeout,$window){return{restrict:'AE',templateUrl:'app/mn_admin/mn_statistics/chart_directive/mn_statistics_chart_directive.html',scope:{syncScope:"=?",config:"=",mnD3:"=?",bucket:"@",zoom:"@",node:"@?",items:"=?",api:"=?"},controller:controller};function controller($scope,$element){if(!$scope.config){return;}
var units;var options;var isFocusChart=$scope.nvd3Options&&$scope.nvd3Options.type==='lineWithFocusChart';if(!_.isEmpty($scope.config.stats)){units=mnStatisticsNewService.getStatsUnits($scope.config.stats);$scope.title=mnStatisticsNewService.getStatsTitle($scope.config.stats);$scope.desc=mnStatisticsNewService.getStatsDesc($scope.config.stats);activate();}
function activate(){initConfig();subscribeToMultiChartData();}
function subscribeToMultiChartData(){mnStatisticsNewService.subscribeUIStatsPoller({bucket:$scope.bucket,node:$scope.node||"all",stats:mnStatisticsNewService.descriptionPathsToStatNames($scope.config,$scope.items),zoom:$scope.zoom,specificStat:$scope.config.specificStat},$scope);$scope.$watch("mnUIStats",onMultiChartDataUpdate);}
function getChartSize(size){switch(size){case"tiny":return 60;case"small":return 100;case"medium":return 120;case"large":return 310;case"extra":return 430;default:return 150;}}
function initConfig(){options={chart:{margin:$scope.config.margin||{top:10,right:36,bottom:16,left:44},height:getChartSize($scope.config.size),tooltip:{valueFormatter:formatValue},useInteractiveGuideline:true,yAxis:[],xAxis:{tickFormat:function(d){return mnStatisticsNewService.tickMultiFormat(new Date(d));}},noData:"Stats are not found or not ready yet"}};Object.keys(units).forEach(function(unit,index){units[unit]=index;options.chart.yAxis[index]={};options.chart.yAxis[index].unit=unit;options.chart.yAxis[index].tickFormat=function(d){return formatMaxMin(d,unit);};options.chart.yAxis[index].domain=getScaledMinMax;});if($scope.mnD3){Object.assign(options.chart,$scope.mnD3);}
$scope.options=options;}
function formatMaxMin(d,unit){switch(unit){case"bytes":var val=mnPrepareQuantityFilter(d,1024);return d3.format(".2s")(d/val[0])+val[1];case"percent":return d3.format(".0%")(d/100);case"second":return d3.format(".2s")(d)+'s';case"millisecond":return d3.format(".2s")(d/1000)+'s';case"microsecond":return d3.format(".2s")(d/1000000)+'s';case"nanoseconds":return d3.format(".2s")(d/1000000000)+'s';default:return d3.format(".2s")(d);}}
function formatValue(d,unit){switch(unit){case"bytes":var val=mnPrepareQuantityFilter(d,1024);return[mnTruncateTo3DigitsFilter(d/val[0]),val[1]].join('');case"percent":return mnTruncateTo3DigitsFilter(d)+"%";case"millisecond":return d3.format(".2s")(d/1000)+'s';case"microsecond":return d3.format(".2s")(d/1000000)+'s';case"nanoseconds":return d3.format(".2s")(d/1000000000)+'s';default:return mnTruncateTo3DigitsFilter(d);}}
function getScaledMinMax(chartData){var min=d3.min(chartData,function(line){return line.min/1.005;});var max=d3.max(chartData,function(line){return line.max;});if(chartData[0]&&chartData[0].unit=="bytes"){return[min<=0?0:roundDownBytes(min),max==0?1:roundUpBytes(max)];}else{return[min<=0?0:roundDown(min),max==0?1:roundUp(max)];}}
function roundUp(num){var mag=Math.pow(10,Math.floor(Math.log10(num)));return(mag*Math.ceil(2*num/mag)/2);}
function roundDown(num){var mag=Math.pow(10,Math.floor(Math.log10(num)));return(mag*Math.floor(2*num/mag)/2);}
function roundUpBytes(num){var mag=Math.trunc(Math.log2(num)/10);var base_num=num/Math.pow(2,mag*10);var mag10=Math.pow(10,Math.floor(Math.log10(base_num))-1);return Math.ceil(base_num/mag10)*mag10*Math.pow(2,mag*10);}
function roundDownBytes(num){var mag=Math.trunc(Math.log2(num)/10);var base_num=num/Math.pow(2,mag*10);var mag10=Math.pow(10,Math.floor(Math.log10(base_num))-1);return Math.floor(base_num/mag10)*mag10*Math.pow(2,mag*10);}
function onMultiChartDataUpdate(stats){if(!stats){return;}
if(stats.status==404){$scope.options={chart:{notFound:true,height:getChartSize($scope.config.size),margin:{top:0,right:0,bottom:0,left:0},type:'multiChart',noData:"Stats are not found or not ready yet"}};$scope.chartData=[];return;}
var chartData=[];if($scope.config.specificStat){var descPath=Object.keys($scope.config.stats)[0];var statName=Object.keys(stats.stats)[0];var desc=mnStatisticsNewService.readByPath(descPath);if(desc){(($scope.node=="all")?Object.keys(stats.stats[statName]||{}):([$scope.node])).forEach(function(nodeName){var nodeStat=stats.stats[statName][nodeName];nodeStat=nodeStat.map(function(v){return(v===null)?undefined:v;});chartData.push({type:'line',unit:desc.unit,max:d3.max(nodeStat||[])||1,min:d3.min(nodeStat||[])||0,yAxis:units[desc.unit],key:nodeName,values:stats.timestamps.map(function(v,i){return[v,nodeStat[i]];})});});}}else{Object.keys($scope.config.stats).forEach(function(descPath,i){var desc=mnStatisticsNewService.readByPath(descPath);if(!desc){return;}
var statName=mnStatisticsNewService.descriptionPathToStatName(descPath,$scope.items);var stat;if(stats.stats[statName]){stat=stats.stats[statName][$scope.node=="all"?"aggregate":$scope.node];}else{stat=[];}
stat=stat.map(function(v){return(v===null)?undefined:v;});chartData.push({type:'line',unit:desc.unit,max:d3.max(stat)||1,min:d3.min(stat)||0,yAxis:units[desc.unit],key:desc.title,values:stats.timestamps.map(function(v,i){return[v,stat[i]];})});});}
if($scope.chartData){$scope.chartData.forEach(function(v,i){if(!chartData[i]){return;}
chartData[i].disabled=v.disabled;});}
$scope.chartData=chartData;}}}})();(function(){"use strict";angular.module('mnD3Service',[]).factory('mnD3Service',mnD3ServiceFactory);function mnD3ServiceFactory(){class mnD3{constructor(options,rootElement){this.opt=options;this.cht=this.opt.chart;this.rootEl=d3.select(rootElement);this.throttledResize=_.throttle(this.resize.bind(this),30);var elmRect=this.getElementRect();this.cvsRect=this.getCanvasRect(elmRect);this.colors=this.cht.color||d3.schemeCategory10;this.svg=this.rootEl.append("svg").attr("width","100%").attr("height",this.cht.height).append("g").attr("transform",this.getTransform(this.cht.margin.left,this.cht.margin.top));}
init(){this.inititalized=true;this.svg.html("");this.linesWrap=this.svg.append("g").attr("clip-path","url(#clip)");this.xScale=d3.scaleTime().range([0,this.cvsRect.width]);this.xAxis=d3.axisBottom().scale(this.xScale).tickFormat(this.cht.xAxis.tickFormat);this.svg.append("g").attr("transform",this.getTransform(0,this.cvsRect.height)).attr("class","xAxis");this.yScale=[];this.yAxis=[];this.yLines=[];this.createYAxis(0,"axisLeft",this.getTransform(0,0));if(this.cht.yAxis[1]){this.createYAxis(1,"axisRight",this.getTransform(this.cvsRect.width,0));}}
destroy(){this.svg.remove();}
getCanvasRect(elmRect){return{width:elmRect.width-this.cht.margin.left-this.cht.margin.right,height:this.cht.height-this.cht.margin.bottom-this.cht.margin.top};}
updateYAxis(i){var domain=this.data.filter(function(line){return(line.yAxis==i)&&this.filterDisabled(line);}.bind(this));var yDomain=this.cht.yAxis[i].domain(domain);this.yScale[i].domain(yDomain);if(!this.cht.showTicks&&domain.length){this.yAxis[i].tickValues(yDomain);}
this.svg.selectAll(".yAxis"+i).call(this.yAxis[i]).transition().duration(0);}
createYAxis(i,axis,coordinates){this.yScale[i]=d3.scaleLinear().range([this.cvsRect.height,0]).nice();this.yAxis[i]=d3[axis]().scale(this.yScale[i]).tickFormat(this.cht.yAxis[i].tickFormat);this.yLines[i]=d3.line().defined(function(d){return!isNaN(d[1]);}).x(function(d){return this.xScale(d[0]);}.bind(this)).y(function(d){return this.yScale[i](d[1]);}.bind(this));if(!this.cht.hideTicks){this.svg.append("g").attr("transform",coordinates).attr("class","yAxis yAxis"+i);}}
getElementRect(){return this.rootEl.node().getBoundingClientRect();}
getTransform(x,y){return"translate("+x+", "+y+")";}
filterDisabled(line){return!!line.values.length&&!line.disabled;}
redrawXAxis(){return this.svg.selectAll(".xAxis").transition().duration(0).call(this.xAxis);}
getLineColor(d,i){var color=this.colors.slice(0,this.data.length).filter(function(_,i){return!!this.data[i].values.length&&!this.data[i].disabled;}.bind(this));return color[i%color.length];}
drawLine(path){path.attr("d",function(d){if(!d.disabled){return this.yLines[d.yAxis](d.values);}else{return undefined;}}.bind(this)).call(this.drawLinePath.bind(this));}
drawLinePath(pipe){pipe.style("stroke",this.getLineColor.bind(this)).style("fill","none").style("stroke-width",1);}
drawCirclePath(pipe){pipe.style("fill",this.getLineColor.bind(this));}
updateXAxis(xDomain){if(!xDomain.length){return;}
this.xScale.domain(xDomain);this.redrawXAxis();}
updateLine(){this.linesWrap.selectAll('.lines').data(this.data.filter(this.filterDisabled.bind(this))).join(function(enter){enter.append('path').attr('class','lines').call(this.drawLine.bind(this));}.bind(this),function(update){update.transition().duration(0).call(this.drawLine.bind(this));}.bind(this));}
updateData(data){if(!data){return;}
this.xAxisData=data.reduce((max,item)=>item.values.length>max.length?item.values:max,[]);this.data=data;if(this.xAxisData&&this.xAxisData.length){if(!this.inititalized){this.init();}}else{this.showEmptyContent();return;}
this.updateXAxis(this.getXaxisDomain(this.xAxisData));this.updateYAxis(0);if(this.cht.yAxis[1]){this.updateYAxis(1);}
this.updateLine();return true;}
showEmptyContent(){this.inititalized=false;this.svg.html("<text class='charts-nodata'>"+this.cht.noData+"</text>");}
getXaxisDomain(data){return[data[0][0],data[data.length-1][0]];}
toggleLine(i){var maybeLast=this.data.filter(this.filterDisabled.bind(this));if((maybeLast.length==1)&&(this.data.indexOf(maybeLast[0])==i)){return;}
this.data[i].disabled=!this.data[i].disabled;this.updateData(this.data);return true;}
resize(){this.cvsRect=this.getCanvasRect(this.getElementRect());this.xScale.range([0,this.cvsRect.width]);this.redrawXAxis();this.xAxis.ticks(Math.max(this.cvsRect.width/100,2));if(this.cht.yAxis[1]&&!this.cht.hideTicks){this.svg.select(".yAxis1").attr("transform",this.getTransform(this.cvsRect.width,0));}}}
class mnD3Focus extends mnD3{constructor(options,rootElement,chart){super(options,rootElement[0]);this.chart=chart;}
init(){super.init();this.chart.clip=this.svg.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",this.chart.cvsRect.width).attr("height",this.chart.cvsRect.height).attr("x",0).attr("y",0);this.chart.linesWrap.attr("clip-path","url(#clip)");this.bisect=d3.bisector(function(d){return d[0];}).left;this.brush=d3.brushX().extent([[0,0],[this.cvsRect.width,this.cht.height]]).on("brush end",this.brushed.bind(this));this.brushEl=this.svg.append("g").attr("class","charts-brush");this.svg.attr("class","focus-chart");this.brushEl.call(this.brush).call(this.brush.move,null);this.onInit&&this.onInit();}
getDomain(){var s=d3.brushSelection(this.brushEl.node());return s?s.map(this.xScale.invert,this.xScale):this.getXaxisDomain(this.xAxisData);}
brushed(){if(!this.data){return;}
var domain=this.getDomain();this.chart.updateXAxis(domain);this.chart.updateLine();this.chart.drawTooltip();}
updateData(data){if(!super.updateData(data)){return;}
this.brushed();}
resize(){var s=this.getDomain();super.resize();this.chart.clip.attr("width",this.chart.cvsRect.width).attr("height",this.chart.cvsRect.height);this.brush.extent([[0,0],[this.cvsRect.width,this.cht.height]]);this.brushEl.call(this.brush);if(d3.brushSelection(this.brushEl.node())){var i1=this.bisect(this.xAxisData,s[0]);var i2=this.bisect(this.xAxisData,s[1]);this.brush.move(this.brushEl,[this.xScale(this.xAxisData[i1][0]),this.xScale(this.xAxisData[i2][0])]);this.brushed();}}}
class mnD3Tooltip extends mnD3{constructor(options,rootElement,onInit){super(options,rootElement[0]);this.onInit=onInit;}
init(){super.init();this.bisect=d3.bisector(function(d){return d[0];}).left;this.tip=d3.select("body").append("div").attr('class','mnd3-tooltip');this.tipLineWrap=this.svg.append("g").attr("class","tip-line-wrap");this.tipLineWrap.append("path").attr("class","tip-line").style("opacity",0);this.tipBox=this.svg.append('rect').attr("height",this.cvsRect.height).attr("width",this.cvsRect.width).attr('opacity',0);this.drawTooltipThrottle=_.throttle(this.drawTooltip.bind(this),10,{leading:true});angular.element(this.tipBox.node()).on('mousemove',this.setMouseMoveEvent.bind(this));angular.element(this.tipBox.node()).on('mousemove',this.drawTooltipThrottle);angular.element(this.tipBox.node()).on('mouseout',this.hideTooltip.bind(this));this.onInit&&this.onInit();}
destroy(){angular.element(this.tipBox.node()).off('mousemove',this.setMouseMoveEvent.bind(this));angular.element(this.tipBox.node()).off('mousemove',this.drawTooltipThrottle);angular.element(this.tipBox.node()).off('mouseout',this.hideTooltip.bind(this));this.getLegends().nodes().forEach(function(node,i){angular.element(node).off('click',this.clickCB[i]);}.bind(this));this.tip.remove();this.svg.remove();this.legendsWrap.remove();}
showEmptyContent(){super.showEmptyContent();this.tip&&this.tip.remove();this.legendsWrap&&this.legendsWrap.remove();}
updateData(data){if(!super.updateData(data)){return;}
this.drawTooltip();}
toggleLine(i){if(!super.toggleLine(i)){return;}
d3.select(this.getLegends.bind(this)().nodes()[i]).classed('disabled',this.data[i].disabled);}
resize(){super.resize();this.tipBox&&this.tipBox.attr("height",this.cvsRect.height).attr("width",this.cvsRect.width);}}
mnD3Tooltip.prototype.updateLabelRow=updateLabelRow;mnD3Tooltip.prototype.updateCirclePosition=updateCirclePosition;mnD3Tooltip.prototype.drawTooltip=drawTooltip;mnD3Tooltip.prototype.drawCircle=drawCircle;mnD3Tooltip.prototype.setMouseMoveEvent=setMouseMoveEvent;mnD3Tooltip.prototype.hideTooltip=hideTooltip;mnD3Tooltip.prototype.disableTooltip=disableTooltip;mnD3Tooltip.prototype.drawLegends=drawLegends;mnD3Tooltip.prototype.getLegends=getLegends;function getLegends(){return this.legendsWrap.selectAll('.legends');}
function drawCircle(path){path.call(this.drawCirclePath.bind(this)).call(this.updateCirclePosition.bind(this),this.selectedValueIndex);}
function drawTooltip(){if(!this.mouseMoveEvent||!this.data){return;}
var elementRect=this.tipBox.node().getBoundingClientRect();var cvsRect=this.getCanvasRect(elementRect);var elementX=this.mouseMoveEvent.pageX-elementRect.left;var elementY=this.mouseMoveEvent.pageY-elementRect.top;var xDate=this.xScale.invert(elementX);var i=this.bisect(this.xAxisData,xDate);var d0=this.xAxisData[i-1];var d1=this.xAxisData[i];this.selectedValueIndex=(!d0||(xDate-d0[0])>(d1[0]-xDate))?i:i-1;this.svg.select(".tip-line").style("opacity","1").attr("d",function(){var idx=this.selectedValueIndex;var d="M"+this.xScale(this.xAxisData[idx][0])+","+elementRect.height;d+=" "+this.xScale(this.xAxisData[idx][0])+", 0";return d;}.bind(this));var circlesPerLine=this.tipLineWrap.selectAll('.circle-per-line').data(this.data.filter(this.filterDisabled.bind(this))).style('opacity',function(d){var idx=this.selectedValueIndex;return(d.values.length&&!d.disabled&&!isNaN(d.values[idx]&&d.values[idx][1]))?1:0;}.bind(this));circlesPerLine.join(function(enter){enter.append("circle").attr('class','circle-per-line').attr("r",5).call(this.drawCircle.bind(this));}.bind(this),function(update){update.transition().duration(0).call(this.drawCircle.bind(this));}.bind(this));if(!this.disableTooltipFlag){var tooltipRows=this.tip.style('display','block').style('left',this.mouseMoveEvent.pageX+20+"px").style('top',this.mouseMoveEvent.pageY-40+"px").selectAll(".charts-tooltip-row").data(this.data.filter(this.filterDisabled.bind(this)));tooltipRows.join(function(enter){enter.append("div").attr('class','charts-tooltip-row').html(this.updateLabelRow.bind(this));}.bind(this),function(update){update.html(this.updateLabelRow.bind(this)).transition().duration(0);}.bind(this))}}
function drawLegends(){this.legendsWrap=this.rootEl.append("div").attr("class","legends-wrap").append("div").attr("class","charts-filter-icon");this.getLegends().data(this.data).join(function(enter){enter.append("div").attr('class','legends').html(getLegendsHtml.bind(this));}.bind(this),function(update){update.html(getLegendsHtml.bind(this)).transition().duration(0);}.bind(this));this.clickCB=this.getLegends().nodes().map(function(node,i){var cb=function(){this.toggleLine(i);this.rootEl.dispatch('toggleLegend',{detail:{index:i}});}.bind(this);angular.element(node).on('click',cb);return cb;}.bind(this));}
function getLegendsHtml(line,i){return"<i style='background-color:"+this.getLineColor(line,i)+"'></i>"+"<span>"+line.key+"</span>";}
function updateLabelRow(line,i){var idx=this.selectedValueIndex;if(!(line.values[idx]&&line.values[idx].length)||line.disabled){return;}
return"<span><i style='background-color:"+this.getLineColor(line,i)+"'></i>"+"<span class='charts-tooltip-key'>"+line.key+"</span></span>"+"<span class='bold'>"+((!line.values[idx]||line.values[idx][1]==undefined)?"-":this.cht.tooltip.valueFormatter(line.values[idx][1],line.unit))+"</span>";}
function updateCirclePosition(pipe,idx){return pipe.attr("transform",function(line){if(line.values[idx]&&line.values[idx].length&&!isNaN(line.values[idx][1])){return this.getTransform(this.xScale(line.values[idx][0]),this.yScale[line.yAxis](line.values[idx][1]));}}.bind(this))}
function hideTooltip(){this.mouseMoveEvent=false;this.svg.selectAll(".tip-line").style("opacity",0);this.svg.selectAll(".circle-per-line").style("opacity",0);this.tip.style("display","none");}
function disableTooltip(flag){this.disableTooltipFlag=flag;}
function setMouseMoveEvent(e){this.mouseMoveEvent=e;}
return{mdD3:mnD3,mnD3Focus:mnD3Focus,mnD3Tooltip:mnD3Tooltip,};}})();(function(){"use strict"
angular.module('mnStatisticsChart').directive("mnMultiChart",mnMultiChartDirective);function mnMultiChartDirective($window,mnD3Service){return{restrict:'AE',scope:{data:"=?",options:"=?",api:"=?",syncScope:"=?"},controller:controller};function controller($element,$scope){var chart=new mnD3Service.mnD3Tooltip($scope.options,$element,function(){angular.element($window).on('resize',chart.throttledResize);chart.resize();if($scope.syncScope){syncTooltips();}
if($scope.options.chart.showFocus){addFocusChart();}
if(this.cht.showLegends){this.drawLegends();}});$scope.$watch("data",chart.updateData.bind(chart));$scope.$on("$destroy",function(){angular.element($window).off('resize',chart.throttledResize);chart.destroy.bind(chart);});if($scope.api){$scope.api.chart=chart;}
function addFocusChart(){var focusChartOpt=_.cloneDeep($scope.options);focusChartOpt.chart.height=80;focusChartOpt.chart.hideTicks=true;focusChartOpt.chart.showFocus=false;var chartF=new mnD3Service.mnD3Focus(focusChartOpt,$element,chart);angular.element($window).on('resize',chartF.throttledResize);$scope.$watch("data",chartF.updateData.bind(chartF));chart.rootEl.on("toggleLegend",function(opt){chartF.updateData(chartF.data);});if($scope.api){$scope.api.chartF=chartF;}
$scope.$on("$destroy",function(){angular.element($window).off('resize',chartF.throttledResize);chartF.destroy.bind(chartF);});}
function syncTooltips(){var throttledSync=_.throttle(function(e){if(e.bubbles){$scope.syncScope.$broadcast("syncTooltips",{element:$element,event:e,chart:chart});}},10,{leading:true});angular.element(chart.tipBox.node()).on("mousemove mouseup mousedown mouseout",throttledSync);$scope.$on("$destroy",function(){angular.element(chart.tipBox.node()).off("mousemove mouseup mousedown mouseout",throttledSync);});$scope.$on("syncTooltips",function(e,source){if(source.element[0]!==$element[0]){var sourcePos=source.chart.tipBox.node().getBoundingClientRect();var elementPos=chart.tipBox.node().getBoundingClientRect();var sourceGraphRelativeX=source.event.clientX-sourcePos.x;var sourceGraphRelativeY=source.event.clientY-sourcePos.y;var interpolateX=sourcePos.width/sourceGraphRelativeX;var clientX=elementPos.x+(elementPos.width/interpolateX);var interpolateY=sourcePos.height/sourceGraphRelativeY;var clientY=elementPos.y+(elementPos.height/interpolateY);source.chart.disableTooltip(false);chart.disableTooltip(true);chart.tipBox.node().dispatchEvent(createEvent(source.event.type,clientX,clientY));}});}
function createEvent(type,clientX,clientY){var event=new MouseEvent(type,{view:$window,bubbles:false,cancelable:true,clientX:clientX,clientY:clientY});return event;}}}})();(function(){"use strict";angular.module('mnStatisticsNew').controller('mnScenarioDialogController',mnScenarioDialogController)
function mnScenarioDialogController($scope,mnStatisticsNewService,mnUserRolesService,$state,$document,$uibModal,mnHelper,mnStoreService){var vm=this;vm.editScenario=editScenario;vm.deleteScenario=deleteScenario;vm.onSubmit=onSubmit;vm.copyScenario="true";vm.clear=clear;setEmptyScenario();function setEmptyScenario(){vm.scenario={name:"",desc:"",groups:[]};}
function clear(){setEmptyScenario();vm.copyScenario="true";vm.isEditingMode=false;vm.showRestOfMenu=false;}
function deleteScenario(scenarioID){$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/mn_statistics_scenario_delete.html',}).result.then(function(){mnStatisticsNewService.deleteScenario(scenarioID);selectLastScenario();mnUserRolesService.saveDashboard();});}
function editScenario(scenario){vm.isEditingMode=!!scenario;vm.scenario=Object.assign({},scenario);vm.showRestOfMenu=true;}
function selectLastScenario(){$scope.statisticsNewCtl.scenario.selected=mnStoreService.store("scenarios").last();return $state.go("^.statistics",{scenario:mnStoreService.store("scenarios").last().id});}
function onSubmit(currentScenario){if(!vm.scenario.name){return;}
if(vm.isEditingMode){mnStoreService.store("scenarios").put(vm.scenario);}else{if(vm.copyScenario=="true"){mnStatisticsNewService.copyScenario(vm.scenario,currentScenario);}else{mnStoreService.store("scenarios").add(vm.scenario);}
selectLastScenario();}
$document.triggerHandler("click");clear();mnUserRolesService.saveDashboard();}}})();(function(){"use strict";angular.module('mnStatisticsNew').controller('mnGroupDialogController',mnGroupDialogController)
function mnGroupDialogController($uibModalInstance,mnUserRolesService,mnPromiseHelper,scenario,mnStoreService){var vm=this;vm.group={name:"",desc:"",charts:[],isOpen:true};vm.submit=submit;function submit(){var group=mnStoreService.store("groups").add(vm.group);scenario.groups.push(group.id);mnPromiseHelper(vm,mnUserRolesService.saveDashboard()).showGlobalSpinner().showGlobalSuccess("Group added successfully!").onSuccess(function(){$uibModalInstance.close(group);});}}})();(function(){"use strict";angular.module('mnStatisticsNew').controller('mnStatisticsOverviewController',mnStatisticsOverviewController);function mnStatisticsOverviewController($scope,mnStatisticsNewService,mnStatisticsDescriptionService,$state,$stateParams,$http,mnPoller,mnBucketsService,$uibModal,$rootScope,mnHelper,$window,mnUserRolesService,permissions,$timeout,mnStoreService,mnGsiService,mnViewsListService,mnTasksDetails,mnPermissions){var vm=this;vm.mnStatisticsNewScope=$scope;vm.rbac=mnPermissions.export;vm.node=$state.params.statsNode;vm.bucket=$state.params.statsBucket;vm.zoom=$state.params.statsZoom;vm.onSelectNode=onSelectNode;vm.onSelectBucket=onSelectBucket;vm.onSelectZoom=onSelectZoom;vm.getNode=getNode;vm.openDetailedChartDialog=openDetailedChartDialog;vm.openedState={"Summary":true};vm.myIsDetailsOpened=function(val){return vm.openedState[val];}
vm.myToggleDetails=function(val){vm.openedState[val]=!vm.openedState[val];}
activate();function getNode(){return vm.node.startsWith("All Server Nodes")?"all":vm.node;}
function onSelectNode(selectedHostname){$state.go('.',{statsNode:selectedHostname},{reload:true});}
function onSelectBucket(bucket){$state.go('.',{statsBucket:bucket},{reload:true});}
function onSelectZoom(zoom){$state.go('.',{statsZoom:zoom},{reload:true});}
function openDetailedChartDialog(block,chart){$state.params.scenarioBucket=vm.bucket;$state.params.statsHostname=vm.getNode();$uibModal.open({templateUrl:'app/mn_admin/mn_statistics/mn_statistics_detailed_chart.html',controller:'mnStatisticsDetailedChartController as detailedChartCtl',windowTopClass:"chart-overlay",resolve:{items:mnHelper.wrapInFunction({}),chart:mnHelper.wrapInFunction(chart)}});}
var fullStatNames={};function extractFullStatNames(stats,prefix){Object.keys(stats).forEach(function(objName){if(objName.startsWith('@'))
extractFullStatNames(stats[objName],prefix+(prefix.length?'.':'')+objName);else
fullStatNames[objName]=prefix+'.'+objName;});}
extractFullStatNames(mnStatisticsDescriptionService.stats,'');function updateCharts(){if(!vm.bucket)
return;mnStatisticsNewService.getStatsDirectory(vm.bucket).then(function success(res){vm.blocks=[];res.data.blocks.forEach(function(block){var chartBlock={blockName:block.blockName,charts:[],columns:block.columns};block.stats.forEach(function(stat){if(fullStatNames[stat.name]){var chart={stats:{},size:"tiny",specificStat:true};chart.margin={top:10,right:10,bottom:16,left:41};chart.stats[fullStatNames[stat.name]]=true;chartBlock.charts.push(chart);}});if(chartBlock.charts.length){vm.blocks.push(chartBlock);}});},function error(res){console.log("Error getting stats directory: "+JSON.stringify(res));});}
function activate(){if(!vm.bucket){vm.bucket=vm.rbac.bucketNames['.stats!read'][0];}
if(!vm.zoom){vm.zoom="hour";}
if($state.params.statsNode)
updateCharts();new mnPoller($scope,function(){return mnStatisticsNewService.prepareNodesList($state.params);}).subscribe(function(nodes){var origNode=vm.node;vm.nodes=nodes;if(!vm.node){vm.node=nodes.nodesNames[0];}
if(vm.node!=origNode){updateCharts();}}).reloadOnScopeEvent("nodesChanged").cycle();}}})();(function(){"use strict";angular.module('mnAnalytics',['mnHelper','mnAnalyticsService','ui.router','mnPoll','mnBucketsService']).controller('mnAnalyticsController',mnAnalyticsController);function mnAnalyticsController($scope,mnAnalyticsService,$state,$http,mnPoller,mnBucketsService){var vm=this;vm.computeOps=computeOps;vm.onSelectBucket=onSelectBucket;vm.onSelectNode=onSelectNode;vm.currentBucket=$state.params.bucket;activate();vm.isSpecificStats=!!$state.params.specificStat
function activate(){if(!$state.params.specificStat){new mnPoller($scope,function(){return mnAnalyticsService.prepareNodesList($state.params);}).subscribe("nodes",vm).reloadOnScopeEvent("nodesChanged").cycle();}
new mnPoller($scope,function(previousResult){return mnAnalyticsService.getStats({$stateParams:$state.params,previousResult:previousResult});}).setInterval(function(response){return response.status?10000:response.stats.nextReqAfter;}).subscribe("state",vm).reloadOnScopeEvent("reloadAnalyticsPoller");}
function onSelectBucket(selectedBucket){$state.go(vm.isSpecificStats?'^.specificGraph':'^.graph',{bucket:selectedBucket});}
function onSelectNode(selectedHostname){$state.go('^.graph',{statsHostname:selectedHostname.indexOf("All Server Nodes")>-1?"all":selectedHostname});}
function computeOps(key){return Math.round(key.ops*100.0)/100.0;}}})();(function(){"use strict";angular.module('mnAnalytics').controller('mnAnalyticsListController',mnAnalyticsListController);function mnAnalyticsListController(mnHelper,$state){var vm=this;vm.params=$state.params;var expanderStateParamName=$state.params.specificStat?'openedSpecificStatsBlock':'openedStatsBlock';mnHelper.initializeDetailsHashObserver(vm,expanderStateParamName,$state.params.specificStat?'^.specificGraph':'^.graph');}})();(function(){"use strict";angular.module('mnAnalytics').controller('mnAnalyticsListGraphController',mnAnalyticsListGraphController);function mnAnalyticsListGraphController($scope,$rootScope,$transition$,$state){var vm=this;var selectedStat;activate();function activate(){$rootScope.$broadcast('reloadAnalyticsPoller');$scope.$watch('analyticsCtl.state',watchOnAnalyticsState);$scope.$on('$destroy',onScopeDestroy);if($state.params.specificStat){$state.current.data.childParams.transGraph=$state.params.specificStat;$state.current.data.childParams.transZoom=$state.params.zoom;}}
function onScopeDestroy(){selectedStat&&(selectedStat.config.isSelected=false);}
function watchOnAnalyticsState(analyticsState){if(!analyticsState){return;}
selectedStat=analyticsState.statsByName&&analyticsState.statsByName[$transition$.params().graph];if(!selectedStat){vm.selectedStat={};return;}
selectedStat.column=$state.params.columnName;selectedStat.config.isSelected=true;selectedStat.visiblePeriod=Math.ceil(Math.min(selectedStat.config.zoomMillis,analyticsState.stats.serverDate-selectedStat.config.timestamp[0])/1000);selectedStat.graphConfig={stats:selectedStat.config.data,tstamps:selectedStat.config.timestamp,options:{color:'#1d88ad',verticalMargin:1.02,fixedTimeWidth:selectedStat.config.zoomMillis,timeOffset:selectedStat.config.timeOffset,lastSampleTime:selectedStat.config.now,breakInterval:selectedStat.config.breakInterval,maxY:selectedStat.config.maxY,isBytes:selectedStat.config.isBytes}};analyticsState.selectedStat=selectedStat;vm.selectedStat=selectedStat;}}})();(function(){"use strict";angular.module('mnAnalyticsService',['mnBucketsService','mnServersService','mnFilters','mnStatisticsNewService']).factory('mnAnalyticsService',mnAnalyticsServiceFactory);function mnAnalyticsServiceFactory($http,$q,mnBucketsService,mnServersService,mnCloneOnlyDataFilter,mnFormatQuantityFilter,mnParseHttpDateFilter,timeUnitToSeconds,mnStatisticsNewService){var mnAnalyticsService={getStats:getStats,doGetStats:doGetStats,prepareNodesList:prepareNodesList};return mnAnalyticsService;function restoreOpsBlock(prevSamples,samples,keepCount){var prevTS=prevSamples.timestamp;if(samples.timestamp&&samples.timestamp.length==0){if(prevSamples&&prevSamples.timestamp&&prevSamples.timestamp.length>0){return prevSamples;}
return samples;}
if(prevTS==undefined||prevTS.length==0||prevTS[prevTS.length-1]!=samples.timestamp[0]){return samples;}
var newSamples={};for(var keyName in samples){var ps=prevSamples[keyName];if(!ps){ps=[];ps.length=keepCount;}
newSamples[keyName]=ps.concat(samples[keyName].slice(1)).slice(-keepCount);}
return newSamples;}
function maybeApplyDelta(prevValue,value){var stats=value.stats;var prevStats=prevValue.stats||{};for(var kind in stats){var newSamples=restoreOpsBlock(prevStats[kind],stats[kind],value.samplesCount+1);stats[kind]=newSamples;}
return value;}
function prepareNodesList(params){return mnServersService.getNodes().then(function(nodes){var rv={};rv.nodesNames=_(nodes.active).filter(function(node){return!(node.clusterMembership==='inactiveFailed')&&!(node.status==='unhealthy');}).pluck("hostname").value();rv.nodesNames.unshift("All Server Nodes ("+rv.nodesNames.length+")");rv.nodesNames.selected=params.statsHostname==="all"?rv.nodesNames[0]:params.statsHostname;return rv;});}
function getStats(params){var isSpecificStat=!!params.$stateParams.specificStat;return mnAnalyticsService.doGetStats(params).then(function(resp){var queries=[$q.when(resp)];queries.push(isSpecificStat?$q.when({data:resp.data.directory.value,origTitle:resp.data.directory.origTitle}):mnStatisticsNewService.getStatsDirectory(params.$stateParams.bucket));return $q.all(queries).then(function(data){return prepareAnaliticsState(data,params);});},function(resp){switch(resp.status){case 0:case-1:return $q.reject(resp);case 404:return!params.$stateParams.bucket?{status:"_404"}:resp;default:return resp;}});}
function doGetStats(params,mnHttpParams){var reqParams={zoom:params.$stateParams.zoom,bucket:params.$stateParams.bucket};if(params.$stateParams.specificStat){reqParams.statName=params.$stateParams.specificStat;}else{if(params.$stateParams.statsHostname!=="all"){reqParams.node=params.$stateParams.statsHostname;}}
if(params.previousResult&&!params.previousResult.status){reqParams.haveTStamp=params.previousResult.stats.lastTStamp;}
return $http({url:'/_uistats',method:'GET',params:reqParams,mnHttp:mnHttpParams});}
function prepareAnaliticsState(data,params){var stats=mnCloneOnlyDataFilter(data[0].data);var statDesc=mnCloneOnlyDataFilter(data[1].data);var samples={};var rv={};if(params.previousResult&&!params.previousResult.status){stats=maybeApplyDelta(params.previousResult.stats,stats);}
angular.forEach(stats.stats,function(subSamples,subName){var timestamps=subSamples.timestamp;for(var k in subSamples){if(k=="timestamp"){continue;}
samples[k]=subSamples[k];samples[k].timestamps=timestamps;}});stats.serverDate=mnParseHttpDateFilter(data[0].headers('date')).valueOf();stats.clientDate=(new Date()).valueOf();var statsByName={};var breakInterval=stats.interval*2.5;var timeOffset=stats.clientDate-stats.serverDate;var zoomMillis=timeUnitToSeconds[params.$stateParams.zoom]*1000;var columnIndex=0;angular.forEach(statDesc.blocks,function(block,index){block.withTotal=block.columns&&block.columns[block.columns.length-1]==="Total";angular.forEach(block.stats,function(info){var sample=samples[info.name];statsByName[info.name]=info;if(block.columns){info.column=block.columns[columnIndex];if(columnIndex===(block.columns.length-1)){columnIndex=0;}else{columnIndex++;}}else{info.column=null;}
info.config={data:sample||[],breakInterval:breakInterval,timeOffset:timeOffset,now:stats.clientDate,zoomMillis:zoomMillis,timestamp:sample&&sample.timestamps||stats.stats[stats.mainStatsBlock].timestamp,maxY:info.maxY,isBytes:info.isBytes,value:!sample?'N/A':mnFormatQuantityFilter(sample[sample.length-1],info.isBytes?1024:1000)};});});rv.isSpecificStats=!!params.$stateParams.specificStat;rv.specificStat=params.$stateParams.specificStat;rv.statsByName=statsByName;rv.statsDirectoryBlocks=statDesc.blocks;rv.stats=stats;rv.origTitle=data[1].origTitle;return rv;}}})();(function(){"use strict";angular.module('mnServers',['mnPoolDefault','ui.router','mnAutocompleteOff','ui.bootstrap','mnServersService','mnHelper','mnBarUsage','mnServersListItemDetailsService','mnFilters','mnSortableTable','mnServices','mnSpinner','ngMessages','mnMemoryQuotaService','mnGsiService','mnPromiseHelper','mnGroupsService','mnStorageMode','mnPoll','mnFocus','mnPools','mnWarmupProgress','mnElementCrane','mnSearch','mnSelectableNodesList','mnRootCertificateService']).controller('mnServersController',mnServersController);function mnServersController($scope,$state,$uibModal,mnPoolDefault,mnPoller,mnServersService,mnHelper,mnGroupsService,mnPromiseHelper,mnPools,permissions,mnStatisticsNewService){var vm=this;vm.mnPoolDefault=mnPoolDefault.latestValue();vm.postStopRebalance=postStopRebalance;vm.onStopRecovery=onStopRecovery;vm.postRebalance=postRebalance;vm.addServer=addServer;vm.filterField="";vm.sortByGroup=sortByGroup;vm.multipleFailoverDialog=multipleFailoverDialog;function sortByGroup(node){return vm.getGroupsByHostname[node.hostname]&&vm.getGroupsByHostname[node.hostname].name;}
activate();function activate(){mnHelper.initializeDetailsHashObserver(vm,'openedServers','app.admin.servers.list');mnStatisticsNewService.heartbeat.setInterval(function(resp){return resp.interval||5000;});if(permissions.cluster.server_groups.read){new mnPoller($scope,function(){return mnGroupsService.getGroupsByHostname();}).subscribe("getGroupsByHostname",vm).reloadOnScopeEvent(["serverGroupsUriChanged","reloadServersPoller"]).cycle();}
new mnPoller($scope,function(){return mnServersService.getNodes();}).subscribe(function(nodes){vm.showSpinner=false;vm.nodes=nodes;}).reloadOnScopeEvent(["mnPoolDefaultChanged","reloadNodes"]).cycle();}
function multipleFailoverDialog(){$uibModal.open({templateUrl:'app/mn_admin/mn_servers/mn_multiple_failover_dialog.html',controller:'mnMultipleFailoverDialogController as multipleFailoverDialogCtl',resolve:{groups:function(){return mnPoolDefault.get().then(function(poolDefault){if(poolDefault.isGroupsAvailable&&permissions.cluster.server_groups.read){return mnGroupsService.getGroupsByHostname();}});},nodes:function(){return vm.nodes.reallyActive;}}});}
function addServer(){$uibModal.open({templateUrl:'app/mn_admin/mn_servers/add_dialog/mn_servers_add_dialog.html',controller:'mnServersAddDialogController as serversAddDialogCtl',resolve:{groups:function(){return mnPoolDefault.get().then(function(poolDefault){if(poolDefault.isGroupsAvailable){return mnGroupsService.getGroups();}});}}});}
function postRebalance(){mnPromiseHelper(vm,mnServersService.postRebalance(vm.nodes.allNodes)).onSuccess(function(){$state.go('app.admin.servers.list',{list:'active'});}).broadcast("reloadServersPoller").catchGlobalErrors().showErrorsSensitiveSpinner();}
function onStopRecovery(){mnPromiseHelper(vm,mnServersService.stopRecovery($scope.adminCtl.tasks.tasksRecovery.stopURI)).broadcast("reloadServersPoller").showErrorsSensitiveSpinner();}
function postStopRebalance(){return mnPromiseHelper(vm,mnServersService.stopRebalanceWithConfirm()).broadcast("reloadServersPoller");}}})();(function(){"use strict";angular.module("mnServers").controller("mnServersListItemController",mnServersListItemController);function mnServersListItemController($scope,$state,$rootScope,$uibModal,mnServersService,mnMemoryQuotaService,mnGsiService,mnPromiseHelper,mnPermissions,mnPoolDefault){var vm=this
vm.cancelEjectServer=cancelEjectServer;vm.cancelFailOverNode=cancelFailOverNode;vm.reAddNode=reAddNode;vm.failOverNode=failOverNode;vm.ejectServer=ejectServer;vm.disableRemoveBtn=disableRemoveBtn;vm.isFailOverDisabled=isFailOverDisabled;var ramUsageConf={};var swapUsageConf={};var cpuUsageConf={};activate();function activate(){$scope.$watch("node",onNodeUpdate,true);$scope.$watchGroup(['node','adminCtl.tasks'],function(values){vm.getRebalanceProgress=getRebalanceProgress(values[0],values[1]);});}
function onNodeUpdate(node){vm.isNodeUnhealthy=isNodeUnhealthy(node);vm.isNodeInactiveFailed=isNodeInactiveFailed(node);vm.isLastActiveData=isLastActiveData(node);vm.isNodeInactiveAdded=isNodeInactiveAdded(node);vm.couchDiskUsage=couchDiskUsage(node);vm.isKVNode=isKVNode(node);vm.getRamUsageConf=getRamUsageConf(node);vm.getSwapUsageConf=getSwapUsageConf(node);vm.getCpuUsageConf=getCpuUsageConf(node);}
function isKVNode(node){return node.services.indexOf("kv")>-1;}
function getRamUsageConf(node){var total=node.memoryTotal;var free=node.memoryFree;var used=total-free;ramUsageConf.exist=(total>0)&&_.isFinite(free);ramUsageConf.value=used/total*100;return ramUsageConf;}
function getSwapUsageConf(node){var swapTotal=node.systemStats.swap_total;var swapUsed=node.systemStats.swap_used;swapUsageConf.exist=swapTotal>0&&_.isFinite(swapUsed);swapUsageConf.value=(swapUsed/swapTotal)*100;return swapUsageConf;}
function getCpuUsageConf(node){var cpuRate=node.systemStats.cpu_utilization_rate;cpuUsageConf.exist=_.isFinite(cpuRate);cpuUsageConf.value=Math.floor(cpuRate*100)/100;return cpuUsageConf;}
function isFailOverDisabled(node){return isLastActiveData(node)||($scope.adminCtl.tasks&&$scope.adminCtl.tasks.inRecoveryMode);}
function disableRemoveBtn(node){return isLastActiveData(node)||isActiveUnhealthy(node)||($scope.adminCtl.tasks&&$scope.adminCtl.tasks.inRecoveryMode);}
function isLastActiveData(node){return $scope.serversCtl.nodes.reallyActiveData.length===1&&isKVNode(node);}
function isNodeInactiveAdded(node){return node.clusterMembership==='inactiveAdded';}
function isNodeUnhealthy(node){return node.status==='unhealthy';}
function isActive(node){return node.clusterMembership==='active';}
function isNodeInactiveFailed(node){return node.clusterMembership==='inactiveFailed';}
function couchDiskUsage(node){return node.interestingStats['couch_docs_actual_disk_size']+
node.interestingStats['couch_views_actual_disk_size']+
node.interestingStats['couch_spatial_disk_size'];}
function getRebalanceProgress(node,tasks){return tasks&&(tasks.tasksRebalance.perNode&&tasks.tasksRebalance.perNode[node.otpNode]?tasks.tasksRebalance.perNode[node.otpNode].progress:0);}
function isActiveUnhealthy(node){return(isActive(node)||isNodeInactiveFailed(node))&&isNodeUnhealthy(node);}
function ejectServer(node){if(isNodeInactiveAdded(node)){mnPromiseHelper(vm,mnServersService.ejectNode({otpNode:node.otpNode})).showErrorsSensitiveSpinner().broadcast("reloadServersPoller");return;}
var promise=mnServersService.getNodes().then(function(nodes){var warnings={isLastIndex:mnMemoryQuotaService.isOnlyOneNodeWithService(nodes.allNodes,node.services,'index',true),isLastQuery:mnMemoryQuotaService.isOnlyOneNodeWithService(nodes.allNodes,node.services,'n1ql',true),isLastFts:mnMemoryQuotaService.isOnlyOneNodeWithService(nodes.allNodes,node.services,'fts',true),isLastEventing:mnMemoryQuotaService.isOnlyOneNodeWithService(nodes.allNodes,node.services,'eventing',true),isKv:_.indexOf(node.services,'kv')>-1};if(mnPoolDefault.export.isEnterprise){warnings.isLastCBAS=mnMemoryQuotaService.isOnlyOneNodeWithService(nodes.allNodes,node.services,'cbas',true);}
return mnPermissions.export.cluster.bucket['.'].n1ql.index.read?mnGsiService.getIndexesState().then(function(indexStatus){warnings.isThereIndex=!!_.find(indexStatus.indexes,function(index){return _.indexOf(index.hosts,node.hostname)>-1;});warnings.isThereReplica=warnings.isThereIndex;return warnings;}):warnings;}).then(function(warnings){if(_.some(_.values(warnings))){$uibModal.open({templateUrl:'app/mn_admin/mn_servers/eject_dialog/mn_servers_eject_dialog.html',controller:'mnServersEjectDialogController as serversEjectDialogCtl',resolve:{warnings:function(){return warnings;},node:function(){return node;}}});}else{mnServersService.addToPendingEject(node);$rootScope.$broadcast("reloadNodes");}});mnPromiseHelper(vm,promise);}
function failOverNode(node){$uibModal.open({templateUrl:'app/mn_admin/mn_servers/failover_dialog/mn_servers_failover_dialog.html',controller:'mnServersFailOverDialogController as serversFailOverDialogCtl',resolve:{node:function(){return node;}}});}
function reAddNode(type,otpNode){mnPromiseHelper(vm,mnServersService.reAddNode({otpNode:otpNode,recoveryType:type})).broadcast("reloadServersPoller").showErrorsSensitiveSpinner();}
function cancelFailOverNode(otpNode){mnPromiseHelper(vm,mnServersService.cancelFailOverNode({otpNode:otpNode})).broadcast("reloadServersPoller").showErrorsSensitiveSpinner();}
function cancelEjectServer(node){mnServersService.removeFromPendingEject(node);$rootScope.$broadcast("reloadNodes");}}})();(function(){"use strict";angular.module('mnServersService',['mnPoolDefault','ui.router','mnSettingsClusterService','mnGroupsService']).factory('mnServersService',mnServersFactory);function mnServersFactory($http,$q,mnPoolDefault,mnGroupsService,$uibModal){var pendingEject=[];var mnServersService={addToPendingEject:addToPendingEject,removeFromPendingEject:removeFromPendingEject,getPendingEject:getPendingEject,setPendingEject:setPendingEject,reAddNode:reAddNode,setupServices:setupServices,cancelFailOverNode:cancelFailOverNode,stopRebalance:stopRebalance,stopRebalanceWithConfirm:stopRebalanceWithConfirm,stopRecovery:stopRecovery,postFailover:postFailover,ejectNode:ejectNode,postRebalance:postRebalance,getNodeStatuses:getNodeStatuses,addNodesByStatus:addNodesByStatus,getNodes:getNodes,addServer:addServer};return mnServersService;function stopRebalanceWithConfirm(){return stopRebalance().then(null,function(resp){if(resp.status===504){return $uibModal.open({templateUrl:'app/mn_admin/mn_servers/stop_rebalance_dialog/mn_servers_stop_rebalance_dialog.html'}).result.then(function(){return stopRebalance(true);});}});}
function addToPendingEject(node){pendingEject.push(node);}
function removeFromPendingEject(node){node.pendingEject=false;_.remove(pendingEject,{'hostname':node.hostname});}
function getPendingEject(){return pendingEject;}
function setPendingEject(newPendingEject){pendingEject=newPendingEject;}
function reAddNode(data){return $http({method:'POST',url:'/controller/setRecoveryType',data:data});}
function setupServices(data){return $http({method:'POST',url:'/node/controller/setupServices',data:data});}
function cancelFailOverNode(data){return $http({method:'POST',url:'/controller/reFailOver',data:data});}
function stopRebalance(allowUnsafe){return $http({method:'POST',url:'/controller/stopRebalance',data:"allowUnsafe="+(allowUnsafe?"true":"false")});}
function stopRecovery(url){return $http({method:'POST',url:url});}
function postFailover(type,otpNode,allowUnsafe){var data="";if(_.isArray(otpNode)){data=otpNode.map(function(node){return"otpNode="+encodeURIComponent(node);}).join("&");}else{data="otpNode="+encodeURIComponent(otpNode);}
data+="&allowUnsafe="+(allowUnsafe?"true":"false");return $http({method:'POST',url:'/controller/'+type,data:data});}
function ejectNode(data){return $http({method:'POST',url:'/controller/ejectNode',data:data});}
function postRebalance(allNodes){return $http({method:'POST',url:'/controller/rebalance',data:{knownNodes:_.pluck(allNodes,'otpNode').join(','),ejectedNodes:_.pluck(mnServersService.getPendingEject(),'otpNode').join(',')}}).then(null,function(resp){if(resp.data){if(resp.data.mismatch){resp.data.mismatch="Could not Rebalance because the cluster configuration was modified by someone else.\nYou may want to verify the latest cluster configuration and, if necessary, please retry a Rebalance.";}
if(resp.data.deltaRecoveryNotPossible){resp.data.deltaRecoveryNotPossible="Could not Rebalance because requested delta recovery is not possible. You probably added more nodes to the cluster or changed server groups configuration.";}
if(resp.data.noKVNodesLeft){resp.data.noKVNodesLeft="Could not Rebalance out last kv node(s).";}}else{resp.data="Request failed. Check logs.";}
return $q.reject(resp);});}
function addStatusMessagePart(status,message){if(status.length){return status+", "+message;}else{return status+message;}}
function getStatusWeight(status){var priority={unhealthy:0,inactiveFailed:1,warmup:2,healthy:3,};return priority[status]===undefined?100:priority[status];}
function addNodesByStatus(nodes){var nodesByStatuses={};var statusClass="inactive";_.forEach(nodes,function(node){var status="";if(node.clusterMembership==='inactiveFailed'){status=addStatusMessagePart(status,"failed over");}
if(node.status==='unhealthy'){status=addStatusMessagePart(status,"not responding");}
if(node.status==='warmup'){status=addStatusMessagePart(status,"pending");}
if(status!=""){nodesByStatuses[status]=++nodesByStatuses[status]||1;}
if(getStatusWeight(statusClass)>getStatusWeight(node.status)){statusClass=node.status;}
if(getStatusWeight(statusClass)>getStatusWeight(node.clusterMembership)){statusClass=node.clusterMembership;}});nodes.nodesByStatuses=nodesByStatuses;nodes.statusClass=statusClass;return nodes;}
function getNodeStatuses(hostname){return $http({method:'GET',url:'/nodeStatuses'}).then(function(resp){var nodeStatuses=resp.data;var node=nodeStatuses[hostname];if(!node){return}
var rv=_.clone(node);rv.confirmation=false;rv.down=node.status!='healthy';rv.backfill=node.replication<1;rv.failOver=rv.down?"startFailover":node.gracefulFailoverPossible?"startGracefulFailover":"startFailover";rv.gracefulFailoverPossible=node.gracefulFailoverPossible;!rv.backfill&&(rv.confirmation=true);return rv;})}
function getNodes(){return mnPoolDefault.get().then(function(poolDefault){var nodes=poolDefault.nodes;var stillActualEject=[];_.each(mnServersService.getPendingEject(),function(node){var original=_.detect(nodes,function(n){return n.otpNode==node.otpNode;});if(!original||original.clusterMembership==='inactiveAdded'){return;}
stillActualEject.push(original);original.pendingEject=true;});mnServersService.setPendingEject(stillActualEject);var rv={};rv.allNodes=nodes;rv.failedOver=_.filter(nodes,function(node){return node.clusterMembership==='inactiveFailed';});rv.onlyActive=_.filter(nodes,function(node){return node.clusterMembership==='active';});rv.active=rv.failedOver.concat(rv.onlyActive);rv.down=_.filter(nodes,function(node){return node.status!=='healthy';});rv.pending=_.filter(nodes,function(node){return node.clusterMembership!=='active';}).concat(mnServersService.getPendingEject());rv.reallyActive=_.filter(rv.onlyActive,function(node){return!node.pendingEject});rv.reallyActiveData=_.filter(rv.reallyActive,function(node){return _.indexOf(node.services,"kv")>-1;});rv.unhealthyActive=_.detect(rv.reallyActive,function(node){return node.status==='unhealthy';});rv.ramTotalPerActiveNode=poolDefault.storageTotals.ram.total/rv.onlyActive.length;return rv;});}
function addServer(selectedGroup,credentials,servicesList){credentials=_.clone(credentials);if(!credentials['user']||!credentials['password']){credentials['user']='';credentials['password']='';}
credentials.services=servicesList.join(',');return $http({method:'POST',url:(selectedGroup&&selectedGroup.addNodeURI)||'/controller/addNode',data:credentials});}}})();(function(){"use strict";angular.module('mnServers').controller('mnServersListItemDetailsController',mnServersListItemDetailsController)
function mnServersListItemDetailsController($scope,mnServersListItemDetailsService,mnPromiseHelper,mnPoller,mnStatisticsNewService,mnPermissions){var vm=this;$scope.$watch('node',function(node){mnPromiseHelper(vm,mnServersListItemDetailsService.getNodeDetails(node)).applyToScope("server");});$scope.$watchGroup(['node','adminCtl.tasks'],function(values){vm.tasks=mnServersListItemDetailsService.getNodeTasks(values[0],values[1]);});mnStatisticsNewService.subscribeUIStatsPoller({node:$scope.node.hostname||"all",zoom:3000,step:1,bucket:mnPermissions.export.bucketNames['.stats!read']&&mnPermissions.export.bucketNames['.stats!read'][0],stats:['index_memory_used','fts_num_bytes_used_ram','cbas_heap_used','cbas_disk_used']},$scope);$scope.$watch("mnUIStats",updateBarChartData);$scope.$watch("serversListItemDetailsCtl.server",updateBarChartData);function updateBarChartData(){if(!vm.server){return;}
var details=vm.server.details;var ram=details.storageTotals.ram;var hdd=details.storageTotals.hdd;var stats=$scope.mnUIStats;vm.memoryUsages=[];vm.diskUsages=[];if(details.services.includes("kv")){vm.memoryUsages.push(mnServersListItemDetailsService.getBaseConfig('quota allocated to buckets',ram.quotaUsedPerNode,ram.quotaTotalPerNode),mnServersListItemDetailsService.getBaseConfig('data service used',ram.usedByData,ram.quotaTotalPerNode));vm.diskUsages.push(mnServersListItemDetailsService.getBaseConfig('data service',hdd.usedByData,hdd.free));}
if(!stats){return;}
vm.isEnterprise=$scope.poolDefault.isEnterprise;vm.memoryUsages.push(mnServersListItemDetailsService.getBaseConfig('index service used',stats.stats['index_memory_used']&&stats.stats['index_memory_used'][$scope.node.hostname],details.indexMemoryQuota*1024*1024),mnServersListItemDetailsService.getBaseConfig('search service used',stats.stats['fts_num_bytes_used_ram']&&stats.stats['fts_num_bytes_used_ram'][$scope.node.hostname],details.ftsMemoryQuota*1024*1024),mnServersListItemDetailsService.getBaseConfig('analytics service used',stats.stats['cbas_heap_used']&&stats.stats['cbas_heap_used'][$scope.node.hostname],details.cbasMemoryQuota*1024*1024));([{name:'cbas_disk_used',label:"analytics service"}]).forEach(function(stat,i){vm.diskUsages.push(mnServersListItemDetailsService.getBaseConfig(stat.label,stats.stats[stat.name]&&stats.stats[stat.name][$scope.node.hostname],hdd.free,hdd.usedByData))});}}})();(function(){angular.module('mnServersListItemDetailsService',[]).factory('mnServersListItemDetailsService',mnServersListItemDetailsFactory);function mnServersListItemDetailsFactory($http,$q){var mnServersListItemDetailsService={getNodeDetails:getNodeDetails,getNodeTasks:getNodeTasks,getBaseConfig:getBaseConfig};return mnServersListItemDetailsService;function getValue(value){return parseFloat(Array.isArray(value)?value.slice().reverse().find(stat=>stat!=null):value);}
function getBaseConfig(title,used,total,used2){used=getValue(used);total=getValue(total);used2=getValue(used2);if(Number.isNaN(used)||Number.isNaN(total)){return;}
return{items:[{name:title,value:used},{name:'remaining',value:total-(Number.isNaN(used2)?used:used2)}]};}
function getNodeTasks(node,tasks){if(!tasks||!node){return;}
var rebalanceTask=tasks.tasksRebalance.status==='running'&&tasks.tasksRebalance;return{warmUpTasks:_.filter(tasks.tasksWarmingUp,function(task){return task.node===node.otpNode;}),detailedProgress:rebalanceTask.detailedProgress&&rebalanceTask.detailedProgress.perNode&&rebalanceTask.detailedProgress.perNode[node.otpNode]};}
function getNodeDetails(node){return $http({method:'GET',url:'/nodes/'+encodeURIComponent(node.otpNode)}).then(function(resp){return{details:resp.data};});}}})();(function(){"use strict";angular.module('mnServers').controller('mnServersEjectDialogController',mnServersEjectDialogController);function mnServersEjectDialogController($scope,$rootScope,$uibModalInstance,node,warnings,mnHelper,mnPromiseHelper,mnServersService){var vm=this;vm.warningFlags=warnings;vm.doEjectServer=doEjectServer;function doEjectServer(){mnServersService.addToPendingEject(node);$uibModalInstance.close();$rootScope.$broadcast("reloadNodes");};}})();(function(){"use strict";angular.module('mnServers').controller('mnMultipleFailoverDialogController',mnMultipleFailoverDialogController);function mnMultipleFailoverDialogController($scope,mnPoolDefault,mnServersService,mnPromiseHelper,groups,nodes,$uibModalInstance,$uibModal,mnHelper){var vm=this;vm.nodes=nodes;vm.onSubmit=onSubmit;vm.mnGroups=groups;vm.mnSelectedNodesHolder={};function doPostFailover(allowUnsafe){var otpNodes=mnHelper.checkboxesToList(vm.mnSelectedNodesHolder);var promise=mnServersService.postFailover("startFailover",otpNodes,allowUnsafe);return mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().broadcast("reloadServersPoller");}
function onSubmit(){doPostFailover().getPromise().then(null,function(resp){if(resp.status==504){return $uibModal.open({templateUrl:'app/mn_admin/mn_servers/failover_dialog/mn_servers_failover_confirmation_dialog.html'}).result.then(function(){return doPostFailover(true);});}});}}})();(function(){"use strict";angular.module('mnServers').controller('mnServersAddDialogController',mnServersAddDialogController)
function mnServersAddDialogController($scope,$rootScope,$q,$uibModal,mnServersService,$uibModalInstance,mnHelper,mnPromiseHelper,groups,mnClusterConfigurationService,mnPoolDefault,mnRootCertificateService){var vm=this;vm.specifyDisk=false;vm.addNodeConfig={services:{model:{kv:true,index:true,n1ql:true,fts:true}},credentials:{hostname:'',user:'Administrator',password:''}};if($scope.poolDefault.isEnterprise){vm.addNodeConfig.services.model.cbas=true;vm.addNodeConfig.services.model.eventing=true;}
vm.isGroupsAvailable=!!groups;vm.onSubmit=onSubmit;if(vm.isGroupsAvailable){vm.addNodeConfig.selectedGroup=groups.groups[0];vm.groups=groups.groups;}
activate();function activate(){reset();if($scope.poolDefault.isEnterprise){mnPromiseHelper(vm,mnRootCertificateService.getDefaultCertificate()).applyToScope("certificate");}
mnClusterConfigurationService.getSelfConfig().then(function(selfConfig){var rv={};rv.selfConfig=selfConfig;if($scope.poolDefault.isEnterprise){rv.cbasDirs=selfConfig.storage.hdd[0].cbas_dirs;}
rv.dbPath=selfConfig.storage.hdd[0].path;rv.indexPath=selfConfig.storage.hdd[0].index_path;rv.eventingPath=selfConfig.storage.hdd[0].eventing_path;vm.selfConfig=rv;});}
function postDiskStorage(resp){if(resp&&resp.data){vm.optNode=resp.data.otpNode;}
var data={path:vm.selfConfig.dbPath,index_path:vm.selfConfig.indexPath};data.eventing_path=vm.selfConfig.eventingPath;if($scope.poolDefault.isEnterprise){data.cbas_path=vm.selfConfig.cbasDirs;}
var promise=mnClusterConfigurationService.postDiskStorage(data,vm.optNode);return mnPromiseHelper(vm,promise).catchErrors('postDiskStorageErrors').getPromise();}
function reset(){vm.focusMe=true;}
function onSubmit(form){if(vm.viewLoading){return;}
var servicesList=mnHelper.checkboxesToList(vm.addNodeConfig.services.model);form.$setValidity('services',!!servicesList.length);if(form.$invalid){return reset();}
var promise;if(vm.postDiskStorageErrors){if(vm.specifyDisk){promise=postDiskStorage();}else{$uibModalInstance.close();}}else{promise=mnServersService.addServer(vm.addNodeConfig.selectedGroup,vm.addNodeConfig.credentials,servicesList);if(vm.specifyDisk){promise=promise.then(postDiskStorage);}}
mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().broadcast("reloadServersPoller").broadcast("maybeShowMemoryQuotaDialog",vm.addNodeConfig.services.model).showGlobalSuccess("Server added successfully!");};}})();(function(){"use strict";angular.module('mnServers').controller('mnServersFailOverDialogController',mnServersFailOverDialogController);function mnServersFailOverDialogController($scope,mnServersService,mnPromiseHelper,node,$uibModalInstance,$uibModal){var vm=this;vm.node=node;vm.onSubmit=onSubmit;vm.isFailOverBtnDisabled=isFailOverBtnDisabled;activate();function isFailOverBtnDisabled(){return!vm.status||!vm.status.confirmation&&(vm.status.failOver==='startFailover')&&!(vm.status.down&&!vm.status.backfill)&&!vm.status.dataless;}
function doPostFailover(allowUnsafe){var promise=mnServersService.postFailover(vm.status.failOver,node.otpNode,allowUnsafe);return mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadServersPoller");}
function onSubmit(){doPostFailover().getPromise().then(null,function(resp){if(resp.status==504){return $uibModal.open({templateUrl:'app/mn_admin/mn_servers/failover_dialog/mn_servers_failover_confirmation_dialog.html'}).result.then(function(){return doPostFailover(true);});}});}
function activate(){mnPromiseHelper(vm,mnServersService.getNodeStatuses(node.hostname)).showSpinner().getPromise().then(function(details){if(details){vm.status=details;}else{$uibModalInstance.close();}});}}})();(function(){"use strict";angular.module('mnServers').controller('mnServersMemoryQuotaDialogController',mnServersMemoryQuotaDialogController);function mnServersMemoryQuotaDialogController($scope,indexSettings,$q,mnPoolDefault,$uibModalInstance,mnSettingsClusterService,memoryQuotaConfig,mnPromiseHelper,firstTimeAddedServices){var vm=this;vm.config=memoryQuotaConfig;vm.isEnterprise=mnPoolDefault.latestValue().value.isEnterprise;vm.onSubmit=onSubmit;vm.initialIndexSettings=_.clone(indexSettings);vm.indexSettings=indexSettings;vm.firstTimeAddedServices=firstTimeAddedServices;vm.getFirstTimeServiceNames=getFirstTimeServiceNames;if(indexSettings.storageMode===""){vm.indexSettings.storageMode=vm.isEnterprise?"plasma":"forestdb";}
function onSubmit(){if(vm.viewLoading){return;}
var queries=[mnPromiseHelper(vm,mnSettingsClusterService.postPoolsDefault(vm.config)).catchErrors().getPromise()];if(vm.firstTimeAddedServices.index){queries.push(mnPromiseHelper(vm,mnSettingsClusterService.postIndexSettings(vm.indexSettings)).catchErrors("postIndexSettingsErrors").getPromise());}
var promise=$q.all(queries);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeOnSuccess().showGlobalSuccess("Memory quota saved successfully!");}
function getFirstTimeServiceNames(){var services=[];if(firstTimeAddedServices.index)
services.push("GSI Index");if(firstTimeAddedServices.fts)
services.push("Full Text");if(firstTimeAddedServices.cbas)
services.push("Analytics");if(firstTimeAddedServices.eventing)
services.push("Eventing");return services;}}})();(function(){"use strict";angular.module('mnGroups',['mnGroupsService','mnSpinner','mnHelper','mnPoll','mnPromiseHelper','mnDragAndDrop','ui.bootstrap','mnFilters','mnAlertsService','mnPoolDefault','mnElementCrane']).controller('mnGroupsController',mnGroupsController);function mnGroupsController($scope,$uibModal,mnGroupsService,mnPromiseHelper,mnHelper,mnPoller,mnMakeSafeForCSSFilter,mnNaturalSortingFilter,$window,mnAlertsService,mnPoolDefault){var vm=this;vm.createGroup=createGroup;vm.deleteGroup=deleteGroup;vm.applyChanges=applyChanges;vm.reloadState=mnHelper.reloadState;vm.changeNodeGroup=changeNodeGroup;vm.disableApplyChangesBtn=true;activate();function applyChanges(){mnPromiseHelper($scope,mnGroupsService.applyChanges(vm.state.uri,vm.state.currentGroups)).reloadState("app.admin.servers.list.groups").showGlobalSuccess("Group changes applied successfully!").getPromise().then(null,function(resp){if(resp.status===409){vm.disableAddGroupBtn=true;vm.disableApplyChangesBtn=true;vm.revisionMismatch=true;}else{mnAlertsService.showAlertInPopup(resp.data,'error');}});}
function isGroupsEqual(){return _.isEqual(vm.state.initialGroups,vm.state.currentGroups);}
function deleteGroup(group){if(isGroupsEqual()){return $uibModal.open({templateUrl:'app/mn_admin/mn_groups/delete_dialog/mn_groups_delete_dialog.html',controller:'mnGroupsDeleteDialogController as groupsDeleteDialogCtl',resolve:{group:mnHelper.wrapInFunction(group)}});}else{$window.scrollTo(0,0);vm.serverGroupsWarnig=true;vm.disableApplyChangesBtn=false;}}
function createGroup(group){return $uibModal.open({templateUrl:'app/mn_admin/mn_groups/group_dialog/mn_groups_group_dialog.html',controller:'mnGroupsGroupDialogController as groupsGroupDialogCtl',resolve:{group:mnHelper.wrapInFunction(group)}});}
function changeNodeGroup(groupOld,groupNew,server){if(groupOld===groupNew||groupNew===server.toGroupPending){return;}
var fromGroup=_.find(vm.state.currentGroups,function(cGroup){return cGroup.name===groupOld;});var toGroup=_.find(vm.state.currentGroups,function(cGroup){return cGroup.name===groupNew;});_.remove(fromGroup.nodes,function(node){return node.hostname===server.hostname;});toGroup.nodes.push(server);if(server.toGroupPending===groupOld){delete server.toGroupPending;}else{server.toGroupPending=toGroup.name}
vm.disableApplyChangesBtn=false;}
function activate(){mnPromiseHelper(vm,mnGroupsService.getGroupsState()).applyToScope("state");}}})();(function(){"use strict";angular.module('mnGroupsService',[]).factory('mnGroupsService',mnGroupsService);function mnGroupsService($http,$filter){var mnGroupsService={getGroups:getGroups,getGroupsState:getGroupsState,createGroup:createGroup,updateGroup:updateGroup,deleteGroup:deleteGroup,applyChanges:applyChanges,getGroupsByHostname:getGroupsByHostname};return mnGroupsService;function applyChanges(url,groups){return $http({method:"PUT",url:url,data:JSON.stringify({"groups":groups})});}
function deleteGroup(url){return $http({method:"DELETE",url:url})}
function updateGroup(groupName,url){return $http({method:"PUT",url:url,data:{name:groupName}});}
function createGroup(groupName){return $http({method:"POST",url:"/pools/default/serverGroups",data:{name:groupName}});}
function getGroupsState(){return mnGroupsService.getGroups();}
function getGroupsByHostname(){return mnGroupsService.getGroups().then(function(resp){var groups=resp.groups;var hostnameToGroup={};_.each(groups,function(group){_.each(group.nodes,function(node){hostnameToGroup[node.hostname]=group;});});return hostnameToGroup;});}
function getGroups(){return $http({method:'GET',url:'/pools/default/serverGroups'}).then(function(resp){var groups=$filter('orderBy')(resp.data.groups,'name');resp.data.currentGroups=_.cloneDeep(groups);resp.data.initialGroups=_.cloneDeep(groups);return resp.data;});}}})();(function(){"use strict";angular.module('mnGroups').controller('mnGroupsGroupDialogController',mnGroupsGroupDialogController);function mnGroupsGroupDialogController($scope,$uibModalInstance,mnGroupsService,mnPromiseHelper,group){var vm=this;vm.isEditMode=!!group;vm.groupName=group?group.name:"";vm.onSubmit=onSubmit;function onSubmit(){if(vm.viewLoading){return;}
var promise=vm.isEditMode?mnGroupsService.updateGroup(vm.groupName,group.uri):mnGroupsService.createGroup(vm.groupName);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().reloadState("app.admin.servers.list.groups").showGlobalSuccess("Group saved successfully!");}}})();(function(){"use strict";angular.module('mnGroups').controller('mnGroupsDeleteDialogController',mnGroupsDeleteDialogController);function mnGroupsDeleteDialogController($scope,$uibModalInstance,mnGroupsService,mnPromiseHelper,group){var vm=this;vm.onSubmit=onSubmit;function onSubmit(){if(vm.viewLoading){return;}
var promise=mnGroupsService.deleteGroup(group.uri);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeFinally().reloadState("app.admin.servers.list.groups").showGlobalSuccess("Group deleted successfully!");}}})();(function(){angular.module('mnBucketsService',['mnBucketsStats']).factory('mnBucketsService',mnBucketsServiceFactory);function mnBucketsServiceFactory($http,$q,mnBucketsStats){var mnBucketsService={getBucketsByType:getBucketsByType,clearCache:clearCache,findMoxiBucket:findMoxiBucket,export:{}};var cache;return mnBucketsService;function clearCache(){mnBucketsStats.clearCache();cache=null}
function findMoxiBucket(mnHttpParams){return mnBucketsStats.get(mnHttpParams).then(function(resp){return _.find(resp.data,function(bucket){return bucket.proxyPort>0;});});}
function getBucketsByType(mnHttpParams){if(!!cache){return $q.when(cache);}
return mnBucketsStats.get(mnHttpParams).then(function(resp){var bucketsDetails=resp.data;bucketsDetails.byType={membase:[],memcached:[],ephemeral:[]};bucketsDetails.byName={};bucketsDetails.byType.membase.isMembase=true;bucketsDetails.byType.memcached.isMemcached=true;bucketsDetails.byType.ephemeral.isEphemeral=true;_.each(bucketsDetails,function(bucket){bucketsDetails.byName[bucket.name]=bucket;bucketsDetails.byType[bucket.bucketType].push(bucket);bucket.isMembase=bucket.bucketType==='membase';bucket.isEphemeral=bucket.bucketType==='ephemeral';bucket.isMemcached=bucket.bucketType==='memcached';});bucketsDetails.byType.names=_.pluck(bucketsDetails,'name');cache=bucketsDetails;mnBucketsService.export.details=bucketsDetails;return bucketsDetails;});}}})();(function(){"use strict";angular.module('mnBuckets',['mnHelper','mnBucketsService','ui.bootstrap','mnBucketsDetailsDialogService','mnBarUsage','mnBucketsForm','mnPromiseHelper','mnPoll','mnPoolDefault','mnSpinner','mnFilters','mnTasksDetails','mnWarmupProgress','mnElementCrane','mnSortableTable']).controller('mnBucketsController',mnBucketsController);function mnBucketsController($scope,mnBucketsService,mnHelper,mnPoolDefault,mnPromiseHelper,mnPoller,$uibModal,$rootScope,$interval){var vm=this;var poolDefault=mnPoolDefault.latestValue();vm.isCreateNewDataBucketDisabled=isCreateNewDataBucketDisabled;vm.isBucketCreationWarning=isBucketCreationWarning;vm.isMaxBucketCountWarning=isMaxBucketCountWarning;vm.areThereCreationWarnings=areThereCreationWarnings;vm.addBucket=addBucket;vm.maxBucketCount=poolDefault.value.maxBucketCount;activate();function activate(){var pull=$interval(function(){$rootScope.$broadcast("reloadBucketStats");},3000);$rootScope.$broadcast("reloadBucketStats");$scope.$on('$destroy',function(){$interval.cancel(pull);});}
function isCreateNewDataBucketDisabled(){return!$scope.buckets||!$scope.buckets.details||areThereCreationWarnings();}
function isBucketCreationWarning(){return poolDefault.value.rebalancing;}
function isMaxBucketCountWarning(){return(($scope.buckets&&$scope.buckets.details)||[]).length>=poolDefault.value.maxBucketCount;}
function areThereCreationWarnings(){return isMaxBucketCountWarning()||isBucketCreationWarning();}
function addBucket(){mnPromiseHelper(vm,mnPoolDefault.getFresh()).onSuccess(function(poolDefault){if(poolDefault.storageTotals.ram.quotaTotal===poolDefault.storageTotals.ram.quotaUsed){$uibModal.open({templateUrl:'app/mn_admin/mn_buckets/mn_bucket_full_dialog.html'});}else{!areThereCreationWarnings()&&$uibModal.open({templateUrl:'app/mn_admin/mn_buckets/details_dialog/mn_buckets_details_dialog.html',controller:'mnBucketsDetailsDialogController as bucketsDetailsDialogCtl',resolve:{bucketConf:function(mnBucketsDetailsDialogService){return mnBucketsDetailsDialogService.getNewBucketConf();},autoCompactionSettings:function(mnSettingsAutoCompactionService){return mnSettingsAutoCompactionService.getAutoCompaction(true);}}});}});}}})();(function(){"use strict";angular.module('mnBuckets').directive('mnBucketsList',mnBucketsList);function mnBucketsList(mnHelper){var mnBucketsListDirective={restrict:'A',scope:{buckets:'=',rbac:"=",poolDefault:"=",adminCtl:"="},templateUrl:'app/mn_admin/mn_buckets/list/mn_buckets_list.html',controller:controller,controllerAs:"bucketsListCtl"};return mnBucketsListDirective;function controller(){var vm=this;mnHelper.initializeDetailsHashObserver(vm,'openedBucket','app.admin.buckets');}}})();(function(){"use strict";angular.module("mnBuckets").controller("mnBucketsListItemController",mnBucketsListItemController);function mnBucketsListItemController(mnServersService,$scope){var vm=this;vm.getWarmUpProgress=getWarmUpProgress;vm.getResidentRatio=getResidentRatio;$scope.$watch("bucket",function(bucket){vm.bucketStatus=mnServersService.addNodesByStatus(bucket.nodes);},true);function getResidentRatio(bucket){var items=bucket.basicStats.itemCount;var activeResident=bucket.basicStats.vbActiveNumNonResident;if(items===0){return 100;}
if(items<activeResident){return 0;}
return(items-activeResident)*100/items;}
function getWarmUpProgress(bucket,tasks){if(!bucket||!tasks){return false;}
var totalPercent=0;var exists=false;tasks.tasksWarmingUp.forEach(function(task){if(task.bucket===bucket.name){exists=true;if(!Number(task.stats.ep_warmup_estimated_key_count)||!Number(task.stats.ep_warmup_estimated_value_count)){return;}
var message=task.stats.ep_warmup_state;switch(message){case"loading keys":totalPercent+=((Number(task.stats.ep_warmup_key_count)||1)/(Number(task.stats.ep_warmup_estimated_key_count)||1))*100;break;case"loading data":totalPercent+=((Number(task.stats.ep_warmup_value_count)||1)/(Number(task.stats.ep_warmup_estimated_value_count)||1))*100;break;default:return 100;}}});return exists?(totalPercent/bucket.nodes.length):false;}}})();(function(){"use strict";angular.module('mnBuckets').controller('mnBucketsDetailsController',mnBucketsDetailsController);function mnBucketsDetailsController($scope,mnBucketsDetailsService,mnTasksDetails,mnPromiseHelper,mnSettingsAutoCompactionService,mnCompaction,$uibModal,mnBytesToMBFilter,mnBucketsDetailsDialogService,mnPoller,mnHelper){var vm=this;vm.editBucket=editBucket;vm.deleteBucket=deleteBucket;vm.flushBucket=flushBucket;vm.registerCompactionAsTriggeredAndPost=registerCompactionAsTriggeredAndPost;vm.getGuageConfig=getGuageConfig;vm.getEndings=mnHelper.getEndings;var compactionTasks;var warmUpTasks;activate();function activate(){compactionTasks=new mnPoller($scope,function(){return mnBucketsDetailsService.getCompactionTask($scope.bucket);}).subscribe("compactionTasks",vm).reloadOnScopeEvent("mnTasksDetailsChanged").cycle();$scope.$watch('bucket',function(){compactionTasks.reload();mnPromiseHelper(vm,mnBucketsDetailsService.doGetDetails($scope.bucket)).applyToScope("bucketDetails");});$scope.$watchGroup(['bucket','adminCtl.tasks'],function(values){vm.warmUpTasks=mnBucketsDetailsService.getWarmUpTasks(values[0],values[1]);});}
$scope.$watch("bucketsDetailsCtl.bucketDetails",getBucketRamGuageConfig);function getBucketRamGuageConfig(details){vm.bucketRamGuageConfig=mnBucketsDetailsService.getBucketRamGuageConfig(details&&{total:details.basicStats.storageTotals.ram.quotaTotalPerNode*details.nodes.length,thisAlloc:details.quota.ram,otherBuckets:details.basicStats.storageTotals.ram.quotaUsedPerNode*details.nodes.length-details.quota.ram});}
function getGuageConfig(details){if(!details){return;}
return mnBucketsDetailsService.getGuageConfig(details.basicStats.storageTotals.hdd.total,details.basicStats.diskUsed,details.basicStats.storageTotals.hdd.usedByData-details.basicStats.diskUsed,details.basicStats.storageTotals.hdd.used-details.basicStats.storageTotals.hdd.usedByData);}
function editBucket(){$uibModal.open({templateUrl:'app/mn_admin/mn_buckets/details_dialog/mn_buckets_details_dialog.html',controller:'mnBucketsDetailsDialogController as bucketsDetailsDialogCtl',resolve:{bucketConf:function(){return mnBucketsDetailsDialogService.reviewBucketConf(vm.bucketDetails);},autoCompactionSettings:function(){if(vm.bucketDetails.autoCompactionSettings===undefined){return;}
return!vm.bucketDetails.autoCompactionSettings?mnSettingsAutoCompactionService.getAutoCompaction(true):mnSettingsAutoCompactionService.prepareSettingsForView(vm.bucketDetails);}}});}
function deleteBucket(bucket){$uibModal.open({templateUrl:'app/mn_admin/mn_buckets/delete_dialog/mn_buckets_delete_dialog.html',controller:'mnBucketsDeleteDialogController as bucketsDeleteDialogCtl',resolve:{bucket:function(){return bucket;}}});}
function flushBucket(bucket){$uibModal.open({templateUrl:'app/mn_admin/mn_buckets/flush_dialog/mn_buckets_flush_dialog.html',controller:'mnBucketsFlushDialogController as bucketsFlushDialogCtl',resolve:{bucket:function(){return bucket;}}});}
function registerCompactionAsTriggeredAndPost(url,disableButtonKey){vm.compactionTasks[disableButtonKey]=true;mnPromiseHelper(vm,mnCompaction.registerAsTriggeredAndPost(url)).onSuccess(function(){compactionTasks.reload()});};}})();(function(){angular.module('mnBucketsDetailsService',['mnPoolDefault','mnTasksDetails','mnCompaction']).factory('mnBucketsDetailsService',mnBucketsDetailsServiceFcatory);function mnBucketsDetailsServiceFcatory($q,$http,mnTasksDetails,mnPoolDefault,mnCompaction){var mnBucketsDetailsService={getBucketRamGuageConfig:getBucketRamGuageConfig,deleteBucket:deleteBucket,flushBucket:flushBucket,doGetDetails:doGetDetails,getWarmUpTasks:getWarmUpTasks,getGuageConfig:getGuageConfig,getCompactionTask:getCompactionTask};var bucketRamGuageConfig={};var guageConfig={};return mnBucketsDetailsService;function getWarmUpTasks(bucket,tasks){if(!bucket||!tasks){return;}
return _.filter(tasks.tasksWarmingUp,function(task){var isNeeded=task.bucket===bucket.name;if(isNeeded){task.hostname=_.find(bucket.nodes,function(node){return node.otpNode===task.node;}).hostname;}
return isNeeded;});}
function getCompactionTask(bucket){return mnTasksDetails.get().then(function(tasks){var rv={};rv.thisBucketCompactionTask=_.find(tasks.tasks,function(task){return task.type==='bucket_compaction'&&task.bucket===bucket.name;});if(rv.thisBucketCompactionTask&&!!rv.thisBucketCompactionTask.cancelURI){rv.disableCancel=!!mnCompaction.getStartedCompactions()[rv.thisBucketCompactionTask.cancelURI];}else{rv.disableCompact=!!(mnCompaction.getStartedCompactions()[bucket.controllers.compactAll]||rv.thisBucketCompactionTask);}
return rv});}
function getBucketRamGuageConfig(ramSummary){if(!ramSummary){return;}
var bucketRamGuageConfig={};bucketRamGuageConfig.topRight={name:'cluster quota',value:ramSummary.total};bucketRamGuageConfig.items=[{name:'other buckets',value:ramSummary.otherBuckets},{name:'this bucket',value:ramSummary.thisAlloc},{name:'remaining',value:ramSummary.total-ramSummary.otherBuckets-ramSummary.thisAlloc}];if(bucketRamGuageConfig.items[2].value<0){bucketRamGuageConfig.items[1].value=ramSummary.total-ramSummary.otherBuckets;bucketRamGuageConfig.items[2]={name:'overcommitted',value:ramSummary.otherBuckets+ramSummary.thisAlloc-ramSummary.total};bucketRamGuageConfig.topLeft={name:'total allocated',value:ramSummary.otherBuckets+ramSummary.thisAlloc};}
return bucketRamGuageConfig;}
function getGuageConfig(total,thisBucket,otherBuckets,otherData){var free=total-otherData-thisBucket-otherBuckets;guageConfig.topRight={name:'total cluster storage',value:total};guageConfig.items=[{name:'other buckets',value:otherBuckets},{name:'this bucket',value:thisBucket},{name:'remaining',value:free}];return guageConfig;}
function deleteBucket(bucket){return $http({method:'DELETE',url:bucket.uri});}
function flushBucket(bucket){return $http({method:'POST',url:bucket.controllers.flush});}
function doGetDetails(bucket){return $http({method:'GET',url:bucket.uri+"&basic_stats=true&skipMap=true"}).then(function(resp){return resp.data;});}}})();(function(){"use strict";angular.module('mnBuckets').controller('mnBucketsDetailsDialogController',mnBucketsDetailsDialogController);function mnBucketsDetailsDialogController($scope,$rootScope,$state,mnBucketsDetailsDialogService,bucketConf,autoCompactionSettings,mnHelper,mnPromiseHelper,$uibModalInstance,mnAlertsService){var vm=this;if(autoCompactionSettings!==undefined){bucketConf.autoCompactionDefined=!!bucketConf.autoCompactionSettings;vm.autoCompactionSettings=autoCompactionSettings;}
vm.bucketConf=bucketConf;vm.validationKeeper={};vm.onSubmit=onSubmit;vm.$uibModalInstance=$uibModalInstance;function onSubmit(){var data=mnBucketsDetailsDialogService.prepareBucketConfigForSaving(vm.bucketConf,vm.autoCompactionSettings,$scope.poolDefault,$scope.pools);var promise=mnBucketsDetailsDialogService.postBuckets(data,vm.bucketConf.uri);mnPromiseHelper(vm,promise).showGlobalSpinner().catchErrors(function(result){if(result){if(result.summaries){vm.validationResult=mnBucketsDetailsDialogService.adaptValidationResult(result);}else{mnAlertsService.showAlertInPopup(result,"error");}}}).onSuccess(function(result){if(!result.data){$uibModalInstance.close();$rootScope.$broadcast("reloadBucketStats");}}).showGlobalSuccess("Bucket settings saved successfully!");};}})();(function(){angular.module('mnBucketsDetailsDialogService',['mnFilters','mnPoolDefault','mnServersService','mnBucketsDetailsService','mnSettingsAutoCompactionService','mnAlertsService']).factory('mnBucketsDetailsDialogService',mnBucketsDetailsDialogServiceFactory);function mnBucketsDetailsDialogServiceFactory($http,$q,mnBytesToMBFilter,mnCountFilter,mnSettingsAutoCompactionService,mnPoolDefault,mnServersService,bucketsFormConfiguration,mnBucketsDetailsService){var mnBucketsDetailsDialogService={prepareBucketConfigForSaving:prepareBucketConfigForSaving,adaptValidationResult:adaptValidationResult,getNewBucketConf:getNewBucketConf,reviewBucketConf:reviewBucketConf,postBuckets:postBuckets};return mnBucketsDetailsDialogService;function postBuckets(data,uri){return $http({data:data,method:'POST',url:uri});}
function prepareBucketConfigForSaving(bucketConf,autoCompactionSettings,poolDefault,pools){var conf={};function copyProperty(property){if(bucketConf[property]!==undefined){conf[property]=bucketConf[property];}}
function copyProperties(properties){properties.forEach(copyProperty);}
if(bucketConf.isNew){copyProperties(["name","bucketType"]);}
if(bucketConf.bucketType==="membase"){copyProperties(["autoCompactionDefined","evictionPolicy"]);}
if(bucketConf.bucketType==="ephemeral"){copyProperty("purgeInterval");conf["evictionPolicy"]=bucketConf["evictionPolicyEphemeral"];}
if(bucketConf.bucketType==="membase"||bucketConf.bucketType==="ephemeral"){copyProperties(["threadsNumber","replicaNumber"]);if(pools.isEnterprise&&poolDefault.compat.atLeast55){copyProperty("compressionMode");if(!bucketConf.enableMaxTTL){conf.maxTTL=0;}else{copyProperty("maxTTL");}}
if(bucketConf.isNew){if(bucketConf.bucketType!=="ephemeral"){copyProperty("replicaIndex");}
if(pools.isEnterprise){copyProperty("conflictResolutionType");}}
if(bucketConf.autoCompactionDefined){_.extend(conf,mnSettingsAutoCompactionService.prepareSettingsForSaving(autoCompactionSettings));}}
if(bucketConf.isWizard){copyProperty("otherBucketsRamQuotaMB");}
copyProperties(["ramQuotaMB","flushEnabled"]);return conf;}
function adaptValidationResult(result){var ramSummary=result.summaries.ramSummary;return{totalBucketSize:mnBytesToMBFilter(ramSummary.thisAlloc),nodeCount:mnCountFilter(ramSummary.nodesCount,'node'),perNodeMegs:ramSummary.perNodeMegs,guageConfig:mnBucketsDetailsService.getBucketRamGuageConfig(ramSummary),errors:mnSettingsAutoCompactionService.prepareErrorsForView(result.errors)};}
function getNewBucketConf(){return $q.all([mnServersService.getNodes(),mnPoolDefault.get()]).then(function(resp){var activeServersLength=resp[0].reallyActiveData.length;var totals=resp[1].storageTotals;var bucketConf=_.clone(bucketsFormConfiguration);bucketConf.isNew=true;bucketConf.ramQuotaMB=mnBytesToMBFilter(Math.floor((totals.ram.quotaTotal-totals.ram.quotaUsed)/activeServersLength));return bucketConf;});}
function reviewBucketConf(bucketDetails){return mnBucketsDetailsService.doGetDetails(bucketDetails).then(function(bucketConf){bucketConf["evictionPolicyEphemeral"]=bucketConf["evictionPolicy"];bucketConf.ramQuotaMB=mnBytesToMBFilter(bucketConf.quota.rawRAM);bucketConf.threadsNumber=bucketConf.threadsNumber.toString();bucketConf.isDefault=bucketConf.name==='default';bucketConf.enableMaxTTL=bucketConf.maxTTL!==0;bucketConf.replicaIndex=bucketConf.replicaIndex?1:0;bucketConf.flushEnabled=(bucketConf.controllers!==undefined&&bucketConf.controllers.flush!==undefined)?1:0;return bucketConf;});}}})();(function(){"use strict";angular.module('mnBuckets').controller('mnBucketsDeleteDialogController',mnBucketsDeleteDialogController);function mnBucketsDeleteDialogController($scope,$uibModalInstance,bucket,mnHelper,mnPromiseHelper,mnBucketsDetailsService,mnAlertsService){var vm=this;vm.doDelete=doDelete;vm.bucketName=bucket.name;function doDelete(){var promise=mnBucketsDetailsService.deleteBucket(bucket);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchGlobalErrors().closeFinally().showGlobalSuccess("Bucket deleted successfully!");}}})();(function(){"use strict";angular.module('mnBuckets').controller('mnBucketsFlushDialogController',mnBucketsFlushDialogController);function mnBucketsFlushDialogController($scope,$uibModalInstance,bucket,mnPromiseHelper,mnBucketsDetailsService){var vm=this;vm.doFlush=doFlush;function doFlush(){var promise=mnBucketsDetailsService.flushBucket(bucket);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().catchGlobalErrors().broadcast("reloadBucketStats").showGlobalSuccess("Bucket flushed successfully!");}}})();(function(){"use strict";angular.module('mnIndexes',['mnViews','mnGsi','mnPluggableUiRegistry','mnElementCrane']).config(mnIndexesConfig);function mnIndexesConfig($stateProvider,mnHelperProvider,mnPluggableUiRegistryProvider){mnPluggableUiRegistryProvider.registerConfig({name:'Indexes',state:'app.admin.gsi',includedByState:'app.admin.gsi',plugIn:'workbenchTab',index:2,ngShow:"rbac.cluster.bucket['.'].n1ql.index.read"});$stateProvider.state('app.admin.gsi',{url:"/index?openedIndex",params:{openedIndex:{array:true,dynamic:true}},data:{title:"Indexes",permissions:"cluster.bucket['.'].n1ql.index.read"},views:{"main@app.admin":{controller:"mnGsiController as gsiCtl",templateUrl:"app/mn_admin/mn_indexes/mn_gsi/mn_gsi.html"}}});addViewsStates("app.admin");function addViewsStates(parent){var viewsState={abstract:true,url:'/views?bucket',params:{bucket:{value:null}},data:{title:"Views",permissions:"cluster.bucket['.'].settings.read && cluster.bucket['.'].views.read"},views:{"main@app.admin":{templateUrl:'app/mn_admin/mn_indexes/mn_views/mn_views.html',controller:'mnViewsController as viewsCtl'}}};$stateProvider.state(parent+'.views',viewsState).state(parent+'.views.list',{url:"?type",params:{type:{value:'development'}},controller:'mnViewsListController as viewsListCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/list/mn_views_list.html'}).state(parent+'.views.list.editing',{abstract:true,url:'/:documentId?viewId&{isSpatial:bool}&sampleDocumentId',views:{"main@app.admin":{controller:'mnViewsEditingController as viewsEditingCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/editing/mn_views_editing.html'}},data:{child:parent+".views.list",title:"Views Editing"}}).state(parent+'.views.list.editing.result',{url:'?subset&{pageNumber:int}&viewsParams',params:{full_set:{value:null},pageNumber:{value:0},activate:{value:null,dynamic:true}},controller:'mnViewsEditingResultController as viewsEditingResultCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/editing/mn_views_editing_result.html'});}}})();(function(){"use strict";angular.module("mnViews",['mnViewsListService','mnViewsEditingService','mnCompaction','mnHelper','mnPromiseHelper','mnPoll','mnFilter','ui.select','ui.router','ui.bootstrap','ngSanitize','mnPoolDefault','ngMessages']).controller("mnViewsController",mnViewsController);function mnViewsController($scope,$state,mnPoller,$q,mnViewsListService,mnPoolDefault){var vm=this;vm.onSelectBucket=onSelectBucket;vm.mnPoolDefault=mnPoolDefault.latestValue();vm.ddocsLoading=true;vm.currentBucketName=$state.params.bucket;function onSelectBucket(selectedBucket){$state.go('^.list',{bucket:selectedBucket});}}})();(function(){"use strict";angular.module("mnViewsListService",['mnTasksDetails','mnBucketsService',]).factory("mnViewsListService",mnViewsListFactory);function mnViewsListFactory($http,$q,mnTasksDetails,mnBucketsService){var mnViewsListService={createDdoc:createDdoc,getDdocUrl:getDdocUrl,getDdoc:getDdoc,deleteDdoc:deleteDdoc,cutOffDesignPrefix:cutOffDesignPrefix,getDdocs:getDdocs,getViewsListState:getViewsListState,getDdocsByType:getDdocsByType,getTasksOfCurrentBucket:getTasksOfCurrentBucket,isDevModeDoc:isDevModeDoc};return mnViewsListService;function handleCouchRequest(resp){var data={json:resp.data,meta:JSON.parse(resp.headers("X-Couchbase-Meta"))};return data;}
function createDdoc(url,json){return $http({method:'PUT',url:url,data:json,mnHttp:{isNotForm:true}}).then(handleCouchRequest);}
function getDdocUrl(bucket,name){var encodedName=encodeURIComponent(cutOffDesignPrefix(name));if(name.indexOf("_design/dev_")>-1){encodedName="_design/dev_"+encodedName;}else if(name.indexOf("_design/")>-1){encodedName="_design/"+encodedName;}
return'/couchBase/'+encodeURIComponent(bucket)+'/'+encodedName;}
function getDdoc(url){return $http({method:'GET',url:url}).then(handleCouchRequest);}
function deleteDdoc(url){return $http({method:'DELETE',url:url});}
function cutOffDesignPrefix(id){return id.replace(/^_design\/(dev_|)/,"");}
function getDdocs(bucket,mnHttpParams){return $http({method:"GET",url:'/pools/default/buckets/'+encodeURIComponent(bucket)+'/ddocs',mnHttp:mnHttpParams});}
function isDevModeDoc(id){var devPrefix="_design/dev_";return id.substring(0,devPrefix.length)==devPrefix;}
function getDdocsByType(bucket){return getDdocs(bucket).then(function(resp){var ddocs=resp.data;ddocs.development=_.filter(ddocs.rows,function(row){return isDevModeDoc(row.doc.meta.id);});ddocs.production=_.reject(ddocs.rows,function(row){return isDevModeDoc(row.doc.meta.id);});return ddocs;},function(resp){switch(resp.status){case 0:case-1:return $q.reject(resp);case 404:return!bucket?{status:"_404"}:resp;default:return resp;}});}
function getTasksOfCurrentBucket(params){return mnTasksDetails.get().then(function(tasks){var rv={};var importance={view_compaction:2,indexer:1};_.each(tasks.tasks,function(taskInfo){if((taskInfo.type!=='indexer'&&taskInfo.type!=='view_compaction')||taskInfo.bucket!==params.bucket){return;}
var ddoc=taskInfo.designDocument;(rv[ddoc]||(rv[ddoc]=[])).push(taskInfo);});_.each(rv,function(ddocTasks,key){ddocTasks.sort(function(taskA,taskB){return importance[taskA.type]-importance[taskB.type];});});return rv;});}
function getViewsListState(params){return getDdocsByType(params.bucket);}}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsListController",mnViewsListController);function mnViewsListController($scope,$rootScope,$state,$uibModal,mnViewsListService,mnViewsEditingService,mnPromiseHelper,mnCompaction,mnHelper,mnPoller,permissions){var vm=this;vm.type=$state.params.type;vm.isDevModeDoc=mnViewsListService.isDevModeDoc;vm.getStartedCompactions=mnCompaction.getStartedCompactions;vm.showCreationDialog=showCreationDialog;vm.showMapreduceCreationDialog=showMapreduceCreationDialog;vm.showSpatialCreationDialog=showSpatialCreationDialog;vm.showDdocDeletionDialog=showDdocDeletionDialog;vm.showViewDeletionDialog=showViewDeletionDialog;vm.publishDdoc=publishDdoc;vm.copyToDev=copyToDev;vm.registerCompactionAsTriggeredAndPost=registerCompactionAsTriggeredAndPost;vm.showPublishButton=showPublishButton;vm.showCreationButton=showCreationButton;vm.showSpatialButton=showSpatialButton;vm.showViewCreationButtons=showViewCreationButtons;vm.showMatchingWarning=showMatchingWarning;vm.getInitialViewsFilterParams=getInitialViewsFilterParams;vm.isDevelopmentViews=$state.params.type==='development';activate();function getInitialViewsFilterParams(key,row,isSpatial){return{sampleDocumentId:null,pageNumber:0,viewId:key,full_set:null,isSpatial:isSpatial,documentId:row.doc.meta.id,bucket:$state.params.bucket,viewsParams:JSON.stringify(mnViewsEditingService.getInitialViewsFilterParams(isSpatial))};}
function showMatchingWarning(row){return row.doc.json.spatial&&row.doc.json.views&&!_.isEmpty(row.doc.json.spatial)&&!_.isEmpty(row.doc.json.views)}
function showViewCreationButtons(){return vm.ddocs&&$state.params.bucket&&vm.isDevelopmentViews&&!vm.ddocs.ddocsAreInFactMissing;}
function showPublishButton(row){return vm.isDevelopmentViews&&!(row.doc.json.spatial&&row.doc.json.views&&!_.isEmpty(row.doc.json.spatial)&&!_.isEmpty(row.doc.json.views));}
function isEmptyView(row){return(!row.doc.json.spatial&&!row.doc.json.views||_.isEmpty(row.doc.json.spatial)&&_.isEmpty(row.doc.json.views));}
function showCreationButton(row){return vm.isDevelopmentViews&&(isEmptyView(row)||(row.doc.json.views&&!_.isEmpty(row.doc.json.views)&&(!row.doc.json.spatial||_.isEmpty(row.doc.json.spatial))));}
function showSpatialButton(row){return vm.isDevelopmentViews&&(isEmptyView(row)||(row.doc.json.spatial&&!_.isEmpty(row.doc.json.spatial)&&(!row.doc.json.views||_.isEmpty(row.doc.json.views))));}
function showMapreduceCreationDialog(){showCreationDialog(undefined,false);}
function showSpatialCreationDialog(){showCreationDialog(undefined,true);}
function showCreationDialog(ddoc,isSpatial){$uibModal.open({controller:'mnViewsCreateDialogController as viewsCreateDialogCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/create_dialog/mn_views_create_dialog.html',scope:$scope,resolve:{currentDdoc:mnHelper.wrapInFunction(ddoc),viewType:mnHelper.wrapInFunction(isSpatial?"spatial":"views")}});}
function showDdocDeletionDialog(ddoc){$uibModal.open({controller:'mnViewsDeleteDdocDialogController as viewsDeleteDdocDialogCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/delete_ddoc_dialog/mn_views_delete_ddoc_dialog.html',scope:$scope,resolve:{currentDdocName:mnHelper.wrapInFunction(ddoc.meta.id)}});}
function showViewDeletionDialog(ddoc,viewName,isSpatial){$uibModal.open({controller:'mnViewsDeleteViewDialogController as viewsDeleteViewDialogCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/delete_view_dialog/mn_views_delete_view_dialog.html',scope:$scope,resolve:{currentDdocName:mnHelper.wrapInFunction(ddoc.meta.id),currentViewName:mnHelper.wrapInFunction(viewName),isSpatial:mnHelper.wrapInFunction(isSpatial)}});}
function prepareToPublish(url,ddoc){return function(){return mnPromiseHelper(vm,mnViewsListService.createDdoc(url,ddoc.json)).onSuccess(function(){$state.go('^.list',{type:'production'});}).showGlobalSuccess("Design document published successfully!").getPromise();};}
function publishDdoc(ddoc){var url=mnViewsListService.getDdocUrl($state.params.bucket,"_design/"+mnViewsListService.cutOffDesignPrefix(ddoc.meta.id));var publish=prepareToPublish(url,ddoc);var promise=mnViewsListService.getDdoc(url).then(function(){return $uibModal.open({windowClass:"z-index-10001",backdrop:'static',templateUrl:'app/mn_admin/mn_indexes/mn_views/confirm_dialogs/mn_views_confirm_override_dialog.html'}).result.then(publish);},publish);mnPromiseHelper(vm,promise).showGlobalSpinner();}
function copyToDev(ddoc){$uibModal.open({controller:'mnViewsCopyDialogController as viewsCopyDialogCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/copy_dialog/mn_views_copy_dialog.html',scope:$scope,resolve:{currentDdoc:mnHelper.wrapInFunction(ddoc)}});}
function registerCompactionAsTriggeredAndPost(row){mnPromiseHelper(vm,mnCompaction.registerAsTriggeredAndPost(row.controllers.compact)).broadcast("reloadViewsPoller");}
function activate(){if(permissions.cluster.tasks.read){new mnPoller($scope,function(){return mnViewsListService.getTasksOfCurrentBucket($state.params);}).subscribe("tasks",vm).reloadOnScopeEvent(["reloadViewsPoller","mnTasksDetailsChanged"]).cycle();}
if(permissions.cluster.bucket['.'].views.read){new mnPoller($scope,function(){var promise=mnViewsListService.getViewsListState($state.params)
promise["finally"](function(){$scope.viewsCtl.ddocsLoading=false;});return promise;}).setInterval(10000).subscribe("ddocs",vm).reloadOnScopeEvent("reloadViewsPoller",vm,"showViewsPollerSpinner").cycle();}else{$scope.viewsCtl.ddocsLoading=false;}}}})();(function(){"use strict";angular.module("mnViewsEditingService",["mnViewsListService","mnDocumentsEditingService","mnViewsListService","mnFilters"]).factory("mnViewsEditingService",mnViewsEditingFactory);function mnViewsEditingFactory($http,$state,mnPermissions,mnViewsListService,mnDocumentsEditingService,mnDocumentsListService,$q,removeEmptyValueFilter,jQueryLikeParamSerializerFilter,mnPoolDefault,viewsPerPageLimit,docBytesLimit,getStringBytesFilter){var mnViewsEditingService={getViewsEditingState:getViewsEditingState,prepareRandomDocument:prepareRandomDocument,getViewResult:getViewResult,getFilterParams:getFilterParams,getFilterParamsAsString:getFilterParamsAsString,buildViewUrl:buildViewUrl,getInitialViewsFilterParams:getInitialViewsFilterParams};return mnViewsEditingService;function getInitialViewsFilterParams(isSpatial){return isSpatial?{limit:viewsPerPageLimit,stale:"false",connection_timeout:60000,}:{limit:viewsPerPageLimit,stale:"false",connection_timeout:60000,inclusive_end:true,reduce:""};}
function buildViewUrl(params){if(!params||!params.documentId){return;}
var params=_.clone(params);if(params.documentId.slice(0,"_design/".length)==="_design/"){params.documentId="_design/"+encodeURIComponent(params.documentId.slice("_design/".length));}
if(params.documentId.slice(0,"_local/".length)==="_local/"){params.documentId="_local/"+encodeURIComponent(params.documentId.slice("_local/".length));}
return encodeURIComponent(params.bucket)+"/"+params.documentId+(params.isSpatial?"/_spatial/":"/_view/")+encodeURIComponent(params.viewId);}
function getRandomKey(bucket){return $http({method:"GET",url:"/pools/default/buckets/"+encodeURIComponent(bucket)+"/localRandomKey"});}
function getFilterParamsAsString(params){return"?"+jQueryLikeParamSerializerFilter(removeEmptyValueFilter(getFilterParams(params)));}
function getFilterParams(params){params=params||$state.params;var filterParams
try{filterParams=JSON.parse(params.viewsParams)||{};}catch(e){filterParams={};}
filterParams.skip=params.pageNumber*viewsPerPageLimit;filterParams.full_set=params.full_set;return filterParams;}
function getViewResult(params){return $http({method:"GET",url:"/couchBase/"+buildViewUrl(params),params:removeEmptyValueFilter(getFilterParams(params)),timeout:3600000}).then(function(resp){resp.data.rows=_.filter(resp.data.rows,function(r){return('key'in r);});return resp.data;},function(view){return mnViewsListService.getTasksOfCurrentBucket(params).then(function(tasks){if(angular.isString(view.data)){view={data:{error:view.data}};}
view.data.from=buildViewUrl(params)+getFilterParamsAsString(params);var indexingRunning=_.filter(tasks[params.documentId],function(item){return item.type=="indexer"&&item.status=="running"&&item.designDocument==params.documentId;}).length;if((view.data.error==="timeout"||(view.config&&view.config.timeout.value==="timeout"))&&indexingRunning){view.data.error==="timeout";view.data.reason="node is still building up the index";view.data.showBtn=true;}
return $q.reject(view);});});}
function prepareDocForCodeMirror(doc){doc.metaJSON=angular.toJson(doc.meta,2);doc.jsonJSON=js_beautify(doc.json||"",{"indent_size":2});return doc;}
function getSampleDocument(params){return mnDocumentsEditingService.getDocument(params).then(function(sampleDocument){if(getStringBytesFilter(angular.toJson(sampleDocument.data.json))>docBytesLimit){return{meta:sampleDocument.data.meta,warnings:{largeDocument:true}};}
return prepareDocForCodeMirror(sampleDocument.data);},function(resp){switch(resp.status){case 404:return{source:{meta:{id:resp.data.key}},warnings:{documentDoesNotExist:true}};}});}
function prepareRandomDocument(params){return params.sampleDocumentId?getSampleDocument({documentId:params.sampleDocumentId,bucket:params.bucket}):getRandomKey(params.bucket).then(function(resp){return getSampleDocument({documentId:resp.data.key,bucket:params.bucket});},function(resp){switch(resp.status){case 404:if(resp.data.error==="fallback_to_all_docs"){return mnDocumentsListService.getDocuments({bucket:params.bucket,pageNumber:0,pageLimit:1}).then(function(resp){if(resp.data.rows[0]){return prepareDocForCodeMirror(resp.data.rows[0].doc);}else{return{warnings:{thereAreNoDocs:true}};}});}else{return{warnings:{thereAreNoDocs:true}};}}});}
function getEmptyViewState(params){return{isEmptyState:true};}
function getViewsEditingState(params){return $http({method:"HEAD",url:"/couchBase/"+buildViewUrl(params)}).then(function(){return $q.all([mnViewsListService.getDdocsByType(params.bucket),mnPoolDefault.get()]).then(function(resp){var rv={};var poolDefault=resp[1];rv.ddocs=resp[0];rv.capiBase=poolDefault.capiBase;rv.isDevelopmentDocument=mnViewsListService.isDevModeDoc(params.documentId)
if(rv.ddocs.rows.length){rv.currentDocument=_.find(rv.ddocs.rows,function(row){return row.doc.meta.id===params.documentId;});if(mnPermissions.export.cluster.bucket[params.bucket].data.docs.read){return prepareRandomDocument(params).then(function(randomDoc){rv.sampleDocument=randomDoc;return rv;});}else{return rv;}}else{return rv;}});},function(resp){switch(resp.status){default:return getEmptyViewState(params);}});}}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsEditingController",mnViewsEditingController);function mnViewsEditingController($scope,$state,$uibModal,mnHelper,mnViewsEditingService,mnViewsListService,mnPromiseHelper){var vm=this;var codemirrorOptions={lineNumbers:true,lineWrapping:true,matchBrackets:true,tabSize:2,mode:{name:"javascript",json:true},theme:'default',readOnly:false}
var viewsOptions=_.clone(codemirrorOptions);var sampleDocumentOptions=_.clone(codemirrorOptions);sampleDocumentOptions.readOnly=true;sampleDocumentOptions.lineWrapping=true;var sampleMetaOptions=_.clone(sampleDocumentOptions);vm.currentBucketName=$state.params.bucket;vm.viewsOptions=viewsOptions;vm.sampleDocumentOptions=sampleDocumentOptions;vm.sampleMetaOptions=sampleMetaOptions;vm.isSpatial=$state.params.isSpatial;vm.viewId=$state.params.viewId;vm.previewRandomDocument=previewRandomDocument;vm.awaitingSampleDocument=awaitingSampleDocument;vm.onReduceChange=onReduceChange;vm.setReduceValue=setReduceValue;vm.awaitingViews=awaitingViews;vm.goToDocumentsSection=goToDocumentsSection;vm.isEditDocumentDisabled=isEditDocumentDisabled;vm.toggleSampleDocument=toggleSampleDocument;vm.isViewsEditorControllsDisabled=isViewsEditorControllsDisabled;vm.isPreviewRandomDisabled=isPreviewRandomDisabled;vm.onSelectViewName=onSelectViewName;vm.toggleViews=toggleViews;vm.saveAs=saveAs;vm.save=save;vm.isFilterOpened=false;activate();function goToDocumentsSection(e){e.stopImmediatePropagation();$state.go("app.admin.buckets.documents.editing",{documentId:vm.state.sampleDocument.meta.id,bucket:$state.params.bucket});}
function toggleSampleDocument(){vm.isSampleDocumentClosed=!vm.isSampleDocumentClosed;}
function toggleViews(){vm.isViewsClosed=!vm.isViewsClosed;}
function hasNoWritePermission(){return!$scope.rbac.cluster.bucket[$state.params.bucket].views.write;}
function isEditDocumentDisabled(){return awaitingSampleDocument()||(vm.state.sampleDocument&&vm.state.sampleDocument.warnings)||vm.state.isEmptyState||hasNoWritePermission();}
function isPreviewRandomDisabled(){return awaitingSampleDocument()||vm.state.isEmptyState||hasNoWritePermission();}
function isViewsEditorControllsDisabled(){return awaitingViews()||vm.state.isEmptyState||!vm.state.isDevelopmentDocument||hasNoWritePermission();}
function awaitingSampleDocument(){return!vm.state||vm.state.sampleDocumentLoading}
function awaitingViews(){return!vm.state||vm.state.viewsLoading;}
function isViewPathTheSame(current,selected){return current.viewId===selected.viewId&&current.isSpatial===selected.isSpatial&&current.documentId===selected.documentId;}
function previewRandomDocument(e){e&&e.stopImmediatePropagation&&e.stopImmediatePropagation();mnPromiseHelper(vm.state,mnViewsEditingService.prepareRandomDocument($state.params)).showSpinner("sampleDocumentLoading").applyToScope("sampleDocument");}
function saveAs(e){e.stopImmediatePropagation();$uibModal.open({controller:'mnViewsCreateDialogController as viewsCreateDialogCtl',templateUrl:'app/mn_admin/mn_indexes/mn_views/create_dialog/mn_views_create_dialog.html',scope:$scope,resolve:{currentDdoc:mnHelper.wrapInFunction(vm.state.currentDocument.doc),viewType:mnHelper.wrapInFunction($state.params.isSpatial?"spatial":"views")}}).result.then(function(vm){var selected={documentId:'_design/dev_'+vm.ddoc.name,isSpatial:vm.isSpatial,viewId:vm.ddoc.view};if(!isViewPathTheSame($state.params,selected)){$state.go('^.result',{viewId:selected.viewId,documentId:selected.documentId});}});}
function setReduceValue(value){if(isViewsEditorControllsDisabled()){return;}
vm.state.currentDocument.doc.json.views[vm.viewId].reduce=value;}
function onReduceChange(view){if(view.reduce===""){delete view.reduce;}}
function save(e){e.stopImmediatePropagation();var url=mnViewsListService.getDdocUrl($state.params.bucket,vm.state.currentDocument.doc.meta.id)
mnPromiseHelper(vm.state,mnViewsListService.createDdoc(url,vm.state.currentDocument.doc.json)).catchErrors("viewsError").showSpinner("viewsLoading").showGlobalSuccess("View saved successfully!");}
function onSelectViewName(selected){$state.go('^.result',{viewId:selected.viewId,isSpatial:selected.isSpatial,documentId:selected.documentId});}
function activate(){$scope.$watch(isViewsEditorControllsDisabled,function(isDisabled){viewsOptions.readOnly=!!isDisabled;viewsOptions.matchBrackets=!isDisabled;vm.viewsOptions=viewsOptions;});return mnPromiseHelper(vm,mnViewsEditingService.getViewsEditingState($state.params)).applyToScope("state");}}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsEditingResultController",mnViewsEditingResultController);function mnViewsEditingResultController($scope,$state,mnPromiseHelper,mnViewsEditingService,viewsPerPageLimit){var vm=this;var filterConfig={};if($state.params.isSpatial){filterConfig.items={stale:true,connectionTimeout:true,bbox:true,startRange:true,endRange:true};}else{filterConfig.items={stale:true,connectionTimeout:true,descending:true,startkey:true,endkey:true,startkeyDocid:true,endkeyDocid:true,group:true,groupLevel:true,inclusiveEnd:true,key:true,keys:true,reduce:true};}
vm.filterConfig=filterConfig;vm.onFilterClose=onFilterClose;vm.onFilterOpen=onFilterOpen;vm.onFilterReset=onFilterReset;vm.isPrevDisabled=isPrevDisabled;vm.isNextDisabled=isNextDisabled;vm.nextPage=nextPage;vm.prevPage=prevPage;vm.loadSampleDocument=loadSampleDocument;vm.generateViewHref=generateViewHref;vm.getFilterParamsAsString=mnViewsEditingService.getFilterParamsAsString;vm.activate=activate;filterConfig.params=mnViewsEditingService.getFilterParams();if($state.params.activate){$state.go('^.result',{activate:false});activate();}
function onFilterReset(){filterConfig.params=mnViewsEditingService.getInitialViewsFilterParams($state.params.isSpatial);}
function generateViewHref(){return $scope.viewsEditingCtl.state&&($scope.viewsEditingCtl.state.capiBase+
mnViewsEditingService.buildViewUrl($state.params)+
mnViewsEditingService.getFilterParamsAsString());}
function nextPage(){$state.go('^.result',{pageNumber:$state.params.pageNumber+1,activate:true});}
function prevPage(){var prevPage=$state.params.pageNumber-1;prevPage=prevPage<0?0:prevPage;$state.go('^.result',{pageNumber:prevPage,activate:true});}
function loadSampleDocument(id){$state.go('^.result',{sampleDocumentId:id});}
function isEmptyState(){return!vm.state||vm.state.isEmptyState;}
function isPrevDisabled(){return isEmptyState()||vm.viewLoading||$state.params.pageNumber<=0;}
function isNextDisabled(){return isEmptyState()||vm.viewLoading||!vm.state.rows||vm.state.rows.length<viewsPerPageLimit||$state.params.pageNumber>=15;}
function onFilterClose(){var params=filterConfig.params
if(params.group===false){delete params.group;}
if(params.descending===false){delete params.descending;}
$state.go('^.result',{viewsParams:JSON.stringify(params)});$scope.viewsEditingCtl.isFilterOpened=false;}
function onFilterOpen(){$scope.viewsEditingCtl.isFilterOpened=true;}
function activate(){mnPromiseHelper(vm,mnViewsEditingService.getViewResult($state.params)).showSpinner().catchErrors().applyToScope("state");}}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsCreateDialogController",mnViewsCreateDialogController);function mnViewsCreateDialogController($scope,$uibModal,$state,$q,mnViewsListService,mnHelper,mnPromiseHelper,$uibModalInstance,currentDdoc,viewType){var vm=this;var isViewsEditingSection=$state.includes('views.editing.result');vm.ddoc={};vm.isSpatial=viewType==="spatial";vm.ddoc.name=currentDdoc&&mnViewsListService.cutOffDesignPrefix(currentDdoc.meta.id);vm.doesDdocExist=!!currentDdoc;if(isViewsEditingSection){vm.ddoc.view=$state.params.viewId;}
vm.isCopy=isViewsEditingSection;vm.onSubmit=onSubmit;function getDdocUrl(){return mnViewsListService.getDdocUrl($state.params.bucket,'_design/dev_'+vm.ddoc.name);}
function createDdoc(presentDdoc){var ddoc=presentDdoc||{json:{}};var views=ddoc.json[viewType]||(ddoc.json[viewType]={});if(vm.isCopy){views[vm.ddoc.view]=currentDdoc.json[viewType][$state.params.viewId];}else{if(vm.isSpatial){views[vm.ddoc.view]='function (doc) {\n  if (doc.geometry) {\n    emit(doc.geometry, null);\n  }\n}'}else{views[vm.ddoc.view]={map:'function (doc, meta) {\n  emit(meta.id, null);\n}'};}}
return mnViewsListService.createDdoc(getDdocUrl(),ddoc.json);}
function onSubmit(ddocForm){if(ddocForm.$invalid||vm.viewLoading){return;}
vm.error=false;var promise=mnViewsListService.getDdoc(getDdocUrl()).then(function(presentDdoc){var views=presentDdoc.json[viewType]||(presentDdoc.json[viewType]={});if(views[vm.ddoc.view]&&!vm.isCopy){return $q.reject({data:{reason:'View with given name already exists'}});}
if(_.keys(views).length>=10){return $uibModal.open({windowClass:"z-index-10001",backdrop:'static',templateUrl:'app/mn_admin/mn_indexes/mn_views/confirm_dialogs/mn_views_confirm_limit_dialog.html'}).result.then(function(){return createDdoc(presentDdoc);},function(){$uibModalInstance.close();});}
return createDdoc(presentDdoc);},function(){return createDdoc();});mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().broadcast("reloadViewsPoller").showGlobalSuccess("View created successfully!");};}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsDeleteDdocDialogController",mnViewsDeleteDdocDialogController);function mnViewsDeleteDdocDialogController($scope,$state,$uibModalInstance,mnViewsListService,currentDdocName,mnPromiseHelper){var vm=this;vm.currentDdocName=currentDdocName;vm.doDelete=doDelete;function doDelete(){var url=mnViewsListService.getDdocUrl($state.params.bucket,currentDdocName);var promise=mnViewsListService.deleteDdoc(url);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadViewsPoller").showGlobalSuccess("Design document deleted successfully!");}}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsDeleteViewDialogController",mnViewsDeleteViewDialogController);function mnViewsDeleteViewDialogController($scope,$state,$uibModalInstance,mnPromiseHelper,mnViewsListService,currentDdocName,currentViewName,isSpatial){var vm=this;vm.currentDdocName=currentDdocName;vm.currentViewName=currentViewName;vm.maybeSpatial=isSpatial?'Spatial':'';vm.doDelete=doDelete;function doDelete(){var url=mnViewsListService.getDdocUrl($state.params.bucket,currentDdocName);var promise=mnViewsListService.getDdoc(url).then(function(presentDdoc){delete presentDdoc.json[isSpatial?'spatial':'views'][currentViewName];return mnViewsListService.createDdoc(url,presentDdoc.json);});mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadViewsPoller").showGlobalSuccess("View deleted successfully!");};}})();(function(){"use strict";angular.module("mnViews").controller("mnViewsCopyDialogController",mnViewsCopyDialogController);function mnViewsCopyDialogController($scope,$uibModal,$state,mnViewsListService,mnPromiseHelper,$uibModalInstance,currentDdoc){var vm=this;vm.ddoc={};vm.ddoc.name=mnViewsListService.cutOffDesignPrefix(currentDdoc.meta.id);vm.onSubmit=onSubmit;function onSubmit(){var url=mnViewsListService.getDdocUrl($state.params.bucket,"_design/dev_"+vm.ddoc.name);var copy=prepareToCopy(url,currentDdoc);var promise=mnViewsListService.getDdoc(url).then(function(presentDdoc){return $uibModal.open({windowClass:"z-index-10001",backdrop:'static',templateUrl:'app/mn_admin/mn_indexes/mn_views/confirm_dialogs/mn_views_confirm_override_dialog.html'}).result.then(copy);},copy);mnPromiseHelper(vm,promise).showGlobalSpinner().showGlobalSuccess("View copied successfully!");}
function prepareToCopy(url,ddoc){return function(){return mnPromiseHelper(vm,mnViewsListService.createDdoc(url,ddoc.json),$uibModalInstance).closeOnSuccess().onSuccess(function(){$state.go('^.list',{type:'development'});}).getPromise();};}}})();(function(){"use strict";angular.module('mnGsiService',["qwQuery"]).factory('mnGsiService',mnGsiServiceFactory);function mnGsiServiceFactory($http,$q,qwQueryService){var mnGsiService={getIndexesState:getIndexesState,postDropIndex:postDropIndex};return mnGsiService;function postDropIndex(row){return qwQueryService.executeQueryUtil('DROP INDEX `'+row.bucket+'`.`'+row.indexName+'`',true);}
function getIndexesState(mnHttpParams){return $http({method:'GET',url:'/indexStatus',mnHttp:mnHttpParams}).then(function(resp){var byNodes={};var byBucket={};var byID={};resp.data.indexes.forEach(function(index){byBucket[index.bucket]=byBucket[index.bucket]||[];byBucket[index.bucket].push(Object.assign({},index));index.hosts.forEach(function(node){byNodes[node]=byNodes[node]||[];byNodes[node].push(Object.assign({},index));});});resp.data.byBucket=byBucket;resp.data.byNodes=byNodes;resp.data.byID=resp.data.indexes;return resp.data;});}}})();(function(){"use strict";angular.module('mnGsi',['mnHelper','mnGsiService','mnSortableTable','mnPoll','mnPoolDefault','mnPermissions','mnSpinner','mnFilters','mnSearch','mnElementCrane','ui.bootstrap','mnPromiseHelper','mnAlertsService','mnStatisticsNewService','mnDetailStats']).controller('mnGsiController',mnGsiController).controller('mnFooterStatsController',mnFooterStatsController);function mnGsiController($scope,mnGsiService,mnPoller){var vm=this;activate();function activate(){new mnPoller($scope,function(){return mnGsiService.getIndexesState();}).setInterval(10000).subscribe("state",vm).reloadOnScopeEvent("indexStatusURIChanged").cycle();}}
function mnFooterStatsController($scope,mnStatisticsNewService,mnPermissions){var vm=this;vm.currentBucket=mnPermissions.export.bucketNames['.stats!read']&&mnPermissions.export.bucketNames['.stats!read'][0];vm.onSelectBucket=onSelectBucket;vm.getLatestStat=getLatestStat;vm.getLatestStatExponent=getLatestStatExponent;var config={bucket:vm.currentBucket,node:"all",zoom:3000,step:1,stats:$scope.stats};activate();function activate(){mnStatisticsNewService.subscribeUIStatsPoller(config,$scope);}
function getLatestStat(statName){return $scope.mnUIStats&&$scope.mnUIStats.stats[statName]&&$scope.mnUIStats.stats[statName].aggregate.slice().reverse().find(stat=>stat!=null);}
function getLatestStatExponent(statName,digits){var value=getLatestStat(statName);if(value){return(d3.format('.'+digits+'e')(value));}else{return value;}}
function onSelectBucket(){config.bucket=vm.currentBucket;mnStatisticsNewService.heartbeat.throttledReload();}}})();(function(){"use strict";angular.module('mnGsi').directive('mnGsiTable',mnGsiTableDirective);function mnGsiTableDirective(mnHelper){var mnGsiTable={restrict:'EA',scope:{list:"=",hideColumn:"@",filterField:"=",rbac:"=",pools:"=",nodeName:"@?"},controller:mnGsiTableController,controllerAs:"mnGsiTableCtl",templateUrl:'app/mn_admin/mn_indexes/mn_gsi/mn_gsi_table_directive.html'};return mnGsiTable;function mnGsiTableController($scope){var vm=this;vm.generateIndexId=generateIndexId;vm.getStatusClass=getStatusClass;vm.getStatusDescription=getStatusDescription;mnHelper.initializeDetailsHashObserver(vm,'openedIndex','app.admin.gsi');function generateIndexId(row,partitionHost){return(row.id.toString()+(row.instId||""))+
(row.hosts?row.hosts.join():"")+
($scope.nodeName||"");}
function getStatusClass(row){row=row||{};if(row.stale){return'dynamic_warmup';}
switch(row.status){case'Ready':return'dynamic_healthy';case'Not Available':return'dynamic_unhealthy';case'Error':return'dynamic_unhealthy';case'Paused':return'dynamic_unhealthy';case'Replicating':case'Created':case'Building':case'Warmup':case'Created (Upgrading)':case'Created (Downgrading)':case'Building (Upgrading)':case'Building (Downgrading)':return'dynamic_warmup';default:return'dynamic_warmup';}}
function getStatusDescription(row){row=row||{};switch(row.status){case'Created':return'Index definition has been saved. Use Build Index to build the index. It is NOT serving scan requests yet.';case'Building':return'Index is currently building. It is NOT serving scan requests yet.';case'Ready':return'Index is ready to serve scan requests.';case'Replicating':return'Index is being replicated as part of a Rebalance or Alter Index operation. It is NOT serving scan requests until replication is complete.';case'Paused':return'Index is not ingesting new mutations as allocated memory has been completely used.';case'Warmup':return'Index is being loaded from persisted on-disk snapshot after indexer process restart. It is NOT serving scan requests yet.';case'Error':return'Index is in an error state and cannot be used in scan operations.';case'Created (Upgrading)':return'Index definition has been upgraded from Legacy storage engine to Standard GSI. It is NOT serving scan requests yet.';case'Created (Downgrading)':return'Index definition has been downgraded from Standard GSI to Legacy storage engine. It is NOT serving scan requests yet.';case'Building (Upgrading)':return'Index is building after upgrade from Legacy storage engine to Standard GSI. It is NOT serving scan requests yet.';case'Building (Downgrading)':return'Index is building after downgrade from Standard GSI to Legacy storage engine. It is NOT serving scan requests yet.';case'Not Available':return'Index not available.';}}}}})();(function(){"use strict";angular.module('mnGsi').controller('mnGsiItemController',mnGsiItemController).controller('mnGsiItemStatsController',mnGsiItemStatsController).directive('mnGsiItemDetails',mnGsiItemDetails);function mnGsiItemStatsController(mnStatisticsNewService,mnHelper,$scope){var vm=this;vm.zoom="minute";vm.onSelectZoom=onSelectZoom;activate();function onSelectZoom(){activate();}
function getStats(stat){var rv={};rv[stat]="@index-.@items";return rv;}
function activate(){var row=$scope.row;vm.hosts=row.hosts.join(', ');}}
function mnGsiItemController($scope,mnStatisticsNewService,mnPermissions){var vm=this;mnStatisticsNewService.subscribeUIStatsPoller({bucket:$scope.row.bucket,node:$scope.nodeName||"all",zoom:3000,step:1,stats:(['num_requests','index_resident_percent','items_count','data_size','num_docs_pending+queued']).map(getIndexStatName)},$scope);$scope.$watch("mnUIStats",updateValues);$scope.$watch("row",updateValues);function getIndexStatName(statName){return'index/'+$scope.row.index+'/'+statName;}
function hasNoValue(statName){var value=getStatSamples(statName);return parseFloat(value)!==value;}
function hasValue(statName){var value=getStatSamples(statName);return parseFloat(value)===value;}
function getStatSamples(statName){return $scope.mnUIStats&&$scope.mnUIStats.stats[getIndexStatName(statName)]&&$scope.mnUIStats.stats[getIndexStatName(statName)][$scope.nodeName||"aggregate"].slice().reverse().find(stat=>stat!=null);}
function updateValues(){(['num_requests','index_resident_percent','items_count','data_size','num_docs_pending+queued']).forEach(function(statName){vm['has_'+statName]=hasValue(statName);vm['has_no_'+statName]=hasNoValue(statName);if(vm['has_'+statName]){$scope.row[statName]=getStatSamples(statName);}});}}
function mnGsiItemDetails(){var mnGsiItemDetails={restrict:'E',scope:{row:"=",rbac:"=",pools:"=",nodeName:"@?"},controller:mnGsiItemDetailsController,controllerAs:"mnGsiItemDetailsCtl",templateUrl:'app/mn_admin/mn_indexes/mn_gsi/mn_gsi_item_details.html'};return mnGsiItemDetails;function mnGsiItemDetailsController($rootScope,mnGsiService,$uibModal,$filter,mnPromiseHelper,mnAlertsService){var vm=this;vm.dropIndex=dropIndex;vm.getFormattedScanTime=getFormattedScanTime;function getFormattedScanTime(row){if(row&&row.lastScanTime!='NA')
return $filter('date')(Date.parse(row.lastScanTime),'hh:mm:ss a, d MMM, y');else
return'NA';}
function dropIndex(row){var scope=$rootScope.$new();scope.partitioned=row.partitioned;$uibModal.open({windowClass:"z-index-10001",backdrop:'static',templateUrl:'app/mn_admin/mn_indexes/mn_gsi/mn_gsi_drop_confirm_dialog.html',scope:scope}).result.then(function(){row.awaitingRemoval=true;mnPromiseHelper(vm,mnGsiService.postDropIndex(row)).showGlobalSpinner().catchErrors(function(resp){if(!resp){return;}else if(_.isString(resp)){mnAlertsService.formatAndSetAlerts(resp.data,"error",4000);}else if(resp.errors&&resp.errors.length){mnAlertsService.formatAndSetAlerts(_.map(resp.errors,"msg"),"error",4000);}
row.awaitingRemoval=false;}).showGlobalSuccess("Index dropped successfully!");});}}}})();(function(){"use strict";angular.module("mnDocuments",["mnDocumentsListService","mnDocumentsEditingService","mnPromiseHelper","mnFilter","mnFilters","ui.router","ui.bootstrap","ui.codemirror","mnSpinner","ngMessages","mnPoll","mnElementCrane"]).controller("mnDocumentsController",mnDocumentsController);function mnDocumentsController($scope,mnDocumentsListService,mnPromiseHelper,$state,mnPoller){var vm=this;vm.onSelectBucketName=onSelectBucketName;vm.currentBucketName=$state.params.bucket;function onSelectBucketName(selectedBucket){$state.go('^.list',{bucket:selectedBucket,pageNumber:0});}}})();(function(){"use strict";angular.module("mnDocumentsEditingService",["mnBucketsService","mnFilters"]).factory("mnDocumentsEditingService",mnDocumentsEditingFactory);function mnDocumentsEditingFactory($http,mnBucketsService,$q,getStringBytesFilter,docBytesLimit){var mnDocumentsEditingService={getDocument:getDocument,createDocument:createDocument,deleteDocument:deleteDocument,getDocumentsEditingState:getDocumentsEditingState,isJsonOverLimited:isJsonOverLimited};return mnDocumentsEditingService;function isJsonOverLimited(json){return getStringBytesFilter(json)>docBytesLimit;}
function getDocumentsEditingState(params){return getDocument(params).then(function getDocumentState(resp){var doc=resp.data
var rv={};var editorWarnings={documentIsBase64:("base64"in doc),documentLimitError:isJsonOverLimited(doc.json)};rv.title=doc.meta.id;if(_.chain(editorWarnings).values().some().value()){rv.editorWarnings=editorWarnings;}else{rv.doc=js_beautify(doc.json,{"indent_size":2});rv.meta=JSON.stringify(doc.meta,null,"  ");}
return rv;},function(resp){switch(resp.status){case 404:return{editorWarnings:{notFound:true},title:params.documentId};default:return{errors:resp&&resp.data,};}});}
function deleteDocument(params){return $http({method:"DELETE",url:buildDocumentUrl(params)});}
function createDocument(params,doc,flags){return $http({method:"POST",url:buildDocumentUrl(params),data:{flags:flags||0x02000006,value:js_beautify(doc,{"indent_size":0,"eol":"","remove_space_before_token":true,"indent_char":""})||'{"click": "to edit", "with JSON": "there are no reserved field names"}'}});}
function getDocument(params){if(!params.documentId){return $q.reject({data:{reason:"Document ID cannot be empty"}});}
return $http({method:"GET",url:buildDocumentUrl(params)});}
function buildDocumentUrl(params){return"/pools/default/buckets/"+encodeURIComponent(params.bucket)+"/docs/"+encodeURIComponent(params.documentId);}}})();(function(){"use strict";angular.module("mnDocuments").controller("mnDocumentsEditingController",mnDocumentsEditingController);function mnDocumentsEditingController($scope,$state,$uibModal,mnDocumentsEditingService,mnPromiseHelper){var vm=this;var codemirrorOptions={lineNumbers:true,matchBrackets:false,lineWrapping:true,tabSize:2,mode:{name:"javascript",json:true},theme:'default'};var metaOptions=_.clone(codemirrorOptions);metaOptions.readOnly=true;metaOptions.lineWrapping=true;var editorOptions=_.clone(codemirrorOptions);editorOptions.onLoad=codemirrorLoaded;vm.editorOptions=editorOptions;vm.metaOptions=metaOptions;vm.isDeleteDisabled=isDeleteDisabled;vm.isSaveAsDisabled=isSaveAsDisabled;vm.isSaveDisabled=isSaveDisabled;vm.isEditorDisabled=isEditorDisabled;vm.areThereWarnings=areThereWarnings;vm.saveAsDialog=saveAsDialog;vm.deleteDocument=deleteDocument;vm.save=save;function save(){var parsedMeta=JSON.parse(vm.state.meta);var promise=mnDocumentsEditingService.createDocument($state.params,vm.state.doc,parsedMeta.flags).then(function(){return mnDocumentsEditingService.getDocumentsEditingState($state.params);});mnPromiseHelper(vm,promise).showSpinner().catchErrors().applyToScope("state").onSuccess(function(doc){vm.isDocumentChanged=false;}).showGlobalSuccess("Document saved successfully!");}
function codemirrorLoaded(cm){activate().then(function(resp){if(resp.doc){cm.on("change",function(doc){vm.isDocumentChanged=!documentIsNotChanged(doc.historySize());onDocValueUpdate(doc.getValue());});}});}
function deleteDocument(documentId){return $uibModal.open({controller:'mnDocumentsDeleteDialogController as documentsDeleteDialogCtl',templateUrl:'app/mn_admin/mn_documents/delete_dialog/mn_documents_delete_dialog.html',resolve:{documentId:function(){return vm.state.title;}}}).result.then(function(){$state.go("^.control.list");});}
function saveAsDialog(){return $uibModal.open({controller:'mnDocumentsCreateDialogController as documentsCreateDialogCtl',templateUrl:'app/mn_admin/mn_documents/create_dialog/mn_documents_create_dialog.html',resolve:{doc:function(){return vm.state.doc;}}}).result.then(function(resp){$state.go("^.editing",{documentId:resp.documentId});})}
function documentIsNotChanged(history){return history.redo==0&&history.undo==1;}
function areThereWarnings(){return vm.state&&_.chain(vm.state.editorWarnings).values().some().value();}
function areThereErrors(){return!!vm.state.errors||areThereWarnings();}
function hasDocUpsert(){return $scope.rbac.cluster.bucket[$state.params.bucket]&&$scope.rbac.cluster.bucket[$state.params.bucket].data.docs.upsert;}
function isEditorDisabled(){return!vm.state||(vm.state.editorWarnings&&(vm.state.editorWarnings.notFound||vm.state.editorWarnings.documentIsBase64||vm.state.editorWarnings.documentLimitError))||!hasDocUpsert();}
function isDeleteDisabled(){return!vm.state||vm.viewLoading||(vm.state.editorWarnings&&vm.state.editorWarnings.notFound)||!hasDocUpsert();}
function isSaveAsDisabled(){return!vm.state||vm.viewLoading||areThereErrors()||!hasDocUpsert();}
function isSaveDisabled(){return!vm.state||vm.viewLoading||!vm.isDocumentChanged||areThereErrors()||!hasDocUpsert();}
function onDocValueUpdate(json){vm.state.errors=null;try{var parsedJSON=JSON.parse(json);vm.state.editorWarnings={documentLimitError:mnDocumentsEditingService.isJsonOverLimited(JSON.stringify(parsedJSON))};}catch(error){vm.state.errors={reason:error.message,error:"Invalid document"};return false;}
return areThereWarnings()?false:parsedJSON;}
function activate(){$scope.$watch(isEditorDisabled,function(isDisabled){editorOptions.readOnly=!!isDisabled;editorOptions.matchBrackets=!isDisabled;vm.editorOptions=editorOptions;});return mnPromiseHelper(vm,mnDocumentsEditingService.getDocumentsEditingState($state.params)).applyToScope("state").getPromise();}}})();(function(){"use strict";angular.module("mnDocuments").controller("mnDocumentsListController",mnDocumentsListController);function mnDocumentsListController($scope,$rootScope,mnDocumentsListService,$state,$uibModal,removeEmptyValueFilter,jQueryLikeParamSerializerFilter){var vm=this;vm.lookupSubmit=lookupSubmit;vm.showCreateDialog=showCreateDialog;vm.deleteDocument=deleteDocument;vm.onFilterClose=onFilterClose;vm.onFilterReset=onFilterReset;vm.getDocumentsURI=getDocumentsURI;vm.getFilterParamsAsString=getFilterParamsAsString;var filterConfig={};try{filterConfig.params=JSON.parse($state.params.documentsFilter);}catch(e){filterConfig.params={};}
filterConfig.items={inclusiveEnd:true,endkey:true,startkey:true};vm.filterConfig=filterConfig;activate();function getDocumentsURI(){return mnDocumentsListService.getDocumentsURI($state.params)+getFilterParamsAsString($state.params);}
function getFilterParamsAsString(params){return"?"+jQueryLikeParamSerializerFilter(removeEmptyValueFilter(mnDocumentsListService.getDocumentsParams($state.params)));}
function onFilterReset(){vm.filterConfig.params={};}
function lookupSubmit(){vm.lookupId&&$state.go('^.^.editing',{documentId:vm.lookupId});}
function deleteDocument(documentId){return $uibModal.open({controller:'mnDocumentsDeleteDialogController as documentsDeleteDialogCtl',templateUrl:'app/mn_admin/mn_documents/delete_dialog/mn_documents_delete_dialog.html',resolve:{documentId:function(){return documentId;}}});}
function showCreateDialog(){return $uibModal.open({controller:'mnDocumentsCreateDialogController as documentsCreateDialogCtl',templateUrl:'app/mn_admin/mn_documents/create_dialog/mn_documents_create_dialog.html',resolve:{doc:function(){return false;}}});}
function onFilterClose(){var params=filterConfig.params;params=removeEmptyValueFilter(params);params&&$state.go('^.list',{documentsFilter:_.isEmpty(params)?null:JSON.stringify(params)});}
function activate(){$rootScope.$broadcast("reloadDocumentsPoller");}}})();(function(){"use strict";angular.module("mnDocuments").controller("mnDocumentsControlController",mnDocumentsControlController);function mnDocumentsControlController($scope,$state,mnPoller,mnDocumentsListService){var vm=this;vm.nextPage=nextPage;vm.prevPage=prevPage;vm.isPrevDisabled=isPrevDisabled;vm.isNextDisabled=isNextDisabled;vm.onSelectPageLimits=onSelectPageLimits;vm.isEmptyState=isEmptyState
activate();function isEmptyState(){return!vm.state||vm.state.status;}
function isPrevDisabled(){return isEmptyState()||vm.state.pageNumber===0;}
function isNextDisabled(){return isEmptyState()||vm.state.isNextDisabled;}
function nextPage(){$state.go('^.list',{pageNumber:vm.state.pageNumber+1});}
function prevPage(){var prevPage=vm.state.pageNumber-1;prevPage=prevPage<0?0:prevPage;$state.go('^.list',{pageNumber:prevPage});}
function onSelectPageLimits(pageLimit){$state.go('^.list',{pageLimit:pageLimit});}
function activate(){var poller=new mnPoller($scope,function(){return mnDocumentsListService.getDocumentsListState($state.params);}).setInterval(10000).subscribe("state",vm).reloadOnScopeEvent("reloadDocumentsPoller");}}})();(function(){"use strict";angular.module("mnDocumentsListService",["mnBucketsService"]).factory("mnDocumentsListService",mnDocumentsListFactory);function mnDocumentsListFactory($http,$q,mnBucketsService,docsLimit){var mnDocumentsListService={getDocuments:getDocuments,getDocumentsListState:getDocumentsListState,getDocumentsParams:getDocumentsParams,getDocumentsURI:getDocumentsURI};return mnDocumentsListService;function getListState(docs,params){var rv={};rv.pageNumber=params.pageNumber;rv.isNextDisabled=docs.rows.length<=params.pageLimit||params.pageLimit*(params.pageNumber+1)===docsLimit;if(docs.rows.length>params.pageLimit){docs.rows.pop();}
rv.docs=docs;rv.pageLimits=[10,20,50,100];rv.pageLimits.selected=params.pageLimit;return rv;}
function getDocumentsListState(params){return getDocuments(params).then(function(resp){return getListState(resp.data,params);},function(resp){switch(resp.status){case 0:case-1:return $q.reject(resp);case 404:return!params.bucket?{status:"_404"}:resp;case 501:return{};default:return resp;}});}
function getDocumentsParams(params){var param;try{param=JSON.parse(params.documentsFilter)||{};}catch(e){param={};}
var page=params.pageNumber;var limit=params.pageLimit;var skip=page*limit;param.skip=String(skip);param.include_docs=true;param.limit=String(limit+1);if(param.startkey){param.startkey=JSON.stringify(param.startkey);}
if(param.endkey){param.endkey=JSON.stringify(param.endkey);}
return param;}
function getDocumentsURI(params){return"/pools/default/buckets/"+encodeURIComponent(params.bucket)+"/docs";}
function getDocuments(params){return $http({method:"GET",url:getDocumentsURI(params),params:getDocumentsParams(params)});}}})();(function(){"use strict";angular.module("mnDocuments").controller("mnDocumentsCreateDialogController",mnDocumentsCreateDialogController);function mnDocumentsCreateDialogController($scope,mnDocumentsEditingService,mnPromiseHelper,$state,$uibModalInstance,doc){var vm=this;vm.onSubmit=onSubmit;function onSubmit(){var newDocumentParams={bucket:$state.params.bucket,documentId:vm.documentId};var promise=mnDocumentsEditingService.getDocument(newDocumentParams).then(function(){vm.error="Document with given ID already exists";},function(resp){if(resp.status==400){vm.error=resp.data&&resp.data.reason;}else if(resp.status>400&&resp.status<500){return mnPromiseHelper(vm,mnDocumentsEditingService.createDocument(newDocumentParams,doc),$uibModalInstance).catchErrors(function(data){vm.error=data&&data.reason;}).closeOnSuccess().onSuccess(function(){$state.go('^.^.editing',{documentId:newDocumentParams.documentId});});}else{vm.error=resp.data&&resp.data.reason;}});mnPromiseHelper($scope,promise,$uibModalInstance).showGlobalSpinner().showGlobalSuccess("Document created successfully!");}}})();(function(){"use strict";angular.module("mnDocuments").controller("mnDocumentsDeleteDialogController",mnDocumentsDeleteDialogController);function mnDocumentsDeleteDialogController($scope,mnDocumentsEditingService,$state,documentId,$uibModalInstance,mnPromiseHelper){var vm=this;vm.onSubmit=onSubmit;function onSubmit(){var promise=mnDocumentsEditingService.deleteDocument({bucket:$state.params.bucket,documentId:documentId});mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadDocumentsPoller").showGlobalSuccess("Document deleted successfully!");}}})();(function(){"use strict";angular.module('mnSettings',['mnSettingsNotifications','mnSettingsSampleBuckets','mnSettingsCluster','mnSettingsAutoFailover','mnSettingsAutoCompaction','mnAudit','mnSettingsCluster','mnSettingsAlerts','mnSettingsNotificationsService','ui.router','mnPluggableUiRegistry','mnElementCrane','mnSession']).config(mnSettingsConfig);function mnSettingsConfig($stateProvider){$stateProvider.state('app.admin.settings',{url:'/settings',abstract:true,views:{"main@app.admin":{templateUrl:'app/mn_admin/mn_settings/mn_settings.html',controller:'mnSettingsController as settingsCtl'}},data:{title:"Settings"}}).state('app.admin.settings.cluster',{url:'/cluster',views:{"":{controller:'mnSettingsClusterController as settingsClusterCtl',templateUrl:'app/mn_admin/mn_settings/cluster/mn_settings_cluster.html'},"autofailover@app.admin.settings.cluster":{controller:'mnSettingsAutoFailoverController as settingsAutoFailoverCtl',templateUrl:'app/mn_admin/mn_settings/auto_failover/mn_settings_auto_failover.html'},"notifications@app.admin.settings.cluster":{controller:'mnSettingsNotificationsController as settingsNotificationsCtl',templateUrl:'app/mn_admin/mn_settings/notifications/mn_settings_notifications.html'}}}).state('app.admin.settings.alerts',{url:'/alerts',controller:'mnSettingsAlertsController as settingsAlertsCtl',templateUrl:'app/mn_admin/mn_settings/alerts/mn_settings_alerts.html',data:{permissions:'cluster.settings.read'}}).state('app.admin.settings.autoCompaction',{url:'/autoCompaction',controller:'mnSettingsAutoCompactionController as settingsAutoCompactionCtl',templateUrl:'app/mn_admin/mn_settings/auto_compaction/mn_settings_auto_compaction.html',data:{permissions:'cluster.settings.read'}}).state('app.admin.settings.sampleBuckets',{url:'/sampleBuckets',controller:'mnSettingsSampleBucketsController as settingsSampleBucketsCtl',templateUrl:'app/mn_admin/mn_settings/sample_buckets/mn_settings_sample_buckets.html',data:{permissions:'cluster.samples.read'}});}})();(function(){"use strict";angular.module("mnSettings").controller("mnSettingsController",mnSettingsController);function mnSettingsController($scope){var vm=this;}})();(function(){"use strict";angular.module('mnSettingsAutoFailoverService',[]).factory('mnSettingsAutoFailoverService',mnSettingsAutoFailoverServiceFactory);function mnSettingsAutoFailoverServiceFactory($http){var mnSettingsAutoFailoverService={resetAutoFailOverCount:resetAutoFailOverCount,resetAutoReprovisionCount:resetAutoReprovisionCount,getAutoFailoverSettings:getAutoFailoverSettings,saveAutoFailoverSettings:saveAutoFailoverSettings,getAutoReprovisionSettings:getAutoReprovisionSettings,postAutoReprovisionSettings:postAutoReprovisionSettings};return mnSettingsAutoFailoverService;function resetAutoFailOverCount(mnHttpParams){return $http({method:'POST',url:'/settings/autoFailover/resetCount',mnHttp:mnHttpParams});}
function getAutoFailoverSettings(){return $http({method:'GET',url:"/settings/autoFailover"}).then(function(resp){return resp.data;});}
function saveAutoFailoverSettings(autoFailoverSettings,params){return $http({method:'POST',url:"/settings/autoFailover",data:autoFailoverSettings,params:params});}
function getAutoReprovisionSettings(){return $http({method:'GET',url:"/settings/autoReprovision"});}
function postAutoReprovisionSettings(settings,params){return $http({method:'POST',url:"/settings/autoReprovision",data:settings,params:params});}
function resetAutoReprovisionCount(mnHttpParams){return $http({method:'POST',url:"/settings/autoReprovision/resetCount",mnHttp:mnHttpParams});}}})();(function(){"use strict";angular.module('mnSettingsAutoFailover',['mnSettingsAutoFailoverService','mnHelper','mnPromiseHelper',"mnSettingsClusterService"]).controller('mnSettingsAutoFailoverController',mnSettingsAutoFailoverController);function mnSettingsAutoFailoverController($scope,$q,mnHelper,mnPromiseHelper,mnSettingsAutoFailoverService,mnPoolDefault,mnSettingsClusterService){var vm=this;mnSettingsClusterService.registerSubmitCallback(submit);activate();function getAutoFailoverSettings(){var settings={enabled:vm.autoFailoverSettings.enabled,timeout:vm.autoFailoverSettings.timeout};if(mnPoolDefault.export.compat.atLeast55&&mnPoolDefault.export.isEnterprise){settings.failoverOnDataDiskIssues=vm.autoFailoverSettings.failoverOnDataDiskIssues;settings.failoverServerGroup=vm.autoFailoverSettings.failoverServerGroup;settings.maxCount=vm.autoFailoverSettings.maxCount;}
if(mnPoolDefault.export.compat.atLeast65&&mnPoolDefault.export.isEnterprise){settings.canAbortRebalance=vm.autoFailoverSettings.canAbortRebalance;}
return settings;}
function getReprovisionSettings(){return{enabled:vm.reprovisionSettings.enabled,maxNodes:vm.reprovisionSettings.max_nodes};}
function watchOnSettings(method,dataFunc){return function(){if(!$scope.rbac.cluster.settings.write){return;}
mnPromiseHelper(vm,mnSettingsAutoFailoverService[method](dataFunc(),{just_validate:1})).catchErrorsFromSuccess(function(rv){vm[method+"Errors"]=rv;$scope.settingsClusterCtl[method+"Errors"]=rv;});}}
function activate(){mnPromiseHelper(vm,mnSettingsAutoFailoverService.getAutoReprovisionSettings()).applyToScope(function(resp){vm.reprovisionSettings=resp.data;$scope.$watch('settingsAutoFailoverCtl.reprovisionSettings',_.debounce(watchOnSettings("postAutoReprovisionSettings",getReprovisionSettings),500,{leading:true}),true);});mnPromiseHelper(vm,mnSettingsAutoFailoverService.getAutoFailoverSettings()).applyToScope(function(resp){vm.autoFailoverSettings=resp;$scope.$watch('settingsAutoFailoverCtl.autoFailoverSettings',_.debounce(watchOnSettings("saveAutoFailoverSettings",getAutoFailoverSettings),500,{leading:true}),true);});}
function submit(){var queries=[mnPromiseHelper(vm,mnSettingsAutoFailoverService.saveAutoFailoverSettings(getAutoFailoverSettings())).catchErrors(function(resp){vm.saveAutoFailoverSettingsErrors=resp&&{timeout:resp};}).getPromise(),mnPromiseHelper(vm,mnSettingsAutoFailoverService.postAutoReprovisionSettings(getReprovisionSettings())).catchErrors(function(resp){vm.postAutoReprovisionSettingsErrors=resp&&{maxNodes:resp};}).getPromise()];return $q.all(queries);};}})();(function(){"use strict";angular.module('mnSettingsClusterService',['mnPools']).factory('mnSettingsClusterService',mnSettingsClusterServiceFactory);function mnSettingsClusterServiceFactory($http,$q,IEC,mnPools){var mnSettingsClusterService={postPoolsDefault:postPoolsDefault,getIndexSettings:getIndexSettings,postIndexSettings:postIndexSettings,registerSubmitCallback:registerSubmitCallback,clearSubmitCallbacks:clearSubmitCallbacks,getSubmitCallbacks:getSubmitCallbacks,getSettingsRetryRebalance:getSettingsRetryRebalance,postSettingsRetryRebalance:postSettingsRetryRebalance,getPendingRetryRebalance:getPendingRetryRebalance,postCancelRebalanceRetry:postCancelRebalanceRetry,getMemcachedSettings:getMemcachedSettings,postMemcachedSettings:postMemcachedSettings};var childSubmitCallbacks=[];return mnSettingsClusterService;function postSettingsRetryRebalance(data,params){return $http.post("/settings/retryRebalance",data,{params:params});}
function getMemcachedSettings(){return $http.get("/pools/default/settings/memcached/global");}
function postMemcachedSettings(data){return $http.post("/pools/default/settings/memcached/global",data);}
function getPendingRetryRebalance(mnHttpParams){return $http({url:"/pools/default/pendingRetryRebalance",method:'GET',mnHttp:mnHttpParams});}
function getSettingsRetryRebalance(){return $http.get("/settings/retryRebalance").then(function(resp){return resp.data;});}
function postCancelRebalanceRetry(replicationId){return $http({url:"/controller/cancelRebalanceRetry/"+encodeURIComponent(replicationId),method:"POST",mnHttp:{group:"global"}});}
function getSubmitCallbacks(){return childSubmitCallbacks;}
function clearSubmitCallbacks(cb){childSubmitCallbacks=[];}
function registerSubmitCallback(cb){childSubmitCallbacks.push(cb);}
function maybeSetQuota(data,memory,service,key){if(!memory.services||memory.services.model[service]){if(memory[key]===null){data[key]="";}else{data[key]=memory[key];}}}
function postPoolsDefault(memoryQuotaConfig,justValidate,clusterName){var data={};if(clusterName!==undefined){data.clusterName=clusterName;}
if(memoryQuotaConfig){maybeSetQuota(data,memoryQuotaConfig,"kv","memoryQuota");maybeSetQuota(data,memoryQuotaConfig,"index","indexMemoryQuota");maybeSetQuota(data,memoryQuotaConfig,"fts","ftsMemoryQuota");if(mnPools.export.isEnterprise){maybeSetQuota(data,memoryQuotaConfig,"cbas","cbasMemoryQuota");maybeSetQuota(data,memoryQuotaConfig,"eventing","eventingMemoryQuota");}}
var config={method:'POST',url:'/pools/default',data:data};if(justValidate){config.params={just_validate:1};}
return $http(config);}
function getIndexSettings(){return $http.get("/settings/indexes").then(function(resp){return resp.data;});}
function postIndexSettings(data,justValidate){var configData={};(["indexerThreads","logLevel","maxRollbackPoints","storageMode"]).forEach(function(name){if(data[name]!==undefined){configData[name]=data[name];}});var config={method:'POST',url:'/settings/indexes',data:configData};if(justValidate){config.params={just_validate:1};}
return $http(config);}}})();(function(){"use strict";angular.module('mnSettingsCluster',['mnSettingsClusterService','mnHelper','mnPromiseHelper','mnMemoryQuota','mnStorageMode','mnPoolDefault','mnMemoryQuotaService','mnSpinner','mnClusterConfigurationService','mnXDCRService','mnField']).controller('mnSettingsClusterController',mnSettingsClusterController);function mnSettingsClusterController($scope,$q,$uibModal,mnPoolDefault,mnMemoryQuotaService,mnSettingsClusterService,mnHelper,mnPromiseHelper,mnClusterConfigurationService,mnXDCRService){var vm=this;vm.saveVisualInternalSettings=saveVisualInternalSettings;vm.reloadState=mnHelper.reloadState;vm.itemsSelect=[...Array(65).keys()].slice(1);activate();$scope.$watch('settingsClusterCtl.memoryQuotaConfig',_.debounce(function(memoryQuotaConfig){if(!memoryQuotaConfig||!$scope.rbac.cluster.pools.write){return;}
var promise=mnSettingsClusterService.postPoolsDefault(vm.memoryQuotaConfig,true);mnPromiseHelper(vm,promise).catchErrorsFromSuccess("memoryQuotaErrors");},500),true);$scope.$watch('settingsClusterCtl.indexSettings',_.debounce(function(indexSettings,prevIndexSettings){if(!indexSettings||!$scope.rbac.cluster.settings.indexes.write||!(prevIndexSettings&&!_.isEqual(indexSettings,prevIndexSettings))){return;}
var promise=mnSettingsClusterService.postIndexSettings(vm.indexSettings,true);mnPromiseHelper(vm,promise).catchErrorsFromSuccess("indexSettingsErrors");},500),true);function saveSettings(){var queries=[];var promise1=mnPromiseHelper(vm,mnSettingsClusterService.postPoolsDefault(vm.memoryQuotaConfig,false,vm.clusterName)).catchErrors("memoryQuotaErrors").onSuccess(function(){vm.initialMemoryQuota=vm.memoryQuotaConfig.indexMemoryQuota;}).getPromise();var promise2;var promise3;var promise5;var promise6;var promise8;var promise7=mnPromiseHelper(vm,mnSettingsClusterService.postSettingsRetryRebalance(vm.retryRebalanceCfg)).catchErrors("retryRebalanceErrors").getPromise();promise6=mnPromiseHelper(vm,mnXDCRService.postSettingsReplications(vm.replicationSettings)).catchErrors("replicationSettingsErrors").getPromise();queries.push(promise6);if(!_.isEqual(vm.indexSettings,vm.initialIndexSettings)&&$scope.rbac.cluster.settings.indexes.write){promise2=mnPromiseHelper(vm,mnSettingsClusterService.postIndexSettings(vm.indexSettings)).catchErrors("indexSettingsErrors").applyToScope("initialIndexSettings").getPromise();queries.push(promise2);}
if(mnPoolDefault.export.compat.atLeast55&&$scope.rbac.cluster.settings.write){promise3=mnPromiseHelper(vm,mnClusterConfigurationService.postQuerySettings((["queryTmpSpaceDir","queryTmpSpaceSize","queryPipelineBatch","queryPipelineCap","queryScanCap","queryTimeout","queryPreparedLimit","queryCompletedLimit","queryCompletedThreshold","queryLogLevel","queryMaxParallelism","queryN1QLFeatCtrl"]).reduce(function(acc,key){acc[key]=vm.querySettings[key];return acc;},{}))).catchErrors("querySettingsErrors").getPromise();promise5=mnPromiseHelper(vm,mnClusterConfigurationService.postCurlWhitelist(vm.querySettings.queryCurlWhitelist,vm.initialCurlWhitelist)).catchErrors("curlWhitelistErrors").onSuccess(prepareQueryCurl).getPromise();queries.push(promise3,promise5,promise7);}
if($scope.rbac.cluster.admin.memcached.write){promise8=mnPromiseHelper(vm,mnSettingsClusterService.postMemcachedSettings({num_reader_threads:packThreadValue('reader'),num_writer_threads:packThreadValue('writer')})).catchErrors("dataServiceSettingsErrors").getPromise();queries.push(promise8);}
queries=queries.concat(mnSettingsClusterService.getSubmitCallbacks().map(function(cb){return cb();}));var promiseAll=$q.all(queries);mnPromiseHelper(vm,promiseAll).showGlobalSpinner().reloadState().showGlobalSuccess("Settings saved successfully!");}
function packThreadValue(type){switch(vm[type+'Threads']){case"fixed":return vm[type+'ThreadsFixed'];default:return vm[type+'Threads'];}}
function unpackThreadValue(value,settings){switch(typeof value){case"string":return value;case"number":return"fixed";default:return"default";}}
function unpackThreadsCount(value){switch(typeof value){case"number":return value.toString();default:return"4";}}
function saveVisualInternalSettings(){if(vm.clusterSettingsLoading){return;}
if((!vm.indexSettings||vm.indexSettings.storageMode==="forestdb")&&vm.initialMemoryQuota!=vm.memoryQuotaConfig.indexMemoryQuota){$uibModal.open({templateUrl:'app/mn_admin/mn_settings/cluster/mn_settings_cluster_confirmation_dialog.html'}).result.then(saveSettings);}else{saveSettings();}}
function maybeSetInititalValue(array,value){if(array.length===0){array.push(value);}}
function prepareQueryCurl(querySettings){var queryCurl=querySettings.queryCurlWhitelist;queryCurl.allowed_urls=queryCurl.allowed_urls||[];queryCurl.disallowed_urls=queryCurl.disallowed_urls||[];maybeSetInititalValue(queryCurl.allowed_urls,"");maybeSetInititalValue(queryCurl.disallowed_urls,"");vm.initialCurlWhitelist=_.cloneDeep(queryCurl);vm.querySettings=querySettings;}
function activate(){mnSettingsClusterService.clearSubmitCallbacks();mnPromiseHelper(vm,mnPoolDefault.get()).applyToScope(function(resp){vm.clusterName=resp.clusterName;});if(mnPoolDefault.export.compat.atLeast55&&$scope.rbac.cluster.settings.read){mnPromiseHelper(vm,mnClusterConfigurationService.getQuerySettings()).onSuccess(prepareQueryCurl);}
var services={kv:true,index:true,fts:true,n1ql:true};if(mnPoolDefault.export.isEnterprise){services.cbas=mnPoolDefault.export.compat.atLeast55;services.eventing=mnPoolDefault.export.compat.atLeast55;}
mnXDCRService.getSettingsReplications().then(function(rv){vm.replicationSettings=rv.data;});if($scope.rbac.cluster.admin.memcached.read){mnSettingsClusterService.getMemcachedSettings().then(function(rv){vm.readerThreads=unpackThreadValue(rv.data.num_reader_threads);vm.writerThreads=unpackThreadValue(rv.data.num_writer_threads);vm.readerThreadsFixed=unpackThreadsCount(rv.data.num_reader_threads);vm.writerThreadsFixed=unpackThreadsCount(rv.data.num_writer_threads);});}
mnSettingsClusterService.getSettingsRetryRebalance().then(function(data){vm.retryRebalanceCfg=data;if(!$scope.rbac.cluster.settings.write){return;}
$scope.$watch('settingsClusterCtl.retryRebalanceCfg',_.debounce(function(values){mnPromiseHelper(vm,mnSettingsClusterService.postSettingsRetryRebalance(values,{just_validate:1})).catchErrorsFromSuccess("retryRebalanceErrors");},500,{leading:true}),true);});mnPromiseHelper(vm,mnMemoryQuotaService.memoryQuotaConfig(services,false,false)).applyToScope(function(resp){vm.initialMemoryQuota=resp.indexMemoryQuota;vm.memoryQuotaConfig=resp;});if($scope.rbac.cluster.settings.indexes.read){mnPromiseHelper(vm,mnSettingsClusterService.getIndexSettings()).applyToScope(function(indexSettings){vm.indexSettings=indexSettings;vm.initialIndexSettings=_.clone(indexSettings);});}}}})();angular.module('mnSettingsNotificationsService',['mnPoolDefault','mnBucketsService','mnPools','mnAnalyticsService','mnViewsListService','mnSettingsClusterService','mnSettingsAutoFailoverService','mnSettingsAutoCompactionService','mnGsiService','mnAuditService','mnFilters','mnPermissions','mnTasksDetails','mnUserRolesService']).factory('mnSettingsNotificationsService',function($http,mnPoolDefault,mnBucketsService,mnPools,$q,$window,$rootScope,mnAnalyticsService,mnViewsListService,mnGsiService,mnAuditService,mnMBtoBytesFilter,mnPermissions,mnSettingsClusterService,mnSettingsAutoFailoverService,mnSettingsAutoCompactionService,mnTasksDetails,mnXDCRService,mnUserRolesService){var mnSettingsNotificationsService={};function sumWithoutNull(array,average){if(!array){return 0;}
array=_.without(array,null);if(!array.length){return 0;}
var rv=_.reduce(array,function(memo,num){return memo+num;},0);return average?rv/array.length:rv;}
function buildPhoneHomeThingy(source){var bucketsList=source[0];var perBucketStats=source[1];var pools=source[2];var poolsDefault=source[3];var indexStatus=source[4];var auditSettings=source[5];var indexSettings=source[6];var autoFailoverSettings=source[7];var autoCompactionSettings=source[8];var remotes=source[9];var xdcr_tasks=source[10];var eventing=source[11];var analytics=source[12];var ldapSettings=source[13];function getAvgPerItem(items,filter){var avgs=[];_.each(items,function(item,key){if(filter(key)){avgs.push(sumWithoutNull(item,true));}});return avgs;}
function precision(val){return Number(val.toFixed(5));}
function getHourFromWeek(value){return value/11520*60;}
function calculateAvgWeekAndHour(stats,name,avg){var weekName=name+"_last_week";var hourName=name+"_last_hour";if(stats.istats[weekName].length){stats.istats[weekName]=sumWithoutNull(stats.istats[weekName],avg);stats.istats[hourName]=getHourFromWeek(stats.istats[weekName]);stats.istats[weekName]=precision(stats.istats[weekName]);stats.istats[hourName]=precision(stats.istats[hourName]);}else{stats.istats[weekName]=0;stats.istats[hourName]=0;}}
function setPerBucketStat(stats,name,value){if(value){var weekName=name+"_last_week";stats.istats[weekName]=stats.istats[weekName].concat(value);}}
var stats={cluster_settings:{},version:pools.implementationVersion,componentsVersion:pools.componentsVersion,uuid:pools.uuid,numNodes:poolsDefault.nodes.length,isEnterpriseEdition:pools.isEnterprise,adminLDAPEnabled:poolsDefault.saslauthdEnabled||ldapSettings&&ldapSettings.data.authenticationEnabled,ram:{total:poolsDefault.storageTotals.ram.total,quotaTotal:poolsDefault.storageTotals.ram.quotaTotal,quotaUsed:poolsDefault.storageTotals.ram.quotaUsed,indexMemoryQuota:mnMBtoBytesFilter(poolsDefault.indexMemoryQuota)},hdd:{total:poolsDefault.storageTotals.hdd.total,quotaTotal:poolsDefault.storageTotals.hdd.quotaTotal,used:poolsDefault.storageTotals.hdd.used,usedByData:poolsDefault.storageTotals.hdd.usedByData},buckets:{total:bucketsList.length,membase:bucketsList.byType.membase.length,memcached:bucketsList.byType.memcached.length,ephemeral:bucketsList.byType.ephemeral.length},counters:poolsDefault.counters,nodes:{os:[],uptime:[],istats:[],services:{}},istats:{avg_ops_last_week:[],avg_cmd_set_last_week:[],avg_query_requests_last_week:[],total_avg_view_accesses_last_week:[],total_avg_index_num_rows_returned_last_week:[],vb_active_sync_write_committed_count_last_week:[],total_ddocs:0,total_views:0,total_indexes:0,total_curr_items_tot:0,total_fts_indexes:0},xdcr:{},browser:$window.navigator.userAgent};if(remotes&&remotes.filtered){stats.xdcr.remotes=remotes.filtered.map(function(remote){return{name:remote.name,uuid:remote.uuid};});}
if(xdcr_tasks&&xdcr_tasks.tasksXDCR){stats.xdcr.replications=xdcr_tasks.tasksXDCR.map(function(task){return{source_bucket:task.source,dest_bucket:task.target.split('buckets/')[1],dest_cluster:task.id.split('/')[0],filter:task.filterExpression,protocol:task.replicationType,status:task.status};});}
if(eventing){stats.eventing={num_eventing_nodes:eventing.num_eventing_nodes};if(eventing.apps){stats.eventing.num_apps=eventing.apps.length;stats.eventing.apps=eventing.apps.map(function(app){return{composite_status:app.composite_status,num_deployed_nodes:app.num_deployed_nodes};});}}
stats.analytics=analytics;for(i in poolsDefault.nodes){stats.nodes.os.push(poolsDefault.nodes[i].os);stats.nodes.uptime.push(poolsDefault.nodes[i].uptime);stats.nodes.istats.push(poolsDefault.nodes[i].interestingStats);var servicesContainerName=poolsDefault.nodes[i].services.sort().join(',');if(!stats.nodes.services[servicesContainerName]){stats.nodes.services[servicesContainerName]=0;}
stats.nodes.services[servicesContainerName]++;}
var interestedBuckets=bucketsList.byType.membase.concat(bucketsList.byType.ephemeral);_.each(perBucketStats,function(perBucketStat,index){var bucketName=interestedBuckets[index].name;var ddocs=perBucketStat[1].data;if(ddocs&&ddocs.rows){stats.istats.total_ddocs+=ddocs.rows.length;_.each(ddocs.rows,function(row){stats.istats.total_views+=_.keys(row.doc.json.views||{}).length;stats.istats.total_views+=_.keys(row.doc.json.spatial||{}).length;});}
var statsInfo=perBucketStat[0].data;if(statsInfo){var bucketStats=statsInfo.stats["@kv-"+bucketName];var indexStats=statsInfo.stats["@index-"+bucketName];var queriesStats=statsInfo.stats["@query"];var ftsStats=statsInfo.stats["@fts-"+bucketName];if(ftsStats){stats.istats.total_fts_indexes+=_.keys(_.reduce(ftsStats,function(result,value,key){key=key.split("/");if(key.length===3){result[key[1]]=true;}
return result;},{})).length;}
var avgNumRowsReturnedPerIndex=getAvgPerItem(indexStats,function(key){key=key.split("/");return key.length===3&&key[2]==="num_rows_returned"&&key[0]==="index";});var avgViewAccessesPerView=getAvgPerItem(bucketStats,function(key){key=key.split("/");return key.length===3&&key[2]==="accesses"&&key[0]==="views";});setPerBucketStat(stats,"avg_ops",bucketStats.ops);setPerBucketStat(stats,"vb_active_sync_write_committed_count",bucketStats.vb_active_sync_write_committed_count);setPerBucketStat(stats,"avg_cmd_set",bucketStats.cmd_set);setPerBucketStat(stats,"total_avg_view_accesses",bucketStats&&avgViewAccessesPerView);setPerBucketStat(stats,"total_avg_index_num_rows_returned",indexStats&&avgNumRowsReturnedPerIndex);stats.istats.avg_query_requests_last_week=(queriesStats&&queriesStats.query_requests)||[];stats.istats.total_curr_items_tot+=bucketStats.curr_items_tot?bucketStats.curr_items_tot[bucketStats.curr_items_tot.length-1]:0;}});if(autoCompactionSettings){stats.cluster_settings.compaction={database_trigger_percent_enabled:!!autoCompactionSettings.databaseFragmentationThreshold.percentageFlag,database_trigger_percent_level:autoCompactionSettings.databaseFragmentationThreshold.percentage,database_trigger_size_enabled:!!autoCompactionSettings.databaseFragmentationThreshold.sizeFlag,database_trigger_size_MB:autoCompactionSettings.databaseFragmentationThreshold.size,view_trigger_percent_enabled:!!autoCompactionSettings.viewFragmentationThreshold.percentageFlag,view_trigger_percent_level:autoCompactionSettings.viewFragmentationThreshold.percentage,view_trigger_size_enabled:!!autoCompactionSettings.viewFragmentationThreshold.sizeFlag,view_trigger_size_MB:autoCompactionSettings.viewFragmentationThreshold.size,compaction_trigger_time_based_enabled:!!autoCompactionSettings.allowedTimePeriodFlag,compaction_trigger_time_based_start_time:{hour:autoCompactionSettings.allowedTimePeriod.fromHour,minute:autoCompactionSettings.allowedTimePeriod.fromMinute},index_trigger_percent_enabled:!autoCompactionSettings.indexCircularCompactionFlag,index_trigger_percent_level:autoCompactionSettings.indexFragmentationThreshold.percentage,index_trigger_circular_reuse_enabled:autoCompactionSettings.indexCircularCompactionFlag,index_trigger_circular_reuse_days:autoCompactionSettings.indexCircularCompactionDaysOfWeek,index_trigger_circular_reuse_start_time:{hour:autoCompactionSettings.indexCircularCompaction.fromHour,minute:autoCompactionSettings.indexCircularCompaction.fromMinute}};}
if(autoFailoverSettings){stats.cluster_settings.enable_auto_failover=autoFailoverSettings.enabled;stats.cluster_settings.failover_timeout=autoFailoverSettings.timeout;}
if(indexSettings){stats.cluster_settings.index_storage_mode=indexSettings.storageMode;}
if(indexStatus){stats.istats.total_indexes=indexStatus.indexes.length;}
if(auditSettings){stats.adminAuditEnabled=auditSettings.auditdEnabled;}
calculateAvgWeekAndHour(stats,"avg_ops",true);calculateAvgWeekAndHour(stats,"avg_cmd_set",true);calculateAvgWeekAndHour(stats,"avg_query_requests",true);calculateAvgWeekAndHour(stats,"vb_active_sync_write_committed_count",true);calculateAvgWeekAndHour(stats,"total_avg_view_accesses");calculateAvgWeekAndHour(stats,"total_avg_index_num_rows_returned");return stats;}
mnSettingsNotificationsService.buildPhoneHomeThingy=function(mnHttpParams){return $q.all([mnBucketsService.getBucketsByType(mnHttpParams),mnPools.get(mnHttpParams),mnPoolDefault.get(undefined,mnHttpParams)]).then(function(resp){var buckets=resp[0];var pools=resp[1];var poolDefault=resp[2];var perBucketQueries=[];angular.forEach(buckets.byType.membase.concat(buckets.byType.ephemeral),function(bucket){var statsParams={$stateParams:{zoom:"week",bucket:bucket.name}};var queries=[mnAnalyticsService.doGetStats(statsParams,mnHttpParams)];if(_.indexOf(poolDefault.thisNode.services,"kv")>-1&&mnPermissions.export.cluster.bucket[bucket.name].views.read){queries.push(mnViewsListService.getDdocs(bucket.name,mnHttpParams));}else{queries.push($q.when({}));}
perBucketQueries.push($q.all(queries));});var queries=[$q.when(buckets),$q.all(perBucketQueries),$q.when(pools),$q.when(poolDefault)];if(mnPermissions.export.cluster.bucket['.'].n1ql.index.read){queries[4]=mnGsiService.getIndexesState(mnHttpParams);}
if(mnPools.export.isEnterprise&&mnPermissions.export.cluster.admin.security.read){queries[5]=mnAuditService.getAuditSettings();}
if(mnPermissions.export.cluster.settings.indexes.read){queries[6]=mnSettingsClusterService.getIndexSettings();}
if(mnPermissions.export.cluster.settings.read){queries[7]=mnSettingsAutoFailoverService.getAutoFailoverSettings();}
if(mnPermissions.export.cluster.settings.read){queries[8]=mnSettingsAutoCompactionService.getAutoCompaction();}
if(mnPermissions.export.cluster.xdcr.remote_clusters.read){queries[9]=mnXDCRService.getReplicationState();}
if(mnPermissions.export.cluster.tasks.read){queries[10]=mnTasksDetails.get(mnHttpParams);}
if(poolDefault.nodes.some(function(node){return(_.indexOf(node.services,'eventing')>-1);})){queries[11]=mnSettingsNotificationsService.getEventingData();}
if(poolDefault.nodes.some(function(node){return _.indexOf(node.services,'cbas')>-1;})){queries[12]=mnSettingsNotificationsService.getCbasData();}
if(poolDefault.isEnterprise&&mnPermissions.export.cluster.admin.security.read){queries[13]=mnUserRolesService.getLdapSettings();}
return $q.all(queries).then(buildPhoneHomeThingy);});};mnSettingsNotificationsService.getCbasData=function(){return $http.post('/_p/cbas/query/service',{statement:'with user_datasets as (select value d from Metadata.`Dataset` d '+'where d.DataverseName <> "Metadata") select '+'(select value count(*) from user_datasets d group by d.BucketName) as datasets_per_bucket, '+'(select value count(*) from user_datasets d group by d.DataverseName) as datasets_per_dataverse, '+'(select value count(distinct d.UUID) from Metadata.`Bucket` d where d.IsRunning) as connected_buckets;'}).then(function(resp){if(resp&&resp.data&&_.isArray(resp.data.results)&&resp.data.results[0])
return(resp.data.results[0]);}).catch(angular.noop);};mnSettingsNotificationsService.getEventingData=function(){return $http.get('/_p/event/api/v1/status').then(function(resp){if(resp&&resp.data)return resp.data}).catch(angular.noop);};mnSettingsNotificationsService.getUpdates=function(data,mnHttpParams){return $http({method:'JSONP',mnHttp:mnHttpParams,url:'https://ph.couchbase.net/v2',timeout:8000,params:{launchID:data.launchID,version:data.version}});};mnSettingsNotificationsService.maybeCheckUpdates=function(mnHttpParams){return mnSettingsNotificationsService.getSendStatsFlag(mnHttpParams).then(function(sendStatsData){sendStatsData.enabled=sendStatsData.sendStats;if(!sendStatsData.sendStats){return sendStatsData;}else{return mnPools.get(mnHttpParams).then(function(pools){return mnSettingsNotificationsService.getUpdates({launchID:pools.launchID,version:pools.implementationVersion},mnHttpParams).then(function(resp){return _.extend(_.clone(resp.data),sendStatsData);},function(resp){return sendStatsData;});});}})};mnSettingsNotificationsService.saveSendStatsFlag=function(flag){return $http.post("/settings/stats",{sendStats:flag});};mnSettingsNotificationsService.getSendStatsFlag=function(mnHttpParams){return $http({method:"GET",url:"/settings/stats",mnHttp:mnHttpParams}).then(function(resp){return resp.data;});};return mnSettingsNotificationsService;});(function(){"use strict";angular.module('mnSettingsNotifications',['mnSettingsNotificationsService','mnPromiseHelper','mnSettingsClusterService']).controller('mnSettingsNotificationsController',mnSettingsNotificationsController);function mnSettingsNotificationsController($scope,mnPromiseHelper,mnSettingsNotificationsService,pools,mnSettingsClusterService){var vm=this;mnSettingsClusterService.registerSubmitCallback(submit);vm.implementationVersion=pools.implementationVersion;activate();function activate(){mnPromiseHelper(vm,mnSettingsNotificationsService.maybeCheckUpdates()).applyToScope("updates");}
function submit(){return mnPromiseHelper(vm,mnSettingsNotificationsService.saveSendStatsFlag(vm.updates.enabled)).catchGlobalErrors('An error occured, update notifications settings were not saved.').getPromise();}}})();(function(){"use strict";angular.module('mnSettingsAlertsService',["mnHelper"]).factory('mnSettingsAlertsService',mnSettingsAlertsService);function mnSettingsAlertsService($http,knownAlerts,mnHelper){var mnSettingsAlertsService={testMail:testMail,saveAlerts:saveAlerts,getAlerts:getAlerts};return mnSettingsAlertsService;function testMail(params){params=_.clone(params);params.alerts=params.alerts.join(',');return $http.post('/settings/alerts/testEmail',params);}
function saveAlerts(settings,params){settings=_.clone(settings);settings.alerts=settings.alerts.join(',');return $http.post('/settings/alerts',settings,{params:params});}
function getAlerts(){return $http.get('/settings/alerts').then(function(resp){var val=_.clone(resp.data);val.recipients=val.recipients.join('\n');val.knownAlerts=_.clone(knownAlerts);val.alerts=mnHelper.listToCheckboxes(val.alerts);return val;});}}})();(function(){"use strict";angular.module('mnSettingsAlerts',['mnSettingsAlertsService','mnHelper','mnPromiseHelper','mnAutocompleteOff']).controller('mnSettingsAlertsController',mnSettingsAlertsController).filter('alertsLabel',alertsLabelFilter);function alertsLabelFilter(knownAlerts){return function(name){switch(name){case knownAlerts[0]:return'Node was auto-failed-over';case knownAlerts[1]:return'Maximum number of auto-failed-over nodes was reached';case knownAlerts[2]:return'Node wasn\'t auto-failed-over as other nodes are down at the same time';case knownAlerts[3]:return'Node was not auto-failed-over as there are not enough nodes in the cluster running the same service';case knownAlerts[4]:return'Node was not auto-failed-over as auto-failover for one or more services running on the node is disabled';case knownAlerts[5]:return'Node\'s IP address has changed unexpectedly';case knownAlerts[6]:return'Disk space used for persistent storage has reached at least 90% of capacity';case knownAlerts[7]:return'Metadata overhead is more than 50%';case knownAlerts[8]:return'Bucket memory on a node is entirely used for metadata';case knownAlerts[9]:return'Writing data to disk for a specific bucket has failed';case knownAlerts[10]:return'Writing event to audit log has failed';case knownAlerts[11]:return'Approaching full Indexer RAM warning';case knownAlerts[12]:return'Remote mutation timestamp exceeded drift threshold';case knownAlerts[13]:return'Communication issues among some nodes in the cluster';}};}
function mnSettingsAlertsController($scope,mnHelper,mnPromiseHelper,mnSettingsAlertsService){var vm=this;vm.isFormElementsDisabled=isFormElementsDisabled;vm.testEmail=testEmail;vm.submit=submit;vm.reloadState=mnHelper.reloadState;activate();function watchOnAlertsSettings(alertsSettings){if(!$scope.rbac.cluster.settings.write){return;}
mnPromiseHelper(vm,mnSettingsAlertsService.saveAlerts(getParams(),{just_validate:1})).catchErrorsFromSuccess();}
function submit(){var params=getParams();mnPromiseHelper(vm,mnSettingsAlertsService.saveAlerts(params)).showGlobalSpinner().catchErrors().showGlobalSuccess("Settings saved successfully!").onSuccess(getState);}
function getState(){return mnPromiseHelper(vm,mnSettingsAlertsService.getAlerts()).onSuccess(function(data){vm.state=data;vm.validState=_.merge({},data);});}
function activate(){getState().onSuccess(function(data){$scope.$watch('settingsAlertsCtl.state',_.debounce(watchOnAlertsSettings,500,{leading:true}),true);});}
function testEmail(){var params=getParams();params.subject='Test email from Couchbase Server';params.body='This email was sent to you to test the email alert email server settings.';mnPromiseHelper(vm,mnSettingsAlertsService.testMail(params)).showGlobalSpinner().showGlobalSuccess('Test email was sent successfully!').catchGlobalErrors('An error occurred during sending test email.');}
function isFormElementsDisabled(){return!vm.state||!vm.state.enabled;}
function getParams(){var params
if(vm.state.enabled===false){params=_.clone(vm.validState);params.enabled=false;}else{params=_.clone(vm.state);}
params.alerts=mnHelper.checkboxesToList(params.alerts);params.recipients=params.recipients.replace(/\s+/g,',');params.emailUser=params.emailServer.user;params.emailPass=params.emailServer.pass;params.emailHost=params.emailServer.host;params.emailPort=params.emailServer.port;params.emailEncrypt=params.emailServer.encrypt;delete params.emailServer;delete params.knownAlerts;return params;}}})();(function(){"use strict";angular.module('mnSettingsAutoCompactionService',['mnFilters','mnHelper']).factory('mnSettingsAutoCompactionService',mnSettingsAutoCompactionServiceFactory);function mnSettingsAutoCompactionServiceFactory($http,$q,mnBytesToMBFilter,mnMBtoBytesFilter,mnHelper){var mnSettingsAutoCompactionService={prepareSettingsForView:prepareSettingsForView,prepareSettingsForSaving:prepareSettingsForSaving,getAutoCompaction:getAutoCompaction,saveAutoCompaction:saveAutoCompaction,prepareErrorsForView:prepareErrorsForView};return mnSettingsAutoCompactionService;function prepareValuesForView(holder){angular.forEach(['size','percentage'],function(fieldName){if(holder[fieldName]==="undefined"){holder[fieldName]="";}else{holder[fieldName+'Flag']=true;fieldName==="size"&&(holder[fieldName]=mnBytesToMBFilter(holder[fieldName]));}});}
function prepareSettingsForView(settings,isBucketsDetails){var acSettings=settings.autoCompactionSettings;prepareValuesForView(acSettings.databaseFragmentationThreshold);prepareValuesForView(acSettings.viewFragmentationThreshold);if(isBucketsDetails){delete acSettings.indexFragmentationThreshold;delete acSettings.indexCircularCompaction;}else{if(acSettings.indexCircularCompaction){acSettings.indexCircularCompactionFlag=acSettings.indexCompactionMode==="circular";if(acSettings.indexCircularCompaction.daysOfWeek==""){acSettings.indexCircularCompactionDaysOfWeek={};}else{acSettings.indexCircularCompactionDaysOfWeek=mnHelper.listToCheckboxes(acSettings.indexCircularCompaction.daysOfWeek.split(","));}
acSettings.indexCircularCompaction=acSettings.indexCircularCompaction.interval;}}
if(acSettings.indexFragmentationThreshold){prepareValuesForView(acSettings.indexFragmentationThreshold);}
acSettings.allowedTimePeriodFlag=!!acSettings.allowedTimePeriod;acSettings.purgeInterval=settings.purgeInterval;!acSettings.allowedTimePeriod&&(acSettings.allowedTimePeriod={abortOutside:false,toMinute:null,toHour:null,fromMinute:null,fromHour:null});return acSettings;}
function prepareVluesForSaving(holder){angular.forEach(['size','percentage'],function(fieldName){if(!holder[fieldName+'Flag']){delete holder[fieldName];}else{fieldName==="size"&&(holder[fieldName]=mnMBtoBytesFilter(holder[fieldName]));fieldName==="percentage"&&(holder[fieldName]=Number(holder[fieldName]));}});}
function prepareSettingsForSaving(acSettings){if(!acSettings){return acSettings;}
acSettings=_.clone(acSettings,true);acSettings.purgeInterval=Number(acSettings.purgeInterval);if(!acSettings.allowedTimePeriodFlag){delete acSettings.allowedTimePeriod;}
if(acSettings.indexCircularCompaction){acSettings.indexCompactionMode=acSettings.indexCircularCompactionFlag===true?"circular":"full";acSettings.indexCircularCompaction={daysOfWeek:mnHelper.checkboxesToList(acSettings.indexCircularCompactionDaysOfWeek).join(','),interval:acSettings.indexCircularCompaction};delete acSettings.indexCircularCompactionFlag;delete acSettings.indexCircularCompactionDaysOfWeek;}
prepareVluesForSaving(acSettings.databaseFragmentationThreshold);prepareVluesForSaving(acSettings.viewFragmentationThreshold);if(acSettings.indexFragmentationThreshold){prepareVluesForSaving(acSettings.indexFragmentationThreshold);delete acSettings.indexFragmentationThreshold.sizeFlag;delete acSettings.indexFragmentationThreshold.percentageFlag;}
delete acSettings.databaseFragmentationThreshold.sizeFlag;delete acSettings.viewFragmentationThreshold.percentageFlag;delete acSettings.viewFragmentationThreshold.sizeFlag;delete acSettings.databaseFragmentationThreshold.percentageFlag;delete acSettings.allowedTimePeriodFlag;return acSettings;}
function getAutoCompaction(isBucketsDetails){return $http.get('/settings/autoCompaction').then(function(resp){return mnSettingsAutoCompactionService.prepareSettingsForView(resp.data,isBucketsDetails);});}
function prepareErrorsForView(errors){angular.forEach(["fromHour","fromMinute","toHour","toMinute"],function(value){if(errors["indexCircularCompaction[interval]["+value+"]"]){errors["indexCircularCompaction["+value+"]"]=errors["indexCircularCompaction[interval]["+value+"]"];delete errors["indexCircularCompaction[interval]["+value+"]"];}});angular.forEach(errors,function(value,key){errors[key.replace('[','_').replace(']','_')]=value;});return errors;}
function saveAutoCompaction(autoCompactionSettings,params){return $http({method:'POST',url:'/controller/setAutoCompaction',params:params||{},data:mnSettingsAutoCompactionService.prepareSettingsForSaving(autoCompactionSettings)}).then(null,function(resp){if(resp.data){resp.data.errors=prepareErrorsForView(resp.data.errors);}
return $q.reject(resp);});}}})();(function(){"use strict";angular.module('mnSettingsAutoCompaction',['mnSettingsAutoCompactionService','mnHelper','mnPromiseHelper','mnAutoCompactionForm']).controller('mnSettingsAutoCompactionController',mnSettingsAutoCompactionController);function mnSettingsAutoCompactionController($scope,mnHelper,mnPromiseHelper,mnSettingsAutoCompactionService){var vm=this;vm.reloadState=mnHelper.reloadState;vm.submit=submit;activate();function activate(){mnPromiseHelper(vm,mnSettingsAutoCompactionService.getAutoCompaction()).applyToScope("autoCompactionSettings").onSuccess(function(){$scope.$watch('settingsAutoCompactionCtl.autoCompactionSettings',watchOnAutoCompactionSettings,true);});}
function watchOnAutoCompactionSettings(autoCompactionSettings){if(!$scope.rbac.cluster.settings.write){return;}
mnPromiseHelper(vm,mnSettingsAutoCompactionService.saveAutoCompaction(autoCompactionSettings,{just_validate:1})).catchErrors();}
function submit(){if(vm.viewLoading){return;}
delete vm.errors;mnPromiseHelper(vm,mnSettingsAutoCompactionService.saveAutoCompaction(vm.autoCompactionSettings)).showGlobalSpinner().reloadState().catchErrors().showGlobalSuccess("Settings saved successfully!");}}})();(function(){"use strict";angular.module("mnSettingsSampleBuckets",["mnSettingsSampleBucketsService","mnPromiseHelper","mnElementCrane"]).controller("mnSettingsSampleBucketsController",mnSettingsSampleBucketsController);function mnSettingsSampleBucketsController($scope,mnSettingsSampleBucketsService,mnPromiseHelper){var vm=this;vm.selected={};vm.isCreateButtonDisabled=isCreateButtonDisabled;vm.installSampleBuckets=installSampleBuckets;vm.isAnyBucketSelected=isAnyBucketSelected;activate();function getState(selected){return mnPromiseHelper(vm,mnSettingsSampleBucketsService.getSampleBucketsState(selected||vm.selected)).applyToScope("state");}
function doGetState(){getState();}
function activate(){getState().showSpinner();$scope.$watch("settingsSampleBucketsCtl.selected",function(value,oldValue){if(value!==oldValue){getState(value);}},true);$scope.$on("reloadBucketStats",doGetState);$scope.$on("nodesChanged",doGetState);$scope.$on("reloadTasksPoller",doGetState);}
function installSampleBuckets(){mnPromiseHelper(vm,mnSettingsSampleBucketsService.installSampleBuckets(vm.selected)).showGlobalSpinner().catchGlobalErrors().reloadState("app.admin.settings").showGlobalSuccess("Task added successfully!");}
function isAnyBucketSelected(){return _.keys(_.pick(vm.selected,_.identity)).length;}
function isCreateButtonDisabled(){return vm.viewLoading||vm.state&&(_.chain(vm.state.warnings).values().some().value()||!vm.state.available.length)||!isAnyBucketSelected();}}})();(function(){"use strict";angular.module("mnSettingsSampleBucketsService",["mnPoolDefault","mnTasksDetails","mnBucketsService","mnServersService"]).factory("mnSettingsSampleBucketsService",mnSettingsSampleBucketsFactory);function mnSettingsSampleBucketsFactory($http,$q,mnPoolDefault,mnTasksDetails,mnBucketsService,mnServersService){var mnSettingsSampleBucketsService={getSampleBuckets:getSampleBuckets,installSampleBuckets:installSampleBuckets,getSampleBucketsState:getSampleBucketsState};return mnSettingsSampleBucketsService;function getSampleBucketsState(selectedBuckets){return $q.all([getSampleBuckets(),mnPoolDefault.getFresh(),mnTasksDetails.get(),mnBucketsService.getBucketsByType(),mnServersService.getNodes()]).then(function(resp){var warnings={quota:false,rebalance:false,maxBucketCount:false};var attentions={};var sampleBuckets=resp[0];var poolDefault=resp[1];var tasks=resp[2];var buckets=resp[3];var servers=resp[4];var numServers=servers.active.length;var quotaAvailable=poolDefault.storageTotals.ram.quotaTotal-poolDefault.storageTotals.ram.quotaUsed;var maxNumBuckets=poolDefault.maxBucketCount;var numExistingBuckets=buckets.length;var storageNeeded=_.reduce(selectedBuckets,function(acc,quotaNeeded){return acc+parseInt(quotaNeeded,10);},0)*numServers;if(!(storageNeeded<=quotaAvailable)){warnings.quota=Math.ceil(storageNeeded-quotaAvailable)/1024/1024/numServers;}
warnings.maxBucketCount=(numExistingBuckets+_.keys(selectedBuckets).length>maxNumBuckets)&&maxNumBuckets;warnings.rebalance=tasks.inRebalance;attentions.noIndexOrQuery=!_.find(servers.active,function(server){return _.indexOf(server.services,"index")>-1;})||!_.find(servers.active,function(server){return _.indexOf(server.services,"n1ql")>-1;});return{installed:_.filter(sampleBuckets,'installed',true),available:_.filter(sampleBuckets,'installed',false),warnings:warnings,attentions:attentions};});}
function getSampleBuckets(){return $http({url:'/sampleBuckets',method:'GET'}).then(function(resp){return resp.data;});}
function installSampleBuckets(selectedSamples){return $http({url:'/sampleBuckets/install',method:'POST',timeout:140000,data:JSON.stringify(_.keys(_.pick(selectedSamples,_.identity)))});}}})();(function(){"use strict";angular.module('mnXDCRService',['mnTasksDetails','mnPoolDefault','mnFilters']).factory('mnXDCRService',mnXDCRServiceFactory);function mnXDCRServiceFactory($q,$http,mnTasksDetails,mnPoolDefault,mnPools,getStringBytesFilter){var mnXDCRService={removeExcessSettings:removeExcessSettings,saveClusterReference:saveClusterReference,deleteClusterReference:deleteClusterReference,deleteReplication:deleteReplication,getReplicationSettings:getReplicationSettings,saveReplicationSettings:saveReplicationSettings,postRelication:postRelication,getReplicationState:getReplicationState,validateRegex:validateRegex,postSettingsReplications:postSettingsReplications,getSettingsReplications:getSettingsReplications};return mnXDCRService;function doValidateOnOverLimit(text){return getStringBytesFilter(text)>250;}
function validateRegex(regex,testDocID,bucket){if(doValidateOnOverLimit(regex)){return $q.reject('Regex should not have size more than 250 bytes');}
if(doValidateOnOverLimit(testDocID)){return $q.reject('Test key should not have size more than 250 bytes');}
return $http({method:'POST',mnHttp:{cancelPrevious:true},data:{expression:regex,docId:testDocID,bucket:bucket},transformResponse:function(data){var resp;try{resp=JSON.parse(data);}catch(e){resp=data;}
return resp;},url:'/_goxdcr/regexpValidation'});}
function removeExcessSettings(settings){var neededProperties=["replicationType","optimisticReplicationThreshold","failureRestartInterval","docBatchSizeKb","workerBatchSize","checkpointInterval","type","toBucket","toCluster","fromBucket","sourceNozzlePerNode","targetNozzlePerNode","statsInterval","logLevel","priority","filterExpiration","filterDeletion","filterBypassExpiry"];if(mnPools.export.isEnterprise&&settings.type!=="capi"&&mnPoolDefault.export.compat.atLeast55){neededProperties.push("compressionType");}
if(mnPools.export.isEnterprise&&settings.type==="xmem"){neededProperties.push("networkUsageLimit");}
var rv={};neededProperties.forEach(function(key){rv[key]=settings[key];});return rv;}
function saveClusterReference(cluster,name){cluster=_.clone(cluster);var re;var result;if(cluster.hostname){re=/^\[?([^\]]+)\]?:(\d+)$/;result=re.exec(cluster.hostname);if(!result){cluster.hostname+=":8091";}}
if(!cluster.demandEncryption){delete cluster.certificate;delete cluster.demandEncryption;delete cluster.encryptionType;delete cluster.clientCertificate;delete cluster.clientKey;}
delete cluster.secureType;return $http.post('/pools/default/remoteClusters'+(name?("/"+encodeURIComponent(name)):""),cluster);}
function deleteClusterReference(name){return $http.delete('/pools/default/remoteClusters/'+encodeURIComponent(name));}
function deleteReplication(id){return $http.delete('/controller/cancelXDCR/'+encodeURIComponent(id));}
function postSettingsReplications(settings,justValidate){return $http({method:'POST',url:'/settings/replications',data:settings,params:{just_validate:justValidate?1:0}});}
function getSettingsReplications(settings,justValidate){return $http.get('/settings/replications');}
function getReplicationSettings(id){return $http.get("/settings/replications"+(id?("/"+encodeURIComponent(id)):""));}
function saveReplicationSettings(id,settings){return $http.post("/settings/replications/"+encodeURIComponent(id),settings);}
function postRelication(settings){return $http.post("/controller/createReplication",settings);}
function getReplicationState(){return $http.get('/pools/default/remoteClusters').then(function(resp){var byUUID={};_.forEach(resp.data,function(reference){byUUID[reference.uuid]=reference;});return{filtered:_.filter(resp.data,function(cluster){return!cluster.deleted}),all:resp.data,byUUID:byUUID};});}}})();(function(){"use strict";angular.module('mnXDCR',['mnXDCRService','mnHelper','mnPromiseHelper','mnPoll','mnAutocompleteOff','mnPoolDefault','mnPools','mnSortableTable','mnSpinner',"ui.codemirror",'mnAlertsService']).controller('mnXDCRController',mnXDCRController);function mnXDCRController($scope,permissions,$uibModal,mnHelper,mnPoller,mnPoolDefault,mnXDCRService,mnTasksDetails,mnPromiseHelper){var vm=this;vm.mnPoolDefault=mnPoolDefault.latestValue();vm.createClusterReference=createClusterReference;vm.deleteClusterReference=deleteClusterReference;vm.editClusterReference=editClusterReference;vm.showReplicationErrors=showReplicationErrors;vm.createReplications=createReplications;mnHelper.initializeDetailsHashObserver(vm,'xdcrDetails','app.admin.replications');activate();vm.toBucket=toBucket;vm.toCluster=toCluster;vm.humanStatus=humanStatus;function toBucket(row){return row.target.split('buckets/')[1];}
function toCluster(row){var uuid=row.id.split("/")[0];var clusters=vm.references?vm.references.byUUID:{};var toName=!clusters[uuid]?"unknown":!clusters[uuid].deleted?clusters[uuid].name:('at '+cluster[uuid].hostname);return toName;}
function humanStatus(row){if(row.pauseRequested&&row.status!='paused'){return'pausing';}else{switch(row.status){case'running':return'replicating';case'paused':return'paused';default:return'starting up';}}}
function activate(){if($scope.rbac.cluster.xdcr.remote_clusters.read){new mnPoller($scope,function(){vm.showReferencesSpinner=false;return mnXDCRService.getReplicationState();}).setInterval(10000).subscribe("references",vm).reloadOnScopeEvent("reloadXdcrPoller",vm,"showReferencesSpinner").cycle();}}
function createClusterReference(){$uibModal.open({controller:'mnXDCRReferenceDialogController as xdcrReferenceDialogCtl',templateUrl:'app/mn_admin/mn_xdcr/reference_dialog/mn_xdcr_reference_dialog.html',scope:$scope,resolve:{reference:mnHelper.wrapInFunction()}});}
function deleteClusterReference(row){$uibModal.open({controller:'mnXDCRDeleteReferenceDialogController as xdcrDeleteReferenceDialogCtl',templateUrl:'app/mn_admin/mn_xdcr/delete_reference_dialog/mn_xdcr_delete_reference_dialog.html',scope:$scope,resolve:{name:mnHelper.wrapInFunction(row.name)}});}
function editClusterReference(reference){$uibModal.open({controller:'mnXDCRReferenceDialogController as xdcrReferenceDialogCtl',templateUrl:'app/mn_admin/mn_xdcr/reference_dialog/mn_xdcr_reference_dialog.html',scope:$scope,resolve:{reference:mnHelper.wrapInFunction(reference)}});}
function createReplications(){$uibModal.open({controller:'mnXDCRCreateDialogController as xdcrCreateDialogCtl',templateUrl:'app/mn_admin/mn_xdcr/create_dialog/mn_xdcr_create_dialog.html',scope:$scope,resolve:{replicationSettings:mnHelper.wrapInFunction(mnXDCRService.getReplicationSettings())}});}
function showReplicationErrors(row){vm.xdcrErrors=row.errors;$uibModal.open({templateUrl:'app/mn_admin/mn_xdcr/errors_dialog/mn_xdcr_errors_dialog.html',scope:$scope}).result['finally'](function(){delete vm.xdcrErrors;});}}})();(function(){"use strict";angular.module('mnXDCR').directive('mnXdcrItemDetails',mnXDCRItemDetails);function mnXDCRItemDetails(){var mnXDCRItemDetails={restrict:'E',scope:{row:"=",rbac:"="},controller:mnXDCRItemDetailsController,controllerAs:"xdcrItemDetailsCtl",templateUrl:'app/mn_admin/mn_xdcr/mn_xdcr_item_details.html'};return mnXDCRItemDetails;function mnXDCRItemDetailsController($scope,mnXDCRService,mnHelper,mnPromiseHelper,$uibModal){var vm=this;vm.deleteReplication=deleteReplication;vm.editReplication=editReplication;vm.status=status;vm.pausePlayReplication=pausePlayReplication;function pausePlayReplication(row){mnPromiseHelper(vm,mnXDCRService.saveReplicationSettings(row.id,{pauseRequested:row.status!=='paused'})).broadcast(["reloadTasksPoller"],{doNotShowSpinner:true});}
function editReplication(row){$uibModal.open({controller:'mnXDCREditDialogController as xdcrEditDialogCtl',templateUrl:'app/mn_admin/mn_xdcr/edit_dialog/mn_xdcr_edit_dialog.html',scope:$scope,resolve:{source:mnHelper.wrapInFunction(row.source),id:mnHelper.wrapInFunction(row.id),currentSettings:mnHelper.wrapInFunction(mnXDCRService.getReplicationSettings(row.id)),globalSettings:mnHelper.wrapInFunction(mnXDCRService.getReplicationSettings())}});}
function deleteReplication(row){$uibModal.open({controller:'mnXDCRDeleteDialogController as xdcrDeleteDialogCtl',templateUrl:'app/mn_admin/mn_xdcr/delete_dialog/mn_xdcr_delete_dialog.html',scope:$scope,resolve:{id:mnHelper.wrapInFunction(row.id)}});}
function status(row){if(row.pauseRequested&&row.status!='paused'){return'spinner';}else{switch(row.status){case'running':return'pause';case'paused':return'play';default:return'spinner';}}}}}})();(function(){"use strict";angular.module('mnXDCR').directive('mnXdcrSettings',mnXdcrSettingsDirective);function mnXdcrSettingsDirective($http,mnPromiseHelper,mnXDCRService){var mnXdcrSettings={restrict:'A',scope:{settings:'=mnXdcrSettings',mnPoolDefault:"=",mnPools:"=",mnIsEditing:"=?"},isolate:false,replace:true,templateUrl:'app/mn_admin/mn_xdcr/settings/mn_xdcr_settings.html',controller:controller,controllerAs:"xdcrSettingsCtl",bindToController:true};return mnXdcrSettings;function controller($scope){var vm=this;$scope.$watch('xdcrSettingsCtl.settings',function(settings){mnPromiseHelper(vm,mnXDCRService.postSettingsReplications(settings,true)).catchErrors();},true);}}})();(function(){"use strict";angular.module('mnXDCR').directive('mnXdcrFilter',mnXdcrFilterDirective);function mnXdcrFilterDirective($http,mnPromiseHelper,mnXDCRService){var mnXdcrFilter={restrict:'AE',scope:{mnReplication:'=',mnIsEditing:"=?",mnErrors:"=?"},templateUrl:'app/mn_admin/mn_xdcr/mn_xdcr_filter.html',controller:controller,controllerAs:"xdcrFilterCtl",};return mnXdcrFilter;function controller($scope){var vm=this;vm.onExpressionUpdate=onExpressionUpdate;vm.showAdvancedFiltering=$scope.mnIsEditing;function onExpressionUpdate(){handleValidateRegex($scope.mnReplication.filterExpression,vm.testDocID,$scope.mnReplication.fromBucket);}
function handleValidateRegex(regex,testDocID,bucket){if(!testDocID){return;}
return mnPromiseHelper(vm,mnXDCRService.validateRegex(regex,testDocID,bucket)).showSpinner("filterExpressionSpinner").catchErrors("filterExpressionError").applyToScope("filterExpressionResult");}}}})();(function(){"use strict";angular.module('mnXDCR').controller('mnXDCRReferenceDialogController',mnXDCRReferenceDialogController);function mnXDCRReferenceDialogController($scope,$uibModalInstance,mnPromiseHelper,mnXDCRService,reference,mnPoolDefault){var vm=this;vm.isNew=!reference;vm.mnPoolDefault=mnPoolDefault.latestValue();vm.cluster=!vm.isNew?_.clone(reference):{username:'Administrator'};vm.createClusterReference=createClusterReference;if(!vm.cluster.encryptionType&&vm.mnPoolDefault.value.isEnterprise){vm.cluster.encryptionType="half";}
function createClusterReference(){var promise=mnXDCRService.saveClusterReference(vm.cluster,reference&&reference.name);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().broadcast("reloadXdcrPoller").showGlobalSuccess("Cluster reference saved successfully!");};}})();(function(){"use strict";angular.module('mnXDCR').controller('mnXDCRCreateDialogController',mnXDCRCreateDialogController);function mnXDCRCreateDialogController($scope,$uibModalInstance,$timeout,$window,mnPromiseHelper,mnPoolDefault,mnPools,mnXDCRService,replicationSettings,mnAlertsService){var vm=this;var codemirrorInstance;var codemirrorMarkers=[];vm.replication=replicationSettings.data;delete vm.replication.socketOptions;vm.replication.replicationType="continuous";vm.replication.type="xmem";vm.createReplication=createReplication;function createReplication(){var replication=mnXDCRService.removeExcessSettings(vm.replication);if($scope.poolDefault.isEnterprise){replication.filterExpression=vm.replication.filterExpression;}
var promise=mnXDCRService.postRelication(replication);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors(function(error){vm.errors=angular.isString(error)?{_:error}:error;}).closeOnSuccess().broadcast("reloadTasksPoller").onSuccess(function(resp){var hasWarnings=!!(resp.data.warnings&&resp.data.warnings.length);mnAlertsService.formatAndSetAlerts(hasWarnings?resp.data.warnings:"Replication created successfully!",hasWarnings?'warning':"success",hasWarnings?0:2500);});};}})();(function(){"use strict";angular.module('mnXDCR').controller('mnXDCRDeleteReferenceDialogController',mnXDCRDeleteReferenceDialogController);function mnXDCRDeleteReferenceDialogController($scope,$uibModalInstance,mnPromiseHelper,mnXDCRService,name){var vm=this;vm.name=name;vm.deleteClusterReference=deleteClusterReference;function deleteClusterReference(){var promise=mnXDCRService.deleteClusterReference(name);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().catchGlobalErrors().broadcast("reloadXdcrPoller").showGlobalSuccess("Cluster reference deleted successfully!");}}})();(function(){"use strict";angular.module('mnXDCR').controller('mnXDCRDeleteDialogController',mnXDCRDeleteDialogController);function mnXDCRDeleteDialogController($scope,$uibModalInstance,mnPromiseHelper,mnXDCRService,id){var vm=this;vm.deleteReplication=deleteReplication;function deleteReplication(){var promise=mnXDCRService.deleteReplication(id);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadTasksPoller").showGlobalSuccess("Replication deleted successfully!");}}})();(function(){"use strict";angular.module('mnXDCR').controller('mnXDCREditDialogController',mnXDCREditDialogController);function mnXDCREditDialogController($scope,$uibModalInstance,mnPromiseHelper,mnXDCRService,currentSettings,globalSettings,id,source,mnPools,mnPoolDefault){var vm=this;vm.pools=mnPools.export;vm.poolDefault=mnPoolDefault.export;vm.settings=_.extend({fromBucket:source},globalSettings.data,currentSettings.data);vm.settings.filterSkipRestream="false";vm.createReplication=createReplication;function createReplication(){var settings=mnXDCRService.removeExcessSettings(vm.settings);if(vm.pools.isEnterprise){settings.filterExpression=vm.settings.filterExpression;settings.filterSkipRestream=(vm.settings.filterSkipRestream==="true");}
var promise=mnXDCRService.saveReplicationSettings(id,settings);mnPromiseHelper(vm,promise,$uibModalInstance).showGlobalSpinner().catchErrors().closeOnSuccess().broadcast("reloadTasksPoller").showGlobalSuccess("Settings saved successfully!");};}})();(function(){"use strict";angular.module('mnSecurity',['mnUserRoles','mnPluggableUiRegistry','mnRootCertificate','mnElementCrane','mnClientCertificate','mnRedaction','mnRolesGroups']).config(mnIndexesConfig);function mnIndexesConfig($stateProvider){$stateProvider.state('app.admin.security',{abstract:true,url:"/security",views:{"main@app.admin":{controller:"mnSecurityController as securityCtl",templateUrl:"app/mn_admin/mn_security/mn_security.html"}},data:{permissions:"cluster.admin.security.read",title:"Security"}}).state('app.admin.security.roles',{abstract:true,templateUrl:"app/mn_admin/mn_security/mn_roles.html",controller:"mnRolesController as rolesCtl"}).state('app.admin.security.roles.user',{url:"/userRoles?openedUsers&startFrom&startFromDomain&sortBy&order&substr&{pageSize:int}",params:{openedUsers:{array:true,dynamic:true},substr:{dynamic:true,value:""},pageSize:{value:20},startFrom:{value:null},startFromDomain:{value:null},sortBy:{value:"id",dynamic:true},order:{value:"asc",dynamic:true}},controller:"mnUserRolesController as userRolesCtl",templateUrl:"app/mn_admin/mn_security/mn_user_roles/mn_user_roles.html"}).state('app.admin.security.roles.groups',{url:"/rolesGroups?startFrom&sortBy&order&substr&{pageSize:int}",params:{openedRolesGroups:{array:true,dynamic:true},substr:{dynamic:true,value:""},pageSize:{value:20},startFrom:{value:null},sortBy:{value:"id",dynamic:true},order:{value:"asc",dynamic:true}},controller:"mnRolesGroupsController as rolesGroupsCtl",templateUrl:"app/mn_admin/mn_security/mn_roles_groups.html",data:{enterprise:true}}).state('app.admin.security.session',{url:'/session',controller:'mnSessionController as sessionCtl',templateUrl:'app/mn_admin/mn_security/mn_session/mn_session.html',data:{permissions:"cluster.admin.security.read"}}).state('app.admin.security.rootCertificate',{url:'/rootCertificate',controller:'mnRootCertificateController as rootCertificateCtl',templateUrl:'app/mn_admin/mn_security/mn_root_certificate/mn_root_certificate.html',data:{enterprise:true}}).state('app.admin.security.clientCert',{url:'/clientCert',controller:'mnClientCertController as clientCertCtl',templateUrl:'app/mn_admin/mn_security/mn_client_certificate/mn_client_certificate.html',data:{enterprise:true}}).state('app.admin.security.audit',{url:'/audit',controller:'mnAuditController as auditCtl',templateUrl:'app/mn_admin/mn_security/mn_audit/mn_audit.html',data:{enterprise:true}}).state('app.admin.security.redaction',{url:'/redaction',controller:'mnRedactionController as redactionCtl',templateUrl:'app/mn_admin/mn_security/mn_redaction/mn_redaction.html',data:{compat:"atLeast55",enterprise:true}});}})();(function(){"use strict";angular.module("mnSecurity").controller("mnSecurityController",mnSecurityController);function mnSecurityController($scope,mnPluggableUiRegistry,poolDefault){var vm=this;vm.poolDefault=poolDefault;}})();(function(){"use strict";angular.module("mnRolesGroups",["mnUserRolesService","mnUserRolesList","mnHelper","mnPromiseHelper","mnPoll","mnSpinner","ui.select","mnEqual","mnFilters","mnAutocompleteOff","mnFocus"]).controller("mnRolesGroupsController",mnRolesGroupsController);function mnRolesGroupsController($scope,$uibModal,mnPromiseHelper,mnUserRolesService,mnPoller,mnHelper,$state,poolDefault,$timeout){var vm=this;vm.addRolesGroup=addRolesGroup;vm.deleteRolesGroup=deleteRolesGroup;vm.editRolesGroup=editRolesGroup;vm.filterField=$state.params.substr;vm.stateParams=$state.params;vm.pageSize=$state.params.pageSize;vm.pageSizeChanged=pageSizeChanged;vm.sortByChanged=sortByChanged;vm.isOrderBy=isOrderBy;vm.isDesc=isDesc;activate();function isOrderBy(sortBy){return sortBy===$state.params.sortBy;}
function isDesc(){return $state.params.order==="desc";}
function pageSizeChanged(){$state.go('.',{pageSize:vm.pageSize});}
function sortByChanged(sortBy){$state.go('.',{order:$state.params.sortBy!=sortBy?"asc":$state.params.order==="asc"?"desc":"asc",sortBy:sortBy})}
function activate(){$scope.$watch('rolesGroupsCtl.filterField',_.debounce(function(){$state.go('.',{substr:vm.filterField||undefined})},500,{leading:true}),true);$scope.$watchGroup(["rolesGroupsCtl.stateParams.order","rolesGroupsCtl.stateParams.sortBy","rolesGroupsCtl.stateParams.substr"],_.debounce(function(){$scope.$broadcast("reloadRolesGroupsPoller");},500,{leading:true}));mnHelper.initializeDetailsHashObserver(vm,'openedRolesGroups','.');mnPromiseHelper(vm,mnUserRolesService.getRoles()).applyToScope(function(roles){mnPromiseHelper(vm,mnUserRolesService.getRolesByRole(roles)).applyToScope("rolesByRole");});var poller=new mnPoller($scope,function(){return mnUserRolesService.getRolesGroupsState($state.params);}).subscribe("state",vm).setInterval(10000).reloadOnScopeEvent("reloadRolesGroupsPoller").cycle();}
function editRolesGroup(rolesGroup){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_roles_groups_add_dialog.html',controller:'mnRolesGroupsAddDialogController as rolesGroupsAddDialogCtl',resolve:{rolesGroup:mnHelper.wrapInFunction(rolesGroup)}});}
function addRolesGroup(){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_roles_groups_add_dialog.html',controller:'mnRolesGroupsAddDialogController as rolesGroupsAddDialogCtl',resolve:{rolesGroup:mnHelper.wrapInFunction(undefined)}});}
function deleteRolesGroup(rolesGroup){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_roles_groups_delete_dialog.html',controller:'mnRolesGroupsDeleteDialogController as rolesGroupsDeleteDialogCtl',resolve:{rolesGroup:mnHelper.wrapInFunction(rolesGroup)}});}}})();(function(){"use strict";angular.module("mnRolesGroups").controller("mnRolesGroupsAddDialogController",mnRolesGroupsAddDialogController);function mnRolesGroupsAddDialogController($scope,mnUserRolesService,$uibModalInstance,mnPromiseHelper,rolesGroup,$timeout){var vm=this;vm.rolesGroup=_.clone(rolesGroup)||{};vm.rolesGroupID=vm.rolesGroup.id||'New';vm.save=save;vm.isEditingMode=!!rolesGroup;vm.selectedRoles={};vm.focusError=false;function save(){if(vm.form.$invalid){vm.focusError=true;return;}
var roles=[];_.forEach(vm.selectedRoles,function(value,key){if(value){var path=key.split("|");roles.push(path[path.length-1]);}});mnPromiseHelper(vm,mnUserRolesService.addGroup(vm.rolesGroup,roles,vm.isEditingMode),$uibModalInstance).showGlobalSpinner().catchErrors().broadcast("reloadRolesGroupsPoller").closeOnSuccess().showGlobalSuccess("Group saved successfully!");}}})();(function(){"use strict";angular.module("mnRolesGroups").controller("mnRolesGroupsDeleteDialogController",mnRolesGroupsDeleteDialogController);function mnRolesGroupsDeleteDialogController($scope,mnUserRolesService,rolesGroup,mnPromiseHelper,$uibModalInstance){var vm=this;vm.grolesGroupsId=rolesGroup.id;vm.onSubmit=onSubmit;function onSubmit(){mnPromiseHelper(vm,mnUserRolesService.deleteRolesGroup(rolesGroup),$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadRolesGroupsPoller").showGlobalSuccess("Group deleted successfully!");}}})();(function(){"use strict";angular.module('mnUserRolesList',["mnFilters","mnUserRolesService","mnPromiseHelper"]).directive('mnUserRolesList',mnUserRolesListDirective);function mnUserRolesListDirective(){var mnUserRolesList={restrict:'E',scope:{rolesToEnable:"=?",selectedRoles:"=",selectedWrappers:"=?",selectedGroupsRoles:"=?"},templateUrl:'app/components/directives/mn_user_roles_list.html',controller:mnUserRolesListController,controllerAs:"mnThisCtl",bindToController:true};return mnUserRolesList;function mnUserRolesListController(mnUserRolesService,mnPromiseHelper){var vm=this;vm.openedWrappers={};vm.getUIID=mnUserRolesService.getRoleUIID;vm.toggleWrappers=toggleWrappers;vm.isRoleDisabled=isRoleDisabled;vm.onCheckChange=onCheckChange;vm.getGroupsList=getGroupsList;vm.hasGroups=hasGroups;activate();function hasGroups(id){if(vm.selectedGroupsRoles&&vm.selectedGroupsRoles[id]){return!!Object.keys(vm.selectedGroupsRoles[id]).length;}else{return false;}}
function getGroupsList(id){return Object.keys(vm.selectedGroupsRoles[id]).join(", ");}
function activate(){vm.openedWrappers[vm.getUIID({role:"admin"},true)]=true;mnPromiseHelper(vm,mnUserRolesService.getRoles()).showSpinner().onSuccess(function(roles){vm.allRoles=roles;vm.rolesTree=mnUserRolesService.getRolesTree(roles);if(vm.rolesToEnable){vm.rolesToEnable.forEach(function(role){var id=vm.getUIID(role);vm.selectedRoles[id]=true;onCheckChange(role,id);});}});}
function onCheckChange(role,id){var selectedRoles;if(vm.selectedRoles[id]){if(role.role==="admin"){selectedRoles={};selectedRoles[id]=true;vm.selectedRoles=selectedRoles;}else if(role.bucket_name==="*"){vm.allRoles.forEach(function(item){if(item.bucket_name!==undefined&&item.bucket_name!=="*"&&item.role===role.role){vm.selectedRoles[vm.getUIID(item)]=false;}});}}
reviewSelectedWrappers();}
function reviewSelectedWrappers(){vm.selectedWrappers=mnUserRolesService.reviewSelectedWrappers(vm.selectedRoles,vm.selectedGroupsRoles);}
function isRoleDisabled(role){return(role.role!=='admin'&&vm.selectedRoles[vm.getUIID({role:'admin'})])||(role.bucket_name!=='*'&&vm.selectedRoles[vm.getUIID({role:role.role,bucket_name:'*'})]);}
function toggleWrappers(id,value){vm.openedWrappers[id]=!vm.openedWrappers[id];}}}})();(function(){"use strict";angular.module("mnUserRolesService",['mnHelper','mnPoolDefault','mnStoreService','mnStatisticsNewService']).factory("mnUserRolesService",mnUserRolesFactory);function mnUserRolesFactory($q,$http,mnHelper,mnPoolDefault,mnStatisticsNewService,mnStoreService){var mnUserRolesService={getState:getState,addUser:addUser,deleteUser:deleteUser,getRoles:getRoles,getRolesByRole:getRolesByRole,getRolesTree:getRolesTree,getUsers:getUsers,getUser:getUser,lookupLDAPUser:lookupLDAPUser,getRoleUIID:getRoleUIID,addGroup:addGroup,deleteRolesGroup:deleteRolesGroup,getRolesGroups:getRolesGroups,getRolesGroup:getRolesGroup,putRolesGroup:putRolesGroup,getRolesGroupsState:getRolesGroupsState,ldapConnectivityValidate:ldapConnectivityValidate,ldapAuthenticationValidate:ldapAuthenticationValidate,ldapGroupsQueryValidate:ldapGroupsQueryValidate,postLdapSettings:postLdapSettings,getLdapSettings:getLdapSettings,clearLdapCache:clearLdapCache,getUserProfile:getUserProfile,putUserProfile:putUserProfile,saveDashboard:saveDashboard,reviewSelectedWrappers:reviewSelectedWrappers,getSaslauthdAuth:getSaslauthdAuth};var queryDnError="LDAP DN should be supplied";var usersAttrsError="The field can't be empty";return mnUserRolesService;function getSaslauthdAuth(){return $http({method:"GET",url:"/settings/saslauthdAuth"}).then(function(resp){return resp.data;},function(resp){return;});}
function clearLdapCache(){return $http({method:"POST",url:"/settings/invalidateLDAPCache"});}
function reviewSelectedWrappers(selectedRoles,selectedGroupsRoles){var rv={};Object.keys(selectedRoles).forEach(function(key){if(selectedRoles[key]){selectWrappers(key,true,rv);}});Object.keys(selectedGroupsRoles||{}).forEach(function(key){if(Object.keys(selectedGroupsRoles[key]).length){selectWrappers(key,true,rv);}});return rv;}
function selectWrappers(id,value,applyTo){var wrappers=id.split("|");var flag=wrappers.pop();var id;while(wrappers.length){id=wrappers.join("|");applyTo[id]=value;wrappers.pop();}}
function getLdapSettings(){return $http({method:"GET",url:"/settings/ldap"});}
function isAnonOrQueryDn(data,isAnon){return(isAnon||data.bindDN);}
function validateLDAPQuery(data){return!!(data.userDNMapping&&data.userDNMapping.includes("query"));}
function validateGroupQuery(data){return!!(data.groupsQuery);}
function validateGroupUserAttrs(formData){return formData.queryForGroups==="users_attrs"&&!formData.group.groupsQuery.attributes;}
function ldapConnectivityValidate(data,formData){if(!isAnonOrQueryDn(data,formData.isAnon)){return $q.reject({bindDN:queryDnError});}
return $http.post("/settings/ldap/validate/connectivity",data);}
function ldapAuthenticationValidate(data,formData){if(!isAnonOrQueryDn(data,formData.isAnon)&&validateLDAPQuery(data)){return $q.reject({bindDN:queryDnError});}
return $http.post("/settings/ldap/validate/authentication",data);}
function ldapGroupsQueryValidate(data,formData){var errors={};if(!isAnonOrQueryDn(data,formData.isAnon)&&validateGroupQuery(data)){errors.bindDN=queryDnError;}
if(validateGroupUserAttrs(formData)){errors.groupsQuery=usersAttrsError;}
if(!data.groupsQueryUser){errors.groupsQueryUser="The filed is mandatory";}
if(Object.keys(errors).length){return $q.reject(errors);}else{return $http.post("/settings/ldap/validate/groupsQuery",data);}}
function postLdapSettings(data,formData){var errors={};var isGroups=data.authorizationEnabled;var isUser=data.authenticationEnabled;if(!isAnonOrQueryDn(data,formData.isAnon)&&((!isUser&&!isGroups)||(validateLDAPQuery(data)&&isUser)||(validateGroupQuery(data)&&isGroups))){errors.bindDN=queryDnError;}
if(isGroups&&validateGroupUserAttrs(formData)){errors.groupsQuery=usersAttrsError;}
if(Object.keys(errors).length){return $q.reject(errors);}else{return $http({method:"POST",url:"/settings/ldap",data:data});}}
function saveDashboard(){return getProfile().then(function(resp){var profile=resp.data;profile.scenarios=mnStoreService.store("scenarios").share();profile.groups=mnStoreService.store("groups").share();profile.charts=mnStoreService.store("charts").share();return putUserProfile(profile);});}
function putUserProfile(data){return $http.put("/settings/rbac/profiles/@self",JSON.stringify(data));}
function getProfile(){return $http.get("/settings/rbac/profiles/@self").then(null,function(resp){switch(resp.status){case"404":default:resp.data={};return resp;}});}
function getUserProfile(){return $q.all([getProfile(),mnPoolDefault.get()]).then(function(resp){var profile=resp[0].data;var poolDefault=resp[1];if(profile.version){mnStoreService.createStore("scenarios",{keyPath:"id",fill:profile.scenarios});mnStoreService.createStore("groups",{keyPath:"id",fill:profile.groups});mnStoreService.createStore("charts",{keyPath:"id",fill:profile.charts});return profile;}else{mnStoreService.createStore("scenarios",{keyPath:"id"});mnStoreService.createStore("groups",{keyPath:"id"});mnStoreService.createStore("charts",{keyPath:"id"});mnStatisticsNewService.doAddPresetScenario();return putUserProfile({version:poolDefault.versions["65"],scenarios:mnStoreService.store("scenarios").share(),groups:mnStoreService.store("groups").share(),charts:mnStoreService.store("charts").share()}).then(getUserProfile);}});}
function getRoles(){return $http({method:"GET",url:"/settings/rbac/roles"}).then(function(resp){return resp.data;});}
function getWrapperName(name){switch(name){case"data":return"Data Service";case"views":return"Views";case"query":return"Query and Index Services";case"fts":return"Search Service";case"analytics":return"Analytics Service";case"replication":case"bucket":return undefined;default:return name;}}
function sortAdminAndGlobalRoles(roles){var rv=new Array(8);roles.forEach(function(role){switch(role.role){case"admin":rv[0]=role;break;case"cluster_admin":rv[1]=role;break;case"security_admin":rv[2]=role;break;case"ro_admin":rv[3]=role;break;case"replication_admin":rv[4]=role;break;case"query_external_access":rv[5]=role;break;case"query_system_catalog":rv[6]=role;break;case"analytics_reader":rv[7]=role;break;default:rv.push(role);break;}});rv=_.compact(rv);return rv;}
function sortBucketRoles(roles){var rv=[];var restRoles=new Array(5);_.forEach(_.groupBy(roles,function(role){return role.role.split("_")[0];}),function(value,key){switch(key){case"data":restRoles[0]=[getWrapperName(key),value];break;case"views":restRoles[1]=[getWrapperName(key),value];break;case"query":restRoles[2]=[getWrapperName(key),value];break;case"fts":restRoles[3]=[getWrapperName(key),value];break;case"analytics":restRoles[4]=[getWrapperName(key),value];break;case"bucket":case"replication":rv=rv.concat(value);break;default:restRoles[5].push([getWrapperName(key),value]);break;}});restRoles=_.compact(restRoles);return rv.concat(restRoles);}
function prepareRootRoles(roles){var rv=new Array(2);_.forEach(_.groupBy(roles,'bucket_name'),function(value,key){switch(key){case"undefined":rv[0]=["Administration & Global Roles",sortAdminAndGlobalRoles(value)];break;case"*":rv[1]=["All Buckets (*)",sortBucketRoles(value)];break;default:rv.push([key,sortBucketRoles(value)]);break;}});rv=_.compact(rv);return rv;}
function getRolesTree(roles){return prepareRootRoles(roles);}
function getRoleUIID(role,isWrapper){var rv="";var bucketWrapperName=getWrapperName(role.bucket_name||"undefined");var serviceWrapperName;if(role.bucket_name){serviceWrapperName=getWrapperName(role.role.split("_")[0]);}
rv+=bucketWrapperName;if(serviceWrapperName){rv+=("|"+serviceWrapperName);}
if(!isWrapper){rv+=("|"+(role.bucket_name?(role.role+'['+role.bucket_name+']'):role.role));}
return rv;}
function getUser(user,params){return $http({method:"GET",url:getUserUrl(user),params:params});}
function lookupLDAPUser(user){return $http({method:"GET",url:getLookupLDAPUserUrl(user)})}
function getUsers(params){var config={method:"GET",url:"/settings/rbac/users"};config.params={};if(params&&params.permission){config.params.permission=params.permission;}
if(params&&params.pageSize){if(params.substr){config.params.substr=params.substr;}
config.params.pageSize=params.pageSize;config.params.startFromDomain=params.startFromDomain;config.params.startFrom=params.startFrom;config.params.order=params.order;config.params.sortBy=params.sortBy;}
return $http(config);}
function deleteUser(user){return $http({method:"DELETE",url:getUserUrl(user)});}
function deleteRolesGroup(group){return $http({method:"DELETE",url:"/settings/rbac/groups/"+encodeURIComponent(group.id),});}
function getUserUrl(user){var base="/settings/rbac/users/";return base+encodeURIComponent(user.domain)+"/"+encodeURIComponent(user.id);}
function getLookupLDAPUserUrl(user){return"/settings/rbac/lookupLDAPUser/"+encodeURIComponent(user.id);}
function getRolesByRole(userRoles){return(userRoles?$q.when(userRoles):getRoles()).then(function(roles){var rolesByRole={};angular.forEach(roles,function(role){rolesByRole[role.role+(role.bucket_name?'['+role.bucket_name+']':'')]=role;});return rolesByRole;});}
function packData(user,roles,groups,isEditingMode,resetPassword){var data={roles:roles.indexOf("admin")>-1?"admin":roles.join(','),name:user.name};if(mnPoolDefault.export.isEnterprise){data.groups=groups.join(',');}
if((!isEditingMode&&user.domain=="local")||resetPassword){data.password=user.password;}
return data;}
function doAddUser(data,user){return $http({method:"PUT",data:data,url:getUserUrl(user)});}
function addGroup(group,roles,isEditingMode){if(!group||!group.id){return $q.reject({name:"name is required"});}
if(isEditingMode){return putRolesGroup(group,roles);}else{return getRolesGroup(group).then(function(){return $q.reject({name:"group already exists"});},function(){return putRolesGroup(group,roles);});}}
function getRolesGroups(params){var config={method:"GET",url:"/settings/rbac/groups",params:{}};if(params&&params.pageSize){if(params.substr){config.params.substr=params.substr;}
config.params.pageSize=params.pageSize;config.params.startFrom=params.startFrom;config.params.order=params.order;config.params.sortBy=params.sortBy;}
return $http(config);}
function getRolesGroup(group){return $http({method:"GET",url:"/settings/rbac/groups/"+encodeURIComponent(group.id)});}
function putRolesGroup(group,roles){var config={method:"PUT",url:"/settings/rbac/groups/"+encodeURIComponent(group.id),data:{roles:roles.indexOf("admin")>-1?"admin":roles.join(','),description:group.description,ldap_group_ref:group.ldap_group_ref}};return $http(config);}
function getRolesGroupsState(params){return getRolesGroups(params).then(function(resp){var i;for(i in resp.data.links){resp.data.links[i]=resp.data.links[i].split("?")[1].split("&").reduce(function(prev,curr,i,arr){var p=curr.split("=");prev[decodeURIComponent(p[0])]=decodeURIComponent(p[1]);return prev;},{});}
return resp.data;});}
function addUser(user,roles,groups,isEditingMode,resetPassword){if(!user||!user.id){return $q.reject({username:"username is required"});}
if(isEditingMode){return doAddUser(packData(user,roles,groups,isEditingMode,resetPassword),user);}else{return getUser(user).then(function(users){return $q.reject({username:"username already exists"});},function(){return doAddUser(packData(user,roles,groups,isEditingMode),user);});}}
function getState(params){return getUsers(params).then(function(resp){var i;for(i in resp.data.links){resp.data.links[i]=resp.data.links[i].split("?")[1].split("&").reduce(function(prev,curr,i,arr){var p=curr.split("=");prev[decodeURIComponent(p[0])]=decodeURIComponent(p[1]);return prev;},{});}
if(!resp.data.users){return{users:resp.data};}else{return resp.data;}});}}})();(function(){"use strict";angular.module("mnUserRoles",["mnUserRolesService","mnUserRolesList","mnHelper","mnPromiseHelper","mnPoll","mnSortableTable","mnSpinner","ui.select","mnEqual","mnFilters","mnAutocompleteOff","mnFocus"]).controller("mnUserRolesController",mnUserRolesController);function mnUserRolesController($scope,$uibModal,mnPromiseHelper,mnUserRolesService,mnPoller,mnHelper,$state,poolDefault){var vm=this;vm.deleteUser=deleteUser;vm.editUser=editUser;vm.resetUserPassword=resetUserPassword;vm.filterField="";vm.stateParams=$state.params;vm.pageSize=$state.params.pageSize;vm.pageSizeChanged=pageSizeChanged;vm.parseGroupNames=parseGroupNames;vm.sortByChanged=sortByChanged;vm.isOrderBy=isOrderBy;vm.isDesc=isDesc;activate();function isOrderBy(sortBy){return sortBy===$state.params.sortBy;}
function isDesc(){return $state.params.order==="desc";}
function pageSizeChanged(){$state.go('.',{pageSize:vm.pageSize});}
function parseGroupNames(group){return _.uniq(group.groups.concat(group.external_groups)).join(", ");}
function sortByChanged(sortBy){$state.go('.',{order:$state.params.sortBy!=sortBy?"asc":$state.params.order==="asc"?"desc":"asc",sortBy:sortBy});}
function activate(){$scope.$watchGroup(["userRolesCtl.stateParams.order","userRolesCtl.stateParams.sortBy","userRolesCtl.stateParams.substr"],_.debounce(function(){$scope.$broadcast("reloadRolesPoller");},500,{leading:true}));$scope.$watch('userRolesCtl.filterField',_.debounce(function(){$state.go('.',{substr:vm.filterField||undefined})},500,{leading:true}),true);mnHelper.initializeDetailsHashObserver(vm,'openedUsers','.');mnPromiseHelper(vm,mnUserRolesService.getRoles()).applyToScope(function(roles){mnPromiseHelper(vm,mnUserRolesService.getRolesByRole(roles)).applyToScope("rolesByRole");});if(poolDefault.saslauthdEnabled){mnPromiseHelper(vm,mnUserRolesService.getSaslauthdAuth()).applyToScope("saslauthdAuth");}
if(poolDefault.isEditingMode){new mnPoller($scope,function(){return mnUserRolesService.getLdapSettings();}).subscribe("ldapSettings",vm).setInterval(10000).reloadOnScopeEvent("reloadLdapSettings").cycle();}
new mnPoller($scope,function(){return mnUserRolesService.getState($state.params);}).subscribe("state",vm).setInterval(10000).reloadOnScopeEvent("reloadRolesPoller").cycle();}
function editUser(user){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_user_roles/add_dialog/mn_user_roles_add_dialog.html',controller:'mnUserRolesAddDialogController as userRolesAddDialogCtl',resolve:{user:mnHelper.wrapInFunction(user),isLdapEnabled:function(){return(vm.saslauthdAuth&&vm.saslauthdAuth.enabled)||(vm.ldapSettings&&vm.ldapSettings.data.authenticationEnabled);}}});}
function resetUserPassword(user){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_user_roles/reset_password_dialog/mn_user_roles_reset_password_dialog.html',controller:'mnUserRolesResetPasswordDialogController as userRolesResetPasswordDialogCtl',resolve:{user:mnHelper.wrapInFunction(user)}});}
function deleteUser(user){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_user_roles/delete_dialog/mn_user_roles_delete_dialog.html',controller:'mnUserRolesDeleteDialogController as userRolesDeleteDialogCtl',resolve:{user:mnHelper.wrapInFunction(user)}});}}})();(function(){"use strict";angular.module("mnUserRoles").controller("mnUserRolesAddDialogController",mnUserRolesAddDialogController);function mnUserRolesAddDialogController($scope,mnUserRolesService,$uibModalInstance,mnPromiseHelper,user,isLdapEnabled,mnPoolDefault,$timeout,mnHelper,$q){var vm=this;vm.user=_.clone(user)||{domain:"local"};vm.userID=vm.user.id||'New';vm.save=save;vm.isEditingMode=!!user;vm.isLdapEnabled=isLdapEnabled;vm.selectedRoles={};vm.selectedGroupsRoles={};vm.selectedGroups={};vm.focusError=false;vm.getGroupTitle=getGroupTitle;vm.onGroupChanged=onGroupChanged;vm.selectedPanel="roles";vm.lookupMembership=_.debounce(lookupMembership,500,{leading:true});vm.onDomainChanged=onDomainChanged;vm.isLookupEnabled=isLookupEnabled;activate();function onDomainChanged(){if(vm.user.domain==="external"){lookupMembership();}else{clearRoles();}}
function lookupMembership(){vm.reloadUserRoles=true;mnUserRolesService.lookupLDAPUser(vm.user).then(function(user){clearRoles();applyUser(user.data);vm.isUserAvailable=true;vm.reloadUserRoles=false;},function(){clearRoles();vm.isUserAvailable=false;vm.reloadUserRoles=false;});}
function isLookupEnabled(){return!vm.isEditingMode&&(vm.user.domain==='external');}
function clearRoles(){vm.selectedRoles={};vm.selectedGroupsRoles={};vm.selectedGroups={};vm.externalGroups={};delete vm.rolesToEnable;}
function selectRoles(group,flag){return function(role){var id=mnUserRolesService.getRoleUIID(role);vm.selectedGroupsRoles[id]=vm.selectedGroupsRoles[id]||{};if(flag){vm.selectedGroupsRoles[id][group]=flag;}else{delete vm.selectedGroupsRoles[id][group];}
reviewSelectedWrappers();}}
function reviewSelectedWrappers(){vm.selectedWrappers=mnUserRolesService.reviewSelectedWrappers(vm.selectedRoles,vm.selectedGroupsRoles);}
function onGroupChanged(group){if(vm.selectedGroups[group.id]){group.roles.forEach(selectRoles(group.id,true));}else{group.roles.forEach(selectRoles(group.id,false));}
if(vm.externalGroups[group.id]){group.roles.forEach(selectRoles(group.id,true));}
reviewSelectedWrappers();}
function getGroupTitle(roles){return roles&&roles.map(function(v){return vm.byRole[v.role+(v.bucket_name?'['+v.bucket_name+']':'')].name;}).join(',');}
function getUserRoles(user){return user.roles.filter(function(role){return role.origins.find(function(origin){return origin.type=="user";});});}
function groupsToObject(groups){return groups.reduce(function(acc,group){acc[group]=true;return acc;},{});}
function activate(){vm.reloadUserRoles=true;$q.all([mnUserRolesService.getRolesByRole(),mnPoolDefault.export.isEnterprise?mnUserRolesService.getRolesGroups():$q.when()]).then(function(resp){vm.byRole=resp[0];vm.groups=resp[1]&&resp[1].data;applyUser(vm.user);vm.reloadUserRoles=false;},function(){vm.reloadUserRoles=false;});}
function applyUser(user){vm.selectedGroups=groupsToObject(user.groups||[]);vm.externalGroups=groupsToObject(user.external_groups||[]);if(user.roles){vm.rolesToEnable=getUserRoles(user);user.roles.forEach(function(role){var id=mnUserRolesService.getRoleUIID(role);vm.selectedGroupsRoles[id]=vm.selectedGroupsRoles[id]||{};role.origins.forEach(function(group){if(group.type=="group"){vm.selectedGroupsRoles[id][group.name]=true;}});});}
reviewSelectedWrappers();}
function save(){if(vm.form.$invalid){vm.focusError=true;return;}
var roles=[];_.forEach(vm.selectedRoles,function(value,key){if(value){var path=key.split("|");roles.push(path[path.length-1]);}});mnPromiseHelper(vm,mnUserRolesService.addUser(vm.user,roles,mnHelper.checkboxesToList(vm.selectedGroups),vm.isEditingMode,),$uibModalInstance).showGlobalSpinner().catchErrors(function(errors){vm.focusError=!!errors;vm.errors=errors;}).broadcast("reloadRolesPoller").closeOnSuccess().showGlobalSuccess("User saved successfully!");}}})();(function(){"use strict";angular.module("mnUserRoles").controller("mnAddLDAPDialogController",mnAddLDAPDialogController);function mnAddLDAPDialogController($scope,mnUserRolesService,mnPromiseHelper,$uibModalInstance){var vm=this;vm.config={connect:{hosts:"",port:"",encryption:"None",serverCertValidation:"false",cacert:"",bindDN:"",bindPass:""},isAnon:false,userDnMapping:"template",authentication:{authenticationEnabled:false,userDNMapping:{template:""}},cred:{},queryForGroups:"users_attrs",group:{authorizationEnabled:false,nestedGroupsEnabled:false,groupsQuery:{},},groupsQueryUser:"",advanced:{requestTimeout:4000,maxParallelConnections:1000,maxCacheSize:10000,cacheValueLifetime:30000,nestedGroupsMaxDepth:10}};vm.save=save;vm.checkConnectivity=checkConnectivity;vm.checkAuthentication=checkAuthentication;vm.checkGroupsQuery=checkGroupsQuery;vm.clearLdapCache=clearLdapCache;vm.removeGroupsQueryErrors=removeGroupsQueryErrors;activate();function activate(){mnUserRolesService.getLdapSettings().then(function(resp){var config=resp.data;vm.config.connect=unpackConnectivity(config);vm.config.userDnMapping=unpackUserDnMappingType(config.userDNMapping);vm.config.authentication.authenticationEnabled=config.authenticationEnabled;vm.config.authentication.userDNMapping=unpackUserDnMapping(vm.config.userDnMapping,config.userDNMapping);vm.config.queryForGroups=unpackQueryForGroupsType(config.groupsQuery);vm.config.group.authorizationEnabled=config.authorizationEnabled;vm.config.group.nestedGroupsEnabled=config.nestedGroupsEnabled;vm.config.group.groupsQuery=unpackQueryForGroups(vm.config.queryForGroups,config.groupsQuery);vm.config.advanced=unpackAdvancedSettings(config);vm.config.isAnon=isThisAnonConnection(config);});}
function isThisAnonConnection(data){return!data.bindDN&&!!((data.authenticationEnabled&&data.userDNMapping&&data.userDNMapping.includes("query"))||(data.authorizationEnabled&&data.groupsQuery));}
function clearLdapCache(){delete vm.cacheCleared;return mnPromiseHelper(vm,mnUserRolesService.clearLdapCache(),$uibModalInstance).broadcast("reloadRolesPoller").applyToScope("cacheCleared");}
function unpackAdvancedSettings(config){return Object.keys(vm.config.advanced).reduce(function(acc,key){acc[key]=config[key];return acc;},{});}
function unpackConnectivity(config){return Object.keys(vm.config.connect).reduce(function(acc,key){switch(key){case"hosts":acc[key]=config[key].join(",");break;case"serverCertValidation":if(config[key]==false){acc[key]="false";}else if(config["cacert"]){acc[key]="pasteCert";}else{acc[key]="true";}
break;default:if(config[key]!==undefined){acc[key]=config[key].toString();}}
return acc;},{});}
function unpackUserDnMapping(type,mapping){if(mapping=="None"){return{template:""}}
switch(type){case"template":return{template:mapping.template,scope:"one"};case"query":var query=mapping.query.split("?");return{base:query[0],scope:query[2]||"one",filter:query[3]};}}
function unpackUserDnMappingType(userDnMapping){if(userDnMapping=="None"){return"template";}
if(userDnMapping.query){return"query";}
return"template";}
function unpackQueryForGroupsType(query){if(!query||(query.includes("%D?")&&query.includes("?base"))){return"users_attrs";}else{return"query";}}
function unpackQueryForGroups(type,groupsQuery){if(!groupsQuery){return{scope:"one"};}
var query=groupsQuery.split("?");switch(type){case"users_attrs":return{attributes:query[1],scope:"base"};case"query":return{base:query[0],scope:query[2]||"one",filter:query[3]};}}
function getUserDnMapping(config){switch(vm.config.userDnMapping){case"template":return JSON.stringify({template:config.userDNMapping.template||""});case"query":var dnQuery=(config.userDNMapping.base||"")+"??"+
(config.userDNMapping.scope||"")+"?"+
(config.userDNMapping.filter||"");return JSON.stringify({query:dnQuery});}}
function getQueryForGroups(config){switch(vm.config.queryForGroups){case"users_attrs":return"%D?"+(config.groupsQuery.attributes||"")+"?base";case"query":return(config.groupsQuery.base||"")+"??"+
(config.groupsQuery.scope||"")+"?"+
(config.groupsQuery.filter||"");}}
function getConnectivitySettings(){var config=Object.assign({},vm.config.connect);if(config.bindPass=="**********"){delete config.bindPass;}
if(vm.config.isAnon){config.bindDN="";config.bindPass="";}
if(config.serverCertValidation=="pasteCert"){config.serverCertValidation="true";}else if(config.serverCertValidation=="true"){config.cacert="";}else{delete config.cacert;}
return config;}
function getAuthenticationSettings(){var config=Object.assign({},vm.config.authentication);if(config.authenticationEnabled){config.userDNMapping=getUserDnMapping(config);}else{delete config.userDNMapping;}
return config;}
function getQueryForGroupsSettings(){var config=Object.assign({},vm.config.group);if(config.authorizationEnabled){config.groupsQuery=getQueryForGroups(config);}else{delete config.groupsQuery;}
return config;}
function maybeExtractResultFromError(resultName){return function(error){if(error.result){vm[resultName]={data:error};vm.errors={};}else{vm.errors=error;}};}
function removeGroupsQueryErrors(){if(vm.errors){delete vm.errors.groupsQuery;}}
function removeErrors(){delete vm.errors;delete vm.connectSuccessResult;delete vm.authenticationSuccessResult;delete vm.queryForGroupsSuccessResult;}
function checkConnectivity(){removeErrors();mnPromiseHelper(vm,mnUserRolesService.ldapConnectivityValidate(getConnectivitySettings(),vm.config)).applyToScope("connectSuccessResult").catchErrors(maybeExtractResultFromError("connectSuccessResult"));}
function checkAuthentication(){removeErrors();var settings=Object.assign({},getConnectivitySettings(),getAuthenticationSettings(),vm.config.cred);mnPromiseHelper(vm,mnUserRolesService.ldapAuthenticationValidate(settings,vm.config)).applyToScope("authenticationSuccessResult").catchErrors(maybeExtractResultFromError("authenticationSuccessResult"));}
function checkGroupsQuery(){removeErrors();var settings=Object.assign({groupsQueryUser:vm.config.groupsQueryUser},getConnectivitySettings(),getAuthenticationSettings(),getQueryForGroupsSettings());mnPromiseHelper(vm,mnUserRolesService.ldapGroupsQueryValidate(settings,vm.config)).applyToScope("queryForGroupsSuccessResult").catchErrors(maybeExtractResultFromError("queryForGroupsSuccessResult"));}
function save(){removeErrors();var config=Object.assign({},getConnectivitySettings(),getAuthenticationSettings(),getQueryForGroupsSettings(),vm.config.advanced);mnPromiseHelper(vm,mnUserRolesService.postLdapSettings(config,vm.config),$uibModalInstance).showGlobalSpinner().removeErrors().catchErrors().broadcast("reloadLdapSettings").closeOnSuccess().showGlobalSuccess("LDAP connected successfully!");}}})();(function(){"use strict";angular.module("mnUserRoles").controller("mnUserRolesResetPasswordDialogController",mnUserRolesResetPasswordDialogController);function mnUserRolesResetPasswordDialogController($scope,mnUserRolesService,$uibModalInstance,mnPromiseHelper,user){var vm=this;vm.user=user;vm.userID=vm.user.id;vm.save=save;function save(){if(vm.form.$invalid){return;}
mnPromiseHelper(vm,mnUserRolesService.addUser(vm.user,vm.user.roles.map(function(role){return(role.bucket_name?(role.role+'['+role.bucket_name+']'):role.role);}),vm.user.groups,true,true),$uibModalInstance).showGlobalSpinner().catchErrors().broadcast("reloadRolesPoller").closeOnSuccess().showGlobalSuccess("Password reset successfully!");}}})();(function(){"use strict";angular.module("mnUserRoles").controller("mnUserRolesDeleteDialogController",mnUserRolesDeleteDialogController);function mnUserRolesDeleteDialogController($scope,mnUserRolesService,user,mnPromiseHelper,$uibModalInstance){var vm=this;vm.username=user.id;vm.onSubmit=onSubmit;function onSubmit(){mnPromiseHelper(vm,mnUserRolesService.deleteUser(user),$uibModalInstance).showGlobalSpinner().closeFinally().broadcast("reloadRolesPoller").showGlobalSuccess("User deleted successfully!");}}})();(function(){"use strict";angular.module("mnUserRoles").controller("mnRolesController",mnRolesController);function mnRolesController(poolDefault,mnHelper,$uibModal,$q){var vm=this;vm.addUser=addUser;vm.addRolesGroup=addRolesGroup;vm.addLDAP=addLDAP;function addUser(){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_user_roles/add_dialog/mn_user_roles_add_dialog.html',controller:'mnUserRolesAddDialogController as userRolesAddDialogCtl',resolve:{user:mnHelper.wrapInFunction(undefined),isLdapEnabled:function(mnUserRolesService){return $q.all([poolDefault.saslauthdEnabled?mnUserRolesService.getSaslauthdAuth():$q.when(),poolDefault.isEnterprise?mnUserRolesService.getLdapSettings():$q.when()]).then(function(resp){return(resp[0]&&resp[0].enabled)||(resp[1]&&resp[1].data.authenticationEnabled);});}}});}
function addLDAP(){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_user_roles/mn_add_ldap_dialog.html',controller:'mnAddLDAPDialogController as addLdapDialogCtl'});}
function addRolesGroup(){$uibModal.open({templateUrl:'app/mn_admin/mn_security/mn_roles_groups_add_dialog.html',controller:'mnRolesGroupsAddDialogController as rolesGroupsAddDialogCtl',resolve:{rolesGroup:mnHelper.wrapInFunction(undefined)}});}}})();(function(){"use strict";angular.module('mnAuditService',['mnPoolDefault']).factory('mnAuditService',mnAuditServiceFactory);function mnAuditServiceFactory($http,$q,mnPoolDefault,IEC){var mnAuditService={getAuditSettings:getAuditSettings,saveAuditSettings:saveAuditSettings,getAuditDescriptors:getAuditDescriptors,getState:getState,getNonFilterableDescriptors:getNonFilterableDescriptors};return mnAuditService;function getState(){var queries=[getAuditSettings()];if(mnPoolDefault.export.isEnterprise){if(mnPoolDefault.export.compat.atLeast55){queries.push(getAuditDescriptors());}
if(mnPoolDefault.export.compat.atLeast65){queries.push(getNonFilterableDescriptors())}}
return $q.all(queries).then(unpack);}
function getAuditSettings(){return $http({method:'GET',url:'/settings/audit'}).then(function(resp){return resp.data;});}
function getNonFilterableDescriptors(){return $http({method:'GET',url:'/settings/audit/nonFilterableDescriptors'}).then(function(resp){return resp.data.map(function(desc){desc.nonFilterable=true;desc.enabledByUI=true;return desc;})});}
function getAuditDescriptors(){return $http({method:'GET',url:'/settings/audit/descriptors'}).then(function(resp){return _.clone(resp.data);});}
function saveAuditSettings(data,validateOnly){var params={};if(validateOnly){params.just_validate=1;}
return $http({method:'POST',url:'/settings/audit',params:params,data:pack(data)}).then(function(resp){if(resp.data.errors){if(resp.data.errors.disabledUsers){resp.data.errors.disabledUsers=resp.data.errors.disabledUsers.replace(/\/local/gi,"/couchbase");}
if(resp.data.errors.rotateSize){resp.data.errors.rotateSize=resp.data.errors.rotateSize.replace(/\d+/g,function(bytes){return Number(bytes)/IEC.Mi;});}}
return resp;});}
function mergeEvets(result,value){return result.concat(value);}
function filterDisabled(result,desc){if(!desc.enabledByUI){result.push(desc.id);}
return result;}
function pack(data){var result={auditdEnabled:data.auditdEnabled};if(mnPoolDefault.export.compat.atLeast55&&mnPoolDefault.export.isEnterprise){result.disabled=_.reduce(_.reduce(data.eventsDescriptors,mergeEvets,[]),filterDisabled,[]).join(',');result.disabledUsers=data.disabledUsers.replace(/\/couchbase/gi,"/local");}
if(data.auditdEnabled){result.rotateInterval=data.rotateInterval*formatTimeUnit(data.rotateUnit);result.logPath=data.logPath;result.rotateSize=data.rotateSize;}
if(data.rotateSize){result.rotateSize=data.rotateSize*IEC.Mi;}
return result;}
function formatTimeUnit(unit){switch(unit){case'minutes':return 60;case'hours':return 3600;case'days':return 86400;}}
function unpack(resp){var data=resp[0];var eventsDescriptors=resp[1];if(data.rotateInterval%86400==0){data.rotateInterval/=86400;data.rotateUnit='days';}else if(data.rotateInterval%3600==0){data.rotateInterval/=3600;data.rotateUnit='hours';}else{data.rotateInterval/=60;data.rotateUnit='minutes';}
if(data.rotateSize){data.rotateSize=data.rotateSize/IEC.Mi;}
if(mnPoolDefault.export.isEnterprise){if(mnPoolDefault.export.compat.atLeast55){var mapDisabledIDs=_.groupBy(data.disabled);eventsDescriptors.forEach(function(desc){desc.enabledByUI=!mapDisabledIDs[desc.id];});if(mnPoolDefault.export.compat.atLeast65){Array.prototype.push.apply(eventsDescriptors,resp[2]);}
data.eventsDescriptors=_.groupBy(eventsDescriptors,"module");data.disabledUsers=data.disabledUsers.map(function(user){return user.name+"/"+(user.domain==="local"?"couchbase":user.domain);}).join(',');}}
data.logPath=data.logPath||"";return data;}}})();(function(){"use strict";angular.module('mnAudit',['mnAuditService','mnHelper','mnPromiseHelper','mnFilters']).controller('mnAuditController',mnAuditController);function mnAuditController($scope,mnAuditService,mnPromiseHelper,mnHelper){var vm=this;vm.submit=submit;vm.toggleAll=toggleAll;vm.mapNames=mapNames;vm.findEnabled=findEnabled;vm.reloadState=mnHelper.reloadState;activate();function mapNames(name){switch(name){case"auditd":return"Audit";case"ns_server":return"REST API";case"n1ql":return"Query and Index Service";case"eventing":return"Eventing Service";case"memcached":return"Data Service";case"xdcr":return name.toUpperCase();case"fts":return"Search Service";case"view_engine":return"Views";default:return name.charAt(0).toUpperCase()+name.substr(1).toLowerCase();}}
function findEnabled(moduleName,bool){return!!_.find(vm.state.eventsDescriptors[moduleName],{enabledByUI:bool});}
function setEnabled(moduleName,bool){vm.state.eventsDescriptors[moduleName].forEach(function(desc){if(desc.nonFilterable){return;}
desc.enabledByUI=bool;});}
function toggleAll(moduleName){setEnabled(moduleName,findEnabled(moduleName,false));}
function activate(){mnPromiseHelper(vm,mnAuditService.getState()).applyToScope("state");$scope.$watch('auditCtl.state',_.debounce(watchOnState,500),true);}
function watchOnState(state){if(!state||!$scope.rbac.cluster.admin.security.write){return;}
mnPromiseHelper(vm,mnAuditService.saveAuditSettings(state,true)).catchErrorsFromSuccess();}
function submit(){if($scope.viewLoading){return;}
mnPromiseHelper(vm,mnAuditService.saveAuditSettings(vm.state)).catchErrorsFromSuccess().showSpinner().reloadState("app.admin.security").showGlobalSuccess("Audit settings changed successfully!");};}})();(function(){"use strict";angular.module("mnRootCertificateService",[]).factory("mnRootCertificateService",mnRootCertificateFactory);function mnRootCertificateFactory($http,$q){var mnRootCertificateService={getDefaultCertificate:getDefaultCertificate};return mnRootCertificateService;function getDefaultCertificate(){return $http({method:'GET',url:'/pools/default/certificate',params:{extended:true}}).then(function(resp){return resp.data;});}}})();(function(){"use strict";angular.module("mnRootCertificate",["mnRootCertificateService","mnPromiseHelper","mnSpinner"]).controller("mnRootCertificateController",mnRootCertificateController);function mnRootCertificateController($scope,mnRootCertificateService,mnPromiseHelper){var vm=this;activate();function activate(){mnPromiseHelper(vm,mnRootCertificateService.getDefaultCertificate()).applyToScope("certificate");}}})();(function(){"use strict";angular.module("mnClientCertificateService",["mnPoolDefault"]).factory("mnClientCertificateService",mnClientCertificateFactory);function mnClientCertificateFactory($http,$q,mnPoolDefault){var mnClientCertificateService={getClientCertificateSettings:getClientCertificateSettings,postClientCertificateSettings:postClientCertificateSettings};return mnClientCertificateService;function getClientCertificateSettings(){return $http({method:'GET',url:'/settings/clientCertAuth',}).then(function(resp){return resp.data;});}
function postClientCertificateSettings(data){var settings=_.clone(data);if(settings.state=='disable'){settings.prefixes=settings.prefixes.filter(function(pref){return!_.isEqual(pref,{delimiter:'',prefix:'',path:''});});}
if(!mnPoolDefault.export.compat.atLeast51){(['delimiter','prefix','path']).forEach(function(key){if(settings.prefixes[0]&&settings.prefixes[0][key]){settings[key]=settings.prefixes[0][key];}});delete settings.prefixes;}
return $http({method:'POST',url:'/settings/clientCertAuth',mnHttp:{isNotForm:mnPoolDefault.export.compat.atLeast51},data:settings,}).then(function(resp){return resp.data;});}}})();(function(){"use strict";angular.module("mnClientCertificate",["mnClientCertificateService","mnSpinner"]).controller("mnClientCertController",mnClientCertController);function mnClientCertController($scope,mnClientCertificateService,mnPromiseHelper){var vm=this;vm.onSubmit=onSubmit;activate();function maybeSetInititalValue(array,value){}
function onSubmit(){if($scope.mnGlobalSpinnerFlag){return;}
mnPromiseHelper(vm,mnClientCertificateService.postClientCertificateSettings(vm.settings)).showGlobalSpinner().catchErrors().showGlobalSuccess("Settings saved successfully!");}
function activate(){mnPromiseHelper(vm,mnClientCertificateService.getClientCertificateSettings()).applyToScope("settings").onSuccess(function(resp){if($scope.rbac.cluster.admin.security.write&&vm.settings.prefixes.length===0){vm.settings.prefixes.push({delimiter:'',prefix:'',path:'subject.cn'});}});}}})();(function(){"use strict";angular.module("mnLogRedactionService",[]).factory("mnLogRedactionService",mnRedactionFactory);function mnRedactionFactory($http){var mnLogRedactionService={get:get,post:post};return mnLogRedactionService;function get(){return $http.get("/settings/logRedaction").then(function(resp){return resp.data;});}
function post(data){return $http.post("/settings/logRedaction",data);}}})();(function(){"use strict";angular.module("mnRedaction",["mnLogRedactionService","mnSpinner"]).controller("mnRedactionController",mnRedactionController);function mnRedactionController($scope,mnLogRedactionService,mnPromiseHelper){var vm=this;vm.onSubmit=onSubmit;activate();function onSubmit(){if($scope.mnGlobalSpinnerFlag){return;}
mnPromiseHelper(vm,mnLogRedactionService.post(vm.logRedactionSettings)).showGlobalSpinner().catchErrors().showGlobalSuccess("Settings saved successfully!");}
function activate(){mnPromiseHelper(vm,mnLogRedactionService.get()).applyToScope("logRedactionSettings");}}})();(function(){"use strict";angular.module('mnLogsService',['mnLogsCollectInfoService','ui.bootstrap']).service('mnLogsService',mnLogsServiceFactory);function mnLogsServiceFactory($http,$rootScope,$uibModal){var mnLogsService={getLogs:getLogs,showClusterInfoDialog:showClusterInfoDialog};return mnLogsService;function getLogs(){return $http.get('/logs');}
function getClusterInfo(){return $http.get('/pools/default/terseClusterInfo');}
function showClusterInfoDialog(){return getClusterInfo().then(function(resp){var scope=$rootScope.$new();scope.info=JSON.stringify(resp.data,null,2);return $uibModal.open({templateUrl:'app/mn_admin/mn_cluster_info_dialog.html',scope:scope});});}}})();(function(){"use strict";angular.module('mnLogs',['mnLogsService','mnPromiseHelper','mnPoll','mnSpinner','mnFilters','mnElementCrane','mnSearch','mnSortableTable','mnLogRedactionService','mnSelectableNodesList','mnGroupsService']).controller('mnLogsController',mnLogsController);function mnLogsController($scope,mnHelper,mnLogsService){var vm=this;}})();(function(){"use strict";angular.module('mnLogsCollectInfoService',['mnServersService','mnTasksDetails','mnFilters','mnPoolDefault','mnHelper']).service('mnLogsCollectInfoService',mnLogsCollectInfoServiceFactory);function mnLogsCollectInfoServiceFactory($http,$q,mnServersService,mnTasksDetails,mnStripPortHTMLFilter,mnPoolDefault,mnHelper){var mnLogsCollectInfoService={startLogsCollection:startLogsCollection,cancelLogsCollection:cancelLogsCollection,getState:getState};return mnLogsCollectInfoService;function startLogsCollection(collect){var data={};data.nodes=collect.nodes.join(',');if(collect.upload){data.uploadHost=collect.uploadHost;data.customer=collect.customer;data.ticket=collect.ticket;if(collect.uploadProxy){data.uploadProxy=collect.uploadProxy;}}
if(collect.enableLogDir){data.logDir=collect.logDir;}
if(collect.enableTmpDir){data.tmpDir=collect.tmpDir;}
if(mnPoolDefault.export.compat.atLeast55&&mnPoolDefault.export.isEnterprise){data.logRedactionLevel=collect.logRedactionLevel;}
return $http.post('/controller/startLogsCollection',data);}
function cancelLogsCollection(){return $http.post('/controller/cancelLogsCollection');}
function getState(){var queries=[mnServersService.getNodes(),mnTasksDetails.get()];return $q.all(queries).then(function(resp){var nodes=_.clone(resp[0].allNodes,true);var tasks=resp[1].tasks;var logRedaction=resp[2];var task=_.detect(tasks,function(taskInfo){return taskInfo.type==="clusterLogsCollection";});if(!task){return{nodesByStatus:{},nodeErrors:[],status:'idle',perNode:{},nodes:nodes};}
task=JSON.parse(JSON.stringify(task));var perNodeHash=task.perNode;var perNode=[];var cancallable="starting started startingUpload startedUpload".split(" ");_.each(perNodeHash,function(ni,nodeName){var node=_.detect(nodes,function(n){return n.otpNode===nodeName;});ni.nodeName=(node===undefined)?nodeName.replace(/^.*?@/,''):mnStripPortHTMLFilter(node.hostname,nodes);perNode.push(ni);if(task.status=='cancelled'&&cancallable.indexOf(ni.status)>=0){ni.status='cancelled';}});var nodesByStatus=_.groupBy(perNode,'status');var nodeErrors=_.compact(_.map(perNode,function(ni){var rv;var error;if(ni.uploadOutput||ni.collectionOutput){error=[];ni.uploadOutput&&error.push(ni.uploadOutput);ni.collectionOutput&&error.push(ni.collectionOutput);return{nodeName:ni.nodeName,error:error};}}));task.nodesByStatus=nodesByStatus;task.nodeErrors=nodeErrors;task.nodes=nodes;return task});}}})();(function(){"use strict";angular.module('mnLogs').controller('mnLogsCollectInfoController',mnLogsCollectInfoController);function mnLogsCollectInfoController($scope,mnHelper,mnPromiseHelper,mnPoolDefault,mnLogsCollectInfoService,mnPoller,$state,$uibModal,mnLogRedactionService,permissions,mnGroupsService,mnLogsService){var vm=this;vm.stopCollection=stopCollection;vm.isNodeDisabled=isNodeDisabled;vm.submit=submit;vm.showClusterInfoDialog=mnLogsService.showClusterInfoDialog;activate();vm.collect={};vm.mnSelectedNodesHolder={};if(mnPoolDefault.latestValue().value.isEnterprise){vm.collect.uploadHost='uploads.couchbase.com';}
function isNodeDisabled(node){return node.status==='unhealthy';}
function activate(){if(mnPoolDefault.export.isGroupsAvailable&&permissions.cluster.server_groups.read){new mnPoller($scope,mnGroupsService.getGroupsByHostname).subscribe("getGroupsByHostname",vm).cycle();}
new mnPoller($scope,mnLogsCollectInfoService.getState).subscribe(function(state){vm.loadingResult=false;vm.state=state;}).reloadOnScopeEvent("reloadCollectInfoPoller",vm,"loadingResult").reloadOnScopeEvent("mnTasksDetailsChanged").cycle();if(permissions.cluster.settings.read&&mnPoolDefault.export.compat.atLeast55&&mnPoolDefault.export.isEnterprise){mnLogRedactionService.get().then(function(value){vm.collect.logRedactionLevel=value.logRedactionLevel;});}}
function stopCollection(){$uibModal.open({templateUrl:'app/mn_admin/mn_logs/collect_info/mn_logs_collect_info_stop_dialog.html'}).result.then(function(){vm.disabledStopCollect=true;mnPromiseHelper(vm,mnLogsCollectInfoService.cancelLogsCollection()).getPromise()['finally'](function(){vm.disabledStopCollect=false;});});}
function submit(){vm.collect.nodes=mnHelper.checkboxesToList(vm.mnSelectedNodesHolder);mnPromiseHelper(vm,mnLogsCollectInfoService.startLogsCollection(vm.collect)).showSpinner().catchErrors().onSuccess(function(){vm.loadingResult=true;$state.go('app.admin.logs.collectInfo.result');});}}})();(function(){"use strict";angular.module('mnLogs').controller('mnLogsListController',mnLogsListController).filter('moduleCode',moduleCodeFilter);function mnLogsListController($scope,mnLogsService,mnPoller,$filter,moduleCodeFilter){var vm=this;var openedByIndex={};var textLimit=1000;vm.toggle=toggle;vm.textLimit=textLimit;vm.isOpened=isOpened;vm.isOverLimit=isOverLimit;activate();function activate(){new mnPoller($scope,mnLogsService.getLogs).subscribe(function(logs){vm.logs=logs.data.list.map(function(row){return{module:row.module,text:row.text,node:row.node,code:moduleCodeFilter(row.code),time:$filter('date')(row.serverTime,'mediumTime','UTC'),date:$filter('date')(row.serverTime,'d MMM, y','UTC'),tstamp:row.tstamp};});}).setInterval(10000).cycle();}
function getOriginalLogItemIndex(index){return vm.logs.length-(index+1);}
function isOverLimit(row){return row.text.length>textLimit;}
function toggle(index){var originalIndex=getOriginalLogItemIndex(index);openedByIndex[originalIndex]=!openedByIndex[originalIndex];}
function isOpened(index){return openedByIndex[getOriginalLogItemIndex(index)];}}
function moduleCodeFilter(){return function(code){return new String(1000+parseInt(code)).slice(-3);};}})();(function(){"use strict";angular.module("mnPoorMansAlertsService",['ui.router','ui.bootstrap','mnHelper']).factory("mnPoorMansAlertsService",mnPoorMansAlertsFactory);function mnPoorMansAlertsFactory($http,$state,$uibModal,mnHelper,$timeout){var alerts=[];var modal;var modalDeferId;var mnPoorMansAlerts={maybeShowAlerts:maybeShowAlerts,postAlertsSilenceURL:postAlertsSilenceURL};return mnPoorMansAlerts;function postAlertsSilenceURL(alertsSilenceURL){return $http({method:"POST",url:alertsSilenceURL,timeout:5000,data:''});}
function maybeShowAlerts(poolDefault){if($state.params.disablePoorMansAlerts){return;}
alerts=poolDefault.alerts;if(!alerts.length){return;}
if(modalDeferId){$timeout.cancel(modalDeferId);}
if(modal){modal.dismiss();modal=null;modalDeferId=$timeout(function(){modal=doShowAlerts(poolDefault.alertsSilenceURL,alerts);},0);}else{modal=doShowAlerts(poolDefault.alertsSilenceURL,alerts);}}
function doShowAlerts(alertsSilenceURL,alerts){return $uibModal.open({templateUrl:"app/mn_admin/mn_poor_mans_alerts/mn_poor_mans_alerts.html",controller:"mnPoorMansAlertsController as poorMansCtl",resolve:{alertsSilenceURL:mnHelper.wrapInFunction(alertsSilenceURL),alerts:mnHelper.wrapInFunction(_.clone(alerts,true))}});}}})();(function(){"use strict";angular.module("mnPoorMansAlerts",["mnPromiseHelper","mnPoorMansAlertsService","mnSpinner"]).controller("mnPoorMansAlertsController",mnPoorMansAlertsController);function mnPoorMansAlertsController(mnPromiseHelper,mnPoorMansAlertsService,alertsSilenceURL,alerts,$uibModalInstance){var vm=this;vm.alerts=alerts;vm.onClose=onClose;function onClose(){mnPromiseHelper(vm,mnPoorMansAlertsService.postAlertsSilenceURL(alertsSilenceURL),$uibModalInstance).showGlobalSpinner().closeOnSuccess();}}})();(function(){"use strict";angular.module('mnWizard',['mnWizardService','mnClusterConfigurationService','mnAuthService','mnSpinner','mnPromiseHelper','mnFocus','mnAutocompleteOff','mnMinlength','mnEqual','mnFilters','mnServicesDiskPaths','mnRootCertificateService']).config(mnWizardConfig);function mnWizardConfig($stateProvider){$stateProvider.state('app.wizard',{abstract:true,templateUrl:'app/mn_wizard/mn_wizard.html',controller:"mnWizardWelcomeController as wizardWelcomeCtl",resolve:{pools:function(mnPools){return mnPools.get();}}}).state('app.wizard.welcome',{templateUrl:'app/mn_wizard/welcome/mn_wizard_welcome.html'}).state('app.wizard.setupNewCluster',{templateUrl:'app/mn_wizard/mn_setup_new_cluster/mn_setup_new_cluster.html',controller:'mnSetupNewClusterController as setupNewClusterCtl'}).state('app.wizard.joinCluster',{templateUrl:'app/mn_wizard/mn_join_cluster/mn_join_cluster.html',controller:'mnClusterConfigurationController as clusterConfigurationCtl'}).state('app.wizard.termsAndConditions',{templateUrl:'app/mn_wizard/mn_terms_and_conditions/mn_terms_and_conditions.html',controller:'mnTermsAndConditionsController as termsCtl'}).state('app.wizard.clusterConfiguration',{templateUrl:'app/mn_wizard/mn_cluster_configuration/mn_cluster_configuration.html',controller:'mnClusterConfigurationController as clusterConfigurationCtl'})}})();(function(){"use strict";angular.module('mnWizardService',[]).factory('mnWizardService',mnWizardServiceFactory);function mnWizardServiceFactory($http){var mnWizardService={getNewClusterState:getNewClusterState,getState:getState,getCELicense:getCELicense,getEELicense:getEELicense};var state={isNewCluster:undefined,newClusterState:{clusterName:"",user:{username:'Administrator',password:'',verifyPassword:''}}};return mnWizardService;function getCELicense(){return $http({method:"GET",url:"CE_license_agreement.txt"}).then(function(resp){return resp.data;});}
function getEELicense(){return $http({method:"GET",url:"EE_subscription_license_agreement.txt"}).then(function(resp){return resp.data;});}
function getState(){return state;}
function getNewClusterState(){return state.newClusterState;}}})();(function(){"use strict";angular.module("mnWizard").controller("mnWizardWelcomeController",mnWizardWelcomeController);function mnWizardWelcomeController(pools,mnWizardService){var vm=this;vm.implementationVersion=pools.implementationVersion;vm.setIsNewClusterFlag=setIsNewClusterFlag;function setIsNewClusterFlag(value){mnWizardService.getState().isNewCluster=value;}}})();(function(){"use strict"
angular.module('mnWizard').controller('mnSetupNewClusterController',mnSetupNewClusterController);function mnSetupNewClusterController($state,mnClusterConfigurationService,mnPromiseHelper,mnWizardService){var vm=this;vm.state=mnWizardService.getNewClusterState();vm.onSubmit=onSubmit;activate();function activate(){vm.focusMe=true;}
function login(user){return mnClusterConfigurationService.postAuth(user,true).then(function(){return $state.go('app.wizard.termsAndConditions');});}
function onSubmit(){if(vm.viewLoading){return;}
if(vm.form.$invalid){return activate();}
var promise=login(vm.state.user);mnPromiseHelper(vm,promise).showGlobalSpinner().catchErrors(function(data){vm.errors=(data&&data.statusText)||data;});}}})();(function(){"use strict";angular.module('mnWizard').controller('mnTermsAndConditionsController',mnTermsAndConditionsController);function mnTermsAndConditionsController($scope,$state,mnWizardService,pools,mnPromiseHelper,mnClusterConfigurationService,mnSettingsClusterService,mnAuthService,mnServersService,mnStatisticsNewService){var vm=this;vm.isEnterprise=pools.isEnterprise;vm.onSubmit=onSubmit;vm.finishWithDefault=finishWithDefault;activate();function activate(){var promise;if(vm.isEnterprise){promise=mnWizardService.getEELicense();}else{promise=mnWizardService.getCELicense();}
mnPromiseHelper(vm,promise).showSpinner().applyToScope("license");}
function finishWithDefault(){vm.form.agree.$setValidity('required',!!vm.agree);if(vm.form.$invalid){return;}
mnClusterConfigurationService.postStats(true).then(function(){var services="kv,index,fts,n1ql";if(vm.isEnterprise){services+=",eventing,cbas";}
var setupServicesPromise=mnServersService.setupServices({services:services,setDefaultMemQuotas:true});mnPromiseHelper(vm,setupServicesPromise).catchErrors().onSuccess(function(){var newClusterState=mnWizardService.getNewClusterState();mnSettingsClusterService.postIndexSettings({storageMode:vm.isEnterprise?"plasma":"forestdb"});mnSettingsClusterService.postPoolsDefault(false,false,newClusterState.clusterName).then(function(){mnClusterConfigurationService.postAuth(newClusterState.user).then(function(){return mnAuthService.login(newClusterState.user).then(function(){return $state.go('app.admin.overview.statistics');});});});});});}
function onSubmit(){vm.form.agree.$setValidity('required',!!vm.agree);if(vm.form.$invalid){return;}
$state.go('app.wizard.clusterConfiguration');}}})();(function(){"use strict";angular.module('mnClusterConfigurationService',['mnHelper','mnPools']).factory('mnClusterConfigurationService',mnClusterConfigurationServiceFactory);function mnClusterConfigurationServiceFactory($http,mnHelper,IEC,mnPools){var mnClusterConfigurationService={getDynamicRamQuota:getDynamicRamQuota,getJoinClusterConfig:getJoinClusterConfig,getNewClusterConfig:getNewClusterConfig,getSelfConfig:getSelfConfig,postDiskStorage:postDiskStorage,postHostname:postHostname,postJoinCluster:postJoinCluster,lookup:lookup,getConfig:getConfig,postAuth:postAuth,postStats:postStats,getQuerySettings:getQuerySettings,postQuerySettings:postQuerySettings,postCurlWhitelist:postCurlWhitelist,postEnableExternalListener:postEnableExternalListener,postSetupNetConfig:postSetupNetConfig};var re=/^[A-Z]:\//;var preprocessPath;var joinClusterConfig={clusterMember:{hostname:"127.0.0.1",username:"Administrator",password:''},services:{disabled:{kv:false,index:false,n1ql:false,fts:false},model:{kv:true,index:true,n1ql:true,fts:true}},firstTimeAddedServices:undefined};var newConfig={maxMemorySize:undefined,totalMemorySize:undefined,memoryQuota:undefined,displayedServices:{kv:true,index:true,fts:true,n1ql:true},services:{disabled:{kv:true,index:false,n1ql:false,fts:false},model:{kv:true,index:true,n1ql:true,fts:true}},showKVMemoryQuota:true,showIndexMemoryQuota:true,showFTSMemoryQuota:true,indexMemoryQuota:undefined,ftsMemoryQuota:undefined,eventingMemoryQuota:undefined,cbasMemoryQuota:undefined,minMemorySize:256,indexSettings:{storageMode:mnPools.export.isEnterprise?"plasma":"forestdb"}};if(mnPools.export.isEnterprise){newConfig.displayedServices.cbas=true;newConfig.services.disabled.cbas=false;newConfig.services.model.cbas=true;joinClusterConfig.services.disabled.cbas=false;joinClusterConfig.services.model.cbas=true;newConfig.showCBASMemoryQuota=true;newConfig.displayedServices.eventing=true;newConfig.services.disabled.eventing=false;newConfig.services.model.eventing=true;joinClusterConfig.services.disabled.eventing=false;joinClusterConfig.services.model.eventing=true;newConfig.showEventingMemoryQuota=true;}
return mnClusterConfigurationService;function postEnableExternalListener(data){return $http({method:'POST',url:'/node/controller/enableExternalListener',data:data});}
function postSetupNetConfig(data){return $http({method:'POST',url:'/node/controller/setupNetConfig',data:data});}
function postQuerySettings(data){return $http({method:'POST',url:'/settings/querySettings',data:data}).then(function(resp){return resp.data;});}
function getQuerySettings(){return $http({method:'GET',url:'/settings/querySettings'}).then(function(resp){return resp.data;});}
function postCurlWhitelist(data,initData){data=_.clone(data);if(data.all_access&&initData){data.allowed_urls=initData.allowed_urls;data.disallowed_urls=initData.disallowed_urls;}
if(data.allowed_urls.length==1&&data.allowed_urls[0]===""){delete data.allowed_urls;}
if(data.disallowed_urls.length==1&&data.disallowed_urls[0]===""){delete data.disallowed_urls;}
return $http({method:'POST',mnHttp:{isNotForm:true},url:'/settings/querySettings/curlWhitelist',data:data}).then(function(resp){return resp.data;});}
function postStats(sendStats){return doPostStats({sendStats:sendStats});}
function doPostStats(data){return $http({method:'POST',url:'/settings/stats',data:data});}
function postAuth(user,justValidate){var data=_.clone(user);delete data.verifyPassword;data.port="SAME";return $http({method:'POST',url:'/settings/web',data:data,params:{just_validate:justValidate?1:0}});}
function getConfig(){return mnClusterConfigurationService.getSelfConfig().then(function(resp){var selfConfig=resp;var rv={};rv.selfConfig=selfConfig;newConfig.maxMemorySize=selfConfig.ramMaxMegs;newConfig.totalMemorySize=selfConfig.ramTotalSize;newConfig.memoryQuota=selfConfig.memoryQuota;newConfig.indexMemoryQuota=selfConfig.indexMemoryQuota;newConfig.ftsMemoryQuota=selfConfig.ftsMemoryQuota;newConfig.eventingMemoryQuota=selfConfig.eventingMemoryQuota;newConfig.calculateTotal=true;if(mnPools.export.isEnterprise){newConfig.cbasMemoryQuota=selfConfig.cbasMemoryQuota;rv.cbasDirs=selfConfig.storage.hdd[0].cbas_dirs;}
rv.startNewClusterConfig=newConfig;rv.hostname=selfConfig.hostname;rv.dbPath=selfConfig.storage.hdd[0].path;rv.indexPath=selfConfig.storage.hdd[0].index_path;rv.eventingPath=selfConfig.storage.hdd[0].eventing_path;rv.java_home=selfConfig.storage.hdd[0].java_home;return rv;});}
function getDynamicRamQuota(){return newConfig.memoryQuota;}
function getNewClusterConfig(){return newConfig;}
function preprocessPathStandard(p){if(p.charAt(p.length-1)!='/'){p+='/';}
return p;}
function preprocessPathForWindows(p){p=p.replace(/\\/g,'/');if(re.exec(p)){p=String.fromCharCode(p.charCodeAt(0)+0x20)+p.slice(1);}
return preprocessPathStandard(p);}
function updateTotal(pathResource){return(Math.floor(pathResource.sizeKBytes*(100-pathResource.usagePercent)/100/IEC.Mi))+' GB';}
function getJoinClusterConfig(){return joinClusterConfig;}
function getSelfConfig(){return $http({method:'GET',url:'/nodes/self'}).then(function(resp){var nodeConfig=resp.data;var ram=nodeConfig.storageTotals.ram;var totalRAMMegs=Math.floor(ram.total/IEC.Mi);preprocessPath=(nodeConfig.os==='windows'||nodeConfig.os==='win64'||nodeConfig.os==='win32')?preprocessPathForWindows:preprocessPathStandard;nodeConfig.preprocessedAvailableStorage=_.map(_.clone(nodeConfig.availableStorage.hdd,true),function(storage){storage.path=preprocessPath(storage.path);return storage;}).sort(function(a,b){return b.path.length-a.path.length;});nodeConfig.ramTotalSize=totalRAMMegs;nodeConfig.ramMaxMegs=mnHelper.calculateMaxMemorySize(totalRAMMegs);nodeConfig.hostname=(nodeConfig&&nodeConfig['otpNode'].split('@')[1])||'127.0.0.1';if(nodeConfig.hostname=="cb.local"){nodeConfig.hostname="127.0.0.1";}
return nodeConfig;});}
function lookup(path,availableStorage){return updateTotal(path&&_.detect(availableStorage,function(info){return preprocessPath(path).substring(0,info.path.length)==info.path;})||{path:"/",sizeKBytes:0,usagePercent:0});}
function postDiskStorage(config,node){return $http({method:'POST',url:'/nodes/'+(node||'self')+'/controller/settings',data:config});}
function postHostname(hostname){return $http({method:'POST',url:'/node/controller/rename',data:{hostname:hostname}});}
function postJoinCluster(clusterMember){clusterMember.user=clusterMember.username;return $http({method:'POST',url:'/node/controller/doJoinCluster',data:clusterMember});}}})();(function(){"use strict";angular.module('mnWizard').controller('mnClusterConfigurationController',mnClusterConfigurationController);function mnClusterConfigurationController($scope,$rootScope,$state,$q,mnClusterConfigurationService,mnSettingsClusterService,mnAuthService,pools,mnHelper,mnServersService,mnPools,mnAlertsService,mnPromiseHelper,mnWizardService,mnStatisticsNewService,mnRootCertificateService){var vm=this;vm.joinClusterConfig=mnClusterConfigurationService.getJoinClusterConfig();vm.defaultJoinClusterSerivesConfig=_.clone(vm.joinClusterConfig.services,true);vm.isEnterprise=pools.isEnterprise;vm.hostConfig={afamily:pools.isIPv6?"ipv6":"ipv4",nodeEncryption:'off'};vm.onSubmit=onSubmit;vm.onIPvChange=onIPvChange;vm.sendStats=true;activate();function postSetupNetConfig(){return mnClusterConfigurationService.postSetupNetConfig(vm.hostConfig);}
function postEnableExternalListener(){return mnClusterConfigurationService.postEnableExternalListener(vm.hostConfig);}
function onIPvChange(){if(vm.hostConfig.afamily=="ipv6"&&vm.config.hostname=="127.0.0.1"){vm.config.hostname="::1";}
if(vm.hostConfig.afamily=="ipv4"&&vm.config.hostname=="::1"){vm.config.hostname="127.0.0.1";}}
function postHostConfig(){var promise=postEnableExternalListener().then(postSetupNetConfig);return addErrorHandler(promise,"postHostConfig");}
function activate(){if(!mnWizardService.getState().isNewCluster&&vm.isEnterprise){mnPromiseHelper(vm,mnRootCertificateService.getDefaultCertificate()).applyToScope("certificate");}
mnPromiseHelper(vm,mnClusterConfigurationService.getConfig()).applyToScope("config").onSuccess(function(config){vm.defaultConfig=_.clone(config);});mnPromiseHelper(vm,mnClusterConfigurationService.getQuerySettings()).applyToScope("querySettings");$scope.$watch('clusterConfigurationCtl.config.startNewClusterConfig',_.debounce(onMemoryQuotaChanged,500),true);}
function onMemoryQuotaChanged(memoryQuotaConfig){if(!memoryQuotaConfig){return;}
var promise=mnSettingsClusterService.postPoolsDefault(memoryQuotaConfig,true);mnPromiseHelper(vm,promise).catchErrorsFromSuccess("postMemoryErrors");}
function goNext(){var newClusterState=mnWizardService.getNewClusterState();return mnClusterConfigurationService.postAuth(newClusterState.user).then(function(){return mnAuthService.login(newClusterState.user).then(function(){var config=mnClusterConfigurationService.getNewClusterConfig();if(config.services.model.index){mnSettingsClusterService.postIndexSettings(config.indexSettings);}}).then(function(){return $state.go('app.admin.overview.statistics');});});}
function addErrorHandler(query,name){return mnPromiseHelper(vm,query).catchErrors(name+'Errors').getPromise();}
function postMemoryQuota(){var data=_.clone(vm.config.startNewClusterConfig);var newClusterState=mnWizardService.getNewClusterState();!vm.config.startNewClusterConfig.services.model.index&&(delete data.indexMemoryQuota);!vm.config.startNewClusterConfig.services.model.fts&&(delete data.ftsMemoryQuota);if(pools.isEnterprise){!vm.config.startNewClusterConfig.services.model.cbas&&(delete data.cbasMemoryQuota);!vm.config.startNewClusterConfig.services.model.eventing&&(delete data.eventingMemoryQuota);}
return addErrorHandler(mnSettingsClusterService.postPoolsDefault(data,false,newClusterState.clusterName),"postMemory");}
function validateIndexSettings(){return mnPromiseHelper(vm,mnSettingsClusterService.postIndexSettings(vm.config.startNewClusterConfig.indexSettings)).catchErrors('postIndexSettingsErrors').getPromise();}
function postServices(){return addErrorHandler(mnServersService.setupServices({services:mnHelper.checkboxesToList(vm.config.startNewClusterConfig.services.model).join(',')}),"setupServices");}
function postDiskStorage(){var data={path:vm.config.dbPath,index_path:vm.config.indexPath,eventing_path:vm.config.eventingPath,java_home:vm.config.java_home};if(pools.isEnterprise){data.cbas_path=vm.config.cbasDirs;}
return addErrorHandler(mnClusterConfigurationService.postDiskStorage(data),"postDiskStorage");}
function postJoinCluster(){var data=_.clone(vm.joinClusterConfig.clusterMember);data.services=mnHelper.checkboxesToList(vm.joinClusterConfig.services.model).join(',');data.newNodeHostname=vm.config.hostname;return addErrorHandler(mnClusterConfigurationService.postJoinCluster(data),"postJoinCluster");}
function postStats(){var promise=mnClusterConfigurationService.postStats(vm.sendStats);return mnPromiseHelper(vm,promise).catchGlobalErrors().getPromise();}
function doStartNewCluster(){var newClusterParams=vm.config.startNewClusterConfig;var hadServicesString=vm.config.selfConfig.services.sort().join("");var hasServicesString=mnHelper.checkboxesToList(newClusterParams.services.model).sort().join("");if(hadServicesString===hasServicesString){return postMemoryQuota().then(postStats).then(goNext);}else{var hadIndexService=hadServicesString.indexOf("index")>-1;var hasIndexService=hasServicesString.indexOf("index")>-1;if(hadIndexService&&!hasIndexService){return postServices().then(function(){return postMemoryQuota().then(postStats).then(goNext);});}else{return postMemoryQuota().then(function(){return postServices().then(postStats).then(goNext);});}}}
function onSubmit(e){if(vm.viewLoading){return;}
delete vm.setupServicesErrors;delete vm.postMemoryErrors;delete vm.postDiskStorageErrors;delete vm.postJoinClusterErrors;delete vm.postHostnameErrors;delete vm.postIndexSettingsErrors;var promise=postDiskStorage().then(function(){if(mnWizardService.getState().isNewCluster&&vm.isEnterprise){return postHostConfig();}}).then(function(){if(mnWizardService.getState().isNewCluster){return addErrorHandler(mnClusterConfigurationService.postHostname(vm.config.hostname),"postHostname");}}).then(function(){if(mnWizardService.getState().isNewCluster){if(vm.config.startNewClusterConfig.services.model.index){return validateIndexSettings().then(function(){if(vm.postIndexSettingsErrors){return $q.reject();}
return doStartNewCluster();});}else{return doStartNewCluster();}}else{return postJoinCluster().then(function(){return mnAuthService.login(vm.joinClusterConfig.clusterMember).then(function(){return $state.go('app.admin.overview.statistics').then(function(){$rootScope.$broadcast("maybeShowMemoryQuotaDialog",vm.joinClusterConfig.services.model);mnAlertsService.formatAndSetAlerts('This server has been associated with the cluster and will join on the next rebalance operation.','success',60000);});});});}});mnPromiseHelper(vm,promise).showGlobalSpinner();};}})();(function(){"use strict";angular.module("mnServicesDiskPaths",["mnClusterConfigurationService"]).directive("mnServicesDiskPaths",mnServicesDiskPathsDirective);function mnServicesDiskPathsDirective(){var mnServicesDiskPaths={restrict:"AE",scope:{config:"=",postDiskStorageErrors:"=",isEnterprise:"=",isDisabled:"=?"},templateUrl:"app/components/directives/mn_services_disk_paths.html",controller:controller,controllerAs:"mnCtl"};return mnServicesDiskPaths;function controller($scope,mnClusterConfigurationService){var vm=this;vm.onDbPathChange=onDbPathChange;vm.onIndexPathChange=onIndexPathChange;vm.onEventingPathChange=onEventingPathChange;vm.onCbasDirsChange=onCbasDirsChange;vm.addCbasPath=addCbasPath;activate();function activate(){vm.onDbPathChange();vm.onIndexPathChange();vm.onEventingPathChange();if($scope.config.cbasDirs){$scope.config.cbasDirs.forEach(function(path,index){vm.onCbasDirsChange(index);});}}
function onDbPathChange(){vm.dbPathTotal=mnClusterConfigurationService.lookup($scope.config.dbPath,$scope.config.selfConfig.preprocessedAvailableStorage);}
function onIndexPathChange(){vm.indexPathTotal=mnClusterConfigurationService.lookup($scope.config.indexPath,$scope.config.selfConfig.preprocessedAvailableStorage);}
function onEventingPathChange(){vm.eventingPathTotal=mnClusterConfigurationService.lookup($scope.config.eventingPath,$scope.config.selfConfig.preprocessedAvailableStorage);}
function onCbasDirsChange(index){vm["cbasDirsTotal"+index]=mnClusterConfigurationService.lookup($scope.config.cbasDirs[index],$scope.config.selfConfig.preprocessedAvailableStorage);}
function addCbasPath(){var last=$scope.config.cbasDirs.length-1;vm["cbasDirsTotal"+(last+1)]=vm["cbasDirsTotal"+last];$scope.config.cbasDirs.push($scope.config.cbasDirs[last]);}}}})();(function(){"use strict";angular.module('mnDetailStats',["mnStatisticsNewService","mnStatisticsChart","mnHelper","mnStatisticsDescriptionService"]).directive('mnDetailStats',mnDetailStatsDirective);function mnDetailStatsDirective(mnStatisticsNewService,mnStatisticsDescriptionService,mnHelper){var mnDetailStats={restrict:"AE",scope:{mnTitle:"@",bucket:"@",itemId:"@",service:"@",prefix:"@",nodeName:"@?"},templateUrl:"app/components/directives/mn_detail_stats.html",controller:controller,controllerAs:"thisCtl"};return mnDetailStats;function controller($scope){var vm=this;vm.zoom="minute";vm.onSelectZoom=onSelectZoom;vm.items={};activate();function onSelectZoom(){activate();}
function getStats(stat){var rv={};rv["@"+$scope.service+"-.@items."+stat]=true;return rv;}
function activate(){mnStatisticsNewService.heartbeat.setInterval(mnStatisticsNewService.defaultZoomInterval(vm.zoom));vm.items[$scope.service]=$scope.prefix+"/"+$scope.itemId+"/";vm.charts=Object.keys(mnStatisticsDescriptionService.stats["@"+$scope.service+"-"]["@items"]).filter(function(key){return mnStatisticsDescriptionService.stats["@"+$scope.service+"-"]["@items"][key];}).map(function(stat){return{node:$scope.nodeName,preset:true,id:mnHelper.generateID(),isSpecific:false,size:"small",stats:getStats(stat)};});}}}})();(function(){"use strict";angular.module('mnField',[]).directive('mnField',mnFieldDirective);function mnFieldDirective(){var mnFieldDirective={restrict:"AE",scope:{mnName:"@",mnType:"@",mnId:"@",mnDisabled:"=",mnLabel:"@",mnErrors:"=?",mnModel:"=",mnItems:"="},templateUrl:"app/components/directives/mn_field.html",controller:controller,controllerAs:"thisCtl"};return mnFieldDirective;function controller($scope){}}})();(function(){"use strict";angular.module('mnDropdown',[]).directive('mnDropdown',mnDropdownDirective).directive('mnDropdownItem',mnDropdownItemDirective)
function mnDropdownItemDirective(){var mnDropdownItem={require:'^^mnDropdown',restrict:'E',scope:{mnItem:'='},link:link};return mnDropdownItem;function link(scope,element,attrs,mnDropdownCtl){element.on("mousedown",onMousedown);element.on("click",onItemClick);element.on("mouseup",onMouseup);scope.$on("$destroy",function(){element.off("mousedown",onMousedown);element.off("mouseup",onMouseup);element.off("click",onItemClick);});function onItemClick(){mnDropdownCtl.onItemClick(scope.mnItem);}
function onMousedown(){element.addClass("mousedowm");}
function onMouseup(){element.removeClass("mousedowm");}}}
function mnDropdownDirective($document){var mnDropdown={restrict:'E',scope:{model:"=?",onClose:"&?",onSelect:"&?",iconClass:"@?"},transclude:{'select':'?innerSelect','header':'?innerHeader','body':'innerBody','footer':'?innerFooter'},templateUrl:"app/components/directives/mn_dropdown.html",controller:controller};return mnDropdown;function controller($scope,$transclude,$timeout){$scope.toggleMenu=toggleMenu;$scope.isSlotFilled=$transclude.isSlotFilled;this.onItemClick=onItemClick;$scope.$on("$destroy",function(){$document.off('click',toggleMenu);});function closeMenu(){$scope.showMenu=false;$scope.onClose&&$scope.onClose($scope.model&&$scope.model.selected);}
function openMenu(){$scope.showMenu=true;}
function onItemClick(item){$timeout(function(){$scope.model&&($scope.model.selected=item);$scope.onSelect&&$scope.onSelect({scenario:item});toggleMenu();});}
function documentClick(){$timeout(toggleMenu);}
function toggleMenu($event){$event&&$event.stopPropagation&&$event.stopPropagation();($scope.showMenu?closeMenu:openMenu)();outsideClick();}
function outsideClick(){$document[$scope.showMenu?"on":"off"]('click',documentClick);}}}})();(function(){"use strict";angular.module("mnSelectableNodesList",["mnFilters","mnSearch"]).directive("mnSelectableNodesList",mnSelectableNodesListDirective);function mnSelectableNodesListDirective(){var mnSelectableNodesList={restrict:"A",scope:{nodes:"=",mnIsNodeDisabled:"&?",mnGroups:"=?",mnSelectedNodesHolder:"="},templateUrl:"app/components/directives/mn_selectable_nodes_list.html",controller:mnSelectableNodesListController,controllerAs:"mnThisCtl",bindToController:true};return mnSelectableNodesList;function mnSelectableNodesListController($scope){var vm=this;vm.toggleAll=toggleAll;vm.findEnabled=findEnabled;vm.getGroupName=getGroupName;vm.areAllChecked=areAllChecked;function areAllChecked(bool){return!!$scope.filteredNodes&&!!$scope.filteredNodes.length&&!findEnabled(bool);}
function getGroupName(node){return!!vm.mnGroups&&vm.mnGroups[node.hostname].name;}
function findEnabled(bool){return!!_.find($scope.filteredNodes,function(node){if(vm.mnIsNodeDisabled){return!vm.mnIsNodeDisabled({node:node})&&(!!vm.mnSelectedNodesHolder[node.otpNode]===bool);}else{return!!vm.mnSelectedNodesHolder[node.otpNode]===bool;}});}
function setEnabled(bool){$scope.filteredNodes.forEach(function(node){if(vm.mnIsNodeDisabled){if(!vm.mnIsNodeDisabled({node:node})){vm.mnSelectedNodesHolder[node.otpNode]=bool;}}else{vm.mnSelectedNodesHolder[node.otpNode]=bool;}});}
function toggleAll(){setEnabled(findEnabled(false));}}}})();(function(){"use strict";angular.module('mnBarUsage',['mnFilters']).directive('mnBarUsage',mnBarUsageDirective);function mnBarUsageDirective(mnRescaleForSumFilter,mnCalculatePercentFilter){var mnBarUsage={restrict:'A',scope:{baseInfo:'=',},isolate:false,templateUrl:'app/components/directives/mn_bar_usage/mn_bar_usage.html',controller:controller};return mnBarUsage;function controller($scope){$scope.$watch('baseInfo',function(options){if(!options){return;}
var sum=0;var newOptions=_.cloneDeep(options);var items=newOptions.items;var values=_.map(items,function(item){return Math.max(item.value,0);});var total=_.chain(values).reduce(function(sum,num){return sum+num;}).value();values=mnRescaleForSumFilter(100,values,total);_.each(values,function(item,i){var v=values[i];values[i]+=sum;newOptions.items[i].itemStyle=newOptions.items[i].itemStyle||{};newOptions.items[i].itemStyle.width=values[i]+"%";sum+=v;});newOptions.tdItems=_.select(newOptions.items,function(item){return item.name!==null;});$scope.config=newOptions;},true);}}})();(function(){"use strict";angular.module('mnElementCrane',[]).service('mnElementCraneService',mnElementCraneFactory).directive('mnElementDepot',mnElementDepotDirective).directive('mnElementCargo',mnElementCargoDirective);function mnElementCargoDirective(mnElementCraneService){var mnElementCargo={restrict:'E',link:mnElementCraneService.deliverCargo.bind(mnElementCraneService)};return mnElementCargo;}
function mnElementDepotDirective(mnElementCraneService){var mnElementCargo={restrict:'E',link:mnElementCraneService.registerDepot.bind(mnElementCraneService)};return mnElementCargo;}
function mnElementCraneFactory($timeout){var depots={};var mnElementCraneService={deliverCargo:deliverCargo,registerDepot:registerDepot};return mnElementCraneService;function registerDepot(scope,element,attrs){depots[attrs.name]=element;}
function deliverCargo(scope,element,attrs){var depotElement=depots[attrs.depot];if(depotElement){appendElement();}else{$timeout(appendElement,0);}
function appendElement(){depotElement=depotElement||depots[attrs.depot];depotElement.append(element.contents());element.remove();scope.$on('$destroy',depotElement.empty.bind(depotElement));}}}})();(function(){"use strict";angular.module('mnBucketsForm',['mnFocus','mnBucketsDetailsService','mnFilters','mnAutocompleteOff','mnPromiseHelper','mnBarUsage','mnUserRolesService','mnPermissions']).directive('mnBucketsForm',mnBucketsFormDirective);function mnBucketsFormDirective($http,mnBucketsDetailsDialogService,mnPromiseHelper,mnUserRolesService,$q,mnPermissions,$state){var mnBucketsForm={restrict:'A',scope:{bucketConf:'=',autoCompactionSettings:'=',validation:'=',poolDefault:'=?',pools:'=',rbac:'=',uibModal:'=?'},isolate:false,replace:true,templateUrl:'app/components/directives/mn_buckets_form/mn_buckets_form.html',controller:controller};return mnBucketsForm;function threadsEvictionWarning(scope,value){var initialValue=scope.bucketConf[value];scope.$watch('bucketConf.'+value,function(newValue){if(initialValue!=newValue){scope[value+'Warning']='Changing '+(value==='evictionPolicy'?'eviction policy':'bucket priority')+' will restart the bucket. This will lead to closing all open connections and some downtime';}else{scope[value+'Warning']=''}});}
function getBucketName($scope){return $scope.bucketConf.isNew?".":$scope.bucketConf.name;}
function controller($scope){$scope.goToUsersPage=function(){$scope.uibModal.dismiss();$state.go("app.admin.security.roles.user");};$scope.replicaNumberEnabled=$scope.bucketConf.replicaNumber!=0;$scope.canChangeBucketsSettings=$scope.bucketConf.isNew;if($scope.rbac&&$scope.rbac.cluster.admin.security.read){mnPermissions.getBucketPermissions(getBucketName($scope)).then(function(permissions){var queries=permissions.map(function(permission){return mnUserRolesService.getUsers({permission:permission,pageSize:4});});return $q.all(queries).then(function(resps){var uniqUsers={};resps.forEach(function(resp){resp.data.users.forEach(function(user){var name="";if(user.id.length>16){name+=(user.id.substring(0,16)+"...");}else{name+=user.id;}
name+=(" ("+(user.domain==="local"?"couchbase":user.domain)+")");uniqUsers[user.domain+user.id]=name;});});$scope.users=_.values(uniqUsers);});});}
$scope.$watch('replicaNumberEnabled',function(isEnabled){if(!isEnabled){$scope.bucketConf.replicaNumber=0;$scope.bucketConf.replicaIndex=0;}else{$scope.bucketConf.replicaNumber=Number($scope.bucketConf.replicaNumber)||1;}});if(!$scope.bucketConf.isNew&&!$scope.bucketConf.isWizard){threadsEvictionWarning($scope,'threadsNumber');threadsEvictionWarning($scope,'evictionPolicy');}
function adaptValidationResult(resp){return mnBucketsDetailsDialogService.adaptValidationResult(resp.data);}
$scope.$watch(function(){return{bucketConf:$scope.bucketConf,autoCompactionSettings:$scope.autoCompactionSettings};},function(values){var bucketConf=values.bucketConf;var autoCompactionSettings=values.autoCompactionSettings;mnPromiseHelper($scope,$http({method:'POST',url:bucketConf.uri,data:mnBucketsDetailsDialogService.prepareBucketConfigForSaving(bucketConf,autoCompactionSettings,$scope.poolDefault,$scope.pools),params:{just_validate:1,ignore_warnings:$scope.bucketConf.ignoreWarnings?1:0}})).getPromise().then(adaptValidationResult,adaptValidationResult).then(function(result){$scope.validation.result=result;});},true);}}})();(function(){"use strict";angular.module('mnAutoCompactionForm',['mnPeriod']).directive('mnAutoCompactionForm',mnAutoCompactionFormDirective);function mnAutoCompactionFormDirective($http,daysOfWeek,mnPermissions,mnPoolDefault,mnPromiseHelper,mnSettingsClusterService){var mnAutoCompactionForm={restrict:'A',scope:{autoCompactionSettings:'=',validationErrors:'=',isBucketsSettings:'='},isolate:false,replace:true,templateUrl:'app/components/directives/mn_auto_compaction_form/mn_auto_compaction_form.html',controller:controller};function controller($scope){$scope.daysOfWeek=daysOfWeek;$scope.rbac=mnPermissions.export;$scope.poolDefault=mnPoolDefault.export;$scope.maybeDisableTimeInterval=maybeDisableTimeInterval;$scope.props={};if($scope.rbac.cluster.settings.indexes.read){mnPromiseHelper($scope,mnSettingsClusterService.getIndexSettings()).applyToScope(function(indexSettings){$scope.indexSettings=indexSettings;maybeDisableTimeInterval();});}
function isFragmentationProvided(value){return(value.percentageFlag&&value.percentage)||(value.sizeFlag&&value.size);}
function maybeDisableTimeInterval(){$scope.props.isFragmentationProvided=isFragmentationProvided($scope.autoCompactionSettings.databaseFragmentationThreshold)||isFragmentationProvided($scope.autoCompactionSettings.viewFragmentationThreshold);if(!$scope.props.isFragmentationProvided){$scope.autoCompactionSettings.allowedTimePeriodFlag=false;}}}
return mnAutoCompactionForm;}})();(function(){"use strict";angular.module('mnPeriod',[]).directive('mnPeriod',mnPeriodDirective);function mnPeriodDirective(){var mnPeriod={restrict:'A',scope:{mnPeriod:"@",autoCompactionSettings:'=',errors:"=",rbac:"="},templateUrl:'app/components/directives/mn_period/mn_period.html'};return mnPeriod;}})();(function(){"use strict";angular.module('mnMinlength',[]).directive('mnMinlength',mnMinlengthDirective);function mnMinlengthDirective(){var mnMinlength={restrict:'A',require:'ngModel',link:link};return mnMinlength;function link(scope,element,attrs,ctrl){ctrl.$parsers.unshift(function(value){var min=attrs.mnMinlength;ctrl.$setValidity('mnMinlength',min&&value&&value.length>=parseInt(min));return value;});}}})();(function(){"use strict";angular.module('mnMaxlength',[]).directive('mnMaxlength',mnMaxlengthDirective);function mnMaxlengthDirective(){var mnMaxlength={restrict:'A',require:'ngModel',link:link};return mnMaxlength;function link(scope,element,attrs,ctrl){ctrl.$parsers.unshift(function(value){var max=attrs.mnMaxlength;ctrl.$setValidity('mnMaxlength',max&&value&&value.length<=parseInt(max));return value;});}}})();(function(){"use strict";angular.module('mnEqual',[]).directive('mnEqual',mnEqualDirective);function mnEqualDirective(){var mnEqual={restrict:'A',require:'ngModel',link:link};return mnEqual;function link(scope,element,attrs,ctrl){function validate(value){ctrl.$setValidity('mnEqual',(value===undefined?"":value)===attrs.mnEqual);return value;};ctrl.$parsers.unshift(validate);ctrl.$formatters.push(validate);attrs.$observe('mnEqual',function(){return validate(ctrl.$viewValue);});}}})();(function(){"use strict";angular.module('mnWarmupProgress',[]).directive('mnWarmupProgress',mnWarmupProgressDirective).filter('formatWarmupMessage',formatWarmupMessageFilter);function mnWarmupProgressDirective(){var mnWarmupProgress={restrict:'A',scope:{warmUpTasks:'=',sortBy:'@'},replace:true,templateUrl:'app/components/directives/mn_warmup_progress/mn_warmup_progress.html'};return mnWarmupProgress;}
function formatWarmupMessageFilter(){return function(task){var message=task.stats.ep_warmup_state;switch(message){case"loading keys":return message+" ("+task.stats.ep_warmup_key_count+" / "+task.stats.ep_warmup_estimated_key_count+")";case"loading data":return message+" ("+task.stats.ep_warmup_value_count+" / "+task.stats.ep_warmup_estimated_value_count+")";default:return message;}};}})();(function(){"use strict";angular.module('mnFocus',[]).directive('mnFocus',mnFocusDirective);function mnFocusDirective($parse){var mnFocus={link:link};return mnFocus;function link($scope,$element,$attrs){if($attrs.mnFocus===""){return $element[0].focus();}
var getter=$parse($attrs.mnFocus);var setter=getter.assign;$scope.$watch($attrs.mnFocus,function(focus){focus&&$element[0].focus();});if(setter){var handler=function handler(){setter($scope,false);}
$element.on('blur',handler);$scope.$on('$destroy',function(){$element.off('blur',handler);})}}}})();(function(){"use strict";angular.module('mnAutocompleteOff',[]).directive('mnAutocompleteOff',mnAutocompleteOff);function mnAutocompleteOff($rootScope){var autocompleteOff={link:link};return autocompleteOff;function link($scope,$element,$attr){if($attr.mnAutocompleteOff==="enforce"||!$rootScope.ENV||$rootScope.ENV.disable_autocomplete){var input=angular.element('<input style="display:none" readonly disabled autocomplete="off">');input.attr("type",$attr.type);input.attr("name",$attr.name);$element.parent()[0].insertBefore(input[0],$element[0]);$element.attr('autocomplete','off');$element.attr('readonly',true);var onFocus=function onFocus(){$element.attr('readonly',false);}
$element.on('focus',onFocus);$scope.$on("$destroy",function(){$element.off('focus',onFocus);});}}}})();(function(){"use strict";angular.module('mnSpinner',[]).directive('mnSpinner',mnSpinnerDirective);function mnSpinnerDirective($compile){var directive={restrict:'A',scope:{mnSpinner:'=',minHeight:'@',opacity:'@'},link:link};return directive;function link($scope,$element){var spinner=angular.element("<div class=\"spinner\" ng-show=\"mnSpinner\"></div>");if($scope.opacity){spinner.addClass("opacity");}
if($scope.minHeight){spinner.css({minHeight:$scope.minHeight});}
$element.addClass("relative");$element.append($compile(spinner)($scope));}}})();(function(){"use strict";var insertSteps;var i;angular.module('mnPlot',['mnJquery','mnFilters']).directive('mnPlot',function(mnPrepareQuantityFilter,mnTruncateTo3DigitsFilter,jQuery){(function(){jQuery.color={};jQuery.color.make=function(E,D,B,C){var F={};F.r=E||0;F.g=D||0;F.b=B||0;F.a=C!=null?C:1;F.add=function(I,H){for(var G=0;G<I.length;++G){F[I.charAt(G)]+=H}return F.normalize()};F.scale=function(I,H){for(var G=0;G<I.length;++G){F[I.charAt(G)]*=H}return F.normalize()};F.toString=function(){if(F.a>=1){return"rgb("+[F.r,F.g,F.b].join(",")+")"}else{return"rgba("+[F.r,F.g,F.b,F.a].join(",")+")"}};F.normalize=function(){function G(I,J,H){return J<I?I:(J>H?H:J)}F.r=G(0,parseInt(F.r),255);F.g=G(0,parseInt(F.g),255);F.b=G(0,parseInt(F.b),255);F.a=G(0,F.a,1);return F};F.clone=function(){return jQuery.color.make(F.r,F.b,F.g,F.a)};return F.normalize()};jQuery.color.extract=function(C,B){var D;do{D=C.css(B).toLowerCase();if(D!=""&&D!="transparent"){break}C=C.parent()}while(!jQuery.nodeName(C.get(0),"body"));if(D=="rgba(0, 0, 0, 0)"){D="transparent"}return jQuery.color.parse(D)};jQuery.color.parse=function(E){var D,B=jQuery.color.make;if(D=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(E)){return B(parseInt(D[1],10),parseInt(D[2],10),parseInt(D[3],10))}if(D=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(E)){return B(parseInt(D[1],10),parseInt(D[2],10),parseInt(D[3],10),parseFloat(D[4]))}if(D=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(E)){return B(parseFloat(D[1])*2.55,parseFloat(D[2])*2.55,parseFloat(D[3])*2.55)}if(D=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(E)){return B(parseFloat(D[1])*2.55,parseFloat(D[2])*2.55,parseFloat(D[3])*2.55,parseFloat(D[4]))}if(D=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(E)){return B(parseInt(D[1],16),parseInt(D[2],16),parseInt(D[3],16))}if(D=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(E)){return B(parseInt(D[1]+D[1],16),parseInt(D[2]+D[2],16),parseInt(D[3]+D[3],16))}var C=jQuery.trim(E).toLowerCase();if(C=="transparent"){return B(255,255,255,0)}else{D=A[C];return B(D[0],D[1],D[2])}};var A={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})();(function($){function Plot(placeholder,data_,options_,plugins){var series=[],options={colors:["#b3cfef","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:true,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:0.85},xaxis:{mode:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,twelveHourClock:false},yaxis:{autoscaleMargin:0.02},x2axis:{autoscaleMargin:null},y2axis:{autoscaleMargin:0.02},series:{points:{show:false,radius:3,lineWidth:2,fill:true,fillColor:"#ffffff"},lines:{lineWidth:2,fill:false,fillColor:null,steps:false},bars:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,align:"left",horizontal:false},shadowSize:3},grid:{show:true,aboveData:false,color:"#545454",backgroundColor:null,tickColor:"rgba(0,0,0,0.15)",labelMargin:5,borderWidth:2,borderColor:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:false,hoverable:false,autoHighlight:true,mouseActiveRadius:10},hooks:{}},canvas=null,overlay=null,eventHolder=null,ctx=null,octx=null,axes={xaxis:{},yaxis:{}},plotOffset={left:0,right:0,top:0,bottom:0},canvasWidth=0,canvasHeight=0,plotWidth=0,plotHeight=0,hooks={processOptions:[],processRawData:[],processDatapoints:[],draw:[],bindEvents:[],drawOverlay:[]},plot=this;plot.setData=setData;plot.setupGrid=setupGrid;plot.draw=draw;plot.getPlaceholder=function(){return placeholder;};plot.getCanvas=function(){return canvas;};plot.getPlotOffset=function(){return plotOffset;};plot.width=function(){return plotWidth;};plot.height=function(){return plotHeight;};plot.offset=function(){var o=eventHolder.offset();o.left+=plotOffset.left;o.top+=plotOffset.top;return o;};plot.getData=function(){return series;};plot.getAxes=function(){return axes;};plot.getOptions=function(){return options;};plot.highlight=highlight;plot.unhighlight=unhighlight;plot.triggerRedrawOverlay=triggerRedrawOverlay;plot.pointOffset=function(point){return{left:parseInt(axisSpecToRealAxis(point,"xaxis").p2c(+point.x)+plotOffset.left),top:parseInt(axisSpecToRealAxis(point,"yaxis").p2c(+point.y)+plotOffset.top)};};plot.hooks=hooks;initPlugins(plot);parseOptions(options_);constructCanvas();setData(data_);setupGrid();draw();bindEvents();function executeHooks(hook,args){args=[plot].concat(args);for(var i=0;i<hook.length;++i)
hook[i].apply(this,args);}
function initPlugins(){for(var i=0;i<plugins.length;++i){var p=plugins[i];p.init(plot);if(p.options)
$.extend(true,options,p.options);}}
function parseOptions(opts){$.extend(true,options,opts);if(options.grid.borderColor==null)
options.grid.borderColor=options.grid.color;if(options.xaxis.noTicks&&options.xaxis.ticks==null)
options.xaxis.ticks=options.xaxis.noTicks;if(options.yaxis.noTicks&&options.yaxis.ticks==null)
options.yaxis.ticks=options.yaxis.noTicks;if(options.grid.coloredAreas)
options.grid.markings=options.grid.coloredAreas;if(options.grid.coloredAreasColor)
options.grid.markingsColor=options.grid.coloredAreasColor;if(options.lines)
$.extend(true,options.series.lines,options.lines);if(options.points)
$.extend(true,options.series.points,options.points);if(options.bars)
$.extend(true,options.series.bars,options.bars);if(options.shadowSize)
options.series.shadowSize=options.shadowSize;for(var n in hooks)
if(options.hooks[n]&&options.hooks[n].length)
hooks[n]=hooks[n].concat(options.hooks[n]);executeHooks(hooks.processOptions,[options]);}
function setData(d){series=parseData(d);fillInSeriesOptions();processData();}
function parseData(d){var res=[];for(var i=0;i<d.length;++i){var s=$.extend(true,{},options.series);if(d[i].data){s.data=d[i].data;delete d[i].data;$.extend(true,s,d[i]);d[i].data=s.data;}
else
s.data=d[i];res.push(s);}
return res;}
function axisSpecToRealAxis(obj,attr){var a=obj[attr];if(!a||a==1)
return axes[attr];if(typeof a=="number")
return axes[attr.charAt(0)+a+attr.slice(1)];return a;}
function fillInSeriesOptions(){var i;var neededColors=series.length,usedColors=[],assignedColors=[];for(i=0;i<series.length;++i){var sc=series[i].color;if(sc!=null){--neededColors;if(typeof sc=="number")
assignedColors.push(sc);else
usedColors.push($.color.parse(series[i].color));}}
for(i=0;i<assignedColors.length;++i){neededColors=Math.max(neededColors,assignedColors[i]+1);}
var colors=[],variation=0;i=0;while(colors.length<neededColors){var c;if(options.colors.length==i)
c=$.color.make(100,100,100);else
c=$.color.parse(options.colors[i]);var sign=variation%2==1?-1:1;c.scale('rgb',1+sign*Math.ceil(variation/2)*0.2)
colors.push(c);++i;if(i>=options.colors.length){i=0;++variation;}}
var colori=0,s;for(i=0;i<series.length;++i){s=series[i];if(s.color==null){s.color=colors[colori].toString();++colori;}
else if(typeof s.color=="number")
s.color=colors[s.color].toString();if(s.lines.show==null){var v,show=true;for(v in s)
if(s[v]&&s[v].show){show=false;break;}
if(show)
s.lines.show=true;}
s.xaxis=axisSpecToRealAxis(s,"xaxis");s.yaxis=axisSpecToRealAxis(s,"yaxis");}}
function processData(){var topSentry=Number.POSITIVE_INFINITY,bottomSentry=Number.NEGATIVE_INFINITY,i,j,k,m,length,s,points,ps,x,y,axis,val,f,p;for(axis in axes){axes[axis].datamin=topSentry;axes[axis].datamax=bottomSentry;axes[axis].used=false;}
function updateAxis(axis,min,max){if(min<axis.datamin)
axis.datamin=min;if(max>axis.datamax)
axis.datamax=max;}
for(i=0;i<series.length;++i){s=series[i];s.datapoints={points:new Array(s.data.length*2)};executeHooks(hooks.processRawData,[s,s.data,s.datapoints]);}
for(i=0;i<series.length;++i){s=series[i];var data=s.data,format=s.datapoints.format;if(!format){format=[];format.push({x:true,number:true,required:true});format.push({y:true,number:true,required:true});if(s.bars.show||(s.lines.show&&s.lines.fill))
format.push({y:true,number:true,required:false,defaultValue:0});s.datapoints.format=format;}
if(s.datapoints.pointsize!=null)
continue;if(s.datapoints.pointsize==null)
s.datapoints.pointsize=format.length;ps=s.datapoints.pointsize;points=s.datapoints.points;insertSteps=s.lines.show&&s.lines.steps;s.xaxis.used=s.yaxis.used=true;for(j=k=0;j<data.length;++j,k+=ps){p=data[j];var nullify=p==null;if(!nullify){for(m=0;m<ps;++m){val=p[m];f=format[m];if(f){if(f.number&&val!=null){val=+val;if(isNaN(val))
val=null;}
if(val==null){if(f.required)
nullify=true;if(f.defaultValue!=null)
val=f.defaultValue;}}
points[k+m]=val;}}
if(nullify){for(m=0;m<ps;++m){val=points[k+m];if(val!=null){f=format[m];if(f.x)
updateAxis(s.xaxis,val,val);if(f.y)
updateAxis(s.yaxis,val,val);}
points[k+m]=null;}}
else{if(insertSteps&&k>0&&points[k-ps]!=null&&points[k-ps]!=points[k]&&points[k-ps+1]!=points[k+1]){for(m=0;m<ps;++m)
points[k+ps+m]=points[k+m];points[k+1]=points[k-ps+1];k+=ps;}}}}
for(i=0;i<series.length;++i){s=series[i];executeHooks(hooks.processDatapoints,[s,s.datapoints]);}
for(i=0;i<series.length;++i){s=series[i];points=s.datapoints.points,ps=s.datapoints.pointsize;var xmin=topSentry,ymin=topSentry,xmax=bottomSentry,ymax=bottomSentry;for(j=0;j<points.length;j+=ps){if(points[j]==null)
continue;for(m=0;m<ps;++m){val=points[j+m];f=format[m];if(!f)
continue;if(f.x){if(val<xmin)
xmin=val;if(val>xmax)
xmax=val;}
if(f.y){if(val<ymin)
ymin=val;if(val>ymax)
ymax=val;}}}
if(s.bars.show){var delta=s.bars.align=="left"?0:-s.bars.barWidth/2;if(s.bars.horizontal){ymin+=delta;ymax+=delta+s.bars.barWidth;}
else{xmin+=delta;xmax+=delta+s.bars.barWidth;}}
updateAxis(s.xaxis,xmin,xmax);updateAxis(s.yaxis,ymin,ymax);}
for(axis in axes){if(axes[axis].datamin==topSentry)
axes[axis].datamin=null;if(axes[axis].datamax==bottomSentry)
axes[axis].datamax=null;}}
function constructCanvas(){function makeCanvas(width,height){var c=document.createElement('canvas');c.width=width;c.height=height;if(window.G_vmlCanvasManager)
c=window.G_vmlCanvasManager.initElement(c);return c;}
var checkCanvas=placeholder.children('canvas');if(checkCanvas.length){canvas=checkCanvas.get(0);ctx=canvas.getContext('2d');overlay=checkCanvas.get(1);octx=overlay.getContext('2d');canvasWidth=canvas.width;canvasHeight=canvas.height;if(true){ctx.clearRect(0,0,canvasWidth,canvasHeight);octx.clearRect(0,0,canvasWidth,canvasHeight);unbindEvents();return;}}
{canvasWidth=placeholder.width();canvasHeight=placeholder.height();placeholder.get(0).innerHTML='';if(placeholder.css("position")=='static')
placeholder.css("position","relative");if(canvasWidth<=0||canvasHeight<=0)
throw"Invalid dimensions for plot, width = "+canvasWidth+", height = "+canvasHeight;if(window.G_vmlCanvasManager)
window.G_vmlCanvasManager.init_(document);canvas=$(makeCanvas(canvasWidth,canvasHeight)).appendTo(placeholder).get(0);ctx=canvas.getContext("2d");overlay=$(makeCanvas(canvasWidth,canvasHeight)).css({position:'absolute',left:0,top:0}).appendTo(placeholder).get(0);octx=overlay.getContext("2d");octx.stroke();}}
function bindEvents(){eventHolder=$([overlay,canvas]);if(options.grid.hoverable)
eventHolder.mousemove(onMouseMove);if(options.grid.clickable)
eventHolder.click(onClick);executeHooks(hooks.bindEvents,[eventHolder]);}
function unbindEvents(){eventHolder=$([overlay,canvas]);eventHolder.unbind();}
function setupGrid(){function setTransformationHelpers(axis,o){function identity(x){return x;}
var s,m,t=o.transform||identity,it=o.inverseTransform;if(axis==axes.xaxis||axis==axes.x2axis){s=axis.scale=plotWidth/(t(axis.max)-t(axis.min));m=t(axis.min);if(t==identity)
axis.p2c=function(p){return(p-m)*s;};else
axis.p2c=function(p){return(t(p)-m)*s;};if(!it)
axis.c2p=function(c){return m+c/s;};else
axis.c2p=function(c){return it(m+c/s);};}
else{s=axis.scale=plotHeight/(t(axis.max)-t(axis.min));m=t(axis.max);if(t==identity)
axis.p2c=function(p){return(m-p)*s;};else
axis.p2c=function(p){return(m-t(p))*s;};if(!it)
axis.c2p=function(c){return m-c/s;};else
axis.c2p=function(c){return it(m-c/s);};}}
function measureLabels(axis,axisOptions){var i,labels=[],l;axis.labelWidth=axisOptions.labelWidth;axis.labelHeight=axisOptions.labelHeight;if(axis==axes.xaxis||axis==axes.x2axis){if(axis.labelWidth==null)
axis.labelWidth=canvasWidth/(axis.ticks.length>0?axis.ticks.length:1);if(axis.labelHeight==null){labels=[];for(i=0;i<axis.ticks.length;++i){l=axis.ticks[i].label;if(l)
labels.push('<div class="tickLabel" style="float:left;width:'+axis.labelWidth+'px">'+l+'</div>');}
if(labels.length>0){var dummyDiv=$('<div style="position:absolute;top:-10000px;width:10000px;font-size:smaller">'
+labels.join("")+'<div style="clear:left"></div></div>').appendTo(placeholder);axis.labelHeight=dummyDiv.height();dummyDiv.remove();}}}
else if(axis.labelWidth==null||axis.labelHeight==null){for(i=0;i<axis.ticks.length;++i){l=axis.ticks[i].label;if(l)
labels.push('<div class="tickLabel">'+l+'</div>');}
if(labels.length>0){var dummyDiv=$('<div style="position:absolute;top:-10000px;font-size:smaller">'
+labels.join("")+'</div>').appendTo(placeholder);if(axis.labelWidth==null)
axis.labelWidth=dummyDiv.width();if(axis.labelHeight==null)
axis.labelHeight=dummyDiv.find("div").height();dummyDiv.remove();}}
if(axis.labelWidth==null)
axis.labelWidth=0;if(axis.labelHeight==null)
axis.labelHeight=0;}
function setGridSpacing(){var maxOutset=options.grid.borderWidth;for(i=0;i<series.length;++i)
maxOutset=Math.max(maxOutset,2*(series[i].points.radius+series[i].points.lineWidth/2));plotOffset.left=plotOffset.right=plotOffset.top=plotOffset.bottom=maxOutset;var margin=options.grid.labelMargin+options.grid.borderWidth;if(axes.xaxis.labelHeight>0)
plotOffset.bottom=Math.max(maxOutset,axes.xaxis.labelHeight+margin);if(axes.yaxis.labelWidth>0)
plotOffset.left=Math.max(maxOutset,axes.yaxis.labelWidth+margin);plotWidth=canvasWidth-plotOffset.left-plotOffset.right;plotHeight=canvasHeight-plotOffset.bottom-plotOffset.top;}
var axis;for(axis in axes)
setRange(axes[axis],options[axis]);if(options.grid.show){for(axis in axes){prepareTickGeneration(axes[axis],options[axis]);setTicks(axes[axis],options[axis]);measureLabels(axes[axis],options[axis]);}
setGridSpacing();}
else{plotOffset.left=plotOffset.right=plotOffset.top=plotOffset.bottom=0;plotWidth=canvasWidth;plotHeight=canvasHeight;}
for(axis in axes)
setTransformationHelpers(axes[axis],options[axis]);if(options.grid.show)
insertLabels();insertLegend();}
function setRange(axis,axisOptions){var min=+(axisOptions.min!=null?axisOptions.min:axis.datamin),max=+(axisOptions.max!=null?axisOptions.max:axis.datamax),delta=max-min;if(delta==0.0){var widen=max==0?1:0.01;if(axisOptions.min==null)
min-=widen;if(axisOptions.max==null||axisOptions.min!=null)
max+=widen;}
else{var margin=axisOptions.autoscaleMargin;if(margin!=null){if(axisOptions.min==null){min-=delta*margin;if(min<0&&axis.datamin!=null&&axis.datamin>=0)
min=0;}
if(axisOptions.max==null){max+=delta*margin;if(max>0&&axis.datamax!=null&&axis.datamax<=0)
max=0;}}}
axis.min=min;axis.max=max;}
function prepareTickGeneration(axis,axisOptions){var noTicks;if(typeof axisOptions.ticks=="number"&&axisOptions.ticks>0)
noTicks=axisOptions.ticks;else if(axis==axes.xaxis||axis==axes.x2axis)
noTicks=0.3*Math.sqrt(canvasWidth);else
noTicks=0.3*Math.sqrt(canvasHeight);var delta=(axis.max-axis.min)/noTicks,size,generator,unit,formatter,i,magn,norm;if(axisOptions.mode=="time"){var timeUnitSize={"second":1000,"minute":60*1000,"hour":60*60*1000,"day":24*60*60*1000,"month":30*24*60*60*1000,"year":365.2425*24*60*60*1000};var spec=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[15,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[15,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[0.25,"month"],[0.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]];var minSize=0;if(axisOptions.minTickSize!=null){if(typeof axisOptions.tickSize=="number")
minSize=axisOptions.tickSize;else
minSize=axisOptions.minTickSize[0]*timeUnitSize[axisOptions.minTickSize[1]];}
for(i=0;i<spec.length-1;++i)
if(delta<(spec[i][0]*timeUnitSize[spec[i][1]]
+spec[i+1][0]*timeUnitSize[spec[i+1][1]])/2&&spec[i][0]*timeUnitSize[spec[i][1]]>=minSize)
break;size=spec[i][0];unit=spec[i][1];if(unit=="year"){magn=Math.pow(10,Math.floor(Math.log(delta/timeUnitSize.year)/Math.LN10));norm=(delta/timeUnitSize.year)/magn;if(norm<1.5)
size=1;else if(norm<3)
size=2;else if(norm<7.5)
size=5;else
size=10;size*=magn;}
if(axisOptions.tickSize){size=axisOptions.tickSize[0];unit=axisOptions.tickSize[1];}
generator=function(axis){var ticks=[],tickSize=axis.tickSize[0],unit=axis.tickSize[1],d=new Date(axis.min);var step=tickSize*timeUnitSize[unit];if(unit=="second")
d.setUTCSeconds(floorInBase(d.getUTCSeconds(),tickSize));if(unit=="minute")
d.setUTCMinutes(floorInBase(d.getUTCMinutes(),tickSize));if(unit=="hour")
d.setUTCHours(floorInBase(d.getUTCHours(),tickSize));if(unit=="month")
d.setUTCMonth(floorInBase(d.getUTCMonth(),tickSize));if(unit=="year")
d.setUTCFullYear(floorInBase(d.getUTCFullYear(),tickSize));d.setUTCMilliseconds(0);if(step>=timeUnitSize.minute)
d.setUTCSeconds(0);if(step>=timeUnitSize.hour)
d.setUTCMinutes(0);if(step>=timeUnitSize.day)
d.setUTCHours(0);if(step>=timeUnitSize.day*4)
d.setUTCDate(1);if(step>=timeUnitSize.year)
d.setUTCMonth(0);var carry=0,v=Number.NaN,prev;do{prev=v;v=d.getTime();ticks.push({v:v,label:axis.tickFormatter(v,axis)});if(unit=="month"){if(tickSize<1){d.setUTCDate(1);var start=d.getTime();d.setUTCMonth(d.getUTCMonth()+1);var end=d.getTime();d.setTime(v+carry*timeUnitSize.hour+(end-start)*tickSize);carry=d.getUTCHours();d.setUTCHours(0);}
else
d.setUTCMonth(d.getUTCMonth()+tickSize);}
else if(unit=="year"){d.setUTCFullYear(d.getUTCFullYear()+tickSize);}
else
d.setTime(v+step);}while(v<axis.max&&v!=prev);return ticks;};formatter=function(v,axis){var d=new Date(v);if(axisOptions.timeformat!=null)
return $.plot.formatDate(d,axisOptions.timeformat,axisOptions.monthNames);var t=axis.tickSize[0]*timeUnitSize[axis.tickSize[1]];var span=axis.max-axis.min;var suffix=(axisOptions.twelveHourClock)?" %p":"";if(t<timeUnitSize.minute)
fmt="%h:%M:%S"+suffix;else if(t<timeUnitSize.day){if(span<2*timeUnitSize.day)
fmt="%h:%M"+suffix;else
fmt="%b %d %h:%M"+suffix;}
else if(t<timeUnitSize.month)
fmt="%b %d";else if(t<timeUnitSize.year){if(span<timeUnitSize.year)
fmt="%b";else
fmt="%b %y";}
else
fmt="%y";return $.plot.formatDate(d,fmt,axisOptions.monthNames);};}
else{var maxDec=axisOptions.tickDecimals;var dec=-Math.floor(Math.log(delta)/Math.LN10);if(maxDec!=null&&dec>maxDec)
dec=maxDec;magn=Math.pow(10,-dec);norm=delta/magn;if(norm<1.5)
size=1;else if(norm<3){size=2;if(norm>2.25&&(maxDec==null||dec+1<=maxDec)){size=2.5;++dec;}}
else if(norm<7.5)
size=5;else
size=10;size*=magn;if(axisOptions.minTickSize!=null&&size<axisOptions.minTickSize)
size=axisOptions.minTickSize;if(axisOptions.tickSize!=null)
size=axisOptions.tickSize;axis.tickDecimals=Math.max(0,(maxDec!=null)?maxDec:dec);generator=function(axis){var ticks=[];var start=floorInBase(axis.min,axis.tickSize),i=0,v=Number.NaN,prev;do{prev=v;v=start+i*axis.tickSize;ticks.push({v:v,label:axis.tickFormatter(v,axis)});++i;}while(v<axis.max&&v!=prev);return ticks;};formatter=function(v,axis){return v.toFixed(axis.tickDecimals);};}
axis.tickSize=unit?[size,unit]:size;axis.tickGenerator=generator;if($.isFunction(axisOptions.tickFormatter))
axis.tickFormatter=function(v,axis){return""+axisOptions.tickFormatter(v,axis);};else
axis.tickFormatter=formatter;}
function setTicks(axis,axisOptions){axis.ticks=[];if(!axis.used)
return;if(axisOptions.ticks==null)
axis.ticks=axis.tickGenerator(axis);else if(typeof axisOptions.ticks=="number"){if(axisOptions.ticks>0)
axis.ticks=axis.tickGenerator(axis);}
else if(axisOptions.ticks){var ticks=axisOptions.ticks;if($.isFunction(ticks))
ticks=ticks({min:axis.min,max:axis.max});var i,v;for(i=0;i<ticks.length;++i){var label=null;var t=ticks[i];if(typeof t=="object"){v=t[0];if(t.length>1)
label=t[1];}
else
v=t;if(label==null)
label=axis.tickFormatter(v,axis);axis.ticks[i]={v:v,label:label};}}
if(axisOptions.autoscaleMargin!=null&&axis.ticks.length>0){if(axisOptions.min==null)
axis.min=Math.min(axis.min,axis.ticks[0].v);if(axisOptions.max==null&&axis.ticks.length>1)
axis.max=Math.max(axis.max,axis.ticks[axis.ticks.length-1].v);}}
function draw(){ctx.clearRect(0,0,canvasWidth,canvasHeight);var grid=options.grid;if(grid.show&&!grid.aboveData)
drawGrid();for(var i=0;i<series.length;++i)
drawSeries(series[i]);executeHooks(hooks.draw,[ctx]);if(grid.show&&grid.aboveData)
drawGrid();}
function extractRange(ranges,coord){var firstAxis=coord+"axis",secondaryAxis=coord+"2axis",axis,from,to,reverse;if(ranges[firstAxis]){axis=axes[firstAxis];from=ranges[firstAxis].from;to=ranges[firstAxis].to;}
else if(ranges[secondaryAxis]){axis=axes[secondaryAxis];from=ranges[secondaryAxis].from;to=ranges[secondaryAxis].to;}
else{axis=axes[firstAxis];from=ranges[coord+"1"];to=ranges[coord+"2"];}
if(from!=null&&to!=null&&from>to)
return{from:to,to:from,axis:axis};return{from:from,to:to,axis:axis};}
function drawGrid(){var i;ctx.save();ctx.translate(plotOffset.left,plotOffset.top);if(options.grid.backgroundColor){ctx.fillStyle=getColorOrGradient(options.grid.backgroundColor,plotHeight,0,"rgba(255, 255, 255, 0)");ctx.fillRect(0,0,plotWidth,plotHeight);}
var markings=options.grid.markings;if(markings){if($.isFunction(markings))
markings=markings({xmin:axes.xaxis.min,xmax:axes.xaxis.max,ymin:axes.yaxis.min,ymax:axes.yaxis.max,xaxis:axes.xaxis,yaxis:axes.yaxis,x2axis:axes.x2axis,y2axis:axes.y2axis});for(i=0;i<markings.length;++i){var m=markings[i],xrange=extractRange(m,"x"),yrange=extractRange(m,"y");if(xrange.from==null)
xrange.from=xrange.axis.min;if(xrange.to==null)
xrange.to=xrange.axis.max;if(yrange.from==null)
yrange.from=yrange.axis.min;if(yrange.to==null)
yrange.to=yrange.axis.max;if(xrange.to<xrange.axis.min||xrange.from>xrange.axis.max||yrange.to<yrange.axis.min||yrange.from>yrange.axis.max)
continue;xrange.from=Math.max(xrange.from,xrange.axis.min);xrange.to=Math.min(xrange.to,xrange.axis.max);yrange.from=Math.max(yrange.from,yrange.axis.min);yrange.to=Math.min(yrange.to,yrange.axis.max);if(xrange.from==xrange.to&&yrange.from==yrange.to)
continue;xrange.from=xrange.axis.p2c(xrange.from);xrange.to=xrange.axis.p2c(xrange.to);yrange.from=yrange.axis.p2c(yrange.from);yrange.to=yrange.axis.p2c(yrange.to);if(xrange.from==xrange.to||yrange.from==yrange.to){ctx.beginPath();ctx.strokeStyle=m.color||options.grid.markingsColor;ctx.lineWidth=m.lineWidth||options.grid.markingsLineWidth;ctx.moveTo(xrange.from,yrange.from);ctx.lineTo(xrange.to,yrange.to);ctx.stroke();}
else{ctx.fillStyle=m.color||options.grid.markingsColor;ctx.fillRect(xrange.from,yrange.to,xrange.to-xrange.from,yrange.from-yrange.to);}}}
ctx.lineWidth=1;ctx.strokeStyle=options.grid.tickColor;ctx.beginPath();var v,axis=axes.xaxis,bw=options.grid.borderWidth;for(i=0;i<axis.ticks.length;++i){v=axis.ticks[i].v;if(v<axis.min||v>axis.max||(bw>0&&(v==axis.min||v==axis.max)))
continue;ctx.moveTo(Math.floor(axis.p2c(v))+ctx.lineWidth/2,0);ctx.lineTo(Math.floor(axis.p2c(v))+ctx.lineWidth/2,plotHeight);}
axis=axes.yaxis;for(i=0;i<axis.ticks.length;++i){v=axis.ticks[i].v;if(v<axis.min||v>axis.max||(bw>0&&(v==axis.min||v==axis.max)))
continue;ctx.moveTo(0,Math.floor(axis.p2c(v))+ctx.lineWidth/2);ctx.lineTo(plotWidth,Math.floor(axis.p2c(v))+ctx.lineWidth/2);}
ctx.stroke();if(options.grid.borderWidth){ctx.lineWidth=bw;ctx.strokeStyle=options.grid.borderColor;ctx.strokeRect(-bw/2,-bw/2,plotWidth+bw,plotHeight+bw);}
ctx.restore();}
function insertLabels(){placeholder.find(".tickLabels").remove();var html=['<div class="tickLabels" style="font-size:smaller;color:'+options.grid.color+'">'];function addLabels(axis,labelGenerator){for(var i=0;i<axis.ticks.length;++i){var tick=axis.ticks[i];if(!tick.label||tick.v<axis.min||tick.v>axis.max)
continue;html.push(labelGenerator(tick,axis));}}
var margin=options.grid.labelMargin+options.grid.borderWidth;addLabels(axes.xaxis,function(tick,axis){return'<div style="position:absolute;top:'+(plotOffset.top+plotHeight+margin)+'px;left:'+Math.round(plotOffset.left+axis.p2c(tick.v)-axis.labelWidth/2)+'px;width:'+axis.labelWidth+'px;text-align:center" class="tickLabel">'+tick.label+"</div>";});addLabels(axes.yaxis,function(tick,axis){return'<div style="position:absolute;top:'+Math.round(plotOffset.top+axis.p2c(tick.v)-axis.labelHeight/2)+'px;right:'+(plotOffset.right+plotWidth+margin)+'px;width:'+axis.labelWidth+'px;text-align:right" class="tickLabel">'+tick.label+"</div>";});html.push('</div>');placeholder.append(html.join(""));}
function drawSeries(series){if(series.lines.show)
drawSeriesLines(series);if(series.bars.show)
drawSeriesBars(series);if(series.points.show)
drawSeriesPoints(series);}
function drawSeriesLines(series){function plotLine(datapoints,xoffset,yoffset,axisx,axisy){var points=datapoints.points,ps=datapoints.pointsize,prevx=null,prevy=null;ctx.beginPath();for(var i=ps;i<points.length;i+=ps){var x1=points[i-ps],y1=points[i-ps+1],x2=points[i],y2=points[i+1];if(x1==null||x2==null)
continue;if(y1<=y2&&y1<axisy.min){if(y2<axisy.min)
continue;x1=(axisy.min-y1)/(y2-y1)*(x2-x1)+x1;y1=axisy.min;}
else if(y2<=y1&&y2<axisy.min){if(y1<axisy.min)
continue;x2=(axisy.min-y1)/(y2-y1)*(x2-x1)+x1;y2=axisy.min;}
if(y1>=y2&&y1>axisy.max){if(y2>axisy.max)
continue;x1=(axisy.max-y1)/(y2-y1)*(x2-x1)+x1;y1=axisy.max;}
else if(y2>=y1&&y2>axisy.max){if(y1>axisy.max)
continue;x2=(axisy.max-y1)/(y2-y1)*(x2-x1)+x1;y2=axisy.max;}
if(x1<=x2&&x1<axisx.min){if(x2<axisx.min)
continue;y1=(axisx.min-x1)/(x2-x1)*(y2-y1)+y1;x1=axisx.min;}
else if(x2<=x1&&x2<axisx.min){if(x1<axisx.min)
continue;y2=(axisx.min-x1)/(x2-x1)*(y2-y1)+y1;x2=axisx.min;}
if(x1>=x2&&x1>axisx.max){if(x2>axisx.max)
continue;y1=(axisx.max-x1)/(x2-x1)*(y2-y1)+y1;x1=axisx.max;}
else if(x2>=x1&&x2>axisx.max){if(x1>axisx.max)
continue;y2=(axisx.max-x1)/(x2-x1)*(y2-y1)+y1;x2=axisx.max;}
if(x1!=prevx||y1!=prevy)
ctx.moveTo(axisx.p2c(x1)+xoffset,axisy.p2c(y1)+yoffset);prevx=x2;prevy=y2;ctx.lineTo(axisx.p2c(x2)+xoffset,axisy.p2c(y2)+yoffset);}
ctx.stroke();}
function plotLineArea(datapoints,axisx,axisy){var points=datapoints.points,ps=datapoints.pointsize,bottom=Math.min(Math.max(0,axisy.min),axisy.max),i=0,top,areaOpen=false,ypos=1,segmentStart=0,segmentEnd=0;while(true){if(ps>0&&i>points.length+ps)
break;i+=ps;var x1=points[i-ps],y1=points[i-ps+ypos],x2=points[i],y2=points[i+ypos];if(areaOpen){if(ps>0&&x1!=null&&x2==null){segmentEnd=i;ps=-ps;ypos=2;continue;}
if(ps<0&&i==segmentStart+ps){ctx.fill();areaOpen=false;ps=-ps;ypos=1;i=segmentStart=segmentEnd+ps;continue;}}
if(x1==null||x2==null)
continue;if(x1<=x2&&x1<axisx.min){if(x2<axisx.min)
continue;y1=(axisx.min-x1)/(x2-x1)*(y2-y1)+y1;x1=axisx.min;}
else if(x2<=x1&&x2<axisx.min){if(x1<axisx.min)
continue;y2=(axisx.min-x1)/(x2-x1)*(y2-y1)+y1;x2=axisx.min;}
if(x1>=x2&&x1>axisx.max){if(x2>axisx.max)
continue;y1=(axisx.max-x1)/(x2-x1)*(y2-y1)+y1;x1=axisx.max;}
else if(x2>=x1&&x2>axisx.max){if(x1>axisx.max)
continue;y2=(axisx.max-x1)/(x2-x1)*(y2-y1)+y1;x2=axisx.max;}
if(!areaOpen){ctx.beginPath();ctx.moveTo(axisx.p2c(x1),axisy.p2c(bottom));areaOpen=true;}
if(y1>=axisy.max&&y2>=axisy.max){ctx.lineTo(axisx.p2c(x1),axisy.p2c(axisy.max));ctx.lineTo(axisx.p2c(x2),axisy.p2c(axisy.max));continue;}
else if(y1<=axisy.min&&y2<=axisy.min){ctx.lineTo(axisx.p2c(x1),axisy.p2c(axisy.min));ctx.lineTo(axisx.p2c(x2),axisy.p2c(axisy.min));continue;}
var x1old=x1,x2old=x2;if(y1<=y2&&y1<axisy.min&&y2>=axisy.min){x1=(axisy.min-y1)/(y2-y1)*(x2-x1)+x1;y1=axisy.min;}
else if(y2<=y1&&y2<axisy.min&&y1>=axisy.min){x2=(axisy.min-y1)/(y2-y1)*(x2-x1)+x1;y2=axisy.min;}
if(y1>=y2&&y1>axisy.max&&y2<=axisy.max){x1=(axisy.max-y1)/(y2-y1)*(x2-x1)+x1;y1=axisy.max;}
else if(y2>=y1&&y2>axisy.max&&y1<=axisy.max){x2=(axisy.max-y1)/(y2-y1)*(x2-x1)+x1;y2=axisy.max;}
if(x1!=x1old){ctx.lineTo(axisx.p2c(x1old),axisy.p2c(y1));}
ctx.lineTo(axisx.p2c(x1),axisy.p2c(y1));ctx.lineTo(axisx.p2c(x2),axisy.p2c(y2));if(x2!=x2old){ctx.lineTo(axisx.p2c(x2),axisy.p2c(y2));ctx.lineTo(axisx.p2c(x2old),axisy.p2c(y2));}}}
ctx.save();ctx.translate(plotOffset.left,plotOffset.top);ctx.lineJoin="round";var lw=series.lines.lineWidth,sw=series.shadowSize;if(lw>0&&sw>0){ctx.lineWidth=sw;ctx.strokeStyle="rgba(0,0,0,0.1)";var angle=Math.PI/18;plotLine(series.datapoints,Math.sin(angle)*(lw/2+sw/2),Math.cos(angle)*(lw/2+sw/2),series.xaxis,series.yaxis);ctx.lineWidth=sw/2;plotLine(series.datapoints,Math.sin(angle)*(lw/2+sw/4),Math.cos(angle)*(lw/2+sw/4),series.xaxis,series.yaxis);}
ctx.lineWidth=lw;ctx.strokeStyle=series.color;var fillStyle=getFillStyle(series.lines,series.color,0,plotHeight);if(fillStyle){ctx.fillStyle=fillStyle;plotLineArea(series.datapoints,series.xaxis,series.yaxis);}
if(lw>0)
plotLine(series.datapoints,0,0,series.xaxis,series.yaxis);ctx.restore();}
function drawSeriesPoints(series){function plotPoints(datapoints,radius,fillStyle,offset,circumference,axisx,axisy){var points=datapoints.points,ps=datapoints.pointsize;for(var i=0;i<points.length;i+=ps){var x=points[i],y=points[i+1];if(x==null||x<axisx.min||x>axisx.max||y<axisy.min||y>axisy.max)
continue;ctx.beginPath();ctx.arc(axisx.p2c(x),axisy.p2c(y)+offset,radius,0,circumference,false);if(fillStyle){ctx.fillStyle=fillStyle;ctx.fill();}
ctx.stroke();}}
ctx.save();ctx.translate(plotOffset.left,plotOffset.top);var lw=series.lines.lineWidth,sw=series.shadowSize,radius=series.points.radius;if(lw>0&&sw>0){var w=sw/2;ctx.lineWidth=w;ctx.strokeStyle="rgba(0,0,0,0.1)";plotPoints(series.datapoints,radius,null,w+w/2,Math.PI,series.xaxis,series.yaxis);ctx.strokeStyle="rgba(0,0,0,0.2)";plotPoints(series.datapoints,radius,null,w/2,Math.PI,series.xaxis,series.yaxis);}
ctx.lineWidth=lw;ctx.strokeStyle=series.color;plotPoints(series.datapoints,radius,getFillStyle(series.points,series.color),0,2*Math.PI,series.xaxis,series.yaxis);ctx.restore();}
function drawBar(x,y,b,barLeft,barRight,offset,fillStyleCallback,axisx,axisy,c,horizontal){var left,right,bottom,top,drawLeft,drawRight,drawTop,drawBottom,tmp;if(horizontal){drawBottom=drawRight=drawTop=true;drawLeft=false;left=b;right=x;top=y+barLeft;bottom=y+barRight;if(right<left){tmp=right;right=left;left=tmp;drawLeft=true;drawRight=false;}}
else{drawLeft=drawRight=drawTop=true;drawBottom=false;left=x+barLeft;right=x+barRight;bottom=b;top=y;if(top<bottom){tmp=top;top=bottom;bottom=tmp;drawBottom=true;drawTop=false;}}
if(right<axisx.min||left>axisx.max||top<axisy.min||bottom>axisy.max)
return;if(left<axisx.min){left=axisx.min;drawLeft=false;}
if(right>axisx.max){right=axisx.max;drawRight=false;}
if(bottom<axisy.min){bottom=axisy.min;drawBottom=false;}
if(top>axisy.max){top=axisy.max;drawTop=false;}
left=axisx.p2c(left);bottom=axisy.p2c(bottom);right=axisx.p2c(right);top=axisy.p2c(top);if(fillStyleCallback){c.beginPath();c.moveTo(left,bottom);c.lineTo(left,top);c.lineTo(right,top);c.lineTo(right,bottom);c.fillStyle=fillStyleCallback(bottom,top);c.fill();}
if(drawLeft||drawRight||drawTop||drawBottom){c.beginPath();c.moveTo(left,bottom+offset);if(drawLeft)
c.lineTo(left,top+offset);else
c.moveTo(left,top+offset);if(drawTop)
c.lineTo(right,top+offset);else
c.moveTo(right,top+offset);if(drawRight)
c.lineTo(right,bottom+offset);else
c.moveTo(right,bottom+offset);if(drawBottom)
c.lineTo(left,bottom+offset);else
c.moveTo(left,bottom+offset);c.stroke();}}
function drawSeriesBars(series){function plotBars(datapoints,barLeft,barRight,offset,fillStyleCallback,axisx,axisy){var points=datapoints.points,ps=datapoints.pointsize;for(var i=0;i<points.length;i+=ps){if(points[i]==null)
continue;drawBar(points[i],points[i+1],points[i+2],barLeft,barRight,offset,fillStyleCallback,axisx,axisy,ctx,series.bars.horizontal);}}
ctx.save();ctx.translate(plotOffset.left,plotOffset.top);ctx.lineWidth=series.bars.lineWidth;ctx.strokeStyle=series.color;var barLeft=series.bars.align=="left"?0:-series.bars.barWidth/2;var fillStyleCallback=series.bars.fill?function(bottom,top){return getFillStyle(series.bars,series.color,bottom,top);}:null;plotBars(series.datapoints,barLeft,barLeft+series.bars.barWidth,0,fillStyleCallback,series.xaxis,series.yaxis);ctx.restore();}
function getFillStyle(filloptions,seriesColor,bottom,top){var fill=filloptions.fill;if(!fill)
return null;if(filloptions.fillColor)
return getColorOrGradient(filloptions.fillColor,bottom,top,seriesColor);var c=$.color.parse(seriesColor);c.a=typeof fill=="number"?fill:0.4;c.normalize();return c.toString();}
function insertLegend(){placeholder.find(".legend").remove();if(!options.legend.show)
return;var fragments=[],rowStarted=false,lf=options.legend.labelFormatter,s,label;for(i=0;i<series.length;++i){s=series[i];label=s.label;if(!label)
continue;if(i%options.legend.noColumns==0){if(rowStarted)
fragments.push('</tr>');fragments.push('<tr>');rowStarted=true;}
if(lf)
label=lf(label,s);fragments.push('<td class="legendColorBox"><div style="border:1px solid '+options.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+s.color+';overflow:hidden"></div></div></td>'+'<td class="legendLabel">'+label+'</td>');}
if(rowStarted)
fragments.push('</tr>');if(fragments.length==0)
return;var table='<table style="font-size:smaller;color:'+options.grid.color+'">'+fragments.join("")+'</table>';if(options.legend.container!=null)
$(options.legend.container).html(table);else{var pos="",p=options.legend.position,m=options.legend.margin;if(m[0]==null)
m=[m,m];if(p.charAt(0)=="n")
pos+='top:'+(m[1]+plotOffset.top)+'px;';else if(p.charAt(0)=="s")
pos+='bottom:'+(m[1]+plotOffset.bottom)+'px;';if(p.charAt(1)=="e")
pos+='right:'+(m[0]+plotOffset.right)+'px;';else if(p.charAt(1)=="w")
pos+='left:'+(m[0]+plotOffset.left)+'px;';var legend=$('<div class="legend">'+table.replace('style="','style="position:absolute;'+pos+';')+'</div>').appendTo(placeholder);if(options.legend.backgroundOpacity!=0.0){var c=options.legend.backgroundColor;if(c==null){c=options.grid.backgroundColor;if(c&&typeof c=="string")
c=$.color.parse(c);else
c=$.color.extract(legend,'background-color');c.a=1;c=c.toString();}
var div=legend.children();$('<div style="position:absolute;width:'+div.width()+'px;height:'+div.height()+'px;'+pos+'background-color:'+c+';"> </div>').prependTo(legend).css('opacity',options.legend.backgroundOpacity);}}}
var highlights=[],redrawTimeout=null;function findNearbyItem(mouseX,mouseY,seriesFilter){var maxDistance=options.grid.mouseActiveRadius,smallestDistance=maxDistance*maxDistance+1,item=null,foundPoint=false,i,j;for(i=series.length-1;i>=0;--i){if(!seriesFilter(series[i]))
continue;var s=series[i],axisx=s.xaxis,axisy=s.yaxis,points=s.datapoints.points,ps=s.datapoints.pointsize,mx=axisx.c2p(mouseX),my=axisy.c2p(mouseY),maxx=maxDistance/axisx.scale,maxy=maxDistance/axisy.scale;if(s.lines.show||s.points.show){for(j=0;j<points.length;j+=ps){var x=points[j],y=points[j+1];if(x==null)
continue;if(x-mx>maxx||x-mx<-maxx||y-my>maxy||y-my<-maxy)
continue;var dx=Math.abs(axisx.p2c(x)-mouseX),dy=Math.abs(axisy.p2c(y)-mouseY),dist=dx*dx+dy*dy;if(dist<smallestDistance){smallestDistance=dist;item=[i,j/ps];}}}
if(s.bars.show&&!item){var barLeft=s.bars.align=="left"?0:-s.bars.barWidth/2,barRight=barLeft+s.bars.barWidth;for(j=0;j<points.length;j+=ps){var x=points[j],y=points[j+1],b=points[j+2];if(x==null)
continue;if(series[i].bars.horizontal?(mx<=Math.max(b,x)&&mx>=Math.min(b,x)&&my>=y+barLeft&&my<=y+barRight):(mx>=x+barLeft&&mx<=x+barRight&&my>=Math.min(b,y)&&my<=Math.max(b,y)))
item=[i,j/ps];}}}
if(item){i=item[0];j=item[1];ps=series[i].datapoints.pointsize;return{datapoint:series[i].datapoints.points.slice(j*ps,(j+1)*ps),dataIndex:j,series:series[i],seriesIndex:i};}
return null;}
function onMouseMove(e){if(options.grid.hoverable)
triggerClickHoverEvent("plothover",e,function(s){return s["hoverable"]!=false;});}
function onClick(e){triggerClickHoverEvent("plotclick",e,function(s){return s["clickable"]!=false;});}
function triggerClickHoverEvent(eventname,event,seriesFilter){var offset=eventHolder.offset(),pos={pageX:event.pageX,pageY:event.pageY},canvasX=event.pageX-offset.left-plotOffset.left,canvasY=event.pageY-offset.top-plotOffset.top;if(axes.xaxis.used)
pos.x=axes.xaxis.c2p(canvasX);if(axes.yaxis.used)
pos.y=axes.yaxis.c2p(canvasY);var item=findNearbyItem(canvasX,canvasY,seriesFilter);if(item){item.pageX=parseInt(item.series.xaxis.p2c(item.datapoint[0])+offset.left+plotOffset.left);item.pageY=parseInt(item.series.yaxis.p2c(item.datapoint[1])+offset.top+plotOffset.top);}
if(options.grid.autoHighlight){for(var i=0;i<highlights.length;++i){var h=highlights[i];if(h.auto==eventname&&!(item&&h.series==item.series&&h.point==item.datapoint))
unhighlight(h.series,h.point);}
if(item)
highlight(item.series,item.datapoint,eventname);}
placeholder.trigger(eventname,[pos,item]);}
function triggerRedrawOverlay(){if(!redrawTimeout)
redrawTimeout=setTimeout(drawOverlay,30);}
function drawOverlay(){redrawTimeout=null;octx.save();octx.clearRect(0,0,canvasWidth,canvasHeight);octx.translate(plotOffset.left,plotOffset.top);var i,hi;for(i=0;i<highlights.length;++i){hi=highlights[i];if(hi.series.bars.show)
drawBarHighlight(hi.series,hi.point);else
drawPointHighlight(hi.series,hi.point);}
octx.restore();executeHooks(hooks.drawOverlay,[octx]);}
function highlight(s,point,auto){if(typeof s=="number")
s=series[s];if(typeof point=="number")
point=s.data[point];var i=indexOfHighlight(s,point);if(i==-1){highlights.push({series:s,point:point,auto:auto});triggerRedrawOverlay();}
else if(!auto)
highlights[i].auto=false;}
function unhighlight(s,point){if(s==null&&point==null){highlights=[];triggerRedrawOverlay();}
if(typeof s=="number")
s=series[s];if(typeof point=="number")
point=s.data[point];var i=indexOfHighlight(s,point);if(i!=-1){highlights.splice(i,1);triggerRedrawOverlay();}}
function indexOfHighlight(s,p){for(var i=0;i<highlights.length;++i){var h=highlights[i];if(h.series==s&&h.point[0]==p[0]&&h.point[1]==p[1])
return i;}
return-1;}
function drawPointHighlight(series,point){var x=point[0],y=point[1],axisx=series.xaxis,axisy=series.yaxis;if(x<axisx.min||x>axisx.max||y<axisy.min||y>axisy.max)
return;var pointRadius=series.points.radius+series.points.lineWidth/2;octx.lineWidth=pointRadius;octx.strokeStyle=$.color.parse(series.color).scale('a',0.5).toString();var radius=1.5*pointRadius;octx.beginPath();octx.arc(axisx.p2c(x),axisy.p2c(y),radius,0,2*Math.PI,false);octx.stroke();}
function drawBarHighlight(series,point){octx.lineWidth=series.bars.lineWidth;octx.strokeStyle=$.color.parse(series.color).scale('a',0.5).toString();var fillStyle=$.color.parse(series.color).scale('a',0.5).toString();var barLeft=series.bars.align=="left"?0:-series.bars.barWidth/2;drawBar(point[0],point[1],point[2]||0,barLeft,barLeft+series.bars.barWidth,0,function(){return fillStyle;},series.xaxis,series.yaxis,octx,series.bars.horizontal);}
function getColorOrGradient(spec,bottom,top,defaultColor){if(typeof spec=="string")
return spec;else{var gradient=ctx.createLinearGradient(0,top,0,bottom);for(var i=0,l=spec.colors.length;i<l;++i){var c=spec.colors[i];if(typeof c!="string"){var co=$.color.parse(defaultColor);if(c.brightness!=null)
co=co.scale('rgb',c.brightness)
if(c.opacity!=null)
co.a*=c.opacity;c=co.toString();}
gradient.addColorStop(i/(l-1),c);}
return gradient;}}}
$.plot=function(placeholder,data,options){var plot=new Plot($(placeholder),data,options,$.plot.plugins);return plot;};$.plot.plugins=[];$.plot.formatDate=function(d,fmt,monthNames){var leftPad=function(n){n=""+n;return n.length==1?"0"+n:n;};var r=[];var escape=false;var hours=d.getUTCHours();var isAM=hours<12;if(monthNames==null)
monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(fmt.search(/%p|%P/)!=-1){if(hours>12){hours=hours-12;}else if(hours==0){hours=12;}}
for(var i=0;i<fmt.length;++i){var c=fmt.charAt(i);if(escape){switch(c){case'h':c=""+hours;break;case'H':c=leftPad(hours);break;case'M':c=leftPad(d.getUTCMinutes());break;case'S':c=leftPad(d.getUTCSeconds());break;case'd':c=""+d.getUTCDate();break;case'm':c=""+(d.getUTCMonth()+1);break;case'y':c=""+d.getUTCFullYear();break;case'b':c=""+monthNames[d.getUTCMonth()];break;case'p':c=(isAM)?(""+"am"):(""+"pm");break;case'P':c=(isAM)?(""+"AM"):(""+"PM");break;}
r.push(c);escape=false;}
else{if(c=="%")
escape=true;else
r.push(c);}}
return r.join("");};function floorInBase(n,base){return base*Math.floor(n/base);}})(jQuery);function decimateSamples(decimation,samples){var two_pi_d=2*Math.PI*decimation;var alpha=two_pi_d/(1+two_pi_d);var beta=1-alpha;var filteredSamples=new Array(samples.length);var i;filteredSamples[0]=samples[0];for(i=1;i<samples.length;i++)
filteredSamples[i]=samples[i]*alpha+filteredSamples[i-1]*beta;return decimateNoFilter(decimation,filteredSamples);}
function decimateNoFilter(decimation,samples){var outputSamples=new Array((samples.length/decimation)>>0);var j=samples.length-1;for(i=outputSamples.length-1;i>=0;i--,j-=decimation)
outputSamples[i]=samples[j];return outputSamples;}
function buildPlotSeries(data,tstamps,breakInterval,timeOffset){var plusInf=-1/0;var maxY=plusInf;var dataLength=data.length;var plotSeries=[];var plotData=new Array(dataLength);var usedPlotData=0;var prevTStamp;var i;plotSeries.push(plotData);for(i=0;i<dataLength;i++){if(data[i]!=null){break;}}
if(i==dataLength){return{maxY:1,plotSeries:[]};}
var e=data[i];if(e>=maxY){maxY=e;}
var tstamp=tstamps[i]+timeOffset;prevTStamp=tstamp;plotData[usedPlotData++]=[tstamp,e];for(i++;i<dataLength;i++){e=data[i];if(e==null){continue;}
if(e>=maxY){maxY=e;}
tstamp=tstamps[i]+timeOffset;if(prevTStamp+breakInterval<tstamp){plotData.length=usedPlotData;plotData=new Array(dataLength);plotSeries.push(plotData);usedPlotData=0;}
prevTStamp=tstamp;plotData[usedPlotData++]=[tstamp,e];}
plotData.length=usedPlotData;if(maxY==0||maxY==plusInf){maxY=1;}
return{maxY:maxY,plotSeries:plotSeries};}
function plotStatGraph(config){var data=config.stats;var tstamps=config.tstamps;var options=_.extend({color:'#1d88ad',verticalMargin:1.15,targetPointsCount:120},config.options||{});var timeOffset=options.timeOffset||0;var breakInterval=options.breakInterval||3.1557e+10;var lastSampleTime;if(tstamps.length<2){tstamps=[];data=[];}
var decimation=Math.ceil(data.length/options.targetPointsCount);if(decimation>1){tstamps=decimateNoFilter(decimation,tstamps);data=decimateSamples(decimation,data);}
var plotSeries,maxY;(function(){var rv=buildPlotSeries(data,tstamps,breakInterval,timeOffset);plotSeries=rv.plotSeries;maxY=rv.maxY;})();if(options.maxY){maxY=options.maxY;}
var yTicks=(function(){var delta=maxY/5;if(delta==0.0){return[0,1];}
var size,magn,norm;var dec=-Math.floor(Math.log(delta)/Math.LN10);magn=Math.pow(10,-dec);norm=delta/magn;if(norm<1.5){size=1;}else if(norm<3){size=2;if(norm>2.25){size=2.5;}}else if(norm<7.5){size=5;}else{size=10;}
size*=magn;var ticks=[];var start=0;var i=0;var v;var prev;do{prev=v;v=start+i*size;ticks.push(v);if(v>=maxY||v==prev){break;}
++i;}while(true);return ticks;})();var graphMax;if(options.verticalMargin==null){graphMax=maxY;}else{graphMax=yTicks[yTicks.length-1]*options.verticalMargin;}
var preparedQ=mnPrepareQuantityFilter(yTicks[yTicks.length-1],options.isBytes?1024:1000);function xTickFormatter(val,axis){var unit=axis.tickSize[1];var date=new Date(val);function fd(value,base){return String(value+base).slice(1);}
function formatWithMinutes(){var hours=date.getHours();var mins=date.getMinutes();var am=(hours>0&&hours<13);if(!am){if(hours==0){hours=12;}else{hours-=12;}}
if(hours==12){am=!am;}
var formattedHours=fd(hours,100);var formattedMins=fd(mins,100);return formattedHours+":"+formattedMins+(am?'am':'pm');}
function formatDate(){var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return[monthNames[date.getMonth()],String(fd(date.getDate(),100))].join(' ');}
var rv;switch(unit){case'minute':case'second':rv=formatWithMinutes();if(unit=='second'){rv=rv.slice(0,-2)+':'+fd(date.getSeconds(),100)+rv.slice(-2);}
break;case'hour':rv=[formatDate(),formatWithMinutes()].join(' ');break;default:rv=formatDate();}
return rv;}
var plotOptions={xaxis:{tickFormatter:xTickFormatter,mode:'time',ticks:4,},yaxis:{tickFormatter:function(val,axis){if(val==0){return'0';}
return[mnTruncateTo3DigitsFilter(val/preparedQ[0]),preparedQ[1]].join('');},min:0,max:graphMax,ticks:yTicks},grid:{borderWidth:0,markings:function(opts){return[{xaxis:{from:opts.xmin,to:opts.xmax},yaxis:{from:opts.ymin,to:opts.ymin},color:'black'},{xaxis:{from:opts.xmin,to:opts.xmin},yaxis:{from:opts.ymin,to:opts.ymax},color:'black'}];}}};if(options.fixedTimeWidth&&tstamps.length){lastSampleTime=options.lastSampleTime||tstamps[tstamps.length-1];plotOptions.xaxis.max=lastSampleTime;plotOptions.xaxis.min=lastSampleTime-options.fixedTimeWidth;}else if(options.lastSampleTime){plotOptions.xaxis.max=options.lastSampleTime;}
if(!tstamps.length){plotOptions.xaxis.ticks=[];}
if(options.processPlotOptions){plotOptions=options.processPlotOptions(plotOptions,plotSeries);}
return{plotSeries:_.map(plotSeries,function(plotData){return{color:options.color,data:plotData};}),plotOptions:plotOptions};}
function plotSmallGraph(config){var yaxis={min:0,ticks:0,autoscaleMargin:0.04};if(config.maxY){yaxis.max=config.maxY;}
var plotSeries=buildPlotSeries(config.data,config.timestamp,config.breakInterval,config.timeOffset).plotSeries;return{plotSeries:_.map(plotSeries,function(plotData){return{color:config.isSelected?'#e2f1f9':'#d95e28',shadowSize:3,data:plotData}}),plotOptions:{xaxis:{ticks:0,autoscaleMargin:0.04,min:config.now-config.zoomMillis,max:config.now},yaxis:yaxis,grid:{show:false}}};}
return{restrict:'A',scope:{mnPlotConfig:'=',isSmallGraph:'@'},link:function($scope,$element){var plot;$scope.$on('$destroy',function(){jQuery($element).removeData("plot");plot=null;});var plotFun=($scope.isSmallGraph==='true')?plotSmallGraph:plotStatGraph;$scope.$watch('mnPlotConfig',function(config){if(!config){return;}
var plotData=plotFun(config);plot=jQuery.plot($element,plotData.plotSeries,plotData.plotOptions);},true);}};});})();(function(){"use strict";angular.module('mnLaunchpad',[]).directive('mnLaunchpad',mnLaunchpadDirective);function mnLaunchpadDirective($timeout){var mnLaunchpad={scope:{launchpadSource:"=",launchpadId:"="},link:link}
return mnLaunchpad;function link($scope,$element,$attrs){$scope.$watch('launchpadSource',function(launchpadSource){if(!launchpadSource){return;}
var iframe=document.createElement("iframe");iframe.style.display='none'
$element.append(iframe);var idoc=iframe.contentWindow.document;idoc.body.innerHTML="<form id=\"launchpad\" method=\"POST\"><textarea id=\"sputnik\" name=\"stats\"></textarea></form>";var form=idoc.getElementById("launchpad");var textarea=idoc.getElementById("sputnik");form['action']="https://ph.couchbase.net/v2?launchID="+$scope.launchpadId;textarea.innerText=JSON.stringify(launchpadSource);form.submit();$scope.launchpadSource=undefined;$timeout(function(){$element.empty();},30000);});}}})();(function(){"use strict";angular.module('mnSortableTable',[]).directive('mnSortableTable',mnSortableTableDirective).directive('mnSortableTitle',mnSortableTitleDirective)
function mnSortableTitleDirective($compile){var mnSortableTitle={require:'^mnSortableTable',transclude:'element',restrict:'A',link:link,scope:{sortFunction:"&?",mnSortableTitle:"@?"}};return mnSortableTitle;function link($scope,$element,$attrs,ctl,$transclude){$scope.mnSortableTable=ctl;if($attrs.sortByDefault){ctl.setOrderOrToggleInvert($scope.sortFunction||$scope.mnSortableTitle,$scope.mnSortableTitle);}
$transclude(function(cloned){cloned.attr('ng-click','mnSortableTable.setOrderOrToggleInvert(sortFunction || mnSortableTitle, mnSortableTitle)');cloned.attr('ng-class','{"dynamic-active": mnSortableTable.isOrderBy("'+$scope.mnSortableTitle+'"),'
+'"dynamic-inverted": mnSortableTable.isOrderBy("'+$scope.mnSortableTitle+'") && mnSortableTable.sortableTableProperties.invert}');cloned.removeAttr('mn-sortable-title');$element.after($compile(cloned)($scope));});}}
function mnSortableTableDirective(){var mnSortableTable={transclude:'element',restrict:'A',link:link,controller:controller,controllerAs:"mnSortableTable"};return mnSortableTable;function controller($scope,$element,$attrs,$parse){var currentSortableTitle;var currentOrderByStringOrFunction;var vm=this;vm.sortableTableProperties={orderBy:null,invert:null};vm.setOrderOrToggleInvert=setOrderOrToggleInvert;vm.isOrderBy=isOrderBy;vm.sortableTableProperties.orderBy=orderBy;function orderBy(value){if(angular.isFunction(currentOrderByStringOrFunction)){return currentOrderByStringOrFunction({value:value});}else{return $parse(currentOrderByStringOrFunction)(value);}}
function isOrderBy(name){return currentSortableTitle===name;}
function setOrderOrToggleInvert(orderBy,name){if(isOrderBy(name)){vm.sortableTableProperties.invert=!vm.sortableTableProperties.invert;}else{vm.sortableTableProperties.invert=false;}
setOrder(orderBy,name);}
function setOrder(orderBy,name){currentSortableTitle=name;currentOrderByStringOrFunction=orderBy;}}
function link($scope,$element,$attrs,ctl,$transclude){$transclude(function(cloned){$element.after(cloned);});}}})();(function(){"use strict";angular.module('mnDragAndDrop',[]).directive('mnDragAndDrop',mnDragAndDropDirective);function mnDragAndDropDirective($window,$document){var mnDragAndDrop={scope:{onItemTaken:'&',onItemDropped:'&',onItemMoved:'&'},link:link};return mnDragAndDrop;function link($scope,$element,$attrs){var draggedObject;var startX;var startY;var initialMouseX;var initialMouseY;var baseCornerRight=$attrs.baseCornerRight;$element.on('mousedown touchstart',onMouseDown);$scope.$on("$destroy",function(){$element.off('mousedown touchstart',onMouseDown);});function onMouseDown(e){e=e||$window.event;if(draggedObject){onMouseUp();return;}
var target=e.currentTarget;draggedObject=$element;if($scope.onItemTaken){$scope.onItemTaken({$event:e});}
startX=target.offsetLeft;if(baseCornerRight){startX+=target.clientWidth;}
startY=target.offsetTop;initialMouseX=e.clientX;initialMouseY=e.clientY;$element.addClass("dragged");$document.on('mousemove touchmove',onMouseMove);$document.on('mouseup touchend',onMouseUp);$document.find('body').addClass('disable-text-selection');return false;}
function onMouseMove(e){e=e||$window.event;if($scope.onItemMoved){$scope.onItemMoved(this);}
var dx=e.clientX-initialMouseX;var dy=e.clientY-initialMouseY;var move={top:startY+dy+'px',bottom:'auto'};if(baseCornerRight){move.right=-(startX+dx)+'px';move.left="auto";}else{move.right="auto";move.left=startX+dx+'px';}
$element.css(move);return false;}
function onMouseUp(){if($scope.onItemDropped){$scope.onItemDropped(this);}
draggedObject.removeClass("dragged");$document.off('mousemove touchmove',onMouseMove);$document.off('mouseup touchend',onMouseUp);$document.find('body').removeClass('disable-text-selection');draggedObject=null;}}}})();(function(){"use strict";angular.module("mnFilter",[]).directive("mnFilter",mnFilterDirective);function mnFilterDirective($window){var mnFilter={restrict:"A",scope:{config:"=",mnDisabled:"=",onClose:"&",onOpen:"&",onReset:"&"},templateUrl:"app/components/directives/mn_filter/mn_filter.html",controller:mnFilterController,controllerAs:"mnFilterCtl",bindToController:true};return mnFilter;function mnFilterController($scope){var vm=this;vm.togglePopup=togglePopup;function togglePopup(open){vm.showPopup=open;if(vm.showPopup){vm.onOpen&&vm.onOpen();}else{vm.onClose&&vm.onClose();}}}}})();(function(){"use strict";angular.module('mnStorageMode',[]).directive('mnStorageMode',mnStorageModeDirective).filter('mnFormatStorageModeError',mnFormatStorageModeError);function mnFormatStorageModeError(){return function(error){if(!error){return;}
var errorCode=error.indexOf("Storage mode cannot be set to")>-1?1:error.indexOf("storageMode must be one of")>-1?2:0;switch(errorCode){case 1:return"please choose another index storage mode";case 2:return"please choose an index storage mode";default:return error;}};}
function mnStorageModeDirective(){var mnStorageMode={restrict:'E',scope:{mnIsEnterprise:"=",mnModel:"=",mnErrors:"=",mnCompat:"=?",mnPermissions:"=?",mnServicesModel:"=?",mnInitial:"=?"},templateUrl:'app/components/directives/mn_storage_mode/mn_storage_mode.html'};return mnStorageMode;}})();(function(){"use strict";angular.module('mnMemoryQuota',['mnServices','mnFocus','mnMemoryQuotaService']).directive('mnMemoryQuota',mnMemoryQuotaDirective);function mnMemoryQuotaDirective($window,mnMemoryQuotaService){var mnMemoryQuota={restrict:'A',scope:{config:'=mnMemoryQuota',errors:"=",rbac:"=",mnIsEnterprise:"="},templateUrl:'app/components/directives/mn_memory_quota/mn_memory_quota.html',controller:controller};return mnMemoryQuota;function controller($scope){$scope.mnMemoryQuotaController=$scope;$scope.change=mnMemoryQuotaService.handleAltAndClick;$scope.calculateTotalQuota=calculateTotalQuota;function getServiceFieldName(service){switch(service){case"kv":return"memoryQuota";default:return(service+"MemoryQuota");}}
function calculateTotalQuota(){return Object.keys($scope.config.services.model).reduce(function(total,service){var cfg=$scope.config;var fieldName=getServiceFieldName(service);if(cfg.displayedServices[service]&&cfg.services&&cfg.services.model[service]&&cfg[fieldName]){return total+(Number(cfg[fieldName])||0);}else{return total;}},0);}}}})();(function(){"use strict";angular.module('mnMemoryQuotaService',['mnPoolDefault','mnHelper']).factory('mnMemoryQuotaService',mnMemoryQuotaServiceFactory);function mnMemoryQuotaServiceFactory($http,$window,mnPoolDefault,mnHelper,IEC){var mnMemoryQuotaService={prepareClusterQuotaSettings:prepareClusterQuotaSettings,isOnlyOneNodeWithService:isOnlyOneNodeWithService,memoryQuotaConfig:memoryQuotaConfig,getFirstTimeAddedServices:getFirstTimeAddedServices,handleAltAndClick:handleAltAndClick};return mnMemoryQuotaService;function prepareClusterQuotaSettings(currentPool,displayedServices,calculateMaxMemory,calculateTotal){var ram=currentPool.storageTotals.ram;if(calculateMaxMemory===undefined){calculateMaxMemory=displayedServices.kv;}
var rv={calculateTotal:calculateTotal,displayedServices:displayedServices,minMemorySize:Math.max(256,Math.floor(ram.quotaUsedPerNode/IEC.Mi)),totalMemorySize:Math.floor(ram.total/IEC.Mi),memoryQuota:Math.floor(ram.quotaTotalPerNode/IEC.Mi)};rv.indexMemoryQuota=currentPool.indexMemoryQuota||256;rv.ftsMemoryQuota=currentPool.ftsMemoryQuota||256;if(currentPool.compat.atLeast55&&mnPoolDefault.export.isEnterprise){rv.cbasMemoryQuota=currentPool.cbasMemoryQuota||256;rv.eventingMemoryQuota=currentPool.eventingMemoryQuota||256;}
if(calculateMaxMemory){rv.maxMemorySize=mnHelper.calculateMaxMemorySize(ram.total/IEC.Mi);}else{rv.maxMemorySize=false;}
return rv;}
function getFirstTimeAddedServices(interestedServices,selectedServices,allNodes){var rv={count:0};angular.forEach(interestedServices,function(interestedService){if(selectedServices[interestedService]&&mnMemoryQuotaService.isOnlyOneNodeWithService(allNodes,selectedServices,interestedService)){rv[interestedService]=true;rv.count++;}});return rv;}
function isOnlyOneNodeWithService(nodes,services,service,isTakenIntoAccountPendingEject){var nodesCount=0;var indexExists=_.each(nodes,function(node){nodesCount+=(_.indexOf(node.services,service)>-1&&!(isTakenIntoAccountPendingEject&&node.pendingEject));});return nodesCount===1&&services&&(angular.isArray(services)?(_.indexOf(services,service)>-1):services[service]);}
function memoryQuotaConfig(displayedServices,calculateMaxMemory,calculateTotal){return mnPoolDefault.get().then(function(poolsDefault){return mnMemoryQuotaService.prepareClusterQuotaSettings(poolsDefault,displayedServices,calculateMaxMemory,calculateTotal);});}
function toggleServices(service,bool,config){_.forEach(config.services.model,function(_,service1){if((config.services.disabled&&config.services.disabled[service1])||(config.displayedServices&&!config.displayedServices[service1])){return;}
config.services.model[service1]=bool;});}
function isThereOther(service,config){return _.keys(config.services.model).some(function(service1){return(!config.displayedServices||config.displayedServices[service1])&&(!config.services.disabled||!config.services.disabled[service1])&&config.services.model[service1]&&service1!==service;});}
function handleAltAndClick(service,config){if(!$window.event.altKey){return;}
if(isThereOther(service,config)){toggleServices(service,false,config);}else{toggleServices(service,true,config);}
config.services.model[service]=true;}}})();(function(){"use strict";angular.module('mnServices',['mnMemoryQuotaService']).directive('mnServices',mnServicesDirective);function mnServicesDirective(mnMemoryQuotaService){var mnServices={restrict:'A',scope:{mnIsDisabled:"=?",config:'=mnServices',mnIsEnterprise:"="},templateUrl:'app/components/directives/mn_services/mn_services.html',controller:controller,controllerAs:"mnServicesCtl",bindToController:true};return mnServices;}
function controller(mnMemoryQuotaService){var vm=this;vm.change=mnMemoryQuotaService.handleAltAndClick;}})();(function(){"use strict";angular.module('mnSearch',[]).directive('mnSearch',mnSearchDirective);function mnSearchDirective(){var mnSearch={restrict:'AE',scope:{mnSearch:"=",mnPlaceholder:"@",mnHideButton:"=",mnDisabled:"="},templateUrl:'app/components/directives/mn_search/mn_search.html',controller:controller,controllerAs:"mnSearchCtl",bindToController:true};return mnSearch;function controller(){var vm=this;vm.hideFilter=hideFilter;vm.showFilter=showFilter;function hideFilter(){vm.mnSearch="";vm.showFilterFlag=false;}
function showFilter(){vm.showFilterFlag=true;vm.focusFilterField=true;}}}})();(function(){"use strict";angular.module('mnFilters',[]).filter('mnCount',mnCount).filter('removeEmptyValue',removeEmptyValue).filter('formatProgressMessage',formatProgressMessage).filter('mnCloneOnlyData',mnCloneOnlyData).filter('$httpParamSerializerJQLike',httpParamSerializerJQLike).filter('mnParseHttpDate',mnParseHttpDate).filter('mnPrepareQuantity',mnPrepareQuantity).filter('mnCalculatePercent',mnCalculatePercent).filter('mnEllipsisiseOnLeft',mnEllipsisiseOnLeft).filter('mnRescaleForSum',mnRescaleForSum).filter('mnNaturalSorting',mnNaturalSorting).filter('mnMakeSafeForCSS',mnMakeSafeForCSS).filter('mnStripPortHTML',mnStripPortHTML).filter('mnTruncateTo3Digits',mnTruncateTo3Digits).filter('mnFormatQuantity',mnFormatQuantity).filter('mnFormatMemSize',mnFormatMemSize).filter('mnFormatUptime',mnFormatUptime).filter('mnMBtoBytes',mnMBtoBytes).filter('mnBytesToMB',mnBytesToMB).filter('parseVersion',parseVersion).filter('getStringBytes',getStringBytes).filter('mnFormatServices',mnFormatServices).filter('mnFormatServicesArray',mnFormatServicesArray).filter('mnPrettyVersion',mnPrettyVersion).filter('encodeURIComponent',encodeURIComponentFilter).filter('mnTrustAsHtml',mnTrustAsHtml).filter('mnMath',mnMath).filter('lodash',lodash).filter('isDisabled',isDisabled).filter('mnIntegerToString',mnIntegerToString).filter('mnFormatStorageMode',mnFormatStorageMode).filter('mnLimitTo',mnLimitTo).filter('jQueryLikeParamSerializer',jQueryLikeParamSerializer).filter('decodeCompatVersion',decodeCompatVersion).filter('mnMsToTime',mnMsToTime).filter('mnServersListFilter',mnServersListFilter).filter("formatFailoverWarnings",formatFailoverWarnings);function formatFailoverWarnings(){return function(warning){switch(warning){case'rebalanceNeeded':return'Rebalance required, some data is not currently replicated.';case'hardNodesNeeded':return'At least two servers with the data service are required to provide replication.';case'softNodesNeeded':return'Additional active servers required to provide the desired number of replicas.';case'softRebalanceNeeded':return'Rebalance recommended, some data does not have the desired replicas configuration.';default:return warning;}};}
function mnServersListFilter($filter,mnFormatServicesFilter){return function(nodes,searchValue,groupsByHostname){return $filter('filter')(nodes,function(node){if(searchValue===""||searchValue===undefined){return true;}
var interestingFields=["hostname","status"];var l2=interestingFields.length;var l3=node.services.length;var i2;var i3;var searchFiled;searchValue=searchValue.toLowerCase();var rv=false;if($filter('orderBy')(node.services.map(function(node){return mnFormatServicesFilter(node).toLowerCase();})).join(" ").indexOf(searchValue)>-1){rv=true;}
loop2:for(i2=0;i2<l2;i2++){searchFiled=interestingFields[i2];if(node[searchFiled].toLowerCase().indexOf(searchValue)>-1){rv=true;break loop2;}}
if(!rv&&groupsByHostname&&groupsByHostname[node.hostname]&&groupsByHostname[node.hostname].name.toLowerCase().indexOf(searchValue)>-1){rv=true;}
return rv;});}}
function decodeCompatVersion(){return function(version){var major=Math.floor(version/0x10000);var minor=version-(major*0x10000);return major.toString()+"."+minor.toString();}}
function jQueryLikeParamSerializer(){return function(params){if(!params){return'';}
var parts=[];serialize(params,'',true);return parts.join('&');function serializeValue(v){if(angular.isObject(v)){return angular.isDate(v)?v.toISOString():angular.toJson(v);}
if(v===null||angular.isUndefined(v)){return"";}
return v;}
function serialize(toSerialize,prefix,topLevel){if(angular.isArray(toSerialize)){angular.forEach(toSerialize,function(value,index){serialize(value,prefix+(angular.isObject(value)?'['+index+']':''));});}else if(angular.isObject(toSerialize)&&!angular.isDate(toSerialize)){angular.forEach(toSerialize,function(value,key){serialize(value,prefix+
(topLevel?'':'[')+
key+
(topLevel?'':']'));});}else{parts.push(encodeURIComponent(prefix)+'='+encodeURIComponent(serializeValue(toSerialize)));}}}}
function mnLimitTo(){return function(string,limit){if(string===undefined){return"";}
return(angular.isString(string)?string:angular.toJson(string)).substring(0,limit);}}
function mnFormatStorageMode(){return function(value,isEnterprise){switch(value){case"plasma":return"Standard GSI";case"forestdb":return(isEnterprise?"Legacy":"Standard")+" GSI";case"memory_optimized":return"Memory Optimized GSI";default:return value;}};}
function lodash(){return function(){var args=Array.prototype.slice.call(arguments,0);var method=args.shift();return _[method].apply(_,args);};}
function isDisabled(){return function($event){return angular.element($event.currentTarget).hasClass("dynamic_disabled");};}
function mnMath(){return function(){var args=Array.prototype.slice.call(arguments,0);var method=args.shift();return Math[method].apply(null,args);}}
function mnTrustAsHtml($sce){return function(html){return $sce.trustAsHtml(html);};}
var basedigits="0123456789ABCDEF";function mnIntegerToString(){return function(number,base){var rv=[];var sign='';if(number<0){sign='-';number=-number;}
do{var r=number%base;number=(number/base)>>0;rv.push(basedigits.charAt(r));}while(number!=0);rv.push(sign);rv.reverse();return rv.join('');}}
function mnCount(){return function(count,text){if(count==null){return'?'+text+'(s)';}
count=Number(count);if(count>1){var lastWord=text.split(/\s+/).slice(-1)[0];var specialPluralizations={'copy':'copies'};var specialCase=specialPluralizations[lastWord];if(specialCase){text=specialCase;}else{text+='s';}}
return[String(count),' ',text].join('');};}
function removeEmptyValue(){return function(object){return _.transform(_.clone(object),function(result,n,key){if(n===""){return;}
result[key]=n;});};}
function addNodeCount(perNode){var serversCount=(_.keys(perNode)||[]).length;return serversCount+" "+(serversCount===1?'node':'nodes');}
function formatProgressMessage(){return function(task,includeRebalance){switch(task.type){case"indexer":return"building view index "+task.bucket+"/"+task.designDocument;case"global_indexes":return"building index "+task.index+" on bucket "+task.bucket;case"view_compaction":return"compacting view index "+task.bucket+"/"+task.designDocument;case"bucket_compaction":return"compacting bucket "+task.bucket;case"loadingSampleBucket":return"loading sample: "+task.bucket;case"orphanBucket":return"orphan bucket: "+task.bucket;case"clusterLogsCollection":return"collecting logs from "+addNodeCount(task.perNode);case"rebalance":return!!includeRebalance;}};}
function mnCloneOnlyData(){return function(data){return JSON.parse(JSON.stringify(data));};}
function httpParamSerializerJQLike($httpParamSerializerJQLike){return $httpParamSerializerJQLike;}
function mnParseHttpDate(){var rfc1123RE=/^\s*[a-zA-Z]+, ([0-9][0-9]) ([a-zA-Z]+) ([0-9]{4,4}) ([0-9]{2,2}):([0-9]{2,2}):([0-9]{2,2}) GMT\s*$/m;var rfc850RE=/^\s*[a-zA-Z]+, ([0-9][0-9])-([a-zA-Z]+)-([0-9]{2,2}) ([0-9]{2,2}):([0-9]{2,2}):([0-9]{2,2}) GMT\s*$/m;var asctimeRE=/^\s*[a-zA-Z]+ ([a-zA-Z]+) ((?:[0-9]| )[0-9]) ([0-9]{2,2}):([0-9]{2,2}):([0-9]{2,2}) ([0-9]{4,4})\s*$/m;var monthDict={};(function(){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var i=monthNames.length-1;i>=0;i--){var name=monthNames[i];var shortName=name.substring(0,3);monthDict[name]=i;monthDict[shortName]=i;}})();var badDateException;(function(){try{throw{};}catch(e){badDateException=e;}})();function parseMonth(month){var number=monthDict[month];if(number===undefined)
throw badDateException;return number;}
function doParseHTTPDate(date){var match;if((match=rfc1123RE.exec(date))||(match=rfc850RE.exec(date))){var day=parseInt(match[1],10);var month=parseMonth(match[2]);var year=parseInt(match[3],10);var hour=parseInt(match[4],10);var minute=parseInt(match[5],10);var second=parseInt(match[6],10);return new Date(Date.UTC(year,month,day,hour,minute,second));}else if((match=asctimeRE.exec(date))){var month=parseMonth(match[1]);var day=parseInt(match[2],10);var hour=parseInt(match[3],10);var minute=parseInt(match[4],10);var second=parseInt(match[5],10);var year=parseInt(match[6],10);return new Date(Date.UTC(year,month,day,hour,minute,second));}else{throw badDateException;}}
return function(date,badDate){try{return doParseHTTPDate(date);}catch(e){if(e===badDateException){return badDate||(new Date());}
throw e;}}}
function mnPrepareQuantity(){return function(value,K){K=K||1024;var M=K*K;var G=M*K;var T=G*K;if(K!==1024&&K!==1000){throw new Error("Unknown number system");}
var t=_.detect([[T,'T'],[G,'G'],[M,'M'],[K,'K']],function(t){return value>=t[0];})||[1,''];if(K===1024){t[1]+='B';}
return t;};}
function mnCalculatePercent(){return function(value,total){return(value*100/total)>>0;};}
function mnEllipsisiseOnLeft(){return function(text,length){if(length<=3){return text;}
if(text.length>length){return"..."+text.slice(3-length);}
return text;};}
function mnRescaleForSum(){return function(newSum,values,oldSum){if(oldSum==null){oldSum=_.inject(values,function(a,v){return a+v;},0);}
var error=0;var outputValues=new Array(values.length);for(var i=0;i<outputValues.length;i++){var v=values[i];v*=newSum;v+=error;error=v%oldSum;outputValues[i]=Math.floor(v/oldSum);}
return outputValues;};}
function mnNaturalSorting(){return function naturalSort(a,b){var re=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,sre=/(^[ ]*|[ ]*$)/g,ore=/^0/,x=a.toString().replace(sre,'')||'',y=b.toString().replace(sre,'')||'',xN=x.replace(re,'\0$1\0').replace(/\0$/,'').replace(/^\0/,'').split('\0'),yN=y.replace(re,'\0$1\0').replace(/\0$/,'').replace(/^\0/,'').split('\0');for(var cLoc=0,numS=Math.max(xN.length,yN.length);cLoc<numS;cLoc++){var oFxNcL=!(xN[cLoc]||'').match(ore)&&parseFloat(xN[cLoc])||xN[cLoc]||0;var oFyNcL=!(yN[cLoc]||'').match(ore)&&parseFloat(yN[cLoc])||yN[cLoc]||0;if(isNaN(oFxNcL)!==isNaN(oFyNcL))return(isNaN(oFxNcL))?1:-1;else if(typeof oFxNcL!==typeof oFyNcL){oFxNcL+='';oFyNcL+='';}
if(oFxNcL<oFyNcL)return-1;if(oFxNcL>oFyNcL)return 1;}
return 0;};}
function mnMakeSafeForCSS(){return function(name){return name.replace(/[^a-z0-9]/g,function(s){var c=s.charCodeAt(0);if(c==32)return'-';if(c>=65&&c<=90)return'_'+s.toLowerCase();return'__'+('000'+c.toString(16)).slice(-4);});};}
function mnStripPortHTML(){var cachedAllServers;var cachedIsStripping;var strippingRE=/:8091$/;return function(value,allServers){if(allServers===undefined){throw new Error("second argument is required!");}
if(cachedAllServers===allServers){var isStripping=cachedIsStripping;}else{if(allServers.length==0||_.isString(allServers[0])){var allNames=allServers;}else{var allNames=_.pluck(allServers,'hostname');}
var isStripping=_.all(allNames,function(h){return h.match(strippingRE);});cachedIsStripping=isStripping;cachedAllServers=allServers;}
if(isStripping){var match=value.match(strippingRE);return match?value.slice(0,match.index):value;}
return value;};}
function mnTruncateTo3Digits(){return function(value,leastScale,roundMethod){if(!value){return 0;}
var scale=_.detect([100,10,1,0.1,0.01,0.001],function(v){return value>=v;})||0.0001;if(leastScale!=undefined&&leastScale>scale){scale=leastScale;}
scale=100/scale;return Math[roundMethod||"round"](value*scale)/scale;};}
function mnFormatQuantity(mnPrepareQuantityFilter,mnTruncateTo3DigitsFilter){return function(value,numberSystem,spacing){if(!value&&!_.isNumber(value)){return value;}
if(spacing==null){spacing='';}
if(numberSystem===1000&&value<=9999&&value%1===0){return value;}
var t=mnPrepareQuantityFilter(value,numberSystem);return[mnTruncateTo3DigitsFilter(value/t[0],undefined,"floor"),spacing,t[1]].join('');};}
function mnFormatMemSize(mnFormatQuantityFilter){return function(value){return mnFormatQuantityFilter(value,null,' ');};}
function mnMsToTime(){return function(ms){var d,h,m,s;s=Math.floor(ms/1000);m=Math.floor(s/60);s=s%60;h=Math.floor(m/60);m=m%60;d=Math.floor(h/24);h=h%24;return(h?(h+':'):'')+
((m>9)?m:("0"+m))+":"+((s>9)?s:("0"+s));}}
function mnFormatUptime(){return function(seconds,precision){precision=precision||8;var arr=[[86400,"days","day"],[3600,"hours","hour"],[60,"minutes","minute"],[1,"seconds","second"]];var rv=[];_.each(arr,function(item){var period=item[0];var value=(seconds/period)>>0;seconds-=value*period;if(value){rv.push(String(value)+' '+(value>1?item[1]:item[2]));}
return!!--precision;});return rv.join(', ');};}
function mnMBtoBytes(IEC){return function(MB){return MB*IEC.Mi;};}
function mnBytesToMB(IEC){return function(bytes){return Math.floor(bytes/IEC.Mi);};}
function parseVersion(){return function(str){if(!str){return;}
var a=str.split(/[-_]/);if(a.length===3){a.splice(2,0,undefined);}
a[0]=(a[0].match(/[0-9]+\.[0-9]+\.[0-9]+/)||["0.0.0"])[0];a[1]=a[1]||"0";a[3]=(a[3]&&(a[3].substr(0,1).toUpperCase()+a[3].substr(1)))||"DEV";return a;}}
function getStringBytes(){return function(countMe){if(!_.isString(countMe)){return 0;}
var escapedStr=encodeURI(countMe);var escapedStrLength=escapedStr.length;if(escapedStr.indexOf("%")!=-1){var count=escapedStr.split("%").length-1||1;return count+(escapedStrLength-(count*3));}else{return escapedStrLength;}}}
function mnFormatServices(){return function(service){switch(service){case'kv':return'Data';case'query':case'n1ql':return'Query';case'index':return'Index';case'fts':return'Search';case'eventing':return'Eventing';case'cbas':return'Analytics';default:return service;}}}
function mnFormatServicesArray(){return function(services){return _.map(services,mnFormatServices());};}
function mnPrettyVersion(parseVersionFilter){return function(str,full){if(!str){return;}
var a=parseVersionFilter(str);var suffix="";if(full&&a[2]){suffix='-'+a[2];}
return[a[3],"Edition",a[0],"build",a[1]+suffix].join(' ');};}
function encodeURIComponentFilter(){return encodeURIComponent;}})();(function(){angular.module('mnJquery',[]).factory('jQuery',jQueryFactory);function jQueryFactory(){!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(g,e){"use strict";var t=[],v=g.document,r=Object.getPrototypeOf,s=t.slice,y=t.concat,u=t.push,i=t.indexOf,n={},o=n.toString,m=n.hasOwnProperty,a=m.toString,l=a.call(Object),b={},x=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},w=function(e){return null!=e&&e===e.window},c={type:!0,src:!0,nonce:!0,noModule:!0};function C(e,t,n){var r,i,o=(n=n||v).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function T(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.4.1 -ajax,-ajax/jsonp,-ajax/load,-ajax/parseXML,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-event/ajax,-effects,-effects/Tween,-effects/animatedSelector",E=function(e,t){return new E.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function p(e){var t=!!e&&"length"in e&&e.length,n=T(e);return!x(e)&&!w(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}E.fn=E.prototype={jquery:f,constructor:E,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=E.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return E.each(this,e)},map:function(n){return this.pushStack(E.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},E.extend=E.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||x(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(E.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||E.isPlainObject(n)?n:{},i=!1,a[t]=E.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},E.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=m.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t){C(e,{nonce:t&&t.nonce})},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(d,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?E.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return y.apply([],a)},guid:1,support:b}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=t[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var h=function(n){var e,p,x,o,i,h,f,g,w,u,l,C,T,a,E,v,s,c,y,N="sizzle"+1*new Date,m=n.document,A=0,r=0,d=ue(),b=ue(),k=ue(),S=ue(),D=function(e,t){return e===t&&(l=!0),0},L={}.hasOwnProperty,t=[],j=t.pop,q=t.push,O=t.push,P=t.slice,H=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},I="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+R+"*("+B+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+R+"*\\]",W=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",$=new RegExp(R+"+","g"),F=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g"),z=new RegExp("^"+R+"*,"+R+"*"),_=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),U=new RegExp(R+"|>"),V=new RegExp(W),X=new RegExp("^"+B+"$"),Q={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+W),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+I+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,G=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\([\\da-f]{1,6}"+R+"?|("+R+")|.)","ig"),ne=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){C()},ae=xe(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{O.apply(t=P.call(m.childNodes),m.childNodes),t[m.childNodes.length].nodeType}catch(e){O={apply:t.length?function(e,t){q.apply(e,P.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,d=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==d&&9!==d&&11!==d)return n;if(!r&&((e?e.ownerDocument||e:m)!==T&&C(e),e=e||T,E)){if(11!==d&&(u=Z.exec(t)))if(i=u[1]){if(9===d){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return O.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&p.getElementsByClassName&&e.getElementsByClassName)return O.apply(n,e.getElementsByClassName(i)),n}if(p.qsa&&!S[t+" "]&&(!v||!v.test(t))&&(1!==d||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===d&&U.test(t)){(s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=N),o=(l=h(t)).length;while(o--)l[o]="#"+s+" "+be(l[o]);c=l.join(","),f=ee.test(t)&&ye(e.parentNode)||e}try{return O.apply(n,f.querySelectorAll(c)),n}catch(e){S(t,!0)}finally{s===N&&e.removeAttribute("id")}}}return g(t.replace(F,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>x.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[N]=!0,e}function ce(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)x.attrHandle[n[r]]=t}function de(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function pe(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in p=se.support={},i=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},C=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:m;return r!==T&&9===r.nodeType&&r.documentElement&&(a=(T=r).documentElement,E=!i(T),m!==T&&(n=T.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),p.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),p.getElementsByTagName=ce(function(e){return e.appendChild(T.createComment("")),!e.getElementsByTagName("*").length}),p.getElementsByClassName=J.test(T.getElementsByClassName),p.getById=ce(function(e){return a.appendChild(e).id=N,!T.getElementsByName||!T.getElementsByName(N).length}),p.getById?(x.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},x.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(x.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},x.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),x.find.TAG=p.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):p.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},x.find.CLASS=p.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(p.qsa=J.test(T.querySelectorAll))&&(ce(function(e){a.appendChild(e).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+R+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+R+"*(?:value|"+I+")"),e.querySelectorAll("[id~="+N+"-]").length||v.push("~="),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+N+"+*").length||v.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=T.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+R+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(p.matchesSelector=J.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){p.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",W)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=J.test(a.compareDocumentPosition),y=t||J.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!p.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument===m&&y(m,e)?-1:t===T||t.ownerDocument===m&&y(m,t)?1:u?H(u,e)-H(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===T?-1:t===T?1:i?-1:o?1:u?H(u,e)-H(u,t):0;if(i===o)return de(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?de(a[r],s[r]):a[r]===m?-1:s[r]===m?1:0}),T},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if((e.ownerDocument||e)!==T&&C(e),p.matchesSelector&&E&&!S[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||p.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){S(t,!0)}return 0<se(t,T,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!==T&&C(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!==T&&C(e);var n=x.attrHandle[t.toLowerCase()],r=n&&L.call(x.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:p.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!p.detectDuplicates,u=!p.sortStable&&e.slice(0),e.sort(D),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(x=se.selectors={cacheLength:50,createPseudo:le,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&V.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=d[e+" "];return t||(t=new RegExp("(^|"+R+")"+e+"("+R+"|$)"))&&d(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace($," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),b="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=b&&e.nodeName.toLowerCase(),d=!n&&!b,p=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(b?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&d){p=(s=(r=(i=(o=(a=c)[N]||(a[N]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===A&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(p=s=0)||u.pop())if(1===a.nodeType&&++p&&a===e){i[h]=[A,s,p];break}}else if(d&&(p=s=(r=(i=(o=(a=e)[N]||(a[N]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===A&&r[1]),!1===p)while(a=++s&&a&&a[l]||(p=s=0)||u.pop())if((b?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++p&&(d&&((i=(o=a[N]||(a[N]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[A,p]),a===e))break;return(p-=v)===g||p%g==0&&0<=p/g}}},PSEUDO:function(e,o){var t,a=x.pseudos[e]||x.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[N]?a(o):1<a.length?(t=[e,e,"",o],x.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=H(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace(F,"$1"));return s[N]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return X.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===T.activeElement&&(!T.hasFocus||T.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=x.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[e]=pe(e);for(e in{submit:!0,reset:!0})x.pseudos[e]=he(e);function me(){}function be(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function xe(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,d=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[A,d];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[N]||(e[N]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===A&&r[1]===d)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Ce(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Te(p,h,g,v,y,e){return v&&!v[N]&&(v=Te(v)),y&&!y[N]&&(y=Te(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!p||!e&&h?c:Ce(c,s,p,n,r),d=g?y||(e?p:l||v)?[]:t:f;if(g&&g(f,d,n,r),v){i=Ce(d,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(d[u[o]]=!(f[u[o]]=a))}if(e){if(y||p){if(y){i=[],o=d.length;while(o--)(a=d[o])&&i.push(f[o]=a);y(null,d=[],i,r)}o=d.length;while(o--)(a=d[o])&&-1<(i=y?H(e,a):s[o])&&(e[i]=!(t[i]=a))}}else d=Ce(d===t?d.splice(l,d.length):d),y?y(null,t,d,r):O.apply(t,d)})}function Ee(e){for(var i,t,n,r=e.length,o=x.relative[e[0].type],a=o||x.relative[" "],s=o?1:0,u=xe(function(e){return e===i},a,!0),l=xe(function(e){return-1<H(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=x.relative[e[s].type])c=[xe(we(c),t)];else{if((t=x.filter[e[s].type].apply(null,e[s].matches))[N]){for(n=++s;n<r;n++)if(x.relative[e[n].type])break;return Te(1<s&&we(c),1<s&&be(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(F,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&be(e))}c.push(t)}return we(c)}return me.prototype=x.filters=x.pseudos,x.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=b[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=x.preFilter;while(a){for(o in n&&!(r=z.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=_.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(F," ")}),a=a.slice(n.length)),x.filter)!(r=Q[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):b(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,b,r,i=[],o=[],a=k[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[N]?i.push(a):o.push(a);(a=k(e,(v=o,m=0<(y=i).length,b=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],d=w,p=e||b&&x.find.TAG("*",i),h=A+=null==d?1:Math.random()||.1,g=p.length;for(i&&(w=t===T||t||i);l!==g&&null!=(o=p[l]);l++){if(b&&o){a=0,t||o.ownerDocument===T||(C(o),n=!E);while(s=v[a++])if(s(o,t||T,n)){r.push(o);break}i&&(A=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=j.call(r));f=Ce(f)}O.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(A=h,w=d),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&x.relative[o[1].type]){if(!(t=(x.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=Q.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],x.relative[s=a.type])break;if((u=x.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&be(o)))return O.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},p.sortStable=N.split("").sort(D).join("")===N,p.detectDuplicates=!!l,C(),p.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),p.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(I,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(g);E.find=h,E.expr=h.selectors,E.expr[":"]=E.expr.pseudos,E.uniqueSort=E.unique=h.uniqueSort,E.text=h.getText,E.isXMLDoc=h.isXML,E.contains=h.contains,E.escapeSelector=h.escape;var N=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&E(e).is(n))break;r.push(e)}return r},A=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=E.expr.match.needsContext;function S(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function L(e,n,r){return x(n)?E.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?E.grep(e,function(e){return e===n!==r}):"string"!=typeof n?E.grep(e,function(e){return-1<i.call(n,e)!==r}):E.filter(n,e,r)}E.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?E.find.matchesSelector(r,e)?[r]:[]:E.find.matches(e,E.grep(t,function(e){return 1===e.nodeType}))},E.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(E(e).filter(function(){for(t=0;t<r;t++)if(E.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)E.find(e,i[t],n);return 1<r?E.uniqueSort(n):n},filter:function(e){return this.pushStack(L(this,e||[],!1))},not:function(e){return this.pushStack(L(this,e||[],!0))},is:function(e){return!!L(this,"string"==typeof e&&k.test(e)?E(e):e||[],!1).length}});var j,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(E.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||j,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof E?t[0]:t,E.merge(this,E.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:v,!0)),D.test(r[1])&&E.isPlainObject(t))for(r in t)x(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=v.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):x(e)?void 0!==n.ready?n.ready(e):e(E):E.makeArray(e,this)}).prototype=E.fn,j=E(v);var O=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function H(e,t){while((e=e[t])&&1!==e.nodeType);return e}E.fn.extend({has:function(e){var t=E(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(E.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&E(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&E.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?E.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(E(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),E.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return N(e,"parentNode")},parentsUntil:function(e,t,n){return N(e,"parentNode",n)},next:function(e){return H(e,"nextSibling")},prev:function(e){return H(e,"previousSibling")},nextAll:function(e){return N(e,"nextSibling")},prevAll:function(e){return N(e,"previousSibling")},nextUntil:function(e,t,n){return N(e,"nextSibling",n)},prevUntil:function(e,t,n){return N(e,"previousSibling",n)},siblings:function(e){return A((e.parentNode||{}).firstChild,e)},children:function(e){return A(e.firstChild)},contents:function(e){return"undefined"!=typeof e.contentDocument?e.contentDocument:(S(e,"template")&&(e=e.content||e),E.merge([],e.childNodes))}},function(r,i){E.fn[r]=function(e,t){var n=E.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=E.filter(t,n)),1<this.length&&(P[r]||E.uniqueSort(n),O.test(r)&&n.reverse()),this.pushStack(n)}});var I=/[^\x20\t\r\n\f]+/g;function R(e){return e}function B(e){throw e}function M(e,t,n,r){var i;try{e&&x(i=e.promise)?i.call(e).done(t).fail(n):e&&x(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}E.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},E.each(e.match(I)||[],function(e,t){n[t]=!0}),n):E.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){E.each(e,function(e,t){x(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==T(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return E.each(arguments,function(e,t){var n;while(-1<(n=E.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<E.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},E.extend({Deferred:function(e){var o=[["notify","progress",E.Callbacks("memory"),E.Callbacks("memory"),2],["resolve","done",E.Callbacks("once memory"),E.Callbacks("once memory"),0,"resolved"],["reject","fail",E.Callbacks("once memory"),E.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return E.Deferred(function(r){E.each(o,function(e,t){var n=x(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&x(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,x(t)?s?t.call(e,l(u,o,R,s),l(u,o,B,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,B,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){E.Deferred.exceptionHook&&E.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==B&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(E.Deferred.getStackHook&&(t.stackTrace=E.Deferred.getStackHook()),g.setTimeout(t))}}return E.Deferred(function(e){o[0][3].add(l(0,e,x(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,x(t)?t:R)),o[2][3].add(l(0,e,x(n)?n:B))}).promise()},promise:function(e){return null!=e?E.extend(e,a):a}},s={};return E.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=E.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(M(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||x(i[t]&&i[t].then)))return o.then();while(t--)M(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;E.Deferred.exceptionHook=function(e,t){g.console&&g.console.warn&&e&&W.test(e.name)&&g.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},E.readyException=function(e){g.setTimeout(function(){throw e})};var $=E.Deferred();function F(){v.removeEventListener("DOMContentLoaded",F),g.removeEventListener("load",F),E.ready()}E.fn.ready=function(e){return $.then(e)["catch"](function(e){E.readyException(e)}),this},E.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--E.readyWait:E.isReady)||(E.isReady=!0)!==e&&0<--E.readyWait||$.resolveWith(v,[E])}}),E.ready.then=$.then,"complete"===v.readyState||"loading"!==v.readyState&&!v.documentElement.doScroll?g.setTimeout(E.ready):(v.addEventListener("DOMContentLoaded",F),g.addEventListener("load",F));var z=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===T(n))for(s in i=!0,n)z(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,x(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(E(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,U=/-([a-z])/g;function V(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(U,V)}var Q=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Y(){this.expando=E.expando+Y.uid++}Y.uid=1,Y.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Q(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(I)||[]).length;while(n--)delete r[t[n]]}(void 0===t||E.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!E.isEmptyObject(t)}};var G=new Y,K=new Y,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function ee(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Z,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}K.set(e,t,n)}else n=void 0;return n}E.extend({hasData:function(e){return K.hasData(e)||G.hasData(e)},data:function(e,t,n){return K.access(e,t,n)},removeData:function(e,t){K.remove(e,t)},_data:function(e,t,n){return G.access(e,t,n)},_removeData:function(e,t){G.remove(e,t)}}),E.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=K.get(o),1===o.nodeType&&!G.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),ee(o,r,i[r]));G.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){K.set(this,n)}):z(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=K.get(o,n))?t:void 0!==(t=ee(o,n))?t:void 0;this.each(function(){K.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){K.remove(this,e)})}}),E.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=G.get(e,t),n&&(!r||Array.isArray(n)?r=G.access(e,t,E.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=E.queue(e,t),r=n.length,i=n.shift(),o=E._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){E.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return G.get(e,n)||G.access(e,n,{empty:E.Callbacks("once memory").add(function(){G.remove(e,[t+"queue",n])})})}}),E.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?E.queue(this[0],t):void 0===n?this:this.each(function(){var e=E.queue(this,t,n);E._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&E.dequeue(this,t)})},dequeue:function(e){return this.each(function(){E.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=E.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=G.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var te=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ne=new RegExp("^(?:([+-])=|)("+te+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ie=v.documentElement,oe=function(e){return E.contains(e.ownerDocument,e)},ae={composed:!0};ie.getRootNode&&(oe=function(e){return E.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var se=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===E.css(e,"display")},ue=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,r||[]),t)e.style[o]=a[o];return i};var le={};function ce(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=G.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&se(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=le[s])||(o=a.body.appendChild(a.createElement(s)),u=E.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),le[s]=u)))):"none"!==n&&(l[c]="none",G.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}E.fn.extend({show:function(){return ce(this,!0)},hide:function(){return ce(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){se(this)?E(this).show():E(this).hide()})}});var fe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,pe=/^$|^module$|\/(?:java|ecma)script/i,he={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ge(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&S(e,t)?E.merge([e],n):n}function ve(e,t){for(var n=0,r=e.length;n<r;n++)G.set(e[n],"globalEval",!t||G.get(t[n],"globalEval"))}he.optgroup=he.option,he.tbody=he.tfoot=he.colgroup=he.caption=he.thead,he.th=he.td;var ye,me,be=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),d=[],p=0,h=e.length;p<h;p++)if((o=e[p])||0===o)if("object"===T(o))E.merge(d,o.nodeType?[o]:o);else if(be.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=he[s]||he._default,a.innerHTML=u[1]+E.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;E.merge(d,a.childNodes),(a=f.firstChild).textContent=""}else d.push(t.createTextNode(o));f.textContent="",p=0;while(o=d[p++])if(r&&-1<E.inArray(o,r))i&&i.push(o);else if(l=oe(o),a=ge(f.appendChild(o),"script"),l&&ve(a),n){c=0;while(o=a[c++])pe.test(o.type||"")&&n.push(o)}return f}ye=v.createDocumentFragment().appendChild(v.createElement("div")),(me=v.createElement("input")).setAttribute("type","radio"),me.setAttribute("checked","checked"),me.setAttribute("name","t"),ye.appendChild(me),b.checkClone=ye.cloneNode(!0).cloneNode(!0).lastChild.checked,ye.innerHTML="<textarea>x</textarea>",b.noCloneChecked=!!ye.cloneNode(!0).lastChild.defaultValue;var we=/^key/,Ce=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Te=/^([^.]*)(?:\.(.+)|)/;function Ee(){return!0}function Ne(){return!1}function Ae(e,t){return e===function(){try{return v.activeElement}catch(e){}}()==("focus"===t)}function ke(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)ke(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Ne;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return E().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=E.guid++)),e.each(function(){E.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(G.set(e,i,!1),E.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=G.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(E.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),G.set(this,i,r),t=o(this,i),this[i](),r!==(n=G.get(this,i))||t?G.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else r.length&&(G.set(this,i,{value:E.event.trigger(E.extend(r[0],E.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===G.get(e,i)&&E.event.add(e,i,Ee)}E.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,d,p,h,g,v=G.get(t);if(v){n.handler&&(n=(o=n).handler,i=o.selector),i&&E.find.matchesSelector(ie,i),n.guid||(n.guid=E.guid++),(u=v.events)||(u=v.events={}),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof E&&E.event.triggered!==e.type?E.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(I)||[""]).length;while(l--)p=g=(s=Te.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),p&&(f=E.event.special[p]||{},p=(i?f.delegateType:f.bindType)||p,f=E.event.special[p]||{},c=E.extend({type:p,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&E.expr.match.needsContext.test(i),namespace:h.join(".")},o),(d=u[p])||((d=u[p]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(p,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?d.splice(d.delegateCount++,0,c):d.push(c),E.event.global[p]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,d,p,h,g,v=G.hasData(e)&&G.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(I)||[""]).length;while(l--)if(p=g=(s=Te.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),p){f=E.event.special[p]||{},d=u[p=(r?f.delegateType:f.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=d.length;while(o--)c=d[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,f.remove&&f.remove.call(e,c));a&&!d.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||E.removeEvent(e,p,v.handle),delete u[p])}else for(p in u)E.event.remove(e,p+t[l],n,r,!0);E.isEmptyObject(u)&&G.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=E.event.fix(e),u=new Array(arguments.length),l=(G.get(this,"events")||{})[s.type]||[],c=E.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){a=E.event.handlers.call(this,s,l),t=0;while((i=a[t++])&&!s.isPropagationStopped()){s.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!s.isImmediatePropagationStopped())s.rnamespace&&!1!==o.namespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(r=((E.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<E(i,this).index(l):E.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(E.Event.prototype,t,{enumerable:!0,configurable:!0,get:x(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[E.expando]?e:new E.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return fe.test(t.type)&&t.click&&S(t,"input")&&Se(t,"click",Ee),!1},trigger:function(e){var t=this||e;return fe.test(t.type)&&t.click&&S(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return fe.test(t.type)&&t.click&&S(t,"input")&&G.get(t,"click")||S(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},E.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},E.Event=function(e,t){if(!(this instanceof E.Event))return new E.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ee:Ne,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&E.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:Ne,isPropagationStopped:Ne,isImmediatePropagationStopped:Ne,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ee,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ee,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ee,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},E.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ce.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},E.event.addProp),E.each({focus:"focusin",blur:"focusout"},function(e,t){E.event.special[e]={setup:function(){return Se(this,e,Ae),!1},trigger:function(){return Se(this,e),!0},delegateType:t}}),E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){E.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||E.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),E.fn.extend({on:function(e,t,n,r){return ke(this,e,t,n,r)},one:function(e,t,n,r){return ke(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,E(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ne),this.each(function(){E.event.remove(this,e,n,t)})}});var De=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Le=/<script|<style|<link/i,je=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Oe(e,t){return S(e,"table")&&S(11!==t.nodeType?t:t.firstChild,"tr")&&E(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function He(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ie(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(G.hasData(e)&&(o=G.access(e),a=G.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)E.event.add(t,i,l[i][n]);K.hasData(e)&&(s=K.access(e),u=E.extend({},s),K.set(t,u))}}function Re(n,r,i,o){r=y.apply([],r);var e,t,a,s,u,l,c=0,f=n.length,d=f-1,p=r[0],h=x(p);if(h||1<f&&"string"==typeof p&&!b.checkClone&&je.test(p))return n.each(function(e){var t=n.eq(e);h&&(r[0]=p.call(this,e,t.html())),Re(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=E.map(ge(e,"script"),Pe)).length;c<f;c++)u=e,c!==d&&(u=E.clone(u,!0,!0),s&&E.merge(a,ge(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,E.map(a,He),c=0;c<s;c++)u=a[c],pe.test(u.type||"")&&!G.access(u,"globalEval")&&E.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?E._evalUrl&&!u.noModule&&E._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")}):C(u.textContent.replace(qe,""),u,l))}return n}function Be(e,t,n){for(var r,i=t?E.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||E.cleanData(ge(r)),r.parentNode&&(n&&oe(r)&&ve(ge(r,"script")),r.parentNode.removeChild(r));return e}E.extend({htmlPrefilter:function(e){return e.replace(De,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=oe(e);if(!(b.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||E.isXMLDoc(e)))for(a=ge(c),r=0,i=(o=ge(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&fe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ge(e),a=a||ge(c),r=0,i=o.length;r<i;r++)Ie(o[r],a[r]);else Ie(e,c);return 0<(a=ge(c,"script")).length&&ve(a,!f&&ge(e,"script")),c},cleanData:function(e){for(var t,n,r,i=E.event.special,o=0;void 0!==(n=e[o]);o++)if(Q(n)){if(t=n[G.expando]){if(t.events)for(r in t.events)i[r]?E.event.remove(n,r):E.removeEvent(n,r,t.handle);n[G.expando]=void 0}n[K.expando]&&(n[K.expando]=void 0)}}}),E.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return z(this,function(e){return void 0===e?E.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Re(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)})},prepend:function(){return Re(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Oe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(E.cleanData(ge(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return E.clone(this,e,t)})},html:function(e){return z(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Le.test(e)&&!he[(de.exec(e)||["",""])[1].toLowerCase()]){e=E.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(E.cleanData(ge(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Re(this,arguments,function(e){var t=this.parentNode;E.inArray(this,n)<0&&(E.cleanData(ge(this)),t&&t.replaceChild(e,this))},n)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){E.fn[e]=function(e){for(var t,n=[],r=E(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),E(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Me=new RegExp("^("+te+")(?!px)[a-z%]+$","i"),We=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=g),t.getComputedStyle(e)},$e=new RegExp(re.join("|"),"i");function Fe(e,t,n){var r,i,o,a,s=e.style;return(n=n||We(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||oe(e)||(a=E.style(e,t)),!b.pixelBoxStyles()&&Me.test(a)&&$e.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){s.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ie.appendChild(s).appendChild(u);var e=g.getComputedStyle(u);n="1%"!==e.top,a=12===t(e.marginLeft),u.style.right="60%",o=36===t(e.right),r=36===t(e.width),u.style.position="absolute",i=12===t(u.offsetWidth/3),ie.removeChild(s),u=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s=v.createElement("div"),u=v.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===u.style.backgroundClip,E.extend(b,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),a},scrollboxSize:function(){return e(),i}}))}();var _e=["Webkit","Moz","ms"],Ue=v.createElement("div").style,Ve={};function Xe(e){var t=E.cssProps[e]||Ve[e];return t||(e in Ue?e:Ve[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=_e.length;while(n--)if((e=_e[n]+t)in Ue)return e}(e)||e)}var Qe,Ye,Ge=/^(none|table(?!-c[ea]).+)/,Ke=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},Ze={letterSpacing:"0",fontWeight:"400"};function et(e,t,n){var r=ne.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function tt(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=E.css(e,n+re[a],!0,i)),r?("content"===n&&(u-=E.css(e,"padding"+re[a],!0,i)),"margin"!==n&&(u-=E.css(e,"border"+re[a]+"Width",!0,i))):(u+=E.css(e,"padding"+re[a],!0,i),"padding"!==n?u+=E.css(e,"border"+re[a]+"Width",!0,i):s+=E.css(e,"border"+re[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function nt(e,t,n){var r=We(e),i=(!b.boxSizingReliable()||n)&&"border-box"===E.css(e,"boxSizing",!1,r),o=i,a=Fe(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Me.test(a)){if(!n)return a;a="auto"}return(!b.boxSizingReliable()&&i||"auto"===a||!parseFloat(a)&&"inline"===E.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===E.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+tt(e,t,n||(i?"border":"content"),o,r,a)+"px"}E.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Fe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Ke.test(t),l=e.style;if(u||(t=Xe(s)),a=E.cssHooks[t]||E.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=ne.exec(n))&&i[1]&&(n=function(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return E.css(e,t,"")},u=s(),l=n&&n[3]||(E.cssNumber[t]?"":"px"),c=e.nodeType&&(E.cssNumber[t]||"px"!==l&&+u)&&ne.exec(E.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)E.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,E.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(E.cssNumber[s]?"":"px")),b.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Ke.test(t)||(t=Xe(s)),(a=E.cssHooks[t]||E.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Fe(e,t,r)),"normal"===i&&t in Ze&&(i=Ze[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),E.each(["height","width"],function(e,u){E.cssHooks[u]={get:function(e,t,n){if(t)return!Ge.test(E.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?nt(e,u,n):ue(e,Je,function(){return nt(e,u,n)})},set:function(e,t,n){var r,i=We(e),o=!b.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===E.css(e,"boxSizing",!1,i),s=n?tt(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-tt(e,u,"border",!1,i)-.5)),s&&(r=ne.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=E.css(e,u)),et(0,t,s)}}}),E.cssHooks.marginLeft=ze(b.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Fe(e,"marginLeft"))||e.getBoundingClientRect().left-ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),E.each({margin:"",padding:"",border:"Width"},function(i,o){E.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+re[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(E.cssHooks[i+o].set=et)}),E.fn.extend({css:function(e,t){return z(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=We(e),i=t.length;a<i;a++)o[t[a]]=E.css(e,t[a],!1,r);return o}return void 0!==n?E.style(e,t,n):E.css(e,t)},e,t,1<arguments.length)}}),E.fn.delay=function(r,e){return r=E.fx&&E.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=g.setTimeout(e,r);t.stop=function(){g.clearTimeout(n)}})},Qe=v.createElement("input"),Ye=v.createElement("select").appendChild(v.createElement("option")),Qe.type="checkbox",b.checkOn=""!==Qe.value,b.optSelected=Ye.selected,(Qe=v.createElement("input")).value="t",Qe.type="radio",b.radioValue="t"===Qe.value;var rt,it=E.expr.attrHandle;E.fn.extend({attr:function(e,t){return z(this,E.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){E.removeAttr(this,e)})}}),E.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?E.prop(e,t,n):(1===o&&E.isXMLDoc(e)||(i=E.attrHooks[t.toLowerCase()]||(E.expr.match.bool.test(t)?rt:void 0)),void 0!==n?null===n?void E.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=E.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!b.radioValue&&"radio"===t&&S(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(I);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),rt={set:function(e,t,n){return!1===t?E.removeAttr(e,n):e.setAttribute(n,n),n}},E.each(E.expr.match.bool.source.match(/\w+/g),function(e,t){var a=it[t]||E.find.attr;it[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=it[o],it[o]=r,r=null!=a(e,t,n)?o:null,it[o]=i),r}});var ot=/^(?:input|select|textarea|button)$/i,at=/^(?:a|area)$/i;function st(e){return(e.match(I)||[]).join(" ")}function ut(e){return e.getAttribute&&e.getAttribute("class")||""}function lt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(I)||[]}E.fn.extend({prop:function(e,t){return z(this,E.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[E.propFix[e]||e]})}}),E.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&E.isXMLDoc(e)||(t=E.propFix[t]||t,i=E.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=E.find.attr(e,"tabindex");return t?parseInt(t,10):ot.test(e.nodeName)||at.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),b.optSelected||(E.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){E.propFix[this.toLowerCase()]=this}),E.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(x(t))return this.each(function(e){E(this).addClass(t.call(this,e,ut(this)))});if((e=lt(t)).length)while(n=this[u++])if(i=ut(n),r=1===n.nodeType&&" "+st(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=st(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(x(t))return this.each(function(e){E(this).removeClass(t.call(this,e,ut(this)))});if(!arguments.length)return this.attr("class","");if((e=lt(t)).length)while(n=this[u++])if(i=ut(n),r=1===n.nodeType&&" "+st(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=st(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):x(i)?this.each(function(e){E(this).toggleClass(i.call(this,e,ut(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=E(this),r=lt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=ut(this))&&G.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":G.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+st(ut(n))+" ").indexOf(t))return!0;return!1}});var ct=/\r/g;E.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=x(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,E(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=E.map(t,function(e){return null==e?"":e+""})),(r=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=E.valHooks[t.type]||E.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(ct,""):null==e?"":e:void 0}}),E.extend({valHooks:{option:{get:function(e){var t=E.find.attr(e,"value");return null!=t?t:st(E.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!S(n.parentNode,"optgroup"))){if(t=E(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=E.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<E.inArray(E.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),E.each(["radio","checkbox"],function(){E.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<E.inArray(E(e).val(),t)}},b.checkOn||(E.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),b.focusin="onfocusin"in g;var ft=/^(?:focusinfocus|focusoutblur)$/,dt=function(e){e.stopPropagation()};E.extend(E.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,d=[n||v],p=m.call(e,"type")?e.type:e,h=m.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||v,3!==n.nodeType&&8!==n.nodeType&&!ft.test(p+E.event.triggered)&&(-1<p.indexOf(".")&&(p=(h=p.split(".")).shift(),h.sort()),u=p.indexOf(":")<0&&"on"+p,(e=e[E.expando]?e:new E.Event(p,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:E.makeArray(t,[e]),c=E.event.special[p]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!w(n)){for(s=c.delegateType||p,ft.test(s+p)||(o=o.parentNode);o;o=o.parentNode)d.push(o),a=o;a===(n.ownerDocument||v)&&d.push(a.defaultView||a.parentWindow||g)}i=0;while((o=d[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||p,(l=(G.get(o,"events")||{})[e.type]&&G.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&Q(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=p,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(d.pop(),t)||!Q(n)||u&&x(n[p])&&!w(n)&&((a=n[u])&&(n[u]=null),E.event.triggered=p,e.isPropagationStopped()&&f.addEventListener(p,dt),n[p](),e.isPropagationStopped()&&f.removeEventListener(p,dt),E.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=E.extend(new E.Event,n,{type:e,isSimulated:!0});E.event.trigger(r,null,t)}}),E.fn.extend({trigger:function(e,t){return this.each(function(){E.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return E.event.trigger(e,t,n,!0)}}),b.focusin||E.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){E.event.simulate(r,e.target,E.event.fix(e))};E.event.special[r]={setup:function(){var e=this.ownerDocument||this,t=G.access(e,r);t||e.addEventListener(n,i,!0),G.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=G.access(e,r)-1;t?G.access(e,r,t):(e.removeEventListener(n,i,!0),G.remove(e,r))}}});var pt,ht=/\[\]$/,gt=/\r?\n/g,vt=/^(?:submit|button|image|reset|file)$/i,yt=/^(?:input|select|textarea|keygen)/i;function mt(n,e,r,i){var t;if(Array.isArray(e))E.each(e,function(e,t){r||ht.test(n)?i(n,t):mt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==T(e))i(n,e);else for(t in e)mt(n+"["+t+"]",e[t],r,i)}E.param=function(e,t){var n,r=[],i=function(e,t){var n=x(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!E.isPlainObject(e))E.each(e,function(){i(this.name,this.value)});else for(n in e)mt(n,e[n],t,i);return r.join("&")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=E.prop(this,"elements");return e?E.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!E(this).is(":disabled")&&yt.test(this.nodeName)&&!vt.test(e)&&(this.checked||!fe.test(e))}).map(function(e,t){var n=E(this).val();return null==n?null:Array.isArray(n)?E.map(n,function(e){return{name:t.name,value:e.replace(gt,"\r\n")}}):{name:t.name,value:n.replace(gt,"\r\n")}}).get()}}),E.fn.extend({wrapAll:function(e){var t;return this[0]&&(x(e)&&(e=e.call(this[0])),t=E(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return x(n)?this.each(function(e){E(this).wrapInner(n.call(this,e))}):this.each(function(){var e=E(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=x(t);return this.each(function(e){E(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){E(this).replaceWith(this.childNodes)}),this}}),E.expr.pseudos.hidden=function(e){return!E.expr.pseudos.visible(e)},E.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},b.createHTMLDocument=((pt=v.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===pt.childNodes.length),E.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(b.createHTMLDocument?((r=(t=v.implementation.createHTMLDocument("")).createElement("base")).href=v.location.href,t.head.appendChild(r)):t=v),o=!n&&[],(i=D.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&E(o).remove(),E.merge([],i.childNodes)));var r,i,o},E.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=E.css(e,"position"),c=E(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=E.css(e,"top"),u=E.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),x(t)&&(t=t.call(e,n,E.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},E.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){E.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===E.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===E.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=E(e).offset()).top+=E.css(e,"borderTopWidth",!0),i.left+=E.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-E.css(r,"marginTop",!0),left:t.left-i.left-E.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===E.css(e,"position"))e=e.offsetParent;return e||ie})}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;E.fn[t]=function(e){return z(this,function(e,t,n){var r;if(w(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),E.each(["top","left"],function(e,n){E.cssHooks[n]=ze(b.pixelPosition,function(e,t){if(t)return t=Fe(e,n),Me.test(t)?E(e).position()[n]+"px":t})}),E.each({Height:"height",Width:"width"},function(a,s){E.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){E.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return z(this,function(e,t,n){var r;return w(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?E.css(e,t,i):E.style(e,t,n,i)},s,n?e:void 0,n)}})}),E.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){E.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),E.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),E.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),E.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),x(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||E.guid++,i},E.holdReady=function(e){e?E.readyWait++:E.ready(!0)},E.isArray=Array.isArray,E.parseJSON=JSON.parse,E.nodeName=S,E.isFunction=x,E.isWindow=w,E.camelCase=X,E.type=T,E.now=Date.now,E.isNumeric=function(e){var t=E.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return E});var bt=g.jQuery,xt=g.$;return E.noConflict=function(e){return g.$===E&&(g.$=xt),e&&g.jQuery===E&&(g.jQuery=bt),E},e||(g.jQuery=g.$=E),E});return jQuery;}})();(function(){"use strict";angular.module('mnEnv',[]).factory('mnEnv',mnEnvFactory);function mnEnvFactory($http){var envUrl='/_uiEnv';var envDefaults={disable_autocomplete:true};return{loadEnv:loadEnv};function loadEnv(){return $http({method:'GET',url:envUrl,cache:true}).then(function(resp){return angular.extend({},envDefaults,resp.data);});}}})();(function(){"use strict";angular.module('mnHttp',["mnPendingQueryKeeper","mnFilters"]).factory('mnHttpInterceptor',mnHttpFactory).config(function($httpProvider){$httpProvider.interceptors.push('mnHttpInterceptor');});function mnHttpFactory(mnPendingQueryKeeper,$q,$timeout,jQueryLikeParamSerializerFilter,$exceptionHandler){var myHttpInterceptor={request:request,response:response,responseError:responseError};return myHttpInterceptor;function request(config){if(config.url.indexOf(".html")!==-1||config.doNotIntercept){return config;}else{return intercept(config);}}
function intercept(config){var pendingQuery={config:_.clone(config)};var mnHttpConfig=config.mnHttp||{};delete config.mnHttp;if(config.method.toLowerCase()==="post"&&mnHttpConfig.cancelPrevious){var queryInFly=mnPendingQueryKeeper.getQueryInFly(config);queryInFly&&queryInFly.canceler();}
var canceler=$q.defer();var timeoutID;var timeout=config.timeout;var isCleared;function clear(){if(isCleared){return;}
isCleared=true;timeoutID&&$timeout.cancel(timeoutID);mnPendingQueryKeeper.removeQueryInFly(pendingQuery);}
function cancel(reason){return function(){canceler.resolve(reason);clear();};}
switch(config.method.toLowerCase()){case'post':case'put':config.headers=config.headers||{};if(!mnHttpConfig.isNotForm){config.headers['Content-Type']='application/x-www-form-urlencoded; charset=UTF-8';if(!angular.isString(config.data)){config.data=jQueryLikeParamSerializerFilter(config.data);}}
break;}
config.timeout=canceler.promise;config.clear=clear;pendingQuery.canceler=cancel("cancelled");pendingQuery.group=mnHttpConfig.group;mnPendingQueryKeeper.push(pendingQuery);if(timeout){timeoutID=$timeout(cancel("timeout"),timeout);}
return config;}
function clearOnResponse(response){if(response.config.clear&&angular.isFunction(response.config.clear)){response.config.clear();delete response.config.clear;}}
function response(response){clearOnResponse(response);return response;}
function responseError(response){if(response instanceof Error){$exceptionHandler(response);}
clearOnResponse(response);return $q.reject(response);}}})();(function(){"use strict";angular.module("mnPermissions",[]).provider("mnPermissions",mnPermissionsProvider);function mnPermissionsProvider(){this.$get=["$http","$timeout","$q","$rootScope","mnBucketsService","$parse",mnPermissionsFacatory];this.set=set;this.setBucketSpecific=setBucketSpecific;var bucketSpecificPermissions=[function(name,buckets){var basePermissions=["cluster.bucket["+name+"].settings!write","cluster.bucket["+name+"].settings!read","cluster.bucket["+name+"].recovery!write","cluster.bucket["+name+"].recovery!read","cluster.bucket["+name+"].stats!read","cluster.bucket["+name+"]!flush","cluster.bucket["+name+"]!delete","cluster.bucket["+name+"]!compact","cluster.bucket["+name+"].xdcr!read","cluster.bucket["+name+"].xdcr!write","cluster.bucket["+name+"].xdcr!execute","cluster.bucket["+name+"].n1ql.select!execute","cluster.bucket["+name+"].n1ql.index!read","cluster.bucket["+name+"].n1ql.index!write"];if(name==="."||buckets.byName[name].isMembase){basePermissions=basePermissions.concat(["cluster.bucket["+name+"].views!read","cluster.bucket["+name+"].views!write","cluster.bucket["+name+"].views!compact"]);}
if(name==="."||!buckets.byName[name].isMemcached){basePermissions=basePermissions.concat(["cluster.bucket["+name+"].data!write","cluster.bucket["+name+"].data!read","cluster.bucket["+name+"].data.docs!read","cluster.bucket["+name+"].data.docs!write","cluster.bucket["+name+"].data.docs!upsert"]);}
return basePermissions}];var interestingPermissions=["cluster.buckets!create","cluster.nodes!write","cluster.pools!read","cluster.server_groups!read","cluster.server_groups!write","cluster.settings!read","cluster.settings!write","cluster.stats!read","cluster.tasks!read","cluster.settings.indexes!read","cluster.admin.internal!all","cluster.xdcr.settings!read","cluster.xdcr.settings!write","cluster.xdcr.remote_clusters!read","cluster.xdcr.remote_clusters!write","cluster.admin.security!read","cluster.admin.logs!read","cluster.admin.settings!read","cluster.admin.settings!write","cluster.logs!read","cluster.pools!write","cluster.settings.indexes!write","cluster.admin.security!write","cluster.samples!read","cluster.nodes!read","cluster.admin.memcached!read","cluster.admin.memcached!write"];function getAll(){return _.clone(interestingPermissions);}
function set(permission){if(!_.contains(interestingPermissions,permission)){interestingPermissions.push(permission);}
return this;}
function setBucketSpecific(func){if(angular.isFunction(func)){bucketSpecificPermissions.push(func);}
return this;}
function generateBucketPermissions(bucketName,buckets){return bucketSpecificPermissions.reduce(function(acc,getChunk){return acc.concat(getChunk(bucketName,buckets));},[]);}
function mnPermissionsFacatory($http,$timeout,$q,$rootScope,mnBucketsService,$parse){var mnPermissions={clear:clear,get:doCheck,check:check,getFresh:getFresh,getBucketPermissions:getBucketPermissions,export:{data:{},cluster:{},default:{all:undefined,membase:undefined}}};var cache;interestingPermissions.push(generateBucketPermissions("."));return mnPermissions;function clear(){delete $rootScope.rbac;mnPermissions.export.cluster={};mnPermissions.export.data={};clearCache();}
function clearCache(){cache=null;}
function getFresh(){clearCache();return mnPermissions.check();}
function getBucketPermissions(bucketName){return mnBucketsService.getBucketsByType().then(function(bucketsDetails){return generateBucketPermissions(bucketName,bucketsDetails);});}
function check(){if(!!cache){return $q.when(mnPermissions.export);}
return doCheck(["cluster.bucket[.].settings!read"]).then(function(resp){var permissions=getAll();if(resp.data["cluster.bucket[.].settings!read"]){return mnBucketsService.getBucketsByType().then(function(bucketsDetails){if(bucketsDetails.length){angular.forEach(bucketsDetails,function(bucket){permissions=permissions.concat(generateBucketPermissions(bucket.name,bucketsDetails));});}
return doCheck(permissions).then(function(resp){var bucketNamesByPermission={};var permissions=resp.data;angular.forEach(bucketsDetails,function(bucket){var interesting=generateBucketPermissions(bucket.name,bucketsDetails);angular.forEach(interesting,function(permission){var bucketPermission=permission.split("["+bucket.name+"]")[1];bucketNamesByPermission[bucketPermission]=bucketNamesByPermission[bucketPermission]||[];if(permissions[permission]){bucketNamesByPermission[bucketPermission].push(bucket.name);}});});resp.bucketNames=bucketNamesByPermission;return resp;});});}else{return doCheck(permissions);}}).then(function(resp){cache=convertIntoTree(resp.data);mnPermissions.export.data=resp.data;mnPermissions.export.cluster=cache.cluster;mnPermissions.export.bucketNames=resp.bucketNames||{};return mnPermissions.export;});}
function convertIntoTree(permissions){var rv={};angular.forEach(permissions,function(value,key){var levels=key.split(/[\[\]]+/);var regex=/[.:!]+/;if(levels[1]){levels=_.compact(levels[0].split(regex).concat([levels[1]]).concat(levels[2].split(regex)))}else{levels=levels[0].split(regex);}
var path=levels.shift()+"['"+levels.join("']['")+"']";$parse(path).assign(rv,value);});return rv;}
function doCheck(interestingPermissions){return $http({method:"POST",url:"/pools/default/checkPermissions",data:interestingPermissions.join(',')});}}}})();(function(){"use strict";angular.module("mnPendingQueryKeeper",[]).factory("mnPendingQueryKeeper",mnPendingQueryKeeperFactory);function mnPendingQueryKeeperFactory(){var pendingQueryKeeper=[];return{getQueryInFly:getQueryInFly,removeQueryInFly:removeQueryInFly,push:push,cancelTabsSpecificQueries:cancelTabsSpecificQueries,cancelAllQueries:cancelAllQueries};function cancelAllQueries(){var i=pendingQueryKeeper.length;while(i--){pendingQueryKeeper[i].canceler();}}
function cancelTabsSpecificQueries(){var i=pendingQueryKeeper.length;while(i--){if(pendingQueryKeeper[i].group!=="global"){pendingQueryKeeper[i].canceler();}}}
function removeQueryInFly(findMe){var i=pendingQueryKeeper.length;while(i--){if(pendingQueryKeeper[i]===findMe){pendingQueryKeeper.splice(i,1);}}}
function getQueryInFly(config){return _.find(pendingQueryKeeper,function(inFly){return inFly.config.method===config.method&&inFly.config.url===config.url;});}
function push(query){pendingQueryKeeper.push(query);}}})();(function(){"use strict";angular.module('mnHelper',['ui.router','mnTasksDetails','mnAlertsService','mnBucketsService']).factory('mnHelper',mnHelperFactory);function mnHelperFactory($window,$state,$location,$timeout,$q,mnTasksDetails,mnAlertsService,$http,mnPendingQueryKeeper){var mnHelper={wrapInFunction:wrapInFunction,calculateMaxMemorySize:calculateMaxMemorySize,initializeDetailsHashObserver:initializeDetailsHashObserver,checkboxesToList:checkboxesToList,reloadApp:reloadApp,reloadState:reloadState,listToCheckboxes:listToCheckboxes,getEndings:getEndings,generateID:generateID};return mnHelper;function getEndings(length){return length!==1?"s":"";}
function wrapInFunction(value){return function(){return value;};}
function calculateMaxMemorySize(totalRAMMegs){return Math.floor(Math.max(totalRAMMegs*0.8,totalRAMMegs-1024));}
function initializeDetailsHashObserver($scope,hashKey,stateName){function getHashValue(){return _.clone($state.params[hashKey])||[];}
$scope.isDetailsOpened=function(hashValue){return _.contains(getHashValue(),String(hashValue));};$scope.toggleDetails=function(hashValue){var currentlyOpened=getHashValue();var stateParams={};if($scope.isDetailsOpened(hashValue)){stateParams[hashKey]=_.difference(currentlyOpened,[String(hashValue)]);$state.go(stateName,stateParams);}else{currentlyOpened.push(String(hashValue));stateParams[hashKey]=currentlyOpened;$state.go(stateName,stateParams);}};}
function checkboxesToList(object){return _.chain(object).pick(angular.identity).keys().value();}
function listToCheckboxes(list){return _.zipObject(list,_.fill(new Array(list.length),true,0,list.length));}
function reloadApp(){$window.location.reload();}
function generateID(){return Math.random().toString(36).substr(2,9);}
function reloadState(state){if(!state){mnPendingQueryKeeper.cancelAllQueries();}
return $state.reload(state);}}})();(function(){"use strict";angular.module("mnPoll",["mnTasksDetails","mnPromiseHelper"]).factory("mnPoller",mnPollerFactory).factory("mnEtagPoller",mnEtagPollerFactory);function mnEtagPollerFactory(mnPoller){function EtagPoller(scope,request,doNotListenVisibilitychange){mnPoller.call(this,scope,request,doNotListenVisibilitychange);}
EtagPoller.prototype=Object.create(mnPoller.prototype);EtagPoller.prototype.constructor=EtagPoller;EtagPoller.prototype.cycle=cycle;return EtagPoller;function cycle(){var self=this;var timestamp=new Date();self.doCallPromise=self.doCall(timestamp);self.doCallPromise.then(function(){if((self.doCallPromise!==this)||self.isStopped(timestamp)){return;}
self.cycle();}.bind(self.doCallPromise));return self;}}
function mnPollerFactory($q,$timeout,mnTasksDetails,mnPromiseHelper){function Poller(scope,request,doNotListenVisibilitychange){this.deferred=$q.defer();this.request=request;this.scope=scope;var self=this;function onVisibilitychange(){if(document.hidden){self.stop();}else{self.reload();}}
scope.$on('$destroy',function(){if(!doNotListenVisibilitychange){document.removeEventListener('visibilitychange',onVisibilitychange);}
self.onDestroy();});if(!doNotListenVisibilitychange){document.addEventListener('visibilitychange',onVisibilitychange);}
this.latestResult=undefined;this.stopTimestamp=undefined;this.extractInterval=undefined;this.timeout=undefined;this.doCallPromise=undefined;}
Poller.prototype.isStopped=isStopped;Poller.prototype.doCall=doCall;Poller.prototype.setInterval=setInterval;Poller.prototype.cycle=cycle;Poller.prototype.doCycle=doCycle;Poller.prototype.stop=stop;Poller.prototype.subscribe=subscribe;Poller.prototype.showSpinner=showSpinner;Poller.prototype.reload=reload;Poller.prototype.reloadOnScopeEvent=reloadOnScopeEvent;Poller.prototype.onDestroy=onDestroy;Poller.prototype.getLatestResult=getLatestResult;Poller.prototype.throttledReload=_.debounce(reload,100);return Poller;function onDestroy(){this.stop();}
function getLatestResult(){return this.latestResult;}
function isStopped(startTimestamp){return!(angular.isUndefined(this.stopTimestamp)||startTimestamp>=this.stopTimestamp);}
function reloadOnScopeEvent(eventName,vm,spinnerName){var self=this;function action(){self.reload();if(vm){self.showSpinner(vm,spinnerName);}}
if(angular.isArray(eventName)){angular.forEach(eventName,function(event){self.scope.$on(event,action);});}else{self.scope.$on(eventName,action);}
return this;}
function setInterval(interval){this.extractInterval=interval;return this;}
function reload(keepLatestResult){if(!keepLatestResult){delete this.latestResult;}
this.stop();this.cycle();return this;}
function showSpinner(vm,name){var self=this;mnPromiseHelper(vm,self.doCallPromise).showSpinner(name);return self;}
function doCall(timestamp){var self=this;var query=angular.isFunction(self.request)?self.request(self.latestResult):self.request;query.then(function(result){if((query!==this)||self.isStopped(timestamp)){return;}
self.deferred.notify(result);}.bind(query));return query;}
function cycle(){if(this.isLaunched){return this;}
delete this.stopTimestamp
this.isLaunched=true;this.doCycle();return this;}
function doCycle(){var self=this;var timestamp=new Date();self.doCallPromise=self.doCall(timestamp);if(self.extractInterval){self.doCallPromise.then(function(result){if((self.doCallPromise!==this)||self.isStopped(timestamp)){return;}
var interval=angular.isFunction(self.extractInterval)?self.extractInterval(result):self.extractInterval;self.timeout=$timeout(self.doCycle.bind(self),interval);}.bind(self.doCallPromise));}
self.doCallPromise.then(null,function(resp){self.stop();});return this;}
function stop(){var self=this;self.isLaunched=false;self.stopTimestamp=new Date();$timeout.cancel(self.timeout);}
function subscribe(subscriber,keeper){var self=this;self.deferred.promise.then(null,null,angular.isFunction(subscriber)?function(value){subscriber(value,self.latestResult);self.latestResult=value;}:function(value){(keeper||self.scope)[subscriber]=value;self.latestResult=value;});return self;}}})();(function(){"use strict";angular.module('mnPromiseHelper',['mnAlertsService','mnHelper']).factory('mnPromiseHelper',mnPromiseHelperFactory);function mnPromiseHelperFactory(mnAlertsService,mnHelper,$timeout,$rootScope){return mnPromiseHelper;function mnPromiseHelper(scope,promise,modalInstance){var spinnerNameOrFunction='viewLoading';var errorsNameOrCallback='errors';var pendingGlobalSpinnerQueries={};var spinnerTimeout;var promiseHelper={applyToScope:applyToScope,getPromise:getPromise,onSuccess:onSuccess,reloadState:reloadState,closeFinally:closeFinally,closeOnSuccess:closeOnSuccess,showErrorsSensitiveSpinner:showErrorsSensitiveSpinner,catchErrorsFromSuccess:catchErrorsFromSuccess,showSpinner:showSpinner,showGlobalSpinner:showGlobalSpinner,catchErrors:catchErrors,catchGlobalErrors:catchGlobalErrors,showGlobalSuccess:showGlobalSuccess,broadcast:broadcast,removeErrors:removeErrors,closeModal:closeModal}
return promiseHelper;function getPromise(){return promise;}
function onSuccess(cb){promise.then(cb);return this;}
function reloadState(state){promise.then(function(){spinnerCtrl(true);mnHelper.reloadState(state);});return this;}
function closeFinally(){promise['finally'](closeModal);return this;}
function closeOnSuccess(){promise.then(closeModal);return this;}
function showErrorsSensitiveSpinner(name,timer,scope){name&&setSpinnerName(name);maybeHandleSpinnerWithTimer(timer,scope);promise.then(clearSpinnerTimeout,hideSpinner);return this;}
function catchErrorsFromSuccess(nameOrCallback){nameOrCallback&&setErrorsNameOrCallback(nameOrCallback);promise.then(function(resp){errorsCtrl(extractErrors(resp));});return this;}
function showSpinner(name,timer,scope){name&&setSpinnerName(name);maybeHandleSpinnerWithTimer(timer,scope);promise.then(hideSpinner,hideSpinner);return this;}
function showGlobalSpinner(timer){var id=doShowGlobalSpinner();promise.then(hideGlobalSpinner(id),hideGlobalSpinner(id));return this;}
function catchErrors(nameOrCallback){nameOrCallback&&setErrorsNameOrCallback(nameOrCallback);promise.then(removeErrors,function(resp){if(resp.status!==-1){errorsCtrl(extractErrors(resp));}});return this;}
function catchGlobalErrors(errorMessage,timeout){promise.then(null,function(resp){if(resp.status!==-1){mnAlertsService.formatAndSetAlerts(errorMessage||extractErrors(resp.data),'error',timeout);}});return this;}
function showGlobalSuccess(successMessage,timeout){if(timeout===undefined){timeout=2500;}
promise.then(function(resp){mnAlertsService.formatAndSetAlerts(successMessage||resp.data,'success',timeout);});return this;}
function applyToScope(keyOrFunction){promise.then(angular.isFunction(keyOrFunction)?keyOrFunction:function(value){scope[keyOrFunction]=value;},function(){if(angular.isFunction(keyOrFunction)){keyOrFunction(null);}else{delete scope[keyOrFunction];}});return this;}
function broadcast(event,data){promise.then(function(){$rootScope.$broadcast(event,data);});return this;}
function spinnerCtrl(isLoaded){if(angular.isFunction(spinnerNameOrFunction)){spinnerNameOrFunction(isLoaded);}else{scope[spinnerNameOrFunction]=isLoaded;}}
function errorsCtrl(errors){if(angular.isFunction(errorsNameOrCallback)){errorsNameOrCallback(errors);}else{scope[errorsNameOrCallback]=errors;}}
function doShowGlobalSpinner(){var timer=$timeout(function(){$rootScope.mnGlobalSpinnerFlag=true;},100);var id="id"+Math.random().toString(36).substr(2,9);pendingGlobalSpinnerQueries[id]=timer;return id;}
function hideGlobalSpinner(id){return function(){$timeout.cancel(pendingGlobalSpinnerQueries[id]);delete pendingGlobalSpinnerQueries[id];if(_.isEmpty(pendingGlobalSpinnerQueries)){$rootScope.mnGlobalSpinnerFlag=false;}}}
function hideSpinner(){spinnerCtrl(false);clearSpinnerTimeout();}
function removeErrors(){errorsCtrl(false);return this;}
function setSpinnerName(name){spinnerNameOrFunction=name;}
function setErrorsNameOrCallback(nameOrCallback){errorsNameOrCallback=nameOrCallback;}
function closeModal(){modalInstance.close(scope);}
function extractErrors(resp){if(resp.status===0){return false;}
var errors=resp.data&&resp.data.errors!==undefined&&_.keys(resp.data).length===1?resp.data.errors:resp.data||resp;return _.isEmpty(errors)?false:errors;}
function clearSpinnerTimeout(){if(spinnerTimeout){$timeout.cancel(spinnerTimeout);}}
function enableSpinnerTimeout(timer){spinnerTimeout=$timeout(function(){spinnerCtrl(true);},timer);}
function maybeHandleSpinnerWithTimer(timer,scope){if(timer){enableSpinnerTimeout(timer);scope.$on("$destroy",clearSpinnerTimeout);}else{spinnerCtrl(true);}}}}})();(function(){"use strict";angular.module('mnPools',[]).factory('mnPools',mnPoolsFactory);function mnPoolsFactory($http,$cacheFactory){var mnPools={get:get,clearCache:clearCache,getFresh:getFresh,export:{}};var launchID=(new Date()).valueOf()+'-'+((Math.random()*65536)>>0);return mnPools;function get(mnHttpParams){return $http({method:'GET',url:'/pools',cache:true,mnHttp:mnHttpParams,requestType:'json'}).then(function(resp){var pools=resp.data;pools.isInitialized=!!pools.pools.length;pools.launchID=pools.uuid+'-'+launchID;mnPools.export.isEnterprise=pools.isEnterprise;return pools;});}
function clearCache(){$cacheFactory.get('$http').remove('/pools');return this;}
function getFresh(){return mnPools.clearCache().get();}}})();(function(){"use strict";angular.module('mnPoolDefault',['mnPools','ui.bootstrap']).factory('mnPoolDefault',mnPoolDefaultFactory);function mnPoolDefaultFactory($http,$q,mnPools,$window,$location,$httpParamSerializerJQLike,mnHelper,$state){var latest={};var mnPoolDefault={latestValue:latestValue,get:get,clearCache:clearCache,getFresh:getFresh,setHideNavSidebar:setHideNavSidebar,getUrlsRunningService:getUrlsRunningService,export:{compat:undefined,hideNavSidebar:false}};var version50=encodeCompatVersion(5,0);var version51=encodeCompatVersion(5,1);var version55=encodeCompatVersion(5,5);var version65=encodeCompatVersion(6,5);var cache;var request;return mnPoolDefault;function setHideNavSidebar(value){mnPoolDefault.export.hideNavSidebar=value;}
function latestValue(){return latest;}
function encodeCompatVersion(major,minor){if(major<2){return 1;}
return major*0x10000+minor;}
function get(params,mnHttpParams){if(!(params&&params.etag)&&cache){return $q.when(cache);}
if(request&&!cache){return request;}
params=params||{waitChange:0};request=$q.all([$http({mnHttp:mnHttpParams,method:'GET',url:'/pools/default',params:params,timeout:30000}),mnPools.get(mnHttpParams)]).then(function(resp){var poolDefault=resp[0].data;var pools=resp[1]
poolDefault.rebalancing=poolDefault.rebalanceStatus!=='none';poolDefault.isGroupsAvailable=!!(pools.isEnterprise&&poolDefault.serverGroupsUri);poolDefault.isEnterprise=pools.isEnterprise;poolDefault.thisNode=_.detect(poolDefault.nodes,function(n){return n.thisNode;});poolDefault.compat={atLeast51:poolDefault.thisNode.clusterCompatibility>=version51,atLeast55:poolDefault.thisNode.clusterCompatibility>=version55,atLeast65:poolDefault.thisNode.clusterCompatibility>=version65};poolDefault.versions={"50":version50,"51":version51,"55":version55,"65":version65};poolDefault.capiBase=$window.location.protocol==="https:"?poolDefault.thisNode.couchApiBaseHTTPS:poolDefault.thisNode.couchApiBase;_.extend(mnPoolDefault.export,poolDefault);latest.value=poolDefault;cache=poolDefault;return poolDefault;},function(resp){if((resp.status===404&&resp.data==="unknown pool")||resp.status===500){mnHelper.reloadApp();}
return $q.reject(resp);});return request;}
function clearCache(){cache=undefined;request=undefined;return this;}
function getFresh(params){return mnPoolDefault.clearCache().get(params);}
function parseHostname(href){var l=document.createElement("a");l.href=href;return l;}
function getUrlsRunningService(nodeInfos,service,max){var nodes=_.filter(nodeInfos,function(node){return _.indexOf(node.services,service)>-1&&node.clusterMembership==='active';});if(max&&max<nodes.length){nodes=nodes.slice(0,max);}
var protocol=$location.protocol();var search=$httpParamSerializerJQLike($location.search());var hash=$location.hash();var ext=$state.transition?parseHostname($state.href($state.transition.to().name,$state.transition.params("to"),{absolute:true})).hash:"#!"+$location.path()+
(search?"?"+search:"")+
(hash?"#"+hash:"");return _.map(nodes,function(node){var link=parseHostname("http://"+node.hostname);var port=protocol=="https"?node.ports.httpsMgmt:link.port;return protocol
+"://"+link.hostname
+":"+port
+$window.location.pathname
+ext;});}}})();(function(){"use strict";angular.module('mnTasksDetails',[]).factory('mnTasksDetails',mnTasksDetailsFactory);function mnTasksDetailsFactory($http,$cacheFactory){var mnTasksDetails={get:get,clearCache:clearCache,getFresh:getFresh,getRebalanceReport:getRebalanceReport,clearRebalanceReportCache:clearRebalanceReportCache};return mnTasksDetails;function getRebalanceReport(url){return $http({url:url||"/logs/rebalanceReport",cache:true,method:'GET'}).then(null,function(){return{data:{stageInfo:{}}};});}
function clearRebalanceReportCache(url){$cacheFactory.get('$http').remove(url||"/logs/rebalanceReport");return this;}
function get(mnHttpParams){return $http({url:'/pools/default/tasks',method:'GET',cache:true,mnHttp:mnHttpParams}).then(function(resp){var rv={};var tasks=resp.data;rv.tasks=tasks;rv.tasksXDCR=_.filter(tasks,detectXDCRTask);rv.tasksRecovery=_.detect(tasks,detectRecoveryTasks);rv.tasksRebalance=_.detect(tasks,detectRebalanceTasks);rv.tasksWarmingUp=_.filter(tasks,detectWarmupTask);rv.inRebalance=!!(rv.tasksRebalance&&rv.tasksRebalance.status==="running");rv.inRecoveryMode=!!rv.tasksRecovery;rv.isLoadingSamples=!!_.detect(tasks,detectLoadingSamples);rv.stopRecoveryURI=rv.tasksRecovery&&rv.tasksRecovery.stopURI;rv.isSubtypeGraceful=rv.tasksRebalance.subtype==='gracefulFailover';rv.running=_.filter(tasks,function(task){return task.status==="running";});rv.isOrphanBucketTask=!!_.detect(tasks,detectOrphanBucketTask);return rv;});};function detectXDCRTask(taskInfo){return taskInfo.type==='xdcr';}
function detectOrphanBucketTask(taskInfo){return taskInfo.type==="orphanBucket";}
function detectRecoveryTasks(taskInfo){return taskInfo.type==="recovery";}
function detectRebalanceTasks(taskInfo){return taskInfo.type==="rebalance";}
function detectLoadingSamples(taskInfo){return taskInfo.type==="loadingSampleBucket"&&taskInfo.status==="running";}
function detectWarmupTask(task){return task.type==='warming_up'&&task.status==='running';}
function clearCache(){$cacheFactory.get('$http').remove('/pools/default/tasks');return this;}
function getFresh(mnHttpParams){return mnTasksDetails.clearCache().get(mnHttpParams);}}})();(function(){"use strict";angular.module("mnBucketsStats",[]).factory("mnBucketsStats",mnBucketsFactory);function mnBucketsFactory($http,$cacheFactory){var mnBucketsStats={get:get,clearCache:clearCache,};return mnBucketsStats;function get(mnHttpParams){return $http({method:"GET",cache:true,url:'/pools/default/buckets?basic_stats=true&skipMap=true',mnHttp:mnHttpParams});}
function clearCache(){$cacheFactory.get('$http').remove('/pools/default/buckets?basic_stats=true&skipMap=true');return this;}}})();(function(){"use strict";angular.module('mnCompaction',[]).factory('mnCompaction',mnCompactionFactory);function mnCompactionFactory($interval,$http){var startedCompactions={};var mnCompaction={registerAsTriggered:registerAsTriggered,registerAsTriggeredAndPost:registerAsTriggeredAndPost,getStartedCompactions:getStartedCompactions,canCompact:canCompact};activate();return mnCompaction;function activate(){$interval(function(){_.each(startedCompactions,mayBeExpired);},2000);}
function now(){return new Date().valueOf();}
function mayBeExpired(desc,key){if(desc.staredAt<now()){desc.undoBody();delete startedCompactions[key];}}
function registerAsTriggered(url,undoBody){if(startedCompactions[url]){mayBeExpired(startedCompactions[url],url);}else{startedCompactions[url]={url:url,undoBody:undoBody||new Function(),staredAt:now()+10000};}}
function registerAsTriggeredAndPost(url,undoBody){mnCompaction.registerAsTriggered(url,undoBody);return $http.post(url);}
function getStartedCompactions(){return startedCompactions;}
function canCompact(url){var desc=startedCompactions[url];return desc?desc.staredAt<=now():true;}}})();(function(){"use strict";angular.module('mnAlertsService',['ui.bootstrap','mnFilters']).service('mnAlertsService',mnAlertsServiceFactory);function mnAlertsServiceFactory($uibModal,$rootScope,$timeout){var alerts=[];var alertsHistory=[];var clientAlerts={hideCompatibility:false};var mnAlertsService={setAlert:setAlert,formatAndSetAlerts:formatAndSetAlerts,showAlertInPopup:showAlertInPopup,alerts:alerts,removeItem:removeItem,isNewAlert:isNewAlert,clientAlerts:clientAlerts};return mnAlertsService;function showAlertInPopup(message,title){var scope=$rootScope.$new();scope.alertsCtl={message:message};scope.title=title;return $uibModal.open({scope:scope,templateUrl:"app/components/mn_alerts_popup_message.html"}).result;}
function isNewAlert(item){var findedItem=_.find(alertsHistory,item);return _.indexOf(alertsHistory,findedItem)===-1;}
function startTimer(item,timeout){return $timeout(function(){removeItem(item);},parseInt(timeout,10));}
function removeItem(item){var index=_.indexOf(alerts,item);item.timeout&&$timeout.cancel(item.timeout);alerts.splice(index,1);}
function setAlert(type,message,timeout,id){var item={type:type||'error',msg:message,id:id};var findedItem=_.find(alerts,{type:type,msg:message});if(findedItem){removeItem(findedItem);}
alerts.push(item);alertsHistory.push(item);if(timeout){item.timeout=startTimer(item,timeout);}}
function formatAndSetAlerts(incomingAlerts,type,timeout){timeout=timeout||(60000*5);if((angular.isArray(incomingAlerts)&&angular.isString(incomingAlerts[0]))||angular.isObject(incomingAlerts)){angular.forEach(incomingAlerts,function(msg){setAlert(type,msg,timeout);});}
if(angular.isString(incomingAlerts)){setAlert(type,incomingAlerts,timeout);}}}})();(function(){"use strict";angular.module("mnExceptionReporter",[]).config(mnExceptionReporterConfig);function mnExceptionReporterConfig($provide){$provide.decorator('$exceptionHandler',mnExceptionReporter)}
function mnExceptionReporter($delegate,$injector){var errorReportsLimit=8;var sentReports=0;return function(exception,cause){if(exception.constructor.name==="Rejection"&&(exception.type===2||exception.type===3||exception.type===5)){return;}
exception.cause=cause;send(exception);$delegate(exception,cause);};function formatErrorMessage(exception){var error=["Got unhandled javascript error:\n"];angular.forEach(["name","message","fileName","lineNumber","columnNumber","stack"],function(property){if(exception[property]){error.push(property+": "+exception[property]+";\n");}});return error;}
function send(exception){if(exception.hasOwnProperty("config")&&exception.hasOwnProperty("headers")&&exception.hasOwnProperty("status")&&exception.hasOwnProperty("statusText")){return;}
var error;if(sentReports<errorReportsLimit){sentReports++;error=formatErrorMessage(exception);if(sentReports==errorReportsLimit-1){error.push("Further reports will be suppressed\n");}}
if(error){_.delay(function(){$injector.get("$http")({method:"POST",url:"/logClientError",data:error.join("")});},500);}}}})();(function(){"use strict";angular.module('mnPluggableUiRegistry',[]).provider('mnPluggableUiRegistry',mnPluggableUiRegistryProvider).factory('mnPluggableTabUtil',mnPluggableTabUtil).directive('mnPluggableUiTabs',mnPluggableUiTabs);function mnPluggableTabUtil(){return{getTabTemplate:getTabTemplate};function getTabTemplate(config,tabBarName){return"<a "+"ng-show=\""+config.ngShow+"\"class=\""+(config.responsiveHide?"resp-hide-sml ":"")+
(tabBarName=="indexesTab"?"pills":"")+"\"ui-sref=\""+config.state+
(config.includedByState?"\"ng-class=\"{currentnav: ('"+config.includedByState+"' | includedByState)}\"":"\"ui-sref-active=\"currentnav\"")+">"+
config.name+"</a>";};}
function mnPluggableUiTabs(mnPluggableUiRegistry,mnPluggableTabUtil,$compile){return{link:link};function link($scope,$element,$attrs){var pluggableUiConfigs=mnPluggableUiRegistry.getConfigsByTabBarName($attrs.mnTabBarName);if(!pluggableUiConfigs.length){return;}
pluggableUiConfigs=_.sortBy(pluggableUiConfigs,'index');angular.forEach(pluggableUiConfigs,function(config,index){config.ngShow=config.ngShow==undefined?true:config.ngShow;if(config.after){var targetTab=$element[0].querySelector("[mn-tab='"+config.after+"']");if(!targetTab){throw new Error("There is no tab with mn-tab="+config.after+" in "+$attrs.mnTabBarName);}
var compiled=$compile(mnPluggableTabUtil.getTabTemplate(config,$attrs.mnTabBarName))($scope);angular.element(targetTab).after(compiled);}else{var compiled=$compile(mnPluggableTabUtil.getTabTemplate(config,$attrs.mnTabBarName))($scope);$element.append(compiled);}});}}
function mnPluggableUiRegistryProvider(){var _configs=[];this.registerConfig=registerConfig;this.$get=mnPluggableUiRegistryFactory;function registerConfig(config){_configs.push(config);}
function mnPluggableUiRegistryFactory(){return{getConfigs:getConfigs,getConfigsByTabBarName:getConfigsByTabBarName};function getConfigs(){return _configs;}
function getConfigsByTabBarName(tabBarName){return _.filter(_configs,{plugIn:tabBarName});}}}}());(function(){"use strict";angular.module('mnSessionService',["mnAuthService","mnPoolDefault",'ui.bootstrap',]).factory('mnSessionService',mnSessionFactory);function mnSessionFactory($http,$window,$timeout,mnAuthService,mnPoolDefault,$uibModal,$interval){var mnSession={post:post,get:get,init:init,setTimeout:setTimeout,resetTimeoutAndSyncAcrossTabs:resetTimeoutAndSyncAcrossTabs,showTimeoutDialog:showTimeoutDialog};var throttledResetTimeoutAndSyncAcrossTabs=_.throttle(resetTimeoutAndSyncAcrossTabs,300);var sessionTimer;var sessionTimeoutDialog;var showTimeoutDialogTimer;return mnSession;function init($scope){angular.element($window).on("storage",doSyncAcrossTabs);angular.element($window).on("mousemove keydown touchstart",throttledResetTimeoutAndSyncAcrossTabs);$scope.$on("$destroy",function(){angular.element($window).off("mousemove keydown touchstart",throttledResetTimeoutAndSyncAcrossTabs);angular.element($window).off("storage",doSyncAcrossTabs);});}
function post(uiSessionTimeout){return $http({method:"POST",url:"/settings/security",data:{uiSessionTimeout:uiSessionTimeout?(uiSessionTimeout*60):undefined}});}
function get(){return mnPoolDefault.get().then(function(resp){return{uiSessionTimeout:(Number(resp.uiSessionTimeout)/60)||0};});}
function showTimeoutDialog(timeout){return function(){sessionTimeoutDialog=$uibModal.open({controller:function($scope){var timer=$interval(function(){--$scope.time;},1000);$scope.time=(timeout/1000);$scope.$on("$destroy",function(){$interval.cancel(timer);});},templateUrl:'app/mn_admin/mn_security/mn_session/mn_session_timeout_dialog.html'});sessionTimeoutDialog.result.then(function(){sessionTimeoutDialog=null;resetTimeoutAndSyncAcrossTabs();},function(closedBy){sessionTimeoutDialog=null;if(!closedBy){resetTimeoutAndSyncAcrossTabs();}});}}
function resetTimeout(timeout){timeout=Number(timeout);var dialogTimeout;if(!!sessionTimer){$timeout.cancel(sessionTimer);}
if(!!showTimeoutDialogTimer){$timeout.cancel(showTimeoutDialogTimer);}
if(!!timeout){dialogTimeout=timeout-30000;sessionTimer=$timeout(mnAuthService.logout.bind(mnAuthService),timeout);showTimeoutDialogTimer=$timeout(showTimeoutDialog(dialogTimeout),dialogTimeout);}}
function setTimeout(uiSessionTimeout){localStorage.setItem("uiSessionTimeout",Number(uiSessionTimeout)*1000);}
function resetTimeoutAndSyncAcrossTabs(){if(sessionTimeoutDialog){return;}
resetTimeout(localStorage.getItem("uiSessionTimeout"));localStorage.setItem("mnResetSessionTimeout",Number(localStorage.getItem("mnResetSessionTimeout")||"0")+1);}
function doSyncAcrossTabs(e){if(e.key==="mnResetSessionTimeout"){if(sessionTimeoutDialog){sessionTimeoutDialog.dismiss("reset");}
resetTimeout(localStorage.getItem("uiSessionTimeout"));}}}})();(function(){"use strict";angular.module('mnSession',['mnSessionService','mnPromiseHelper']).controller('mnSessionController',mnSessionController);function mnSessionController(mnSessionService,mnPromiseHelper){var vm=this;vm.submit=submit;activate();function activate(){mnPromiseHelper(vm,mnSessionService.get()).applyToScope("state");}
function submit(){if(vm.viewLoading){return;}
mnPromiseHelper(vm,mnSessionService.post(vm.state.uiSessionTimeout)).catchErrors().showSpinner().showGlobalSuccess("Session settings changed successfully!");};}})();(function(){"use strict";angular.module('app').constant('bucketsFormConfiguration',{authType:'sasl',name:'',conflictResolutionType:'seqno',saslPassword:'',bucketType:'membase',evictionPolicy:'valueOnly',evictionPolicyEphemeral:'noEviction',replicaNumber:"1",replicaIndex:"0",threadsNumber:"3",flushEnabled:"0",ramQuotaMB:"0",uri:'/pools/default/buckets',purgeInterval:"3",compressionMode:"passive",maxTTL:0}).constant('daysOfWeek',['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday']).constant('knownAlerts',['auto_failover_node','auto_failover_maximum_reached','auto_failover_other_nodes_down','auto_failover_cluster_too_small','auto_failover_disabled','ip','disk','overhead','ep_oom_errors','ep_item_commit_failed','audit_dropped_events','indexer_ram_max_usage','ep_clock_cas_drift_threshold_exceeded','communication_issue']).constant('timeUnitToSeconds',{minute:60,hour:3600,day:86400,week:691200,month:2678400,year:31622400}).constant("docsLimit",1000).constant("docBytesLimit",256*1024).constant("viewsPerPageLimit",6).constant("IEC",{Ki:1024,Mi:1048576,Gi:1073741824});})();(function(){"use strict";angular.module('mnAuth',['mnAuthService','ui.router','mnAutocompleteOff','ngMessages']).config(mnAuthConfig);function mnAuthConfig($stateProvider,$httpProvider,$urlRouterProvider){$httpProvider.interceptors.push(['$q','$injector',interceptorOf401]);$stateProvider.state('app.auth',{url:"/auth",templateUrl:'app/mn_auth/mn_auth.html',controller:'mnAuthController as authCtl'});function interceptorOf401($q,$injector){return{responseError:function(rejection){if(rejection.status===401&&rejection.config.url!=="/pools"&&rejection.config.url!=="/controller/changePassword"&&rejection.config.url!=="/uilogout"&&($injector.get('$state').includes('app.admin')||$injector.get('$state').includes('app.wizard'))&&!rejection.config.headers["ignore-401"]&&!$injector.get('mnLostConnectionService').getState().isActive){$injector.get('mnAuthService').logout();}
return $q.reject(rejection);}};}}})();(function(){"use strict";angular.module('mnAuth').controller('mnAuthController',mnAuthController);function mnAuthController(mnAuthService,$location,$state,$urlRouter){var vm=this;vm.loginFailed=false;vm.submit=submit;activate();function activate(){if($state.transition.$from().includes["app.wizard"]){error({status:"initialized"})}
mnAuthService.canUseCertForAuth().then(function(data){vm.canUseCert=data.cert_for_auth;});}
function error(resp){vm.error={};vm.error["_"+resp.status]=true;}
function success(){if($location.path()==="/auth"){$state.go('app.admin.overview.statistics');}else{$urlRouter.sync();}}
function submit(useCertForAuth){mnAuthService.login(vm.user,useCertForAuth).then(success,error);}}})();(function(){"use strict";angular.module('mnAuthService',['mnPools','ui.router','mnPendingQueryKeeper','mnPermissions']).factory('mnAuthService',mnAuthServiceFactory);function mnAuthServiceFactory($http,$state,mnPools,$rootScope,mnPendingQueryKeeper,mnPermissions,$uibModalStack,$window,$q,$cacheFactory){var mnAuthService={login:login,logout:_.once(logout),whoami:whoami,canUseCertForAuth:canUseCertForAuth};return mnAuthService;function whoami(){return $http({method:'GET',cache:true,url:'/whoami'}).then(function(resp){return resp.data;});}
function canUseCertForAuth(){return $http({method:'GET',url:'/_ui/canUseCertForAuth'}).then(function(r){return r.data;});}
function login(user,useCertForAuth){var config={method:'POST',url:'/uilogin'}
if(useCertForAuth){config.params={use_cert_for_auth:1};}else{user=user||{};config.data={user:user.username,password:user.password};}
return $http(config).then(function(resp){return mnPools.get().then(function(cachedPools){mnPools.clearCache();return mnPools.get().then(function(newPools){if(cachedPools.implementationVersion!==newPools.implementationVersion){return $q.reject({status:410});}else{return resp;}});}).then(function(resp){localStorage.setItem("mnLogIn",Number(localStorage.getItem("mnLogIn")||"0")+1);return resp;})});}
function logout(){$uibModalStack.dismissAll("uilogout");return $http({method:'POST',url:"/uilogout"}).then(function(){$window.location.reload();},function(){$window.location.reload();});}}})();